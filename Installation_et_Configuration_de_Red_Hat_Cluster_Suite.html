<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>Installation et Configuration de Red Hat Cluster Suite - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Installation_et_Configuration_de_Red_Hat_Cluster_Suite","wgTitle":"Installation et Configuration de Red Hat Cluster Suite","wgCurRevisionId":10861,"wgRevisionId":10861,"wgArticleId":3335,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Installation_et_Configuration_de_Red_Hat_Cluster_Suite","wgRelevantArticleId":3335,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
.source-xml {line-height: normal;}
.source-xml li, .source-xml pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for xml
 * CSS class: source-xml, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.xml.source-xml .de1, .xml.source-xml .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.xml.source-xml  {font-family:monospace;}
.xml.source-xml .imp {font-weight: bold; color: red;}
.xml.source-xml li, .xml.source-xml .li1 {font-weight: normal; vertical-align:top;}
.xml.source-xml .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.xml.source-xml .li2 {font-weight: bold; vertical-align:top;}
.xml.source-xml .es0 {color: #000099; font-weight: bold;}
.xml.source-xml .br0 {color: #66cc66;}
.xml.source-xml .sy0 {color: #66cc66;}
.xml.source-xml .st0 {color: #ff0000;}
.xml.source-xml .nu0 {color: #cc66cc;}
.xml.source-xml .sc-1 {color: #808080; font-style: italic;}
.xml.source-xml .sc0 {color: #00bbdd;}
.xml.source-xml .sc1 {color: #ddbb00;}
.xml.source-xml .sc2 {color: #339933;}
.xml.source-xml .sc3 {color: #009900;}
.xml.source-xml .re0 {color: #000066;}
.xml.source-xml .re1 {color: #000000; font-weight: bold;}
.xml.source-xml .re2 {color: #000000; font-weight: bold;}
.xml.source-xml .ln-xtra, .xml.source-xml li.ln-xtra, .xml.source-xml div.ln-xtra {background-color: #ffc;}
.xml.source-xml span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
.source-bash {line-height: normal;}
.source-bash li, .source-bash pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for bash
 * CSS class: source-bash, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.bash.source-bash .de1, .bash.source-bash .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.bash.source-bash  {font-family:monospace;}
.bash.source-bash .imp {font-weight: bold; color: red;}
.bash.source-bash li, .bash.source-bash .li1 {font-weight: normal; vertical-align:top;}
.bash.source-bash .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.bash.source-bash .li2 {font-weight: bold; vertical-align:top;}
.bash.source-bash .kw1 {color: #000000; font-weight: bold;}
.bash.source-bash .kw2 {color: #c20cb9; font-weight: bold;}
.bash.source-bash .kw3 {color: #7a0874; font-weight: bold;}
.bash.source-bash .co0 {color: #666666; font-style: italic;}
.bash.source-bash .co1 {color: #800000;}
.bash.source-bash .co2 {color: #cc0000; font-style: italic;}
.bash.source-bash .co3 {color: #000000; font-weight: bold;}
.bash.source-bash .co4 {color: #666666;}
.bash.source-bash .es1 {color: #000099; font-weight: bold;}
.bash.source-bash .es2 {color: #007800;}
.bash.source-bash .es3 {color: #007800;}
.bash.source-bash .es4 {color: #007800;}
.bash.source-bash .es5 {color: #780078;}
.bash.source-bash .es_h {color: #000099; font-weight: bold;}
.bash.source-bash .br0 {color: #7a0874; font-weight: bold;}
.bash.source-bash .sy0 {color: #000000; font-weight: bold;}
.bash.source-bash .st0 {color: #ff0000;}
.bash.source-bash .st_h {color: #ff0000;}
.bash.source-bash .nu0 {color: #000000;}
.bash.source-bash .re0 {color: #007800;}
.bash.source-bash .re1 {color: #007800;}
.bash.source-bash .re2 {color: #007800;}
.bash.source-bash .re4 {color: #007800;}
.bash.source-bash .re5 {color: #660033;}
.bash.source-bash .ln-xtra, .bash.source-bash li.ln-xtra, .bash.source-bash div.ln-xtra {background-color: #ffc;}
.bash.source-bash span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Installation_et_Configuration_de_Red_Hat_Cluster_Suite skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Installation et Configuration de Red Hat Cluster Suite</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#mw-navigation">navigation</a>, 					<a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Pr.C3.A9requis"><span class="tocnumber">2</span> <span class="toctext">Prérequis</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#ACPI"><span class="tocnumber">2.1</span> <span class="toctext">ACPI</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Hostname"><span class="tocnumber">2.2</span> <span class="toctext">Hostname</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Bonding"><span class="tocnumber">2.3</span> <span class="toctext">Bonding</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Multipathing"><span class="tocnumber">2.4</span> <span class="toctext">Multipathing</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Firewall"><span class="tocnumber">2.5</span> <span class="toctext">Firewall</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Installation"><span class="tocnumber">3</span> <span class="toctext">Installation</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Cluster"><span class="tocnumber">3.1</span> <span class="toctext">Cluster</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Luci"><span class="tocnumber">3.2</span> <span class="toctext">Luci</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Clvmd"><span class="tocnumber">3.3</span> <span class="toctext">Clvmd</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#GFS2"><span class="tocnumber">3.4</span> <span class="toctext">GFS2</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Configuration"><span class="tocnumber">4</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-14"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Quorum"><span class="tocnumber">4.1</span> <span class="toctext">Quorum</span></a>
<ul>
<li class="toclevel-3 tocsection-15"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Expected_votes"><span class="tocnumber">4.1.1</span> <span class="toctext">Expected votes</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Qdisk"><span class="tocnumber">4.1.2</span> <span class="toctext">Qdisk</span></a>
<ul>
<li class="toclevel-4 tocsection-17"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Configuration_2"><span class="tocnumber">4.1.2.1</span> <span class="toctext">Configuration</span></a></li>
<li class="toclevel-4 tocsection-18"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Cr.C3.A9er_le_qdisk"><span class="tocnumber">4.1.2.2</span> <span class="toctext">Créer le qdisk</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-19"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#cman"><span class="tocnumber">4.1.3</span> <span class="toctext">cman</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-20"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Fencing"><span class="tocnumber">4.2</span> <span class="toctext">Fencing</span></a>
<ul>
<li class="toclevel-3 tocsection-21"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Stonith"><span class="tocnumber">4.2.1</span> <span class="toctext">Stonith</span></a></li>
<li class="toclevel-3 tocsection-22"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Fabric"><span class="tocnumber">4.2.2</span> <span class="toctext">Fabric</span></a></li>
<li class="toclevel-3 tocsection-23"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Fencing_sur_machines_virtuelles"><span class="tocnumber">4.2.3</span> <span class="toctext">Fencing sur machines virtuelles</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-24"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Failover_domains"><span class="tocnumber">4.3</span> <span class="toctext">Failover domains</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Exemple_de_fichier_de_configuration"><span class="tocnumber">4.4</span> <span class="toctext">Exemple de fichier de configuration</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Mettre_.C3.A0_jour_manuellement_la_configuration"><span class="tocnumber">4.5</span> <span class="toctext">Mettre à jour manuellement la configuration</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#cman_2"><span class="tocnumber">4.6</span> <span class="toctext">cman</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Gestion_des_services_cluster"><span class="tocnumber">4.7</span> <span class="toctext">Gestion des services cluster</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Emp.C3.AAcher_un_noeud_d.27int.C3.A9grer_le_cluster_au_reboot"><span class="tocnumber">4.8</span> <span class="toctext">Empêcher un noeud d'intégrer le cluster au reboot</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Extinction_du_cluster"><span class="tocnumber">4.9</span> <span class="toctext">Extinction du cluster</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-31"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Utilisation"><span class="tocnumber">5</span> <span class="toctext">Utilisation</span></a>
<ul>
<li class="toclevel-2 tocsection-32"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Luci_2"><span class="tocnumber">5.1</span> <span class="toctext">Luci</span></a>
<ul>
<li class="toclevel-3 tocsection-33"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Initialisation"><span class="tocnumber">5.1.1</span> <span class="toctext">Initialisation</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-34"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Cr.C3.A9ation_d.27un_cluster"><span class="tocnumber">5.2</span> <span class="toctext">Création d'un cluster</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Ajouter_des_nodes"><span class="tocnumber">5.3</span> <span class="toctext">Ajouter des nodes</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Fencing_2"><span class="tocnumber">5.4</span> <span class="toctext">Fencing</span></a>
<ul>
<li class="toclevel-3 tocsection-37"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Ajouter_du_fencing_pour_les_noeuds"><span class="tocnumber">5.4.1</span> <span class="toctext">Ajouter du fencing pour les noeuds</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-38"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Cr.C3.A9er_un_service"><span class="tocnumber">5.5</span> <span class="toctext">Créer un service</span></a>
<ul>
<li class="toclevel-3 tocsection-39"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#NFS"><span class="tocnumber">5.5.1</span> <span class="toctext">NFS</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-40"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#rgmanager"><span class="tocnumber">5.6</span> <span class="toctext">rgmanager</span></a></li>
<li class="toclevel-2 tocsection-41"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Gestion_des_services.2FRG"><span class="tocnumber">5.7</span> <span class="toctext">Gestion des services/RG</span></a></li>
<li class="toclevel-2 tocsection-42"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Resources_Recovery"><span class="tocnumber">5.8</span> <span class="toctext">Resources Recovery</span></a>
<ul>
<li class="toclevel-3 tocsection-43"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Check_Status"><span class="tocnumber">5.8.1</span> <span class="toctext">Check Status</span></a></li>
<li class="toclevel-3 tocsection-44"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Custom_scripts"><span class="tocnumber">5.8.2</span> <span class="toctext">Custom scripts</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-45"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Monitoring"><span class="tocnumber">6</span> <span class="toctext">Monitoring</span></a>
<ul>
<li class="toclevel-2 tocsection-46"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Clustat"><span class="tocnumber">6.1</span> <span class="toctext">Clustat</span></a></li>
<li class="toclevel-2 tocsection-47"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#SNMP"><span class="tocnumber">6.2</span> <span class="toctext">SNMP</span></a>
<ul>
<li class="toclevel-3 tocsection-48"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Installation_2"><span class="tocnumber">6.2.1</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-3 tocsection-49"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Configuration_3"><span class="tocnumber">6.2.2</span> <span class="toctext">Configuration</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-50"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#FAQ"><span class="tocnumber">7</span> <span class="toctext">FAQ</span></a>
<ul>
<li class="toclevel-2 tocsection-51"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Logs"><span class="tocnumber">7.1</span> <span class="toctext">Logs</span></a></li>
<li class="toclevel-2 tocsection-52"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Erreurs_fr.C3.A9quentes"><span class="tocnumber">7.2</span> <span class="toctext">Erreurs fréquentes</span></a></li>
<li class="toclevel-2 tocsection-53"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Starting_cman..._Can.27t_determine_address_family_of_nodename"><span class="tocnumber">7.3</span> <span class="toctext">Starting cman... Can't determine address family of nodename</span></a></li>
<li class="toclevel-2 tocsection-54"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Error_locking_on_node"><span class="tocnumber">7.4</span> <span class="toctext">Error locking on node</span></a></li>
<li class="toclevel-2 tocsection-55"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Cluster_is_not_quorate._Refusing_connection"><span class="tocnumber">7.5</span> <span class="toctext">Cluster is not quorate.  Refusing connection</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-56"><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Ressources"><span class="tocnumber">8</span> <span class="toctext">Ressources</span></a></li>
</ul>
</div>

<table class="config_array" align="right" style="width:20em; font-size:90%; text-align:left; border: 1px #d0e7ff solid; margin-left:10px;">
   <tr>
      <td class="config_subarray" colspan="2" style="text-align:center;"><a href="./File:Red_hat_logo.png.html" class="image" title="Red Hat Cluster Suite"><img alt="Red Hat Cluster Suite" src="images/c/cb/Red_hat_logo.png" width="220" height="72" /></a></td>
   </tr><tr><td colspan="2" style="text-align:center;"><hr class="gradient" /></td></tr><tr>
      <th>Software version</th>
      <td>5/6</td>
   </tr><tr>
      <th>Operating System</th>
      <td>RHEL 5/6</td>
   </tr><tr>
      <th>Website</th>
      <td><a rel="nofollow" class="external text" href="http://www.redhat.com">Red Hat Website</a></td>
   </tr><tr>
      <th>Last Update</th>
      <td>14/05/2012</td>
   </tr><tr>
      <th>Others</th>
      <td></td>
   </tr>
</table>
<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p>Red Hat propose un cluster qui s’appuie sur des solutions Open Source. Nous allons voir ici comment en mettre un en place.
</p><p>Voici dans un premier temps le type d'infrastructure que vous devez avoir en place pour pouvoir installer et configurer un cluster&#160;:
</p><p><a href="./File:Cluster_archi_rhel.png.html" class="image"><img alt="Cluster archi rhel.png" src="images/3/39/Cluster_archi_rhel.png" width="949" height="577" /></a>
</p><p>Red Hat cluster suite fonctionne avec un nombre maximum de 16 nodes dans un cluster.
</p><p>Voici la liste des services que nous allons aborder avec leur description&#160;:
</p>
<table class="wikitable sortable" border="0">
<tr>
<th>Service
</th>
<th>Description
</th></tr>
<tr>
<td align="center">ccsd
</td>
<td align="left">Service de configuration du cluster
</td></tr>
<tr>
<td align="center">aisexec
</td>
<td align="left">Framework bas niveau pour le managment du cluster (OpenAIS) pour Red Hat 5
</td></tr>
<tr>
<td align="center">corosync
</td>
<td align="left">Framework bas niveau pour le managment du cluster (Corosync) pour Red Hat 6
</td></tr>
<tr>
<td align="center">cman
</td>
<td align="left">Cluster manager
</td></tr>
<tr>
<td align="center">fenced
</td>
<td align="left">C'est le fencing qui va permettre de redémarrer une machine à distance
</td></tr>
<tr>
<td align="center">DLM
</td>
<td align="left">Système de lock
</td></tr>
<tr>
<td align="center">clvmd
</td>
<td align="left">LVM version cluster
</td></tr>
<tr>
<td align="center">rgmanager
</td>
<td align="left">Ressources Groups Manager
</td></tr>
<tr>
<td align="center">GFS2
</td>
<td align="left">filesystem cluster
</td></tr>
<tr>
<td align="center">ricci
</td>
<td align="left">Service de gestion à distance du cluster
</td></tr>
<tr>
<td align="center">lucci
</td>
<td align="left">Frontend web se connectant à ricci pour la prise en main à distance du cluster
</td></tr></table>
<p>Sur Red Hat 5 et Red Hat 6, vous l'aurez compris, ce n'est pas le même Framework qui est utilisé, mais c'est transparent pour nous.
</p>
<h1><span class="mw-headline" id="Pr.C3.A9requis"><span class="mw-headline-number">2</span> Prérequis</span></h1>
<ul><li> Il faut des interfaces dédiées pour le cluster.<br /></li>
<li> Il faut que les switchs soient capable de faire du multicasting sur les interfaces privées.<br /></li>
<li> Faites du bonding sur vos cartes réseaux.</li>
<li> Mettez autant de redondance que possible.</li></ul>
<h2><span class="mw-headline" id="ACPI"><span class="mw-headline-number">2.1</span> ACPI</span></h2>
<p>Il faut tout d'abord arrêter l'ACPI pour éviter tout problèmes&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">chkconfig acpid off
service acpid stop</pre></div></div>
</td></tr></table><br />
<p>ou dans grub, ajoutez le paramètre acpi à off&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /boot/grub/grub.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">title Red Hat Enterprise Linux (2.6.32-220.el6.x86_64)
	root (hd0,0)
<span class="xtra ln-xtra">	kernel /vmlinuz-2.6.32-220.el6.x86_64 ro root=/dev/mapper/myvg-rootvol rd_NO_LUKS  KEYBOARDTYPE=pc KEYTABLE=fr LANG=en_US.UTF-8 rd_NO_MD quiet SYSFONT=latarcyrheb-sun16 rhgb crashkernel=auto rd_LVM_LV=myvg/rootvol rd_NO_DM acpi=off</span>	initrd /initramfs-2.6.32-220.el6.x86_64.img</pre></div></div>
</td></tr></table><br />
<p>Au choix, faites ce qui vous parait le plus simple.
</p>
<h2><span class="mw-headline" id="Hostname"><span class="mw-headline-number">2.2</span> Hostname</span></h2>
<p><b>Il est obligatoire</b> que le hostname soit correctement configuré sur tous les noeuds&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> hostname</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; hostname
node1.deimos.fr</pre></div></div>
</td></tr></table><br />
<p>Si ce n'est pas le cas, modifiez la ligne du fichier suivant&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/sysconfig/network</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">HOSTNAME=node1.deimos.fr</pre></div></div>
</td></tr></table><br />
<p>De même, vérifiez que tous les noeuds sont joignables par leurs DNS, ou bien renseignez les en le fichier hosts&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/hosts</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
&#160;
# Private interfaces
10.102.2.72     node1
10.102.2.73     node2
10.102.2.74     node3
&#160;
# Public interfaces
192.168.0.1     server1
192.168.0.2     server2
192.168.0.3     server3</pre></div></div>
</td></tr></table><br />
<p>Les interfaces privées seront utilisées (node1, node2 et node3) <b>pour la partie heartbeat et donc dédiée cluster</b>. Les interfaces publiques doivent être utilisées pour le reste (connexions directe, VIP...). Donc <b>lorsque vous configurez votre cluster, utilisez les interfaces privées</b> pour sa création.
</p>
<h2><span class="mw-headline" id="Bonding"><span class="mw-headline-number">2.3</span> Bonding</span></h2>
<p><b>IMPORTANT&#160;: Le bonding des interfaces privées (heartbeat cluster) ne peut être configuré qu'en mode 1&#160;! Seul ce mode est accepté.</b>
</p><p>Si vous êtes sur RHEL 6, dans le fichier /etc/modprobe.d/bonding.conf, on créer la ligne suivante&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/modprobe.d/bonding.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">alias bond0 bonding</pre></div></div>
</td></tr></table><br />
<p>Si vous êtes sur RHEL &lt;6, ce sera dans le fichier /etc/modprobes.conf qu'il faudra insérer ce même contenu.
</p><p>Dans /etc/sysconfig/network-script/, créer le fichier ifcfg-bond0 pour y inscrire la configuration du bonding&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/sysconfig/network-scripts/ifcfg-bond0</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">DEVICE=bond0
IPADDR=192.168.0.104
NETMASK=255.255.255.0
GATEWAY=192.168.0.1
ONBOOT=yes
BOOTPROTO=static
BONDING_OPTS=&quot;mode 1&quot;</pre></div></div>
</td></tr></table><br />
<p>Puis nous allons passer sur nos interfaces réseaux pour leurs dire qu'elles vont être utilisées pour faire du bonding&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/sysconfig/network-scripts/ifcfg-eth0</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">DEVICE=eth0
MASTER=bond0
ONBOOT=yes
SLAVE=yes
BOOTPROTO=static</pre></div></div>
</td></tr></table><br />
<p>Faites pareil pour l'interface 1&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/sysconfig/network-scripts/ifcfg-eth1</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">DEVICE=eth1
MASTER=bond0
ONBOOT=yes
SLAVE=yes
BOOTPROTO=static</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Multipathing"><span class="mw-headline-number">2.4</span> Multipathing</span></h2>
<p>Généralement, vous allez utiliser une baie de disques pour que les données puissent être accessibles depuis n'importe quelle machine. Pour celà, il va falloir utiliser du multipathing. <a href="./Multipath_:_configurer_plusieurs_chemins_pour_ses_accès_disques_externe.html" title="Multipath : configurer plusieurs chemins pour ses accès disques externe">Suivez cette documentation pour le mettre en place</a>.
</p>
<h2><span class="mw-headline" id="Firewall"><span class="mw-headline-number">2.5</span> Firewall</span></h2>
<p>Dans le cas ou vous utilisez un firewall pour la partie interconnection de vos noeuds, voici la liste des ports&#160;:
</p>
<table class="wikitable sortable" border="0">
<tr>
<th>Service name
</th>
<th>Port/Protocol
</th></tr>
<tr>
<td align="left">cman
</td>
<td align="center">5404/udp, 5405/udp
</td></tr>
<tr>
<td align="left">ricci
</td>
<td align="center">11111/tcp
</td></tr>
<tr>
<td align="left">gnbd
</td>
<td align="center">14567/tcp
</td></tr>
<tr>
<td align="left">modclusterd
</td>
<td align="center">16851/tcp
</td></tr>
<tr>
<td align="left">dlm
</td>
<td align="center">21064/tcp
</td></tr>
<tr>
<td align="left">ccsd
</td>
<td align="center">50006/tcp, 50007/udp, 50008/tcp, 50009/tcp
</td></tr></table>
<p><i>Note&#160;: il est fortement <b>déconseillé d'avoir un firewall software</b> sur cette partie là et fortement conseillé d'avoir un <b>switch dédié</b>&#160;!</i>
</p>
<h1><span class="mw-headline" id="Installation"><span class="mw-headline-number">3</span> Installation</span></h1>
<h2><span class="mw-headline" id="Cluster"><span class="mw-headline-number">3.1</span> Cluster</span></h2>
<p>Sur tous vos noeuds, installez cman et toutes vos dépendances s'installeront d'un coup&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> yum</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">yum install cman ricci openais cman ccs rgmanager lvm2-cluster gfs2-utils</pre></div></div>
</td></tr></table><br />
<p>N'installez que ce dont vous avez besoin évidemment, vous n'avez peut être pas besoin de gfs par exemple.
</p><p>Ensuite, mettez un mot de passe à ricci pour pouvoir nous y connecter plus tard&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">passwd ricci</pre></div></div>
</td></tr></table><br />
<p>Puis nous allons mettre en persistant les services nécessaires au bon fonctionnement du cluster&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">chkconfig cman on
chkconfig ricci on
chkconfig clvmd on
chkconfig gfs2 on
chkconfig rgmanager on
service cman start
service ricci start
service clvmd start
service gfs2 start
service rgmanager start</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Luci"><span class="mw-headline-number">3.2</span> Luci</span></h2>
<p>Côté client, utilisez de préférence une machine dédiée, il faudra installer luci&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">yum install luci
chkconfig luci on</pre></div></div>
</td></tr></table><br />
<p>L'idée est d'installer cette interface sur une machine déportée pour l'administration de notre cluster.
</p>
<h2><span class="mw-headline" id="Clvmd"><span class="mw-headline-number">3.3</span> Clvmd</span></h2>
<p>Clvmd est le service permettant d'avoir du LVM en cluster et donc d'avoir des noms de volumes identiques sur tous vos noeuds.
</p><p>Un quorum doit absolument être présent si l'on veut du Clvm. Pour activer cluster LVM, voici la commande à exécuter sur tous les noeuds&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lvmconf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lvmconf --enable-cluster</pre></div></div>
</td></tr></table><br />
<p>Sinon, éditez le fichier de configuration lvm pour modifier cette ligne&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/lvm/lvm.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">...
#locking_type = 1
locking_type = 3
...</pre></div></div>
</td></tr></table><br />
<p>Vous aurez peut être à regarder le paramètre "prefered_names" si vous utilisez du multipathing. Attention aux WWN, si vous les utilisez, vous devez paramétrer correctement ceci&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/lvm/lvm.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">...
    # If several entries in the scanned directories correspond to the
    # same block device and the tools need to display a name for device,
    # all the pathnames are matched against each item in the following
    # list of regular expressions in turn and the first match is used.
    # preferred_names = [ ]
&#160;
    # Try to avoid using undescriptive /dev/dm-N names, if present.
    preferred_names = [ &quot;^/dev/mpath/&quot;, &quot;^/dev/mapper/mpath&quot;, &quot;^/dev/[hs]d&quot; ]
...</pre></div></div>
</td></tr></table><br />
<p>Puis redémarrez et mettez le service en persitance&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> clvmd</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">chkconfig clvmd on
service clvmd restart</pre></div></div>
</td></tr></table><br />
<p>Ensuite vous pouvez créer des volumes LVM comme d'habitude. Si vous n'êtes pas très habitué à LVM, <a href="./LVM_:_Utilisation_des_LVM.html" title="LVM : Utilisation des LVM">regardez cette documentation</a>.
</p><p>Vous pouvez vérifier le status de cette manière&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> service</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; service clvmd status
clvmd (pid  16802) is running...
Clustered Volume Groups: (none)
Active clustered Logical Volumes: (none)</pre></div></div>
</td></tr></table><br />
<p>Nous allons rapidement créer un volume sur un node et vous pourrez vérifier qu'il s'affiche partout. Dans cet exemple, le multipath n'est pas utilisé. Nous allons donc créer une partition et lui mettre un tag de type LVM. Sur tous les nodes, rafraichissez la table des partitions sur le disque ou la nouvelle partition vient d'être créer&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> partprobe</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">partprobe /dev/sdb</pre></div></div>
</td></tr></table><br />
<p>Une fois fait, vérifiez sur tous vos noeuds&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> fdisk</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; fdisk -cul /dev/sdb
Périphérique Amorce  Début        Fin      Blocs     Id  Système
<span class="xtra ln-xtra">/dev/sdb1            2048     8386181     4192067   8e  Linux LVM</span></pre></div></div>
</td></tr></table><br />
<p>Maintenant, nous allons créer le volume&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; pvcreate /dev/sdb1
  Writing physical volume data to disk &quot;/dev/sdb1&quot;
  Physical volume &quot;/dev/sdb1&quot; successfully created
&gt; vgcreate shared_vg /dev/sdb1 
  Clustered volume group &quot;shared_vg&quot; successfully created
&gt; lvcreate -n shared_lv1 -L 256M shared_vg
&gt; mkfs.ext4 /dev/shared_vg/shared_lv1</pre></div></div>
</td></tr></table><br />
<p>Notre volume est maintenant disponible sur tous les nodes. <b>Attention&#160;: ceci ne veut pas dire que vous allez pouvoir écrire simultanément dessus</b>. Pour faire ce genre d'opérations, il va falloir utiliser <a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#GFS2">GFS2</a>.
</p>
<h2><span class="mw-headline" id="GFS2"><span class="mw-headline-number">3.4</span> GFS2</span></h2>
<p>Dans le cas ou vous avez besoin d'avoir un filesystem partagé à travers tous les noeuds, il vous faudra <a href="./GFS2_:_Le_Filesystem_Cluster_de_Red_Hat.html" title="GFS2 : Le Filesystem Cluster de Red Hat">installer et utiliser GFS2</a>.
</p>
<h1><span class="mw-headline" id="Configuration"><span class="mw-headline-number">4</span> Configuration</span></h1>
<h2><span class="mw-headline" id="Quorum"><span class="mw-headline-number">4.1</span> Quorum</span></h2>
<p>Le Quorum est un élément important dans la conception d'un cluster de Haute Diponibilité. Il est obligatoire sur un cluster à noeud et facultatif au delà. Il doit être un élément commun aux noeuds (une partition d'une baie de disques par exemple) et celui ci est utilisé pour y déposer des locks afin de garantir le bon état générale du cluster.
</p><p><b>Pour éviter les situation de split brain, il faut que le poid soit au moins la moitié des noeuds + 1.</b>
</p>
<dl><dd>(expected_votes / 2) + 1</dd></dl>
<p>Par défaut 1 noeud a un poid de 1. L'"Expected votes" est le nombre de poid nécessaire pour que le cluster fonctionne normalement.<br />
On va jouer avec ce genre de choses quand il y a des dépendances d'applications vis à vis d'autres applications ne se trouvant pas sur les mêmes machines. Pour éviter d'avoir des problèmes, on augmentera le poid des noeuds des machines.
</p>
<h3><span class="mw-headline" id="Expected_votes"><span class="mw-headline-number">4.1.1</span> Expected votes</span></h3>
<p>Pour regarder le nombre de votes obligatoire pour que le cluster fonctionne correctement&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cman_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; cman_tool status | grep Expected
Expected votes: 2</pre></div></div>
</td></tr></table><br />
<p>Pour changer la valeur expected votes pour une opération de maintenance par exemple&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cman_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cman_tool -e 2</pre></div></div>
</td></tr></table><br />
<p>Pour voir le poid sur chaque noeuds&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ccs_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">ccs_tool lsnode</pre></div></div>
</td></tr></table><br />
<p>Pour modifier le poid sur un noeud donné&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cman_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cman_tool votes -v &lt;votes&gt;</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="Qdisk"><span class="mw-headline-number">4.1.2</span> Qdisk</span></h3>
<p>Le Quorum disk (qdisk) est nécessaire uniquement sur un cluster à 2 noeuds. Au delà, ce n'est pas nécessaire et surtout n'est pas recommandé&#160;!<br />
Qdisk est utilisé par cman et ccsd et doit être une partition/LUN, et en aucuns cas un volume logique.
</p>
<h4><span class="mw-headline" id="Configuration_2"><span class="mw-headline-number">4.1.2.1</span> Configuration</span></h4>
<p>Pour une bonne configuration, je vous invite à regarder ces liens&#160;:
</p>
<ul><li> <a rel="nofollow" class="external free" href="http://magazine.redhat.com/2007/12/19/enhancing-cluster-quorum-with-qdisk/">http://magazine.redhat.com/2007/12/19/enhancing-cluster-quorum-with-qdisk/</a></li>
<li> <a rel="nofollow" class="external free" href="https://access.redhat.com/knowledge/node/2881">https://access.redhat.com/knowledge/node/2881</a></li></ul>
<p>Il vous faut configurer correctement le heartbeat, les heuristics et configurer le quorum avec les bonnes options.
</p>
<h4><span class="mw-headline" id="Cr.C3.A9er_le_qdisk"><span class="mw-headline-number">4.1.2.2</span> Créer le qdisk</span></h4>
<p>Pour créer le quorum, vous devez avoir une partition unique et visible sur tous les noeuds&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ccs_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; mkqdisk -c /dev/sda2 -l label
mkqdisk v0.6.0
Writing new quorum disk label 'qdisk' to /dev/sda2.
WARNING: About to destroy all data on /dev/sda2; proceed [N/y]&#160;? y
Initializing status block for node 1...
Initializing status block for node 2...
Initializing status block for node 3...
Initializing status block for node 4...
Initializing status block for node 5...
Initializing status block for node 6...
Initializing status block for node 7...
Initializing status block for node 8...
Initializing status block for node 9...
Initializing status block for node 10...
Initializing status block for node 11...
Initializing status block for node 12...
Initializing status block for node 13...
Initializing status block for node 14...
Initializing status block for node 15...
Initializing status block for node 16...</pre></div></div>
</td></tr></table><br />
<ul><li> -c&#160;: la partition correstpondant au quorum</li>
<li> -l&#160;: le label créer pendant le fdisk</li></ul>
<p>Pour lister les quorum actifs&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ccs_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; mkqdisk -L
mkqdisk v0.6.0
/dev/disk/by-id/scsi-S_beaf11-part2:
/dev/disk/by-path/ip-172.17.101.254:3260-iscsi-iqn.2009-10.com.example.cluster1:iscsi-lun-1-part2:
/dev/sda2:
        Magic:                eb7a62c2
        Label:                qdisk
        Created:              Wed Feb 29 16:27:13 2012
        Host:                 node1.deimos.fr
        Kernel Sector Size:   512
        Recorded Sector Size: 512</pre></div></div>
</td></tr></table><br />
<p>On va démarrer le service et le mettre en persistant&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> chkconfig</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">chkconfig qdiskd on
service qdiskd start</pre></div></div>
</td></tr></table><br />
<p>Puis il va falloir redémarrer le cluster pour que le quorum soit pris en compte.
</p>
<h3><span class="mw-headline" id="cman"><span class="mw-headline-number">4.1.3</span> cman</span></h3>
<p>On peut paramétrer CMAN lorsqu'on a un cluster à 2 noeuds pour qu'il n'utilise pas le quorum&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/cluster/cluster.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="xml source-xml"><pre class="de1"><span class="sc3"><span class="re1">&lt;cman</span> <span class="re0">expected_votes</span>=<span class="st0">&quot;1&quot;</span> <span class="re0">two_node</span>=<span class="st0">&quot;1&quot;</span> <span class="re2">/&gt;</span></span></pre></div></div>
</td></tr></table><br />
<p>Il y aura donc une course au fencing, à celui qui fera rebooter l'autre le premier. Tout cela pouer éviter les splitbrains.
</p>
<h2><span class="mw-headline" id="Fencing"><span class="mw-headline-number">4.2</span> Fencing</span></h2>
<p>Le fencing est obligatoire, car un noeud problématique peut faire de la corruption de données sur les partitions montés. Il est donc préférable que les autres noeuds fencent (oui le verbe&#160;;-)), le noeud qui peut poser problèmes.<br />
Pour celà il va y avoir un démon fenced gérer par cman. Les agents fenced sont stockés dans /sbin/fence_*.
</p><p>On peut tester notre configuration de fencing&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> fence_node</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">fence_node node2.deimos.fr</pre></div></div>
</td></tr></table><br />
<p>Il lit donc la configuration avec ccs et utilise le bon agent pour fencer le noeud en question.
</p><p>Il existe 2 méthodes de fencing&#160;:
</p>
<ul><li> STONITH (Shoot The Other Node In The Head)&#160;: pour faire l'équivalent d'une coupure électrique</li>
<li> Fabric&#160;: au niveau d'un switch ou d'un équipement type baie de disques</li></ul>
<h3><span class="mw-headline" id="Stonith"><span class="mw-headline-number">4.2.1</span> Stonith</span></h3>
<p>Voici un exemple avec une ILO d'HP, pour fencer une machine&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> fence_scsi_test</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">/sbin/fence_ilo -a &lt;ip&gt; -l &lt;login&gt; -p &lt;password&gt; -v -o reboot</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="Fabric"><span class="mw-headline-number">4.2.2</span> Fabric</span></h3>
<p>Pour le scsi, il y a un service "scsi_reserve" qui permet de générer une clef unique et de créer des enregistrements pour chaque machines. N'importe quel noeud peut donc supprimer l'enregistrement qui a été fait pour empêcher une machine problématique de pouvoir continuer à écrire sur les périphériques scsi.
</p><p>On peut voir s'il est possible de le faire ou non (ici non car j'utilise du iscsi qui ne le supporte pas)&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> fence_scsi_test</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">fence_scsi_test -c
&#160;
Testing devices in cluster volumes...
DEBUG: pv_name = /dev/sda1
&#160;
Attempted to register with devices:
-------------------------------------
<span class="xtra ln-xtra">        /dev/sda1       Failure</span>-------------------------------------
Number of devices tested: 1
Number of devices passed: 0
Number of devices failed: 1</pre></div></div>
</td></tr></table><br />
<p><br />
</p>
<h3><span class="mw-headline" id="Fencing_sur_machines_virtuelles"><span class="mw-headline-number">4.2.3</span> Fencing sur machines virtuelles</span></h3>
<p>Dans le cas ou votre fencing ne se fait pas via des RAC (Remote Access Card), et que vous utilisez par exemple du Xen ou du KVM, il faudra alors avoir recours à un fencing software en appelant directement l'hyperviseur à shooter un noeud. Nous allons donc voir ici comment procéder.
</p><p>On installe cman sur la machine host si vos noeuds cluster sont sur une machine virtuelle&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> yum</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">yum install cman</pre></div></div>
</td></tr></table><br />
<p>Et on copie le contenu d'un de mes noeuds /etc/cluster/* sur ma machine luci&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> scp</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">scp node1.deimos.fr:/etc/cluster/fence_xvm.key /etc/cluster/</pre></div></div>
</td></tr></table><br />
<p>Dans le cas ou cette clef n'existe pas, vous avez moyen de la recréer de cette façon&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> scp</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">dd if=/dev/urandom of=/etc/cluster/fence-xvm.key bs=4k count=1</pre></div></div>
</td></tr></table><br />
<p>Puis copiez là comme expliqué plus haut.
</p><p>On a ensuite "Shared fence devices" qui apparait dans l'interface. Maintenant, on clique sur add et on choisis le virtuel&#160;:
</p><p>Puis on configure la "Main Fencing Method" pour chaque noeud (dans domain).
</p><p>Failover domains permet de mettre un groupe de machines à une application donnée pour qu'une application ne puisse démarrer que sur un de ses groupes de machines.
</p><p>Si vous utilisez Xen et souhaitez pouvoir rebooter une VM, il va falloir ajouter ceci&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/rc.local</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">/sbin/fence_xvmd -L -I &lt;cluster_interface&gt;</pre></div></div>
</td></tr></table><br />
<ul><li> -L&#160;: écoute sur le réseau et les noeuds, mais n'est pas membre des clusters</li>
<li> -I &lt;cluster_interface&gt;&#160;: mettez le nom de l'interface réseau correspondant au cluster</li></ul>
<h2><span class="mw-headline" id="Failover_domains"><span class="mw-headline-number">4.3</span> Failover domains</span></h2>
<p>Permet de créer des groupes de noeuds sur lesquels des services seront autorisés à basculer.
</p>
<h2><span class="mw-headline" id="Exemple_de_fichier_de_configuration"><span class="mw-headline-number">4.4</span> Exemple de fichier de configuration</span></h2>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/cluster/cluster.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="xml source-xml"><pre class="de1"><span class="sc3"><span class="re1">&lt;?xml</span> <span class="re0">version</span>=<span class="st0">&quot;1.0&quot;</span><span class="re2">?&gt;</span></span>
<span class="sc3"><span class="re1">&lt;cluster</span> <span class="re0">alias</span>=<span class="st0">&quot;cluster1&quot;</span> <span class="re0">config_version</span>=<span class="st0">&quot;16&quot;</span> <span class="re0">name</span>=<span class="st0">&quot;cluster1&quot;</span><span class="re2">&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;fence_daemon</span> <span class="re0">clean_start</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">post_fail_delay</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">post_join_delay</span>=<span class="st0">&quot;3&quot;</span><span class="re2">/&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;clusternodes<span class="re2">&gt;</span></span></span>
                <span class="sc3"><span class="re1">&lt;clusternode</span> <span class="re0">name</span>=<span class="st0">&quot;node2.deimos.fr&quot;</span> <span class="re0">nodeid</span>=<span class="st0">&quot;1&quot;</span> <span class="re0">votes</span>=<span class="st0">&quot;1&quot;</span><span class="re2">&gt;</span></span>
                        <span class="sc3"><span class="re1">&lt;fence<span class="re2">&gt;</span></span></span>
                                <span class="sc3"><span class="re1">&lt;method</span> <span class="re0">name</span>=<span class="st0">&quot;1&quot;</span><span class="re2">&gt;</span></span>
                                        <span class="sc3"><span class="re1">&lt;device</span> <span class="re0">domain</span>=<span class="st0">&quot;xm destroy node1.cluster2.example.com&quot;</span> <span class="re0">name</span>=<span class="st0">&quot;xenfence1&quot;</span><span class="re2">/&gt;</span></span>
                                <span class="sc3"><span class="re1">&lt;/method<span class="re2">&gt;</span></span></span>
                        <span class="sc3"><span class="re1">&lt;/fence<span class="re2">&gt;</span></span></span>
                <span class="sc3"><span class="re1">&lt;/clusternode<span class="re2">&gt;</span></span></span>
                <span class="sc3"><span class="re1">&lt;clusternode</span> <span class="re0">name</span>=<span class="st0">&quot;node1.deimos.fr&quot;</span> <span class="re0">nodeid</span>=<span class="st0">&quot;2&quot;</span> <span class="re0">votes</span>=<span class="st0">&quot;1&quot;</span><span class="re2">&gt;</span></span>
                        <span class="sc3"><span class="re1">&lt;fence<span class="re2">&gt;</span></span></span>
                                <span class="sc3"><span class="re1">&lt;method</span> <span class="re0">name</span>=<span class="st0">&quot;1&quot;</span><span class="re2">&gt;</span></span>
                                        <span class="sc3"><span class="re1">&lt;device</span> <span class="re0">domain</span>=<span class="st0">&quot;xm destroy node1.deimos.fr&quot;</span> <span class="re0">name</span>=<span class="st0">&quot;xenfence1&quot;</span><span class="re2">/&gt;</span></span>
                                <span class="sc3"><span class="re1">&lt;/method<span class="re2">&gt;</span></span></span>
                        <span class="sc3"><span class="re1">&lt;/fence<span class="re2">&gt;</span></span></span>
                <span class="sc3"><span class="re1">&lt;/clusternode<span class="re2">&gt;</span></span></span>
        <span class="sc3"><span class="re1">&lt;/clusternodes<span class="re2">&gt;</span></span></span>
        <span class="sc3"><span class="re1">&lt;cman</span> <span class="re0">expected_votes</span>=<span class="st0">&quot;1&quot;</span> <span class="re0">two_node</span>=<span class="st0">&quot;1&quot;</span><span class="re2">/&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;fencedevices<span class="re2">&gt;</span></span></span>
                <span class="sc3"><span class="re1">&lt;fencedevice</span> <span class="re0">agent</span>=<span class="st0">&quot;fence_xvm&quot;</span> <span class="re0">name</span>=<span class="st0">&quot;xenfence1&quot;</span><span class="re2">/&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;/fencedevices<span class="re2">&gt;</span></span></span>
        <span class="sc3"><span class="re1">&lt;rm<span class="re2">&gt;</span></span></span>
                <span class="sc3"><span class="re1">&lt;failoverdomains<span class="re2">&gt;</span></span></span>
                        <span class="sc3"><span class="re1">&lt;failoverdomain</span> <span class="re0">name</span>=<span class="st0">&quot;prefer_node1&quot;</span> <span class="re0">nofailback</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">ordered</span>=<span class="st0">&quot;1&quot;</span> <span class="re0">restricted</span>=<span class="st0">&quot;1&quot;</span><span class="re2">&gt;</span></span>
                                <span class="sc3"><span class="re1">&lt;failoverdomainnode</span> <span class="re0">name</span>=<span class="st0">&quot;node2.deimos.fr&quot;</span> <span class="re0">priority</span>=<span class="st0">&quot;2&quot;</span><span class="re2">/&gt;</span></span>
                                <span class="sc3"><span class="re1">&lt;failoverdomainnode</span> <span class="re0">name</span>=<span class="st0">&quot;node1.deimos.fr&quot;</span> <span class="re0">priority</span>=<span class="st0">&quot;1&quot;</span><span class="re2">/&gt;</span></span>
                        <span class="sc3"><span class="re1">&lt;/failoverdomain<span class="re2">&gt;</span></span></span>
                <span class="sc3"><span class="re1">&lt;/failoverdomains<span class="re2">&gt;</span></span></span>
                <span class="sc3"><span class="re1">&lt;resources<span class="re2">&gt;</span></span></span>
                        <span class="sc3"><span class="re1">&lt;ip</span> <span class="re0">address</span>=<span class="st0">&quot;172.16.50.16&quot;</span> <span class="re0">monitor_link</span>=<span class="st0">&quot;1&quot;</span><span class="re2">/&gt;</span></span>
                        <span class="sc3"><span class="re1">&lt;apache</span> <span class="re0">config_file</span>=<span class="st0">&quot;conf/httpd.conf&quot;</span> <span class="re0">name</span>=<span class="st0">&quot;httpd&quot;</span> <span class="re0">server_root</span>=<span class="st0">&quot;/etc/httpd&quot;</span> <span class="re0">shutdown_wait</span>=<span class="st0">&quot;5&quot;</span><span class="re2">/&gt;</span></span>
                        <span class="sc3"><span class="re1">&lt;clusterfs</span> <span class="re0">device</span>=<span class="st0">&quot;/dev/mapper/gfslv-webfs&quot;</span> <span class="re0">force_unmount</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">fsid</span>=<span class="st0">&quot;45506&quot;</span> <span class="re0">fstype</span>=<span class="st0">&quot;gfs2&quot;</span> <span class="re0">mountpoint</span>=<span class="st0">&quot;/var/www/html&quot;</span> <span class="re0">name</span>=<span class="st0">&quot;gfs_www&quot;</span> <span class="re0">self_fence</span>=<span class="st0">&quot;0&quot;</span><span class="re2">/&gt;</span></span>
                <span class="sc3"><span class="re1">&lt;/resources<span class="re2">&gt;</span></span></span>
                <span class="sc3"><span class="re1">&lt;service</span> <span class="re0">autostart</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">domain</span>=<span class="st0">&quot;prefer_node1&quot;</span> <span class="re0">exclusive</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">name</span>=<span class="st0">&quot;webby&quot;</span> <span class="re0">recovery</span>=<span class="st0">&quot;relocate&quot;</span><span class="re2">&gt;</span></span>
                        <span class="sc3"><span class="re1">&lt;ip</span> <span class="re0">ref</span>=<span class="st0">&quot;172.16.50.16&quot;</span><span class="re2">/&gt;</span></span>
                        <span class="sc3"><span class="re1">&lt;clusterfs</span> <span class="re0">ref</span>=<span class="st0">&quot;gfs_www&quot;</span><span class="re2">&gt;</span></span>
                                <span class="sc3"><span class="re1">&lt;apache</span> <span class="re0">ref</span>=<span class="st0">&quot;httpd&quot;</span><span class="re2">/&gt;</span></span>
                        <span class="sc3"><span class="re1">&lt;/clusterfs<span class="re2">&gt;</span></span></span>
                <span class="sc3"><span class="re1">&lt;/service<span class="re2">&gt;</span></span></span>
        <span class="sc3"><span class="re1">&lt;/rm<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/cluster<span class="re2">&gt;</span></span></span></pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Mettre_.C3.A0_jour_manuellement_la_configuration"><span class="mw-headline-number">4.5</span> Mettre à jour manuellement la configuration</span></h2>
<p>Vous pouvez toucher manuellement à la configuration du cluster&#160;:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">CLUSTER
   |__CMAN or GULM (RHEL4 only)
   |             |__LOCKSERVER (Only for GULM; 1,3,4 or 5 only)
   |
   |__FENCE_XVMD (RHEL5 option, used when hosting a virtual cluster)
   |
   |__CLUSTERNODES
   |         |_____CLUSTERNODE+
   |                     |______FENCE
   |                               |__METHOD+
   |                                      |___DEVICE+
   |
   |__FENCEDEVICES
   |        |______FENCEDEVICE+
   |
   |__RM (Resource Manager Block)
   |   |__FAILOVERDOMAINS
   |   |          |_______FAILOVERDOMAIN*
   |   |                         |________FAILOVERDOMAINNODE*
   |   |__RESOURCES
   |   |      |_____(See Resource List Below)
   |   |__SERVICE*
   |
   |__FENCE_DAEMON</pre></div></div>
<p>Puis une fois que vous êtes satisfait, changez la valeur de la version + 1&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/cluster/cluster.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="xml source-xml"><pre class="de1"><span class="sc3"><span class="re1">&lt;cluster</span> <span class="re0">alias</span>=<span class="st0">&quot;cluster1&quot;</span> <span class="re0">config_version</span>=<span class="st0">&quot;16&quot;</span> <span class="re0">name</span>=<span class="st0">&quot;cluster1&quot;</span><span class="re2">&gt;</span></span></pre></div></div>
</td></tr></table><br />
<p>Puis updatez cette configuration sur tous les noeuds&#160;:
</p>
<ul><li> Sous RHEL 5, mettez vous sur le noeud en question, puis&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ccs_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">ccs_tool update /etc/cluster/cluster.conf</pre></div></div>
</td></tr></table><br />
<ul><li> Sous RHEL 6&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ccs</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">ccs -h &lt;host&gt; -p &lt;password&gt; --sync --activate</pre></div></div>
</td></tr></table><br />
<ul><li> host&#160;: le noeud sur lequel l'action doit être faite</li>
<li> password&#160;: le mot de passe de ricci</li>
<li> --sync&#160;: synchroniser le fichier de configuration sur tous les neuds</li>
<li> --activate&#160;: activer la nouvelle configuration</li></ul>
<h2><span class="mw-headline" id="cman_2"><span class="mw-headline-number">4.6</span> cman</span></h2>
<p>Voir l'état du cluster&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cman_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; cman_tool status
Version: 6.2.0
Config Version: 14
Cluster Name: cluster1
Cluster Id: 26777
Cluster Member: Yes
Cluster Generation: 12
Membership state: Cluster-Member
Nodes: 3
Expected votes: 3
Total votes: 3
Quorum: 2  
Active subsystems: 9
Flags: Dirty 
Ports Bound: 0 11 177  
Node name: node1.deimos.fr
Node ID: 2
Multicast addresses: 239.192.104.2 
Node addresses: 10.0.0.1</pre></div></div>
</td></tr></table><br />
<p>Voir l'état des nodes&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cman_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cman_tool nodes</pre></div></div>
</td></tr></table><br />
<p>Voir l'état des services&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cman_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cman_tool services</pre></div></div>
</td></tr></table><br />
<p>Enregistrer un noeud dans le cluster&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cman_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cman_tool join</pre></div></div>
</td></tr></table><br />
<p>Pour sortir un noeud du cluster (aucuns services ne doit tourner sur ce noeud)&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cman_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cman_tool leave</pre></div></div>
</td></tr></table><br />
<p>On peut tester le fencing (reboot) sur une machine&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cman_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cman_tool kill -n node2.deimos.fr</pre></div></div>
</td></tr></table><br />
<p><br />
</p>
<h2><span class="mw-headline" id="Gestion_des_services_cluster"><span class="mw-headline-number">4.7</span> Gestion des services cluster</span></h2>
<p>Voici l'ordre d'allumage des services, donc si vous avez un problème, vérifiez ces services&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> service</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">service cman start
service qdiskd start
service clvmd start
service gfs start
service rgmanager start
service ricci start</pre></div></div>
</td></tr></table><br />
<p>Et inversement pour l'extinction.
</p><p>Voici un petit script qui permettra d'allumer que les services utiles en cas de boot non clusters ou problèmes&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> start_cluster.sh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1"><span class="co0">#!/bin/sh</span>
<span class="kw1">for</span> i <span class="kw1">in</span> cman qdiskd clvmd gfs rgmanager ricci&#160;; <span class="kw1">do</span>
   <span class="kw1">if</span> <span class="br0">&#91;</span> $<span class="br0">&#40;</span>chkconfig <span class="re5">--list</span> <span class="sy0">|</span> <span class="kw2">grep</span> <span class="re1">$i</span> <span class="sy0">|</span> <span class="kw2">grep</span> <span class="re5">-c</span> on<span class="br0">&#41;</span> <span class="re5">-ge</span> <span class="nu0">1</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
      service <span class="re1">$i</span> start
   <span class="kw1">fi</span>
<span class="kw1">done</span></pre></div></div>
</td></tr></table><br />
<p>Puis exécutez le.
</p>
<h2><span class="mw-headline" id="Emp.C3.AAcher_un_noeud_d.27int.C3.A9grer_le_cluster_au_reboot"><span class="mw-headline-number">4.8</span> Empêcher un noeud d'intégrer le cluster au reboot</span></h2>
<p>Il est possible d'empêhcer un noeud de réintégrer un cluster comme ceci&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1"><span class="kw1">for</span> i <span class="kw1">in</span> rgmanagers gfs clvmd qdiskq cman&#160;; <span class="kw1">do</span>
   chkconfig <span class="re5">--level</span> <span class="nu0">2345</span> <span class="re1">$i</span> off
<span class="kw1">done</span></pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Extinction_du_cluster"><span class="mw-headline-number">4.9</span> Extinction du cluster</span></h2>
<p>Faites attention si vous utilisez du GFS, pour éteindre complètement son cluster, il faut baisser la valeur "quorum expected" pour ne pas avoir de problèmes lorsque l'on éteint petit à petit ses noeuds. Sinon vous ne pourrez pas du tout démonter votre GFS&#160;!!!
</p>
<ul><li> Solution 1 (conseillée)&#160;:</li></ul>
<p>Par exemple, sur un cluster à 3 noeuds, votre quorum est à 3 par exemple, baissez votre quorum&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cman_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cman_tool expected 2</pre></div></div>
</td></tr></table><br />
<p>Couper un de vos noeuds, redescendez le quorum&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cman_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cman_tool expected 1</pre></div></div>
</td></tr></table><br />
<p>Puis vous pouvez tout démonter, puis éteindre vos noeuds.
</p>
<ul><li> Solution 2 (a éviter)&#160;:</li></ul>
<p>Vous pouvez lancer la commande suivante qui va sortir chaque noeud du cluster et donc on pourra correctement les éteindre, mais il y a un risque de splitbrain&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cman_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cman_tool leave remove</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Utilisation"><span class="mw-headline-number">5</span> Utilisation</span></h1>
<h2><span class="mw-headline" id="Luci_2"><span class="mw-headline-number">5.1</span> Luci</span></h2>
<h3><span class="mw-headline" id="Initialisation"><span class="mw-headline-number">5.1.1</span> Initialisation</span></h3>
<p>Si vous êtes sur Red Hat 5, nous allons devoir créer le premier utilisateur pour Luci&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> luci_admin</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; luci_admin init
Initializing the luci server
&#160;
&#160;
Creating the 'admin' user
&#160;
Enter password: 
Confirm password: 
&#160;
Please wait...
The admin password has been successfully set.
Generating SSL certificates... 
The luci server has been successfully initialized
&#160;
&#160;
You must restart the luci server for changes to take effect.
&#160;
Run &quot;service luci restart&quot; to do so</pre></div></div>
</td></tr></table><br />
<p>Puis démarrer le service&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> luci_admin</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">service luci restart</pre></div></div>
</td></tr></table><br />
<p>Puis logger vous <a rel="nofollow" class="external free" href="http://luci:8084">http://luci:8084</a>
</p>
<ul><li> Utilisez admin avec le mot de passe que vous venez d rentrer via la commande luci_admin si vous êtes sur RHEL 5</li>
<li> Si vous êtes sur RHEL 6, utilisez tout simplement le login et mot de passe root</li></ul>
<h2><span class="mw-headline" id="Cr.C3.A9ation_d.27un_cluster"><span class="mw-headline-number">5.2</span> Création d'un cluster</span></h2>
<p>Pour créer un cluster, mettez vous sur un des futurs noeuds et exécutez la commande suivante&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ccs</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">ccs -h &lt;node1&gt; --createcluster &lt;cluster&gt;</pre></div></div>
</td></tr></table><br />
<ul><li> node1&#160;: le nom du node sur lequel la configuration doit être créer (<b>utilisez le nom de l'interface privée</b>)</li>
<li> cluster&#160;: le nom du cluster (pas + de 15 caractères)</li>
<li> -f&#160;: vous pouvez spécifier le fichier de configuration si vous ne souhaitez pas que celui du cluster se fasse écraser</li></ul>
<h2><span class="mw-headline" id="Ajouter_des_nodes"><span class="mw-headline-number">5.3</span> Ajouter des nodes</span></h2>
<p>Pour ajouter des nodes dans un cluster&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ccs</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">ccs -h node1 --addnode node1
ccs -h node1 --addnode node2
ccs -h node1 --addnode node3</pre></div></div>
</td></tr></table><br />
<p>Ces lignes vont ajouter les nodes 1 à 3 à la configuration cluster sur node1.
</p><p>Pour vérifier la liste des nodes&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ccs</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; ccs -h node1 --lsnodes
node1: nodeid=1
node2: nodeid=2
node3: nodeid=3</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Fencing_2"><span class="mw-headline-number">5.4</span> Fencing</span></h2>
<p>Il nous faut ajouter obligatoirement une méthode de fencing pour pouvoir shooter un node en cas de problème, afin qu'il réintègre le plus rapidement possible le cluster et qu'il ne fasse pas de corruption de données sur les disques.
</p><p>Pour lister les méthodes de fencing disponible&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ccs</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; ccs -h node1 --lsfenceopts
fence_rps10 - RPS10 Serial Switch
fence_vixel - No description available
fence_egenera - No description available
fence_xcat - No description available
fence_na - Node Assassin
fence_apc - Fence agent for APC over telnet/ssh
fence_apc_snmp - Fence agent for APC over SNMP
fence_bladecenter - Fence agent for IBM BladeCenter
fence_bladecenter_snmp - Fence agent for IBM BladeCenter over SNMP
fence_cisco_mds - Fence agent for Cisco MDS
fence_cisco_ucs - Fence agent for Cisco UCS
fence_drac5 - Fence agent for Dell DRAC CMC/5
fence_eps - Fence agent for ePowerSwitch
fence_ibmblade - Fence agent for IBM BladeCenter over SNMP
fence_ifmib - Fence agent for IF MIB
fence_ilo - Fence agent for HP iLO
fence_ilo_mp - Fence agent for HP iLO MP
fence_intelmodular - Fence agent for Intel Modular
fence_ipmilan - Fence agent for IPMI over LAN
fence_kdump - Fence agent for use with kdump
fence_rhevm - Fence agent for RHEV-M REST API
fence_rsa - Fence agent for IBM RSA
fence_sanbox2 - Fence agent for QLogic SANBox2 FC switches
fence_scsi - fence agent for SCSI-3 persistent reservations
fence_virsh - Fence agent for virsh
fence_virt - Fence agent for virtual machines
fence_vmware - Fence agent for VMWare
fence_vmware_soap - Fence agent for VMWare over SOAP API
fence_wti - Fence agent for WTI
fence_xvm - Fence agent for virtual machines</pre></div></div>
</td></tr></table><br />
<p>Pour lister les options possibles sur une méthode de fencing&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ccs</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; ccs -h node1 --lsfenceopts fence_vmware_soap
 fence_vmware_soap - Fence agent for VMWare over SOAP API
  Required Options:
  Optional Options:
    option: No description available
    action: Fencing Action
    ipaddr: IP Address or Hostname
    login: Login Name
    passwd: Login password or passphrase
    passwd_script: Script to retrieve password
    ssl: SSL connection
    port: Physical plug number or name of virtual machine
    uuid: The UUID of the virtual machine to fence.
    ipport: TCP port to use for connection with device
    verbose: Verbose mode
    debug: Write debug information to given file
    version: Display version information and exit
    help: Display help and exit
    separator: Separator for CSV created by operation list
    power_timeout: Test X seconds for status change after ON/OFF
    shell_timeout: Wait X seconds for cmd prompt after issuing command
    login_timeout: Wait X seconds for cmd prompt after login
    power_wait: Wait X seconds after issuing ON/OFF
    delay: Wait X seconds before fencing is started
    retry_on: Count of attempts to retry power on</pre></div></div>
</td></tr></table><br />
<p>Voici comment ajouter une méthode de fencing pour Vmware&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ccs</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">ccs -h node1 --addfencedev &lt;vmware_fence&gt; agent=fence_vmware_soap ipaddr=&lt;vcenter.deimos.fr&gt; login=&lt;login&gt; password=&lt;password&gt;</pre></div></div>
</td></tr></table><br />
<ul><li> vmware_fence&#160;: nom que l'ont veut donner au fencing</li></ul>
<p>Pour Vmware, nous n'en avons besoin que d'un. Mais si vous avez des RAC, il faudra spécifier les informations pour chacune d'elles
</p><p>Si vous souhaitez en supprimer un&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">ccs -h node1 --rmfencedev &lt;vmware_fence&gt;</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="Ajouter_du_fencing_pour_les_noeuds"><span class="mw-headline-number">5.4.1</span> Ajouter du fencing pour les noeuds</span></h3>
<p>Au dessus, nous avons déclarer les méthodes de fencing. Maintenant, il va falloir les ajouter à chacun de nos noeuds&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ccs</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">ccs -h node1 --addmethod &lt;vmware_fence&gt; node1
ccs -h node1 --addfenceinst port=node1 ssl=on uuid=412921c1-c259-f9a4-0ee2-37cc047eb4ed
ccs -h node1 --addmethod &lt;vmware_fence&gt; node2
ccs -h node1 --addfenceinst port=node2 ssl=on uuid=422921c1-c259-f9a4-0ee2-37cc047eb4ed
ccs -h node1 --addmethod &lt;vmware_fence&gt; node3
ccs -h node1 --addfenceinst port=node3 ssl=on uuid=432921c1-c259-f9a4-0ee2-37cc047eb4ed</pre></div></div>
</td></tr></table><br />
<p><i>Note&#160;: Voilà une commande en powershell avec powercli pour récuperer les uuid des vms&#160;: </i>
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> Get-VM</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">Get-VM &lt;vm_name&gt; |&#160;%{(Get-View $_.Id).config.uuid}</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Cr.C3.A9er_un_service"><span class="mw-headline-number">5.5</span> Créer un service</span></h2>
<p>--&gt; création d'un service type
</p><p>Une fois notre service créer, il ne reste plus qu'à faire le clustat&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> clustat</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; clustat 
Cluster Status for cluster1 @ Tue Feb 29 13:50:09 2012
Member Status: Quorate
&#160;
 Member Name                                                     ID   Status
 ------ ----                                                     ---- ------
 node2.deimos.fr                                                 1 Online, rgmanager
 node1.deimos.fr                                                 2 Online, Local, rgmanager
&#160;
 Service Name                                                     Owner (Last)                                                     State         
 ------- ----                                                     ----- ------                                                     -----         
 service:apache                                                   node2.deimos.fr                                                  started</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="NFS"><span class="mw-headline-number">5.5.1</span> NFS</span></h3>
<p>Pour faire du cluster sur nfs, c'est un peu spéciale, il faut&#160;:
</p>
<ul><li> Un système de fichier</li>
<li> NFS export&#160;: monnfs</li>
<li> NFS client&#160;:
<ul><li> Name&#160;: monnfs</li>
<li> Target&#160;: les ip autorisés à se connecter</li>
<li> Options&#160;: ro/rw</li></ul></li></ul>
<p>En tant que dépendances, voici à qui ça doit ressembler&#160;:
</p>
<ul><li> FS
<ul><li> NFS Export
<ul><li> NFS Client</li></ul></li></ul></li></ul>
<h2><span class="mw-headline" id="rgmanager"><span class="mw-headline-number">5.6</span> rgmanager</span></h2>
<p>Les scripts cluster (ressources types) disponibles sont au format OCF (Open Cluster Framework) et les scripts sont disponible dans /usr/share/cluster/.
</p><p>Lorsque vous créez un service (Resource Group), vous pouvez créer plusieurs ressources et les associer ou créer des dépendances les unes envers les autres pour définir un ordre de démarrage.
Vous pouvez récupérer les information prédéfinies par rapport aux ressources types dans /usr/share/cluster/service.sh
</p>
<h2><span class="mw-headline" id="Gestion_des_services.2FRG"><span class="mw-headline-number">5.7</span> Gestion des services/RG</span></h2>
<p>Activer un service&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> clusvcadm</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">clusvcadm -e &lt;service&gt; -m &lt;node&gt;</pre></div></div>
</td></tr></table><br />
<p>Désactiver un service
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> clusvcadm</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">clusvcadm -d &lt;service&gt;</pre></div></div>
</td></tr></table><br />
<p>Relocaliser un service sur un autre noeud&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> clusvcadm</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">clusvcadm -r &lt;service&gt; -m &lt;node&gt;</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Resources_Recovery"><span class="mw-headline-number">5.8</span> Resources Recovery</span></h2>
<p>Par défaut il essaye de redémarrer le service sur le même noeud, mais il existe aussi&#160;:
</p>
<ul><li> relocate&#160;: il va essayer de le basculer sur un autre noeud</li>
<li> disable&#160;: ne tente aucune actions en cas de problèmes</li></ul>
<h3><span class="mw-headline" id="Check_Status"><span class="mw-headline-number">5.8.1</span> Check Status</span></h3>
<p>Le status doit être effectuer sur chaque ressources, qui est par défaut à 30 secondes. Il ne faut surtout pas descendre en dessous de 5s. Vous pouvez modifier toutes ses valeurs par défaut dans /usr/share/cluster/*.
</p><p>Les lignes à modifier ressemblent à&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /usr/share/cluster/script.sh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="xml source-xml"><pre class="de1">        <span class="sc3"><span class="re1">&lt;action</span> <span class="re0">name</span>=<span class="st0">&quot;status&quot;</span> <span class="re0">interval</span>=<span class="st0">&quot;30s&quot;</span> <span class="re0">timeout</span>=<span class="st0">&quot;0&quot;</span><span class="re2">/&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;action</span> <span class="re0">name</span>=<span class="st0">&quot;monitor&quot;</span> <span class="re0">interval</span>=<span class="st0">&quot;30s&quot;</span> <span class="re0">timeout</span>=<span class="st0">&quot;0&quot;</span><span class="re2">/&gt;</span></span></pre></div></div>
</td></tr></table><br />
<p>Vous pouvez changer l'interval de check et le timeout si vous en souhaitez un.
</p>
<h3><span class="mw-headline" id="Custom_scripts"><span class="mw-headline-number">5.8.2</span> Custom scripts</span></h3>
<p>Vous pouvez développer vos propre scripts, et ils doivent être obligatoirement capable de répondre à start, stop, restart et status. De plus il faut impérativement que les codes de retour soient gérés.
</p>
<h1><span class="mw-headline" id="Monitoring"><span class="mw-headline-number">6</span> Monitoring</span></h1>
<p>Vous pouvez monitorer de plusieurs façons&#160;:
</p>
<ul><li> Via la commande clustat</li>
<li> Via SNMP</li></ul>
<h2><span class="mw-headline" id="Clustat"><span class="mw-headline-number">6.1</span> Clustat</span></h2>
<p>Cette commande permet de montrer l'état du cluster&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> clustat</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; clustat 
Cluster Status for cluster1 @ Thu Mar  1 09:45:21 2012
Member Status: Quorate
&#160;
 Member Name                                                     ID   Status
 ------ ----                                                     ---- ------
 node2.deimos.fr                                                 1 Online, rgmanager
 node1.deimos.fr                                                 2 Online, Local, rgmanager
 node3.deimos.fr                                                 3 Online, rgmanager
&#160;
 Service Name                                                     Owner (Last)                                                     State         
 ------- ----                                                     ----- ------                                                     -----         
 service:websrv                                                   (none)</pre></div></div>
</td></tr></table><br />
<p>Et vous pouvez faire un export en xml&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> clustat</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="xml source-xml"><pre class="de1">&gt; clustat -x
&#160;
<span class="sc3"><span class="re1">&lt;?xml</span> <span class="re0">version</span>=<span class="st0">&quot;1.0&quot;</span><span class="re2">?&gt;</span></span>
<span class="sc3"><span class="re1">&lt;clustat</span> <span class="re0">version</span>=<span class="st0">&quot;4.1.1&quot;</span><span class="re2">&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;cluster</span> <span class="re0">name</span>=<span class="st0">&quot;cluster1&quot;</span> <span class="re0">id</span>=<span class="st0">&quot;26777&quot;</span> <span class="re0">generation</span>=<span class="st0">&quot;188&quot;</span><span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;quorum</span> <span class="re0">quorate</span>=<span class="st0">&quot;1&quot;</span> <span class="re0">groupmember</span>=<span class="st0">&quot;1&quot;</span><span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;nodes<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;node</span> <span class="re0">name</span>=<span class="st0">&quot;node2.deimos.fr&quot;</span> <span class="re0">state</span>=<span class="st0">&quot;1&quot;</span> <span class="re0">local</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">estranged</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">rgmanager</span>=<span class="st0">&quot;1&quot;</span> <span class="re0">rgmanager_master</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">qdisk</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">nodeid</span>=<span class="st0">&quot;0x00000001&quot;</span><span class="re2">/&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;node</span> <span class="re0">name</span>=<span class="st0">&quot;node1.deimos.fr&quot;</span> <span class="re0">state</span>=<span class="st0">&quot;1&quot;</span> <span class="re0">local</span>=<span class="st0">&quot;1&quot;</span> <span class="re0">estranged</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">rgmanager</span>=<span class="st0">&quot;1&quot;</span> <span class="re0">rgmanager_master</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">qdisk</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">nodeid</span>=<span class="st0">&quot;0x00000002&quot;</span><span class="re2">/&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;node</span> <span class="re0">name</span>=<span class="st0">&quot;node3.deimos.fr&quot;</span> <span class="re0">state</span>=<span class="st0">&quot;1&quot;</span> <span class="re0">local</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">estranged</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">rgmanager</span>=<span class="st0">&quot;1&quot;</span> <span class="re0">rgmanager_master</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">qdisk</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">nodeid</span>=<span class="st0">&quot;0x00000003&quot;</span><span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;/nodes<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;groups<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;group</span> <span class="re0">name</span>=<span class="st0">&quot;service:webby&quot;</span> <span class="re0">state</span>=<span class="st0">&quot;119&quot;</span> <span class="re0">state_str</span>=<span class="st0">&quot;disabled&quot;</span> <span class="re0">flags</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">flags_str</span>=<span class="st0">&quot;&quot;</span> <span class="re0">owner</span>=<span class="st0">&quot;none&quot;</span> <span class="re0">last_owner</span>=<span class="st0">&quot;none&quot;</span> <span class="re0">restarts</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">last_transition</span>=<span class="st0">&quot;0&quot;</span> <span class="re0">last_transition_str</span>=<span class="st0">&quot;Thu Jan  1 01:00:00 1970&quot;</span><span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;/groups<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/clustat<span class="re2">&gt;</span></span></span></pre></div></div>
</td></tr></table><br />
<p>Pour les états, voici les informations&#160;:
</p>
<ul><li> Started&#160;: le service est démarré</li>
<li> Pending&#160;: le service est en cours de démarrage</li>
<li> Disabled&#160;: le service est désactivé</li>
<li> Stopped&#160;: le service est temporairement arrêter</li>
<li> Failed&#160;: le service n'a pas pu démarrer correctement</li></ul>
<h2><span class="mw-headline" id="SNMP"><span class="mw-headline-number">6.2</span> SNMP</span></h2>
<h3><span class="mw-headline" id="Installation_2"><span class="mw-headline-number">6.2.1</span> Installation</span></h3>
<p>Vous pouvez interroger le cluster via SNMP. Il va falloir installer ceci sur les noeuds&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> yum</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">yum install cluster-snmp net-snmp</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="Configuration_3"><span class="mw-headline-number">6.2.2</span> Configuration</span></h3>
<p>Vous pouvez lire le fichier /usr/share/doc/cluster-snmp-0.12.1/README.snmpd qui contient les 2 lignes de configuration pour le SNMP&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /usr/share/doc/cluster-snmp-0.12.1/README.snmpd</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">...
######################################
## cluster monitoring configuration ##
######################################
&#160;
dlmod RedHatCluster     /usr/lib/cluster-snmp/libClusterMonitorSnmp.so
view    systemview      included        REDHAT-CLUSTER-MIB:RedHatCluster
...</pre></div></div>
</td></tr></table><br />
<p>Et rajoutez les dans votre fichier de configuration snmp&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/snmp/snmpd.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">dlmod RedHatCluster     /usr/lib/cluster-snmp/libClusterMonitorSnmp.so
view    systemview      included        REDHAT-CLUSTER-MIB:RedHatCluster</pre></div></div>
</td></tr></table><br />
<p>Redémarrer votre service snmpd. Maintenant nous allons pouvoir interroger le cluster (requiere net-snmp-utils pour le client)&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> snmpwalk</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; snmpwalk -v1 -c public localhost REDHAT-CLUSTER-MIB:RedHatCluster
REDHAT-CLUSTER-MIB::rhcMIBVersion.0 = INTEGER: 1
REDHAT-CLUSTER-MIB::rhcClusterName.0 = STRING: &quot;cluster1&quot;
REDHAT-CLUSTER-MIB::rhcClusterStatusCode.0 = INTEGER: 4
REDHAT-CLUSTER-MIB::rhcClusterStatusDesc.0 = STRING: &quot;Some services not running&quot;
REDHAT-CLUSTER-MIB::rhcClusterVotesNeededForQuorum.0 = INTEGER: 2
REDHAT-CLUSTER-MIB::rhcClusterVotes.0 = INTEGER: 3
REDHAT-CLUSTER-MIB::rhcClusterQuorate.0 = INTEGER: 1
REDHAT-CLUSTER-MIB::rhcClusterNodesNum.0 = INTEGER: 3
REDHAT-CLUSTER-MIB::rhcClusterNodesNames.0 = STRING: &quot;node1.deimos.fr, node2.deimos.fr, node3.deimos.fr&quot;
REDHAT-CLUSTER-MIB::rhcClusterAvailNodesNum.0 = INTEGER: 3
REDHAT-CLUSTER-MIB::rhcClusterAvailNodesNames.0 = STRING: &quot;node1.deimos.fr, node2.deimos.fr, node3.deimos.fr&quot;
REDHAT-CLUSTER-MIB::rhcClusterUnavailNodesNum.0 = INTEGER: 0
REDHAT-CLUSTER-MIB::rhcClusterUnavailNodesNames.0 = &quot;&quot;
REDHAT-CLUSTER-MIB::rhcClusterServicesNum.0 = INTEGER: 1
REDHAT-CLUSTER-MIB::rhcClusterServicesNames.0 = STRING: &quot;webby&quot;
REDHAT-CLUSTER-MIB::rhcClusterRunningServicesNum.0 = INTEGER: 0
REDHAT-CLUSTER-MIB::rhcClusterRunningServicesNames.0 = &quot;&quot;
REDHAT-CLUSTER-MIB::rhcClusterStoppedServicesNum.0 = INTEGER: 1
REDHAT-CLUSTER-MIB::rhcClusterStoppedServicesNames.0 = STRING: &quot;webby&quot;
REDHAT-CLUSTER-MIB::rhcClusterFailedServicesNum.0 = INTEGER: 0
REDHAT-CLUSTER-MIB::rhcClusterFailedServicesNames.0 = &quot;&quot;
REDHAT-CLUSTER-MIB::rhcNodeName.&quot;node1.deimos.fr&quot; = STRING: &quot;node1.deimos.fr&quot;
REDHAT-CLUSTER-MIB::rhcNodeName.&quot;node2.deimos.fr&quot; = STRING: &quot;node2.deimos.fr&quot;
REDHAT-CLUSTER-MIB::rhcNodeName.&quot;node3.deimos.fr&quot; = STRING: &quot;node3.deimos.fr&quot;
REDHAT-CLUSTER-MIB::rhcNodeStatusCode.&quot;node1.deimos.fr&quot; = INTEGER: 0
REDHAT-CLUSTER-MIB::rhcNodeStatusCode.&quot;node2.deimos.fr&quot; = INTEGER: 0
REDHAT-CLUSTER-MIB::rhcNodeStatusCode.&quot;node3.deimos.fr&quot; = INTEGER: 0
REDHAT-CLUSTER-MIB::rhcNodeStatusDesc.&quot;node1.deimos.fr&quot; = STRING: &quot;Participating in cluster&quot;
REDHAT-CLUSTER-MIB::rhcNodeStatusDesc.&quot;node2.deimos.fr&quot; = STRING: &quot;Participating in cluster&quot;
REDHAT-CLUSTER-MIB::rhcNodeStatusDesc.&quot;node3.deimos.fr&quot; = STRING: &quot;Participating in cluster&quot;
REDHAT-CLUSTER-MIB::rhcNodeRunningServicesNum.&quot;node1.deimos.fr&quot; = INTEGER: 0
REDHAT-CLUSTER-MIB::rhcNodeRunningServicesNum.&quot;node2.deimos.fr&quot; = INTEGER: 0
REDHAT-CLUSTER-MIB::rhcNodeRunningServicesNum.&quot;node3.deimos.fr&quot; = INTEGER: 0
REDHAT-CLUSTER-MIB::rhcNodeRunningServicesNames.&quot;node1.deimos.fr&quot; = &quot;&quot;
REDHAT-CLUSTER-MIB::rhcNodeRunningServicesNames.&quot;node2.deimos.fr&quot; = &quot;&quot;
REDHAT-CLUSTER-MIB::rhcNodeRunningServicesNames.&quot;node3.deimos.fr&quot; = &quot;&quot;
REDHAT-CLUSTER-MIB::rhcServiceName.&quot;webby&quot; = STRING: &quot;webby&quot;
REDHAT-CLUSTER-MIB::rhcServiceStatusCode.&quot;webby&quot; = INTEGER: 1
REDHAT-CLUSTER-MIB::rhcServiceStatusDesc.&quot;webby&quot; = STRING: &quot;stopped&quot;
REDHAT-CLUSTER-MIB::rhcServiceStartMode.&quot;webby&quot; = STRING: &quot;manual&quot;
REDHAT-CLUSTER-MIB::rhcServiceRunningOnNode.&quot;webby&quot; = &quot;&quot;
End of MIB</pre></div></div>
</td></tr></table><br />
<p>Pour obtenir la hiérarchie SNMP cluster&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> snmptranslate</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; snmptranslate -Os -Tp REDHAT-CLUSTER-MIB:RedHatCluster
+--RedHatCluster(8)
   |
   +--rhcMIBInfo(1)
   |  |
   |  +-- -R-- Integer32 rhcMIBVersion(1)
   |
   +--rhcCluster(2)
   |  |
   |  +-- -R-- String    rhcClusterName(1)
   |  +-- -R-- Integer32 rhcClusterStatusCode(2)
   |  +-- -R-- String    rhcClusterStatusDesc(3)
   |  +-- -R-- Integer32 rhcClusterVotesNeededForQuorum(4)
   |  +-- -R-- Integer32 rhcClusterVotes(5)
   |  +-- -R-- Integer32 rhcClusterQuorate(6)
   |  +-- -R-- Integer32 rhcClusterNodesNum(7)
   |  +-- -R-- String    rhcClusterNodesNames(8)
   |  +-- -R-- Integer32 rhcClusterAvailNodesNum(9)
   |  +-- -R-- String    rhcClusterAvailNodesNames(10)
   |  +-- -R-- Integer32 rhcClusterUnavailNodesNum(11)
   |  +-- -R-- String    rhcClusterUnavailNodesNames(12)
   |  +-- -R-- Integer32 rhcClusterServicesNum(13)
   |  +-- -R-- String    rhcClusterServicesNames(14)
   |  +-- -R-- Integer32 rhcClusterRunningServicesNum(15)
   |  +-- -R-- String    rhcClusterRunningServicesNames(16)
   |  +-- -R-- Integer32 rhcClusterStoppedServicesNum(17)
...</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="FAQ"><span class="mw-headline-number">7</span> FAQ</span></h1>
<h2><span class="mw-headline" id="Logs"><span class="mw-headline-number">7.1</span> Logs</span></h2>
<p>Les logs se trouvent dans /var/log/messages, et le niveau de verbosité peut être ajusté dans /etc/cluster/cluster.conf.
</p><p>Vous pouvez tester ensuite votre niveau de logs cluster comme ceci&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cman_tool</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">clulog -s warning &quot;test&quot;</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Erreurs_fr.C3.A9quentes"><span class="mw-headline-number">7.2</span> Erreurs fréquentes</span></h2>
<p>Voici une liste des erreurs les plus fréquentes&#160;:
</p>
<ul><li> Les scripts customs mal écrits, qui ne retournent pas les bonnes valeurs</li>
<li> Est-ce que le service n'est pas statué trop souvent&#160;?</li>
<li> Est-ce que les ressources démarrent dans le bon ordre&#160;?</li></ul>
<h2><span class="mw-headline" id="Starting_cman..._Can.27t_determine_address_family_of_nodename"><span class="mw-headline-number">7.3</span> Starting cman... Can't determine address family of nodename</span></h2>
<p>Si vous avez ce genre de message au démarrage de cman&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> service</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"><span class="xtra ln-xtra">&gt; service cman start</span>Starting cluster: 
   Checking if cluster has been disabled at boot...        [  OK  ]
   Checking Network Manager...                             [  OK  ]
   Global setup...                                         [  OK  ]
   Loading kernel modules...                               [  OK  ]
   Mounting configfs...                                    [  OK  ]
   Starting cman... Can't determine address family of nodename
Unable to get the configuration
Can't determine address family of nodename
cman_tool: corosync daemon didn't start Check cluster logs for details</pre></div></div>
</td></tr></table><br />
<p>Vérifiez que vous avez bien <a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#Hostname">les hostnames configurés</a> et que tous les noeuds peuvent communiquer entre eux.
</p>
<h2><span class="mw-headline" id="Error_locking_on_node"><span class="mw-headline-number">7.4</span> Error locking on node</span></h2>
<p>Vous pouvez tomber sur ce genre de problèmes si votre volume physique n'est pas détecté sur tous les noeuds.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lvcreate</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; lvcreate -n shared_lv1 -L 256M shared_vg
<span class="xtra ln-xtra">  Error locking on node node3: Volume group for uuid not found: EfDxVCE2XWh2Se7ohirVFpXyjXSEJqZxigQMWiiUXNjRXeWd2SzLHwZv3bFropf1</span><span class="xtra ln-xtra">  Error locking on node node1: Volume group for uuid not found: EfDxVCE2XWh2Se7ohirVFpXyjXSEJqZxigQMWiiUXNjRXeWd2SzLHwZv3bFropf1</span>  Failed to activate new LV.</pre></div></div>
</td></tr></table><br />
<p>Pour corriger le problème, faites un partprobe sur les disques contenant la nouvelle partition.
</p>
<h2><span class="mw-headline" id="Cluster_is_not_quorate._Refusing_connection"><span class="mw-headline-number">7.5</span> Cluster is not quorate.  Refusing connection</span></h2>
<p>Il faut vérifier que tous les services clusters sont correctement démarrer. On peut vérifier l'état du cluster comme ceci&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> clusvcadm</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; clustat 
Cluster Status for cluster1 @ Wed Feb 29 14:16:31 2012
<span class="xtra ln-xtra">Member Status: Quorate</span></pre></div></div>
</td></tr></table><br />
<p>Et là il est quorate, donc pas de soucis&#160;:-)
</p>
<h1><span class="mw-headline" id="Ressources"><span class="mw-headline-number">8</span> Ressources</span></h1>
<p><a rel="nofollow" class="external free" href="http://sources.redhat.com/cluster/doc/cluster_schema.html">http://sources.redhat.com/cluster/doc/cluster_schema.html</a><br />
<a rel="nofollow" class="external free" href="https://alteeve.com/w/RHCS_v2_cluster.conf">https://alteeve.com/w/RHCS_v2_cluster.conf</a><br />
<a rel="nofollow" class="external free" href="http://magazine.redhat.com/2007/12/19/enhancing-cluster-quorum-with-qdisk/">http://magazine.redhat.com/2007/12/19/enhancing-cluster-quorum-with-qdisk/</a><br />
<a rel="nofollow" class="external free" href="https://access.redhat.com/knowledge/node/2881">https://access.redhat.com/knowledge/node/2881</a><br />
<a href="images/f/f1/Cluster_archi_rhel.vsd" class="internal" title="Cluster archi rhel.vsd">RHEL Cluster Archi Visio</a>
</p>
<!-- 
NewPP limit report
CPU time usage: 0.228 seconds
Real time usage: 0.229 seconds
Preprocessor visited node count: 1726/1000000
Preprocessor generated node count: 4916/1000000
Post‐expand include size: 19542/2097152 bytes
Template argument size: 5710/2097152 bytes
Highest expansion depth: 4/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   71.362      1 - -total
 48.45%   34.575     62 - Template:Command
 24.41%   17.417     17 - Template:Config
  3.67%    2.620      1 - Template:RedHat_bonding_config
  2.93%    2.091     11 - Template:Array_2col_cl
  2.69%    1.923      1 - Template:Infobox
  1.95%    1.389      6 - Template:Array_2col
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:3335-0!*!0!1!en!5!* and timestamp 20181111230709 and revision id 10861
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=Installation_et_Configuration_de_Red_Hat_Cluster_Suite&amp;oldid=10861">https://wiki.deimos.fr/index.php?title=Installation_et_Configuration_de_Red_Hat_Cluster_Suite&amp;oldid=10861</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=Installation+et+Configuration+de+Red+Hat+Cluster+Suite" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=Installation_et_Configuration_de_Red_Hat_Cluster_Suite&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=Installation_et_Configuration_de_Red_Hat_Cluster_Suite&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/Installation_et_Configuration_de_Red_Hat_Cluster_Suite.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/Installation_et_Configuration_de_Red_Hat_Cluster_Suite" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=Installation_et_Configuration_de_Red_Hat_Cluster_Suite&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=Installation_et_Configuration_de_Red_Hat_Cluster_Suite&amp;oldid=10861" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=Installation_et_Configuration_de_Red_Hat_Cluster_Suite&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 14 May 2012, at 08:53.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":33});
}</script>
	</body>
</html>
	
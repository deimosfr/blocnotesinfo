<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>FuzzyOcr Plugin : Détection des spams image (OCR Detection) - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection)","wgTitle":"FuzzyOcr Plugin : Détection des spams image (OCR Detection)","wgCurRevisionId":5865,"wgRevisionId":5865,"wgArticleId":1683,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection)","wgRelevantArticleId":1683,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-FuzzyOcr_Plugin_Détection_des_spams_image_OCR_Detection skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">FuzzyOcr Plugin : Détection des spams image (OCR Detection)</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html#mw-navigation">navigation</a>, 					<a href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html#Configuration_de_Spamassassin"><span class="tocnumber">2</span> <span class="toctext">Configuration de Spamassassin</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html#La_reconnaissance_de_caract.C3.A8res"><span class="tocnumber">3</span> <span class="toctext">La reconnaissance de caractères</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html#L.27installation_du_greffon_FuzzyOCR"><span class="tocnumber">4</span> <span class="toctext">L'installation du greffon FuzzyOCR</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html#Configuration_du_greffon_FuzzyOCR"><span class="tocnumber">5</span> <span class="toctext">Configuration du greffon FuzzyOCR</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html#Les_tests_de_validation"><span class="tocnumber">6</span> <span class="toctext">Les tests de validation</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html#Faq"><span class="tocnumber">7</span> <span class="toctext">Faq</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html#Je_re.C3.A7ois_toujours_des_spams_de_type_image.2C_que_faire_.3F"><span class="tocnumber">7.1</span> <span class="toctext">Je reçois toujours des spams de type image, que faire&#160;?</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html#Autres_documentations"><span class="tocnumber">8</span> <span class="toctext">Autres documentations</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p>L'outil de lutte contre les pourriels (spams) le plus répandu dans le monde du logiciel libre est  spamassassin. Son mode de focntionnement se rapproche de celui du service amavisd-new. Il collecte les résultats obtenus par une collection d'autres outils et les transmet au service amavisd-new qui prend la décision sur le message en fonction du score total obtenu par celui-ci.
</p><p>Du point de vue système, la mise en oeuvre de spamassassin est très simple. Il suffit de s'appuyer sur le paquet Debian/testing qui est très bien maintenu. Cette situation est d'autant plus intéressante que la collection des bibliothèques et des outils dépendants de spamassassin est très volumineuse. La commande&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> apt-get</font>
</td></tr>
<tr>
<td>
<pre>apt-cache show spamassassin
</pre>
</td></tr></table><br />
<p>liste ces dépendances.
</p>
<h1><span class="mw-headline" id="Configuration_de_Spamassassin"><span class="mw-headline-number">2</span> Configuration de Spamassassin</span></h1>
<p>Il faut distinguer 2 niveaux pour la configuration de cet outil.
</p>
<ul><li> À l'échelle du système, le répertoire /etc/spamassassin contient les fichiers de configuration communs à l'ensemble des utilisateurs.</li>
<li> Pour l'utilisateur amavis, le répertoire .spamassassinsitué sous le répertoire personnel de l'utilisateur contient les fichiers de configuration dédiés ainsi que les bases de données constituées en cours d'exécution&#160;: liste blanche automatique, jetons de calcul, etc..</li></ul>
<p>Comme dans les scénariis décrits dans ce document, le système sur lequel sont installés les outils est un serveur passerelle dédié au traitement du courrier électronique, tous les paramètres de configuration seront dans le répertoire général /etc/spamassassin et toutes les bases de données seront dans le répertoire /var/lib/amavis/.spamassassin.
</p>
<h1><span class="mw-headline" id="La_reconnaissance_de_caract.C3.A8res"><span class="mw-headline-number">3</span> La reconnaissance de caractères</span></h1>
<p>La tendance de la rentrée 2006, c'est l'explosion des pourriels contenant des images animées de type GIF, PNG ou JPEG. Ces images contiennent le plus souvent des publicités ou des offres de cotations boursières pour le moins douteuses.
</p><p>Le FuzzyOcr Plugin est une arme assez efficace pour lutter contre les pourriels contenant des images. Il se base sur la reconnaissance optique de caractères pour rechercher des mots clés dans ces images. Ce greffon possède aussi quelques optimisations pour le traitement des fichiers images volontairement corrompus.
</p><p>Le fonctionnement de base du greffon, tel qu'il est décrit sur la page web de présentation recouvre les étapes suivantes&#160;:
</p>
<ul><li> Recherche les images dans les différentes parties du message,</li>
<li> Chaque image est analysée pour identifié sont format (GIF, PNG, JPEG),</li>
<li> Suivant le format d'image détecté, différents outils sont appelés pour convertir l'image au format PNM,</li>
<li> Le programme de reconnaissance optique de caractères gocr est appelé pour extraire le texte du fichier PNM,</li>
<li> Les chaînes de caractères obtenues sont scrutées à la recherche de mots prédéfinis, les scores sont calculés et les résultats sont transmis à spamassassin.</li></ul>
<h1><span class="mw-headline" id="L.27installation_du_greffon_FuzzyOCR"><span class="mw-headline-number">4</span> L'installation du greffon FuzzyOCR</span></h1>
<p>Malheureusement, on ne dispose pas encore de paquet Debian/testing. Il faut donc passer par une installation manuelle en s'appuyant sur les paquets des outils utilisés par le greffon.
</p><p>On commence par télécharger le code du greffon et placer les sources dans l'arborescence du serveur passerelle de courrier électronique&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>wget <a rel="nofollow" class="external free" href="http://users.own-hero.net/~decoder/fuzzyocr/fuzzyocr-latest.tar.gz">http://users.own-hero.net/~decoder/fuzzyocr/fuzzyocr-latest.tar.gz</a>
mv fuzzyocr-latest.tar.gz /usr/local/src/
cd /usr/local/src/
tar xf fuzzyocr-latest.tar.gz
chown -R root.src FuzzyOcr*
</pre>
</td></tr></table><br />
<p>Ensuite, il faut que ces packages soient installés&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> apt-get</font>
</td></tr>
<tr>
<td>
<pre>apt-get install spamassassin netpbm imagemagick libungif4g libungif-bin gocr libjpeg-progs libstring-approx-perl
</pre>
</td></tr></table><br />
<h1><span class="mw-headline" id="Configuration_du_greffon_FuzzyOCR"><span class="mw-headline-number">5</span> Configuration du greffon FuzzyOCR</span></h1>
<p>Pour cette partie, on ne suit pas les recommandations du fichier INSTALL. En effet, la configuration par défaut du greffon prévoit d'utiliser le répertoire /etc/mail/spamassassin qui n'existe pas sur un système Debian. De plus, il n'est pas souhaitable de mélanger du code et des éléments de configuration dans le répertoire /etc/.
</p><p>Pour l'installation du code du greffon, la commande # dpkg -L spamassassin |grep Plugin/ permet d'identifier le répertoire de dépôt des autres greffons utilisés par spamassassin&#160;: /usr/share/perl5/Mail/SpamAssassin/Plugin/. On copie donc le code dans ce répertoire.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>cp FuzzyOcr.pm /usr/share/perl5/Mail/SpamAssassin/Plugin/
</pre>
</td></tr></table><br />
<p>Pour le fichier de configuration, il suffit de copier les fichiers suivant dans le répertoire général de configuration de spamassassin.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>cp FuzzyOcr.cf /etc/spamassassin/
cp FuzzyOcr.words.sample /etc/spamassassin/FuzzyOcr.words
cd /etc/spamassassin
</pre>
</td></tr></table><br />
<p>Plusieurs fichiers de configuration doivent être édités pour s'adapter au contexte de configuration.<br />
On doit indiquer le nouveau greffon dans la liste parcourue par spamassassin en ajoutant une ligne à la fin du fichier v310.pre.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>echo loadplugin FuzzyOcr /usr/share/perl5/Mail/SpamAssassin/Plugin/FuzzyOcr.pm &gt;&gt; v310.pre
</pre>
</td></tr></table><br />
<p>On doit éditer le fichier FuzzyOcr.cf pour l'adapter au contexte&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> FuzzyOcr.cf</font>
</td></tr>
<tr>
<td>
<pre><b>#loadplugin FuzzyOcr FuzzyOcr.pm</b>
body FUZZY_OCR eval:fuzzyocr_check()
describe FUZZY_OCR Mail contains an image with common spam text inside
body FUZZY_OCR_WRONG_CTYPE eval:dummy_check()
describe FUZZY_OCR_WRONG_CTYPE Mail contains an image with wrong content-type set
body FUZZY_OCR_CORRUPT_IMG eval:dummy_check()
describe FUZZY_OCR_CORRUPT_IMG Mail contains a corrupted image
body FUZZY_OCR_KNOWN_HASH eval:dummy_check()
describe FUZZY_OCR_KNOWN_HASH Mail contains an image with known hash

priority FUZZY_OCR             900

########### Plugin Configuration #############

#### Logging options #####
# Verbosity level (see manual) Attention: Don't set to 0, but to 0.0 for quiet operation. (Default value: 1)
<b>focr_verbose 4</b>
#
# Logfile (make sure it is writable by the plugin) (Default value: /etc/mail/spamassassin/FuzzyOcr.log)
<b>focr_logfile /var/log/fuzzyocr.log</b>
##########################

##### Wordlists #####
# Here we defined the words to scan for (Default value: /etc/mail/spamassassin/FuzzyOcr.words)
<b>focr_global_wordlist /etc/spamassassin/FuzzyOcr.words</b>
#
# This is the path RELATIVE to the respektive home directory for the personalized list
# This list is merged with the global word list on execution (Default value: .spamassassin/fuzzyocr.words)
#focr_personal_wordlist .spamassassin/fuzzyocr.words
#####################

# Set this to 1 if you are running a version &lt; 3.1.4.
# This will disable a function used in conjunction with animated gifs that isn't available in earlier versions (Default value: 0.0)
#focr_pre314 0.0

# These parameters can be used to change other detection settings
# If you leave these commented out, the defaults will be used.
# Do not use " " around any parameters!
#
##### Location of helper applications (path + binary) (Default values: /usr/bin/&lt;app&gt;) #####
#focr_bin_giffix /usr/bin/giffix
#focr_bin_giffix /usr/bin/giffix
#focr_bin_giftext /usr/bin/giftext
#focr_bin_gifasm /usr/bin/gifasm
#focr_bin_gifinter /usr/bin/gifinter
#focr_bin_giftopnm /usr/bin/giftopnm
#focr_bin_jpegtopnm /usr/bin/jpegtopnm
#focr_bin_pngtopnm /usr/bin/pngtopnm
#focr_bin_ppmhist /usr/bin/ppmhist
#focr_bin_convert /usr/bin/convert
#focr_bin_identify /usr/bin/identify
#focr_bin_gocr /usr/bin/gocr
############################################################################################

##### Scansets, comma seperated (Default value: $gocr -i -, $gocr -l 180 -d 2 -i -) #####
# Each scanset consists of one or more commands which make text out of pnm input.
# Each scanset is run seperately on the PNM data, results are combined in scoring.
#focr_scansets $gocr -i -, $gocr -l 180 -d 2 -i -
#
# To use only one scan with default values, uncomment the next line instead
#focr_scansets $gocr -i -
#
# Some example for more advanced sets
# Thisone uses the first the standard scan, then a scanset which first reduces the image to 3 colors and then scans it with custom settings
# and then it scans again only with these custom settings
# NOTE: This is for advanced users only, if you have questions how to use this, ask on the ML or on IRC
#focr_scansets $gocr -i -, pnmnorm 2&gt;$errfile 
</pre>
</td></tr></table><br />
<p>Si voter version est vraiment différente de celle du dessus, voici un patch entre la configuartion de la passerelle et la version distribuée&#160;:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">diff -uBb /usr/local/src/FuzzyOcr-2.3b/FuzzyOcr.cf FuzzyOcr.cf
--- /usr/local/src/FuzzyOcr-2.3b/FuzzyOcr.cf    2006-08-25 22:56:00.000000000 +0200
+++ FuzzyOcr.cf 2006-09-10 23:23:39.000000000 +0200
@@ -1,4 +1,4 @@
-loadplugin FuzzyOcr FuzzyOcr.pm
+#loadplugin FuzzyOcr FuzzyOcr.pm
body FUZZY_OCR eval:fuzzyocr_check()
describe FUZZY_OCR Mail contains an image with common spam text inside
body FUZZY_OCR_WRONG_CTYPE eval:dummy_check()
@@ -14,15 +14,15 @@
&#160;
#### Logging options #####
# Verbosity level (see manual) Attention: Don't set to 0, but to 0.0 for quiet
# operation.
-#focr_verbose 1
+focr_verbose 4
#
# Logfile (make sure it is writable by the plugin)
-focr_logfile /etc/mail/spamassassin/FuzzyOcr.log
+focr_logfile /var/log/fuzzyocr.log
##########################
&#160;
##### Wordlists #####
# Here we defined the words to scan for
-focr_global_wordlist /etc/mail/spamassassin/FuzzyOcr.words
+focr_global_wordlist /etc/spamassassin/FuzzyOcr.words
#
# This is the path RELATIVE to the respektive home directory for the personalized list
# This list is merged with the global word list on execution
@@ -90,6 +90,7 @@
#
# This is used to disable the OCR engine if the message has already more points
# than this value (Default value: 10)
#focr_autodisable_score 10
+#focr_autodisable_score 50
#
# Number of minimum matches before the rule scores (Default value: 2)
#focr_counts_required 2</pre></div></div>
<p>Enfin, il faut implanter la configuration nécessaire à la journalisation.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>touch /var/log/fuzzyocr.log
chown amavis.amavis /var/log/fuzzyocr.log
</pre>
</td></tr></table><br />
<p>Pour limiter l'occupation disque de la journalisation du greffon tout en conservant un historique à 90 jours, on créé un fichier de configuration pour le service logrotate. Créez ce fichier et insérez les lignes suivantes&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/logrotate.d/fuzzyocr</font>
</td></tr>
<tr>
<td>
<pre>$ /etc/logrotate.d/fuzzyocr
/var/log/fuzzyocr.log {
    rotate 90
    daily
    compress
    delaycompress
    create 666 amavis amavis
    }
</pre>
</td></tr></table><br />
<h1><span class="mw-headline" id="Les_tests_de_validation"><span class="mw-headline-number">6</span> Les tests de validation</span></h1>
<p>Avant toute manipulation, il faut s'assurer du bon fonctionnement de spamassassin. Les deux commandes&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> spamassassin</font>
</td></tr>
<tr>
<td>
<pre>spamassassin --lint
</pre>
</td></tr></table><br />
<p>et
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>su - amavis -- spamassassin --lint
</pre>
</td></tr></table><br />
<p>ne doivent produire aucun affichage. Si ce n'est pas le cas, il faut revoir la configuration de spamassassin ou amavis avant de tester le fonctionnement du greffon.
</p><p>On utilise ensuite les échantillons de pourriels fournis avec les sources du greffon et on analyse les résultats produits.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">$ spamassassin -t /usr/local/src/FuzzyOcr-2.3b/samples/animated-gif.eml
&lt;snipped&gt;
 20 FUZZY_OCR              BODY: Mail contains an image with common spam text inside
                           Words found:
                           &quot;alert&quot; in 4 lines
                           &quot;charts&quot; in 1 lines
                           &quot;symbol&quot; in 1 lines
                           &quot;alert&quot; in 4 lines
                           &quot;stock&quot; in 2 lines
                           &quot;company&quot; in 3 lines
                           &quot;trade&quot; in 1 lines
                           &quot;meridia&quot; in 1 lines
                           &quot;growth&quot; in 1 lines
                           (18 word occurrences found)</pre></div></div>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">$ spamassassin -t /usr/local/src/FuzzyOcr-2.3b/samples/corrupted-gif.eml
&lt;snipped&gt;
1.5 FUZZY_OCR_WRONG_CTYPE  BODY: Mail contains an image with wrong
                           content-type set
                           Image has format &quot;GIF&quot; but content-type is
                           &quot;image/jpeg&quot;
2.5 FUZZY_OCR_CORRUPT_IMG  BODY: Mail contains a corrupted image
                           Corrupt image: GIF-LIB error: Image is
                           defective, decoding aborted.
 14 FUZZY_OCR              BODY: Mail contains an image with common spam text inside
                           Words found:
                           &quot;alert&quot; in 1 lines
                           &quot;alert&quot; in 1 lines
                           &quot;stock&quot; in 2 lines
                           &quot;investor&quot; in 1 lines
                           &quot;company&quot; in 1 lines
                           &quot;price&quot; in 2 lines
                           &quot;trade&quot; in 1 lines
                           &quot;target&quot; in 1 lines
                           &quot;service&quot; in 1 lines
                           &quot;recommendation&quot; in 1 lines
                           (12 word occurrences found)</pre></div></div>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">$ spamassassin -t /usr/local/src/FuzzyOcr-2.3b/samples/jpeg.eml
&lt;snipped&gt;
 6.0 FUZZY_OCR             BODY: Mail contains an image with common spam text inside
                           Words found:
			   &quot;viagra&quot; in 2 lines
			   &quot;cialis&quot; in 1 lines
			   &quot;levitra&quot; in 1 lines
			   (4 word occurrences found)</pre></div></div>
</td></tr></table><br />
<p>On constate que les rapports sur les trois échantillons testés montrent que des mots clés ont été détectés dans les images et que les scores ont été augmentés en conséquence.
</p><p>Il ne reste plus qu'à valider la solution en exploitation réelle&#160;! Sans attendre, on obtient un échantillon qui montre que la reconnaissance optique de caractère à ajouté 18 points au score.
</p><p>Extrait du journal système produit par le service amavisd-new&#160;:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">Sep 10 18:08:57 MailGw amavis[13387]: (13387-04) SPAM, \
  &lt;lwrceuqp@demax.sk&gt; -&gt; &lt;xxxxxxxxxxxxx@xxx.xxx-xxxx.fr&gt;, Yes, \
  score=27.449 tag=-999 tag2=6.31 kill=6.31 tests=[BAYES_50=2.5, \
  DATE_IN_FUTURE_03_06=1.961, EXTRA_MPART_TYPE=1.091, FUZZY_OCR=18.000, \
  HTML_MESSAGE=0.001, RCVD_IN_XBL=3.897, SPF_PASS=-0.001], \
  autolearn=spam, quarantine lkwO3NF5SAMT (spam-quarantine)</pre></div></div>
<p>Extrait du journal produit par le greffon pour le même message&#160;:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">[2006-09-10 18:08:57] Debug mode: Message is spam (score 18)...
[2006-09-10 18:08:57] Debug mode: Words found:
                      &quot;charts&quot; in 1 lines
                      &quot;symbol&quot; in 1 lines
                      &quot;stock&quot; in 2 lines
	              &quot;international&quot; in 3 lines
		      &quot;company&quot; in 2 lines
		      &quot;million&quot; in 1 lines
		      &quot;buy&quot; in 1 lines
                      &quot;trade&quot; in 3 lines
                      &quot;target&quot; in 1 lines
                      &quot;meridia&quot; in 1 lines
                      (16 word occurrences found)</pre></div></div>
<h1><span class="mw-headline" id="Faq"><span class="mw-headline-number">7</span> Faq</span></h1>
<h2><span class="mw-headline" id="Je_re.C3.A7ois_toujours_des_spams_de_type_image.2C_que_faire_.3F"><span class="mw-headline-number">7.1</span> Je reçois toujours des spams de type image, que faire&#160;?</span></h2>
<p>Il faut savoir que si c'est très bien camouflé, la détection échouera. Mais vérifiez également ce que disent le logs. J'ai eu un problème avec les droits au niveau des logs. Faites donc une petite correction à ce niveau là si c'est celà qui bloque.
</p>
<h1><span class="mw-headline" id="Autres_documentations"><span class="mw-headline-number">8</span> Autres documentations</span></h1>
<p><a href="./File:FuzzyOCR_debian.pdf.html" title="File:FuzzyOCR debian.pdf">Voici une autre documentation en anglais</a>
</p>
<!-- 
NewPP limit report
CPU time usage: 0.036 seconds
Real time usage: 0.038 seconds
Preprocessor visited node count: 223/1000000
Preprocessor generated node count: 660/1000000
Post‐expand include size: 6271/2097152 bytes
Template argument size: 4315/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    7.256      1 - -total
 51.12%    3.709     12 - Template:Command
 13.13%    0.953      2 - Template:Config
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:1683-0!*!*!1!en!5!* and timestamp 20181111230714 and revision id 5865
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection)&amp;oldid=5865">https://wiki.deimos.fr/index.php?title=FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection)&amp;oldid=5865</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=FuzzyOcr+Plugin+%3A+D%C3%A9tection+des+spams+image+%28OCR+Detection%29" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=FuzzyOcr_Plugin_:_D%C3%A9tection_des_spams_image_(OCR_Detection)&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=FuzzyOcr_Plugin_:_D%C3%A9tection_des_spams_image_(OCR_Detection)&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="./FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/FuzzyOcr_Plugin_:_Détection_des_spams_image_(OCR_Detection).html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/FuzzyOcr_Plugin_:_D%C3%A9tection_des_spams_image_(OCR_Detection)" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=FuzzyOcr_Plugin_:_D%C3%A9tection_des_spams_image_(OCR_Detection)&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=FuzzyOcr_Plugin_:_D%C3%A9tection_des_spams_image_(OCR_Detection)&amp;oldid=5865" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=FuzzyOcr_Plugin_:_D%C3%A9tection_des_spams_image_(OCR_Detection)&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 10 April 2008, at 10:36.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":32});
}</script>
	</body>
</html>
	
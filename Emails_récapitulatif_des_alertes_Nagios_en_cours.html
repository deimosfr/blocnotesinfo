<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>Emails récapitulatif des alertes Nagios en cours - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="Emails_récapitulatif_des_alertes_Nagios_en_cours.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Emails_récapitulatif_des_alertes_Nagios_en_cours","wgTitle":"Emails récapitulatif des alertes Nagios en cours","wgCurRevisionId":12759,"wgRevisionId":12759,"wgArticleId":3472,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Emails_récapitulatif_des_alertes_Nagios_en_cours","wgRelevantArticleId":3472,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
.source-perl {line-height: normal;}
.source-perl li, .source-perl pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for perl
 * CSS class: source-perl, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.perl.source-perl .de1, .perl.source-perl .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.perl.source-perl  {font-family:monospace;}
.perl.source-perl .imp {font-weight: bold; color: red;}
.perl.source-perl li, .perl.source-perl .li1 {font-weight: normal; vertical-align:top;}
.perl.source-perl .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.perl.source-perl .li2 {font-weight: bold; vertical-align:top;}
.perl.source-perl .kw1 {color: #b1b100;}
.perl.source-perl .kw2 {color: #000000; font-weight: bold;}
.perl.source-perl .kw3 {color: #000066;}
.perl.source-perl .co1 {color: #666666; font-style: italic;}
.perl.source-perl .co2 {color: #009966; font-style: italic;}
.perl.source-perl .co3 {color: #0000ff;}
.perl.source-perl .co4 {color: #cc0000; font-style: italic;}
.perl.source-perl .co5 {color: #0000ff;}
.perl.source-perl .coMULTI {color: #666666; font-style: italic;}
.perl.source-perl .es0 {color: #000099; font-weight: bold;}
.perl.source-perl .es_h {color: #000099; font-weight: bold;}
.perl.source-perl .br0 {color: #009900;}
.perl.source-perl .sy0 {color: #339933;}
.perl.source-perl .st0 {color: #ff0000;}
.perl.source-perl .st_h {color: #ff0000;}
.perl.source-perl .nu0 {color: #cc66cc;}
.perl.source-perl .me1 {color: #006600;}
.perl.source-perl .me2 {color: #006600;}
.perl.source-perl .re0 {color: #0000ff;}
.perl.source-perl .re4 {color: #009999;}
.perl.source-perl .ln-xtra, .perl.source-perl li.ln-xtra, .perl.source-perl div.ln-xtra {background-color: #ffc;}
.perl.source-perl span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Emails_récapitulatif_des_alertes_Nagios_en_cours skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Emails récapitulatif des alertes Nagios en cours</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="Emails_récapitulatif_des_alertes_Nagios_en_cours.html#mw-navigation">navigation</a>, 					<a href="Emails_récapitulatif_des_alertes_Nagios_en_cours.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Emails_récapitulatif_des_alertes_Nagios_en_cours.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Emails_récapitulatif_des_alertes_Nagios_en_cours.html#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="Emails_récapitulatif_des_alertes_Nagios_en_cours.html#Configuration"><span class="tocnumber">3</span> <span class="toctext">Configuration</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="Emails_récapitulatif_des_alertes_Nagios_en_cours.html#References"><span class="tocnumber">4</span> <span class="toctext">References</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="Emails_récapitulatif_des_alertes_Nagios_en_cours.html#Utilisation"><span class="tocnumber">5</span> <span class="toctext">Utilisation</span></a></li>
</ul>
</div>

<table class="config_array" align="right" style="width:20em; font-size:90%; text-align:left; border: 1px #d0e7ff solid; margin-left:10px;">
   <tr>
      <td class="config_subarray" colspan="2" style="text-align:center;"><a href="./File:Nagios_logo.png.html" class="image" title="Nagios"><img alt="Nagios" src="images/8/80/Nagios_logo.png" width="220" height="52" /></a></td>
   </tr><tr><td colspan="2" style="text-align:center;"><hr class="gradient" /></td></tr><tr>
      <th>Software version</th>
      <td>Core 3.2.1</td>
   </tr><tr>
      <th>Operating System</th>
      <td>Debian 6</td>
   </tr><tr>
      <th>Website</th>
      <td><a rel="nofollow" class="external text" href="http://www.nagios.org">Nagios Website</a></td>
   </tr><tr>
      <th>Last Update</th>
      <td>02/08/2013</td>
   </tr><tr>
      <th>Others</th>
      <td></td>
   </tr>
</table>
<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p>J'ai longtemps utilisé cet outil trouvé sur le net, puis repris conjointement avec un ex collègue qui permet de recevoir un email en fonction d'alertes de Nagios. Nous l'utilisions pour recevoir, avant d'arriver au taf ces emails, pour savoir quels sont les problèmes avant d'arriver. Cela permet d'arriver soit en courant, soit serein&#160;:-)
</p><p>C'est un script qui va parser l'interface web graphique de Nagios, récupérer le minimum d'informations pour un bon affichage sur smartphone et envoyer un mail. Il suffit de mettre ceci en crontab pour recevoir ça le matin ou quant vous le souhaitez.
</p>
<h1><span class="mw-headline" id="Installation"><span class="mw-headline-number">2</span> Installation</span></h1>
<p>Il va falloir avoir Perl et certaines dépendances&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude install liblwp-useragent-determined-perl libemail-sender-perl</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Configuration"><span class="mw-headline-number">3</span> Configuration</span></h1>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /usr/local/bin/morningchecks.pl</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="perl source-perl"><pre class="de1"><span class="co1">#!/usr/bin/perl -w</span>
<span class="co1"># Inspired by Rob Moss, 2005-07-26, coding@mossko.com</span>
<span class="co1"># Created by Charles-Henri TURPIN</span>
<span class="co1"># Modified by Pierre Mavro</span>
&#160;
<span class="co1">###########################################################################################</span>
&#160;
<span class="xtra ln-xtra"><span class="kw1">my</span> <span class="re0">$mailsmtp</span>	<span class="sy0">=</span>	<span class="st_h">'smtp.deimos.fr'</span><span class="sy0">;</span>    <span class="co1">#	Fill these in!</span></span><span class="xtra ln-xtra"><span class="kw1">my</span> <span class="re0">$mailfrom</span>    <span class="sy0">=</span>       <span class="st_h">'deimos@deimos.fr'</span><span class="sy0">;</span>  <span class="co1">#   Coming from above</span></span><span class="xtra ln-xtra"><span class="kw1">my</span> <span class="re0">$mailto</span>	<span class="sy0">=</span>	<span class="st_h">'deimos@deimos.fr'</span><span class="sy0">;</span>  <span class="co1"># Set defautls receivers</span></span><span class="xtra ln-xtra"><span class="kw1">my</span> <span class="re0">$mailsubject</span>	<span class="sy0">=</span>	<span class="st_h">'Morning Checks'</span><span class="sy0">;</span></span>&#160;
<span class="co1">###########################################################################################</span>
&#160;
<span class="kw3">package</span> Service<span class="sy0">;</span>
<span class="kw2">sub</span> const
<span class="br0">&#123;</span>
	<span class="kw1">my</span> <span class="br0">&#40;</span><span class="re0">$classe</span><span class="sy0">,</span> <span class="re0">$hostname</span><span class="sy0">,</span> <span class="re0">$name</span><span class="sy0">,</span> <span class="re0">$duration</span><span class="sy0">,</span> <span class="re0">$message</span><span class="sy0">,</span> <span class="re0">$color</span><span class="br0">&#41;</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span> <span class="co1">#la fonction reçoit comme premier paramètre le nom de la classe</span>
   	<span class="kw1">my</span> <span class="re0">$this</span> <span class="sy0">=</span> <span class="br0">&#123;</span><span class="st0">&quot;hostname&quot;</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;hostname&quot;</span><span class="sy0">,</span>
		   <span class="st0">&quot;name&quot;</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;name&quot;</span><span class="sy0">,</span>
		   <span class="st0">&quot;duration&quot;</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;duration&quot;</span><span class="sy0">,</span>
		   <span class="st0">&quot;message&quot;</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;message&quot;</span><span class="sy0">,</span>
		   <span class="st0">&quot;color&quot;</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;color&quot;</span><span class="sy0">,</span><span class="br0">&#125;</span><span class="sy0">;</span>
&#160;
	<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span><span class="st0">&quot;hostname&quot;</span><span class="br0">&#125;</span> <span class="sy0">=</span> <span class="re0">$hostname</span> <span class="kw1">if</span> <span class="kw3">defined</span> <span class="re0">$hostname</span><span class="sy0">;</span>
	<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span><span class="st0">&quot;name&quot;</span><span class="br0">&#125;</span> <span class="sy0">=</span> <span class="re0">$name</span> <span class="kw1">if</span> <span class="kw3">defined</span> <span class="re0">$name</span><span class="sy0">;</span>
	<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span><span class="st0">&quot;duration&quot;</span><span class="br0">&#125;</span> <span class="sy0">=</span> <span class="re0">$duration</span> <span class="kw1">if</span> <span class="kw3">defined</span> <span class="re0">$duration</span><span class="sy0">;</span>
	<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span><span class="st0">&quot;message&quot;</span><span class="br0">&#125;</span> <span class="sy0">=</span> <span class="re0">$message</span> <span class="kw1">if</span> <span class="kw3">defined</span> <span class="re0">$message</span><span class="sy0">;</span>
	<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span><span class="st0">&quot;color&quot;</span><span class="br0">&#125;</span> <span class="sy0">=</span> <span class="re0">$color</span> <span class="kw1">if</span> <span class="kw3">defined</span> <span class="re0">$color</span><span class="sy0">;</span>
&#160;
&#160;
   	<span class="kw3">bless</span> <span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">,</span><span class="re0">$classe</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">#lie la référence à la classe</span>
   	<span class="kw3">return</span> <span class="re0">$this</span><span class="sy0">;</span> <span class="co1">#on retourne la référence consacrée</span>
<span class="br0">&#125;</span>
&#160;
<span class="kw2">sub</span> DESTROY
<span class="br0">&#123;</span>
	<span class="kw3">return</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="br0">&#125;</span> 
<span class="nu0">1</span><span class="sy0">;</span>
&#160;
<span class="kw2">use</span> strict<span class="sy0">;</span>
<span class="kw2">use</span> Getopt<span class="sy0">::</span><span class="me2">Long</span><span class="sy0">;</span>
<span class="kw2">use</span> LWP<span class="sy0">::</span><span class="me2">UserAgent</span><span class="sy0">;</span>
<span class="kw2">use</span> Mail<span class="sy0">::</span><span class="me2">Sender</span><span class="sy0">;</span>
<span class="re0">$Mail</span><span class="sy0">::</span><span class="me2">Sender</span><span class="sy0">::</span><span class="me2">NO_X_MAILER</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
&#160;
&#160;
<span class="kw1">my</span> <span class="re0">@services</span> <span class="sy0">=</span> <span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$mailbody</span>	<span class="sy0">=</span>	<span class="st_h">''</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">@finalmailbody</span> <span class="sy0">=</span> <span class="br0">&#40;</span>
	<span class="st_h">'&lt;html&gt;&lt;head&gt;&lt;style type=&quot;text/css&quot;&gt;</span>
<span class="st_h">    .titre {</span>
<span class="st_h">	    color: #FFFFFF;</span>
<span class="st_h">	    background-color: #357AB7;</span>
<span class="st_h">	    font-size: 12;</span>
<span class="st_h">    }</span>
<span class="st_h">    .titre td{</span>
<span class="st_h">	border: 2px solid #000000;</span>
<span class="st_h">    }</span>
<span class="st_h">    .el{</span>
<span class="st_h">	font-size: 12;</span>
<span class="st_h">    }</span>
<span class="st_h">    .confluence{</span>
<span class="st_h">	font-size: 10;</span>
<span class="st_h">    }</span>
<span class="st_h">    &lt;/style&gt;&lt;/head&gt;&lt;body&gt;'</span>
<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
<span class="xtra ln-xtra"><span class="kw1">my</span> <span class="re0">$debug</span>		<span class="sy0">=</span>	<span class="nu0">0</span><span class="sy0">;</span>									<span class="co1">#	Set the debug level to 1 or higher for information</span></span><span class="xtra ln-xtra"><span class="kw1">my</span> <span class="re0">$webuser</span>		<span class="sy0">=</span>	<span class="st_h">''</span><span class="sy0">;</span>							<span class="co1">#	Set this to a read-only nagios user (not nagiosadmin!)</span></span><span class="xtra ln-xtra"><span class="kw1">my</span> <span class="re0">$webpass</span>		<span class="sy0">=</span>	<span class="st_h">''</span><span class="sy0">;</span>							<span class="co1">#	Set this to a read-only nagios user (not nagiosadmin!)</span></span><span class="kw1">my</span> <span class="re0">$full</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$reporturl</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">@nagiosnames</span><span class="sy0">;</span>
&#160;
&#160;
<span class="re0">&amp;GetOptions</span> <span class="br0">&#40;</span>
	<span class="st0">&quot;debug=s&quot;</span>	<span class="sy0">=&gt;</span>	<span class="re0">\$debug</span><span class="sy0">,</span>
	<span class="st0">&quot;help&quot;</span>		<span class="sy0">=&gt;</span>	<span class="re0">\&amp;help</span><span class="sy0">,</span>
	<span class="st0">&quot;email=s&quot;</span>	<span class="sy0">=&gt;</span>	<span class="re0">\$mailto</span><span class="sy0">,</span>
	<span class="st0">&quot;names=s&quot;</span>	<span class="sy0">=&gt;</span>	<span class="re0">\@nagiosnames</span><span class="sy0">,</span>
	<span class="st0">&quot;full&quot;</span>		<span class="sy0">=&gt;</span>	<span class="re0">\$full</span>
<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
<span class="kw1">if</span><span class="br0">&#40;</span><span class="sy0">!</span><span class="kw3">defined</span><span class="br0">&#40;</span><span class="re0">$nagiosnames</span><span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
<span class="xtra ln-xtra">    <span class="re0">@nagiosnames</span> <span class="sy0">=</span> <span class="br0">&#40;</span><span class="st_h">'nagios-prod'</span><span class="br0">&#41;</span><span class="sy0">;</span></span><span class="br0">&#125;</span>
program<span class="br0">&#40;</span><span class="re0">@nagiosnames</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">################################ FUNCTIONS #######################################</span>
<span class="kw2">sub</span> program
<span class="br0">&#123;</span>
    <span class="kw1">my</span> <span class="re0">@nagiosnames</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span>
&#160;
    <span class="kw1">foreach</span> <span class="kw1">my</span> <span class="re0">$nagiosname</span> <span class="br0">&#40;</span><span class="re0">@nagiosnames</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
	launch<span class="br0">&#40;</span><span class="st0">&quot;$nagiosname&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	main<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	check<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <span class="kw3">system</span><span class="br0">&#40;</span><span class="st0">&quot;touch /tmp/nagios-report-htmlout.html; chmod 666 /tmp/nagios-report-htmlout.html&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>    
&#160;
    <span class="kw3">push</span> <span class="re0">@finalmailbody</span><span class="sy0">,</span> <span class="st_h">'&lt;/body&gt;&lt;/html&gt;'</span><span class="sy0">;</span>
    sendmail<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw3">system</span><span class="br0">&#40;</span><span class="st0">&quot;rm /tmp/nagios-report-htmlout.html&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
<span class="kw2">sub</span> launch
<span class="br0">&#123;</span>
    <span class="kw1">my</span> <span class="re0">$nagiosname</span> <span class="sy0">=</span> <span class="kw3">shift</span><span class="sy0">;</span>
    <span class="kw1">my</span> <span class="re0">$title</span> <span class="sy0">=</span> <span class="st0">&quot;&lt;p align=<span class="es0">\&quot;</span>center<span class="es0">\&quot;</span>&gt;&lt;b&gt;&quot;</span><span class="sy0">.</span><span class="kw3">uc</span><span class="br0">&#40;</span><span class="re0">$nagiosname</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="st0">&quot;&lt;/b&gt;&lt;/p&gt;&lt;hr color=<span class="es0">\&quot;</span>black<span class="es0">\&quot;</span> align=<span class="es0">\&quot;</span>center<span class="es0">\&quot;</span> width=<span class="es0">\&quot;</span>80%<span class="es0">\&quot;</span>/&gt;&quot;</span><span class="sy0">;</span>
    <span class="kw3">push</span> <span class="re0">@finalmailbody</span><span class="sy0">,</span> <span class="re0">$title</span><span class="sy0">;</span>
    <span class="co1">#-- 20110926 - Match the monitoring screen's request</span>
    <span class="co1">#$reporturl = &quot;http://$nagiosname/cgi-bin/nagios3/status.cgi?host=all&amp;servicestatustypes=28&amp;hoststatustypes=3&amp;serviceprops=42&amp;sorttype=1&amp;sortoption=6&amp;noheader&quot;;</span>
    <span class="kw1">if</span><span class="br0">&#40;</span><span class="re0">$nagiosname</span> <span class="sy0">=~</span> <span class="co2">/internal/</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="re0">$reporturl</span> <span class="sy0">=</span> <span class="st0">&quot;http://$nagiosname/cgi-bin/nagios3/status.cgi?hostgroup=prod-srv&amp;style=detail&amp;servicestatustypes=28&amp;serviceprops=8&amp;sorttype=1&amp;sortoption=6&amp;noheader&quot;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <span class="kw1">else</span>
    <span class="br0">&#123;</span>
        <span class="re0">$reporturl</span> <span class="sy0">=</span> <span class="st0">&quot;http://$nagiosname/cgi-bin/nagios3/status.cgi?style=detail&amp;servicestatustypes=28&amp;serviceprops=8&amp;sorttype=1&amp;sortoption=6&amp;noheader&quot;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
	<span class="co1"># Get all status</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span><span class="re0">$full</span><span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="re0">$reporturl</span><span class="sy0">=</span><span class="st0">&quot;http://$nagiosname/cgi-bin/nagios3/status.cgi?host=all&amp;sorttype=2&amp;sortoption=3&quot;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span>
<span class="co1">###############################################################################</span>
<span class="kw2">sub</span> main
<span class="br0">&#123;</span>
    debug<span class="br0">&#40;</span><span class="nu0">1</span><span class="sy0">,</span><span class="st0">&quot;reporturl: [$reporturl]&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
    <span class="re0">$mailbody</span> <span class="sy0">=</span> http_request<span class="br0">&#40;</span><span class="re0">$reporturl</span><span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
    <span class="kw3">open</span><span class="br0">&#40;</span>FILE<span class="sy0">,</span> <span class="st0">&quot;&gt; /tmp/nagios-report-htmlout.html&quot;</span><span class="br0">&#41;</span> <span class="kw1">or</span> <span class="kw3">warn</span> <span class="st0">&quot;can't open file /tmp/nagios-report-htmlout.html: $!<span class="es0">\n</span>&quot;</span><span class="sy0">;</span>
&#160;
    <span class="co1">#print &quot;DEBUG $mailbody\n\n\n\n&quot;;</span>
    <span class="kw3">print</span> FILE <span class="re0">$mailbody</span><span class="sy0">;</span>
    <span class="kw3">close</span> FILE<span class="sy0">;</span>
<span class="br0">&#125;</span>
<span class="co1">###############################################################################</span>
<span class="kw2">sub</span> check
<span class="br0">&#123;</span>
    <span class="kw3">open</span><span class="br0">&#40;</span>FILE<span class="sy0">,</span> <span class="st0">&quot;&lt;/tmp/nagios-report-htmlout.html&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">my</span> <span class="re0">$gotit</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="co1"># = 1 while having a service</span>
    <span class="kw1">my</span> <span class="re0">$service</span><span class="sy0">;</span>
    <span class="kw1">while</span><span class="br0">&#40;</span><span class="re4">&lt;FILE&gt;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
	<span class="kw3">chomp</span> <span class="co5">$_</span><span class="sy0">;</span>
	<span class="kw1">my</span> <span class="re0">$line</span> <span class="sy0">=</span> <span class="co5">$_</span><span class="sy0">;</span>
&#160;
	<span class="kw1">if</span><span class="br0">&#40;</span><span class="re0">$line</span> <span class="sy0">=~</span> <span class="co2">/\&amp;host=(.*?)&amp;service=(.*?)\'/</span><span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
	    <span class="co1">#print &quot;DEBUG ENTERS&#160;!!!\n&quot;;</span>
	    <span class="re0">$service</span> <span class="sy0">=</span> Service<span class="sy0">-&gt;</span><span class="me1">const</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	    <span class="re0">$service</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span>hostname<span class="br0">&#125;</span> <span class="sy0">=</span> <span class="co3">$1</span><span class="sy0">;</span>
	    <span class="re0">$service</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span>name<span class="br0">&#125;</span> <span class="sy0">=</span> <span class="co3">$2</span><span class="sy0">;</span>
	    <span class="re0">$service</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span>name<span class="br0">&#125;</span> <span class="sy0">=~</span> <span class="co2">s/\+/ /g</span><span class="sy0">;</span>
	    <span class="re0">$service</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span>name<span class="br0">&#125;</span> <span class="sy0">=~</span> <span class="co2">s/\%2F/\//g</span><span class="sy0">;</span>
	    <span class="re0">$service</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span>name<span class="br0">&#125;</span> <span class="sy0">=~</span> <span class="co2">s/\%3A/:/g</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">elsif</span><span class="br0">&#40;</span><span class="re0">$line</span> <span class="sy0">=~</span> <span class="co2">/CLASS=\'statusUNKNOWN/</span><span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
	    <span class="co1">#print &quot;DEBUG UNKNOWN&#160;!!\n&quot;;</span>
		<span class="re0">$service</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span>color<span class="br0">&#125;</span> <span class="sy0">=</span> <span class="st0">&quot;FFDA9F&quot;</span><span class="sy0">;</span>
		<span class="re0">$gotit</span> <span class="sy0">=</span><span class="nu0">1</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">elsif</span><span class="br0">&#40;</span><span class="re0">$line</span> <span class="sy0">=~</span> <span class="co2">/CLASS=\'statusWARNING/</span><span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
	    <span class="co1">#print &quot;DEBUG WARNING&#160;!!\n&quot;;</span>
		<span class="re0">$service</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span>color<span class="br0">&#125;</span> <span class="sy0">=</span> <span class="st0">&quot;FEFFC1&quot;</span><span class="sy0">;</span>
		<span class="re0">$gotit</span> <span class="sy0">=</span><span class="nu0">1</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">elsif</span><span class="br0">&#40;</span><span class="re0">$line</span> <span class="sy0">=~</span> <span class="co2">/CLASS=\'statusOK/</span><span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span><span class="re0">$full</span><span class="br0">&#41;</span>
		<span class="br0">&#123;</span>
	    	<span class="co1">#print &quot;DEBUG WARNING&#160;!!\n&quot;;</span>
			<span class="re0">$service</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span>color<span class="br0">&#125;</span> <span class="sy0">=</span> <span class="st0">&quot;99FF99&quot;</span><span class="sy0">;</span>
			<span class="re0">$gotit</span> <span class="sy0">=</span><span class="nu0">1</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">elsif</span><span class="br0">&#40;</span><span class="re0">$line</span> <span class="sy0">=~</span> <span class="co2">/CLASS=\'statusCRITICAL/</span><span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
	    <span class="co1">#print &quot;DEBUG CRITICAL&#160;!!\n&quot;;</span>
		<span class="re0">$service</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span>color<span class="br0">&#125;</span> <span class="sy0">=</span> <span class="st0">&quot;FFBBBB&quot;</span><span class="sy0">;</span>
		<span class="re0">$gotit</span> <span class="sy0">=</span><span class="nu0">1</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">elsif</span><span class="br0">&#40;</span><span class="re0">$line</span> <span class="sy0">=~</span> <span class="co2">/\'center\'\&gt;(.*?)\&lt;/</span><span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
	    <span class="co1">#print &quot;DEBUG MESSAGE&#160;!!\n&quot;;</span>
		<span class="re0">$service</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span>message<span class="br0">&#125;</span> <span class="sy0">=</span> <span class="co3">$1</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">elsif</span><span class="br0">&#40;</span><span class="re0">$line</span> <span class="sy0">=~</span> <span class="co2">/\&lt;\/TR\&gt;/</span><span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
	    <span class="kw1">if</span><span class="br0">&#40;</span><span class="re0">$gotit</span> <span class="sy0">==</span> <span class="nu0">1</span><span class="br0">&#41;</span>
	    <span class="br0">&#123;</span>
		<span class="co1">#print &quot;DEBUG PUSH&#160;! $service-&gt;{color}, $service-&gt;{name}, $service-&gt;{message}, $service-&gt;{hostname}, $service-&gt;{duration}\n&quot;;</span>
		<span class="kw3">push</span><span class="br0">&#40;</span><span class="re0">@services</span><span class="sy0">,</span> <span class="re0">$service</span><span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="re0">$gotit</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
	    <span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">elsif</span><span class="br0">&#40;</span><span class="re0">$line</span> <span class="sy0">=~</span> <span class="co2">/\&gt;\s*(\d+d\s*\d+h\s*\d+m\s*\d+s)/</span><span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
	    <span class="co1">#print &quot;DEBUG DURATION&#160;!!\n&quot;;</span>
		<span class="re0">$service</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span>duration<span class="br0">&#125;</span> <span class="sy0">=</span> <span class="co3">$1</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
    <span class="kw3">close</span><span class="br0">&#40;</span>FILE<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
    <span class="co1">#### mailbody creation ####</span>
&#160;
    <span class="kw3">push</span> <span class="re0">@finalmailbody</span><span class="sy0">,</span> <span class="st_h">'&lt;table width=&quot;100%&quot;&gt;&lt;tr class=&quot;titre&quot;&gt;&lt;td &gt;Hostname&lt;/td&gt;&lt;td&gt;Service&lt;/td&gt;&lt;td&gt;Duration&lt;/td&gt;&lt;td&gt;Status&lt;/td&gt;&lt;/tr&gt;'</span><span class="sy0">;</span>
    <span class="kw1">foreach</span> <span class="kw1">my</span> <span class="re0">$el</span> <span class="br0">&#40;</span><span class="re0">@services</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
	<span class="co1">#print &quot;DEBUG  HAD A SERVICE&#160;!\n&quot;;</span>
	<span class="kw3">push</span> <span class="re0">@finalmailbody</span><span class="sy0">,</span> <span class="st0">&quot;&lt;tr class=<span class="es0">\&quot;</span>el<span class="es0">\&quot;</span> bgcolor=<span class="es0">\&quot;</span>#$el-&gt;{color}<span class="es0">\&quot;</span>&gt;&lt;td&gt;$el-&gt;{hostname}&lt;/td&gt;&lt;td bgcolor=<span class="es0">\&quot;</span>#$el-&gt;{color}<span class="es0">\&quot;</span>&gt;$el-&gt;{name}&lt;/td&gt;&lt;td&gt;$el-&gt;{duration}&lt;/td&gt;&lt;td&gt;$el-&gt;{message}&lt;/td&gt;&lt;/tr&gt;<span class="es0">\n</span>&quot;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <span class="kw3">push</span> <span class="re0">@finalmailbody</span><span class="sy0">,</span> <span class="st_h">'&lt;/table&gt;'</span><span class="sy0">;</span>
&#160;
    <span class="re0">$mailbody</span> <span class="sy0">=</span> <span class="st_h">''</span><span class="sy0">;</span> <span class="co1">#Resetting values for next times</span>
    <span class="re0">@services</span> <span class="sy0">=</span> <span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">#Resetting values for next times</span>
<span class="br0">&#125;</span>
&#160;
<span class="co1">###############################################################################</span>
<span class="kw2">sub</span> help <span class="br0">&#123;</span>
<span class="kw3">print</span> <span class="sy0">&lt;&lt;</span>_END_<span class="sy0">;</span>
&#160;
Nagios web<span class="sy0">-&gt;</span><span class="me1">email</span> reporter program<span class="sy0">.</span>
&#160;
<span class="co3">$0</span> <span class="re4">&lt;args&gt;</span>
&#160;
<span class="sy0">--</span>help
	This screen
&#160;
<span class="sy0">--</span>email<span class="sy0">=</span><span class="re4">&lt;email&gt;</span>
	Send to this address instead of the default address
	<span class="st0">&quot;$mailto&quot;</span>
&#160;
<span class="sy0">-</span>names
    Names of the nagios servers you want to check <span class="br0">&#40;</span>multiple names is ok<span class="br0">&#41;</span>
&#160;
<span class="sy0">-</span>full
	Do <span class="kw1">not</span> <span class="kw3">send</span> only unhandled alerts but all <span class="br0">&#40;</span>even ok<span class="br0">&#41;</span>
&#160;
_END_
&#160;
<span class="kw3">exit</span> <span class="nu0">1</span><span class="sy0">;</span>
&#160;
<span class="br0">&#125;</span>
&#160;
<span class="co1">###############################################################################</span>
<span class="kw2">sub</span> http_request <span class="br0">&#123;</span>
	<span class="kw1">my</span> <span class="re0">$ua</span><span class="sy0">;</span>
	<span class="kw1">my</span> <span class="re0">$req</span><span class="sy0">;</span>
	<span class="kw1">my</span> <span class="re0">$res</span><span class="sy0">;</span>
&#160;
	<span class="kw1">my</span> <span class="re0">$geturl</span> <span class="sy0">=</span> <span class="kw3">shift</span><span class="sy0">;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw1">not</span> <span class="kw3">defined</span> <span class="re0">$geturl</span> <span class="kw1">or</span> <span class="re0">$geturl</span> <span class="kw1">eq</span> <span class="st0">&quot;&quot;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw3">warn</span> <span class="st0">&quot;No URL defined for http_request<span class="es0">\n</span>&quot;</span><span class="sy0">;</span>
		<span class="kw3">return</span> <span class="nu0">0</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
	<span class="re0">$ua</span> <span class="sy0">=</span> LWP<span class="sy0">::</span><span class="me2">UserAgent</span><span class="sy0">-&gt;</span><span class="kw2">new</span><span class="sy0">;</span>
	<span class="re0">$ua</span><span class="sy0">-&gt;</span><span class="me1">agent</span><span class="br0">&#40;</span><span class="st0">&quot;Nagios Report Generator &quot;</span> <span class="sy0">.</span> <span class="re0">$ua</span><span class="sy0">-&gt;</span><span class="me1">agent</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="re0">$req</span> <span class="sy0">=</span> HTTP<span class="sy0">::</span><span class="me2">Request</span><span class="sy0">-&gt;</span><span class="kw2">new</span><span class="br0">&#40;</span>GET <span class="sy0">=&gt;</span> <span class="re0">$geturl</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="re0">$req</span><span class="sy0">-&gt;</span><span class="me1">authorization_basic</span><span class="br0">&#40;</span><span class="re0">$webuser</span><span class="sy0">,</span> <span class="re0">$webpass</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="re0">$req</span><span class="sy0">-&gt;</span><span class="me1">header</span><span class="br0">&#40;</span>	<span class="st_h">'Accept'</span>			<span class="sy0">=&gt;</span>	<span class="st_h">'text/html'</span><span class="sy0">,</span>
				<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
	<span class="co1"># send request</span>
	<span class="re0">$res</span> <span class="sy0">=</span> <span class="re0">$ua</span><span class="sy0">-&gt;</span><span class="me1">request</span><span class="br0">&#40;</span><span class="re0">$req</span><span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
	<span class="co1"># check the outcome</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span><span class="re0">$res</span><span class="sy0">-&gt;</span><span class="me1">is_success</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
		debug<span class="br0">&#40;</span><span class="nu0">1</span><span class="sy0">,</span><span class="st0">&quot;Retreived URL successfully&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="kw3">return</span> <span class="re0">$res</span><span class="sy0">-&gt;</span><span class="me1">decoded_content</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">else</span> <span class="br0">&#123;</span>
		<span class="kw3">print</span> <span class="st0">&quot;Error: &quot;</span> <span class="sy0">.</span> <span class="re0">$res</span><span class="sy0">-&gt;</span><span class="me1">status_line</span> <span class="sy0">.</span> <span class="st0">&quot;<span class="es0">\n</span>&quot;</span><span class="sy0">;</span>
		<span class="kw3">return</span> <span class="nu0">0</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&#160;
<span class="co1">###############################################################################</span>
<span class="kw2">sub</span> debug <span class="br0">&#123;</span>
	<span class="kw1">my</span> <span class="br0">&#40;</span><span class="re0">$lvl</span><span class="sy0">,</span><span class="re0">$msg</span><span class="br0">&#41;</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span> <span class="kw3">defined</span> <span class="re0">$debug</span> <span class="kw1">and</span> <span class="re0">$lvl</span> <span class="sy0">&lt;=</span> <span class="re0">$debug</span> <span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw3">chomp</span><span class="br0">&#40;</span><span class="re0">$msg</span><span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="kw3">print</span> <span class="kw3">localtime</span><span class="br0">&#40;</span><span class="kw3">time</span><span class="br0">&#41;</span> <span class="sy0">.</span><span class="st0">&quot;: $msg<span class="es0">\n</span>&quot;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
	<span class="kw3">return</span> <span class="nu0">1</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&#160;
<span class="co1">###############################################################################</span>
<span class="kw2">sub</span> sendmail <span class="br0">&#123;</span>
	<span class="kw1">my</span> <span class="re0">$sender</span> <span class="sy0">=</span> <span class="kw2">new</span> Mail<span class="sy0">::</span><span class="me2">Sender</span> <span class="br0">&#123;</span>
		smtp <span class="sy0">=&gt;</span> <span class="st0">&quot;$mailsmtp&quot;</span><span class="sy0">,</span>
		from <span class="sy0">=&gt;</span> <span class="st0">&quot;$mailfrom&quot;</span><span class="sy0">,</span>
		on_errors <span class="sy0">=&gt;</span> <span class="st_h">'die'</span><span class="sy0">,</span>
	<span class="br0">&#125;</span><span class="sy0">;</span>
	<span class="re0">$sender</span><span class="sy0">-&gt;</span><span class="me1">Open</span><span class="br0">&#40;</span><span class="br0">&#123;</span>
		to <span class="sy0">=&gt;</span> <span class="st0">&quot;$mailto&quot;</span><span class="sy0">,</span>
	    subject <span class="sy0">=&gt;</span> <span class="re0">$mailsubject</span><span class="sy0">,</span>
	    ctype <span class="sy0">=&gt;</span> <span class="st0">&quot;text/html&quot;</span><span class="sy0">,</span>
	    encoding <span class="sy0">=&gt;</span> <span class="st0">&quot;quoted-printable&quot;</span>
	<span class="br0">&#125;</span><span class="br0">&#41;</span> <span class="kw1">or</span> <span class="kw3">die</span> <span class="re0">$Mail</span><span class="sy0">::</span><span class="me2">Sender</span><span class="sy0">::</span><span class="me2">Error</span><span class="sy0">,</span><span class="st0">&quot;<span class="es0">\n</span>&quot;</span><span class="sy0">;</span>
&#160;
	<span class="kw1">my</span> <span class="re0">$body_line</span><span class="sy0">;</span>	
	<span class="kw1">foreach</span> <span class="re0">$body_line</span> <span class="br0">&#40;</span><span class="re0">@finalmailbody</span><span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="re0">$sender</span><span class="sy0">-&gt;</span><span class="me1">SendEnc</span><span class="br0">&#40;</span><span class="re0">$body_line</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span><span class="sy0">;</span>
	<span class="re0">$sender</span><span class="sy0">-&gt;</span><span class="me1">Close</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&#160;
<span class="co1">###############################################################################</span></pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="References"><span class="mw-headline-number">4</span> References</span></h1>
<p>Ajoutez ensuite les droits d'exécution.
</p>
<h1><span class="mw-headline" id="Utilisation"><span class="mw-headline-number">5</span> Utilisation</span></h1>
<p>Pour l'utilisation, c'est relativement simple, il faut renseigner les informations présentes dans le script si vous souhaitez avoir des valeurs par défaut. Ensuite il est possible de spécifier en paramètre ces mêmes options ou non&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> morningchecks.pl</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">/usr/local/bin/morningchecks.pl -names nagios-prod
/usr/local/bin/morningchecks.pl -full -names nagios-prod --email=deimos@deimos.fr</pre></div></div>
</td></tr></table><br />
<p>Consultez également l'aide pour plus d'informations&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> morningchecks.pl</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; /usr/local/bin/morningchecks.pl --help
&#160;
Nagios web-&gt;email reporter program.
&#160;
/usr/local/bin/morningchecks.pl &lt;args&gt;
&#160;
--help
	This screen
&#160;
--email=&lt;email&gt;
	Send to this address instead of the default address
	&quot;deimos@deimos.fr&quot;
&#160;
-names
    Names of the nagios servers you want to check (multiple names is ok)
&#160;
-full
	Do not send only unhandled alerts but all (even ok)</pre></div></div>
</td></tr></table><br />

<!-- 
NewPP limit report
CPU time usage: 0.040 seconds
Real time usage: 0.042 seconds
Preprocessor visited node count: 107/1000000
Preprocessor generated node count: 374/1000000
Post‐expand include size: 1563/2097152 bytes
Template argument size: 373/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   22.230      1 - -total
 77.49%   17.227      1 - Template:Config
 10.88%    2.418      3 - Template:Command
  8.59%    1.910      1 - Template:Infobox
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:3472-0!*!*!1!en!5!* and timestamp 20181111230718 and revision id 12759
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=Emails_récapitulatif_des_alertes_Nagios_en_cours&amp;oldid=12759">https://wiki.deimos.fr/index.php?title=Emails_récapitulatif_des_alertes_Nagios_en_cours&amp;oldid=12759</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=Emails+r%C3%A9capitulatif+des+alertes+Nagios+en+cours" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="Emails_récapitulatif_des_alertes_Nagios_en_cours.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="Emails_récapitulatif_des_alertes_Nagios_en_cours.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="Emails_récapitulatif_des_alertes_Nagios_en_cours.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=Emails_r%C3%A9capitulatif_des_alertes_Nagios_en_cours&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=Emails_r%C3%A9capitulatif_des_alertes_Nagios_en_cours&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="Emails_récapitulatif_des_alertes_Nagios_en_cours.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/Emails_récapitulatif_des_alertes_Nagios_en_cours.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/Emails_r%C3%A9capitulatif_des_alertes_Nagios_en_cours" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=Emails_r%C3%A9capitulatif_des_alertes_Nagios_en_cours&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=Emails_r%C3%A9capitulatif_des_alertes_Nagios_en_cours&amp;oldid=12759" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=Emails_r%C3%A9capitulatif_des_alertes_Nagios_en_cours&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 2 August 2013, at 11:44.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":31});
}</script>
	</body>
</html>
	
<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>Sauvegardes, restaurations et transferts - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="Sauvegardes,_restaurations_et_transferts.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Sauvegardes,_restaurations_et_transferts","wgTitle":"Sauvegardes, restaurations et transferts","wgCurRevisionId":13013,"wgRevisionId":13013,"wgArticleId":1012,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Sauvegardes,_restaurations_et_transferts","wgRelevantArticleId":1012,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Sauvegardes_restaurations_et_transferts skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Sauvegardes, restaurations et transferts</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="Sauvegardes,_restaurations_et_transferts.html#mw-navigation">navigation</a>, 					<a href="Sauvegardes,_restaurations_et_transferts.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Sauvegardes,_restaurations_et_transferts.html#Sauvegardes"><span class="tocnumber">1</span> <span class="toctext">Sauvegardes</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="Sauvegardes,_restaurations_et_transferts.html#mysqldump"><span class="tocnumber">1.1</span> <span class="toctext">mysqldump</span></a>
<ul>
<li class="toclevel-3 tocsection-3"><a href="Sauvegardes,_restaurations_et_transferts.html#Sauvegarder_rapidement_chaque_base_de_donn.C3.A9es"><span class="tocnumber">1.1.1</span> <span class="toctext">Sauvegarder rapidement chaque base de données</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-4"><a href="Sauvegardes,_restaurations_et_transferts.html#mysqlhotcopy"><span class="tocnumber">1.2</span> <span class="toctext">mysqlhotcopy</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="Sauvegardes,_restaurations_et_transferts.html#Snapshot_LVM"><span class="tocnumber">1.3</span> <span class="toctext">Snapshot LVM</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="Sauvegardes,_restaurations_et_transferts.html#Restaurations"><span class="tocnumber">2</span> <span class="toctext">Restaurations</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="Sauvegardes,_restaurations_et_transferts.html#Transferts"><span class="tocnumber">3</span> <span class="toctext">Transferts</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="Sauvegardes,_restaurations_et_transferts.html#Scripts"><span class="tocnumber">4</span> <span class="toctext">Scripts</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="Sauvegardes,_restaurations_et_transferts.html#Backup_par_mail"><span class="tocnumber">4.1</span> <span class="toctext">Backup par mail</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="Sauvegardes,_restaurations_et_transferts.html#Sauvegarde_et_compression_de_toutes_les_bases"><span class="tocnumber">4.2</span> <span class="toctext">Sauvegarde et compression de toutes les bases</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="Sauvegardes,_restaurations_et_transferts.html#Transferts_d.27une_base_mysql_vers_une_autre_via_SSH"><span class="tocnumber">4.3</span> <span class="toctext">Transferts d'une base mysql vers une autre via SSH</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="Sauvegardes,_restaurations_et_transferts.html#Ressources"><span class="tocnumber">5</span> <span class="toctext">Ressources</span></a></li>
</ul>
</div>

<div class="thumb tright"><div class="thumbinner" style="width:130px;"><a href="./File:Mysql_logo.jpeg.html" class="image"><img alt="" src="images/e/e4/Mysql_logo.jpeg" width="128" height="130" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="./File:Mysql_logo.jpeg.html" class="internal" title="Enlarge"></a></div>MySQL Logo</div></div></div>
<h1><span class="mw-headline" id="Sauvegardes"><span class="mw-headline-number">1</span> Sauvegardes</span></h1>
<h2><span class="mw-headline" id="mysqldump"><span class="mw-headline-number">1.1</span> mysqldump</span></h2>
<p>Ceci est à mon sens LA meilleure méthode. Elle est fournit en standart et fonctionne très bien. <b>Cependant attention aux grosses bases de données</b>. Si vous avez de grosses bases, alors regardez du côté d'<a href="./Xtrabackup_:_Optimiser_ses_backups_MySQL.html" title="Xtrabackup : Optimiser ses backups MySQL">XtraBackup</a>.
</p><p>Son usage avec un shell est comme suit (pour des bases de petite taille)&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>mysqldump -uUTILISATEUR -pMOTDEPASSE -e --single-transaction --opt BASEDEDONNEES &gt; backup-`date +%y%m%d`.sql
</pre>
</td></tr></table><br />
<p>Pour sauvegarder toutes les bases d'un seul coup&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>mysqldump -uUTILISATEUR -pMOTDEPASSE --all-databases &gt; backup-`date +%y%m%d`.sql
</pre>
</td></tr></table><br />
<p>Il existe aussi d'autres options&#160;:
</p>
<ul><li> --no-data&#160;: permet de générer un fichir qui contient toutes les instructions de création des tables de votre base (CREATE DATABASE, CREATE TABLE...), mais pas les données elles-mêmes.</li>
<li> --no-createdb et --no-create-info permettent de commenter automatiquement les instructions de création de schéma. Donc d'insérer des données depuis une sauvegarde dans une base avec des tables existantes.</li>
<li> <b>--lock-tables&#160;: permet de poser un LOCK sur toute une base. On obtient alors une cohérence entre les tables, mais pas entre les bases.</b></li>
<li> <b>--lock-all-tables&#160;: permet de poser un LOCK sur toutes les tables. Soyez conscient des impacts d'un tel LOCK sur une grosse base de données non transactionnel comme MyISAM.</b> La mise en attente de toutes les requêtes pendant la durée de la sauvegarde pourraient faire croire au visiteurs que le serveur du site a planté. A la fin du dump, toutes les requêtes en attente seront exécutées (pas de pertes, sauf si la longueur de la queue a été dépassée).</li>
<li> -e&#160;: permet de cumuler les création d'éléments de même type (va donc plus vite à la réimportation</li>
<li> <b>--single-transaction&#160;: permet de lancer les sauvegardes dans une transaction. Elle garantit donc que les tables InnoDB (moteur transactionnel) seront dans un état cohérent entre elles. Les tables qui ne supportent pas les transactions seront également sauvegardées, mais la cohérence ne sera pas garantie (l'instruction BEGIN est simplement ignorée pour ces tables).</b> L'avantage de cette option est la non utilisation d'un LOCK. En faite, elles seront lockées à l'intérieur de la transaction, sans empêcher les autres clients de faire des modifications de la base.</li>
<li> --master-data&#160;: permet d'avoir les position du master pour la réplication directement dans le dump.</li>
<li> --opt&#160;: ajoute les drop-tables si elles existent.</li></ul>
<h3><span class="mw-headline" id="Sauvegarder_rapidement_chaque_base_de_donn.C3.A9es"><span class="mw-headline-number">1.1.1</span> Sauvegarder rapidement chaque base de données</span></h3>
<p>Pour sauvegarder simplement et rapidement chaque base de donnée, voici une solution&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>for I in `echo &quot;show databases;&quot; | mysql -uroot -p | grep -v Database`; do mysqldump -uroot -p -e --single-transaction --opt $I &gt; &quot;$I.sql&quot;; done
</pre>
</td></tr></table><br />
<p>A vous de mettre le mot de passe en dur (créez un user backup par exemple avec les droits de backup uniquement pour améliorer la sécu).
</p>
<h2><span class="mw-headline" id="mysqlhotcopy"><span class="mw-headline-number">1.2</span> mysqlhotcopy</span></h2>
<p>Cette commande est un script PERL livré avec MySQL qui effectue en gros une copie brut des fichiers. Cependant cette méthode est assez performante.
</p><p>Cette commande permet de faire&#160;:
</p>
<ul><li> cp&#160;: si c'est pour une sauvegarde en locale</li>
<li> scp&#160;: si c'est pour du distant</li></ul>
<p>Il pose lui même des fichiers de lock sur les tables à sauvegarder. Il existe aussi l'option <b>--record_log_pos qui permet d'enregistrer dans une table la position dans les journaux binaires lorsque le serveur est en mode maitre ou esclave (pour permettre de créer rapidement un nouvel esclave).</b> Quelques petits exemples pour une sauvegarde en local&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mysqlhotcopy</font>
</td></tr>
<tr>
<td>
<pre>mysqlhotcopy user password /var/lib/mysql/ma_base
</pre>
</td></tr></table><br />
<p>Et pour une sauvegarde distante&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mysqlhotcopy</font>
</td></tr>
<tr>
<td>
 <div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">mysqlhotcopy --user=user --password=pass user user@host:/home/mon_backup</pre></div></div>
</td></tr></table><br />
<p>Un petit inconvénient, mais qui a son importance&#160;: <b>mysqlhostcopy ne fonctionne qu'avec MyISAM et ARCHIVE</b>. Il existe un outil payant (HOT Backup) qui permet de faire la même chose mais avec InnoDB en plus.
</p>
<h2><span class="mw-headline" id="Snapshot_LVM"><span class="mw-headline-number">1.3</span> Snapshot LVM</span></h2>
<p>Je n'aborderais pas ici comment on utilise LVM, mais c'est la méthode à utiliser pour des grosses bases (16 Go par exemple).
</p><p>Tout d'abord, il faut poser un lock (et oui, on est quand même obligé, mais cela ne dure que quelques centièmes de secondes)&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mysql</font>
</td></tr>
<tr>
<td>
<pre>flush tables with read lock;
</pre>
</td></tr></table><br />
<p>Ensuite on fait notre snapshot&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lvcreate</font>
</td></tr>
<tr>
<td>
<pre>lvcreate --snapshot -n snap -L 16G /dev/volumegroupe/snapshot_mysql
</pre>
</td></tr></table><br />
<p>L'opération étant instantanée, nous pouvons enlever le lock&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mysql</font>
</td></tr>
<tr>
<td>
<pre>mysql&gt; unlock tables;
</pre>
</td></tr></table><br />
<h1><span class="mw-headline" id="Restaurations"><span class="mw-headline-number">2</span> Restaurations</span></h1>
<p>La restauration se fait en utilisant directement le programme principal&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>mysql -u&lt;user&gt; -p&lt;password&gt; &lt;database_name&gt; &lt; backup-`date +%y%m%d`.sql
</pre>
</td></tr></table><br />
<p>Si vous souhaitez ne restaurer qu'une seule base depuis un dump ou il y a toutes les bases&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">mysql -u&lt;user&gt; -p&lt;password&gt; --one-database &lt;database_name&gt; &lt; backup-`date +%y%m%d`.sql</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Transferts"><span class="mw-headline-number">3</span> Transferts</span></h1>
<p>Enfin, si l'objectif est de transférer la base d'une machine à l'autre, on peut combiner les deux appels sur une seule ligne&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
 <div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">mysqldump -uUTILISATEUR -pMOTDEPASSE BASEDEDONNEES | ssh utilisateur:motdepasse@IP &quot;cat &gt; myfile.sql&quot;</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Scripts"><span class="mw-headline-number">4</span> Scripts</span></h1>
<h2><span class="mw-headline" id="Backup_par_mail"><span class="mw-headline-number">4.1</span> Backup par mail</span></h2>
<p>Voici un petit script a adapter selon vos besoins&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> mysql_backup.sh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> #!/bin/sh
 ## MySQL Backup Script
 ## Made by Pierre Mavro
&#160;
 ## INFOS MYSQL ##
 LOGIN=root # Login for mysql
 PASS=toto # Pass for mysql
&#160;
 ## Email ##
 ADMINMAIL=user@fqdn.com # This is the mail were the saves will be send
&#160;
 ## Vars ##
 TMPDIR=/tmp/baksql # Temp directory
&#160;
 ## DO NOT MODIFY NOW ##
 mkdir $TMPDIR
 # Backuping databases
 for databases in &quot;cacti&quot; &quot;information_schema&quot; &quot;mysql&quot; &quot;snort&quot; &quot;wikidb&quot;&#160;; do
        mysqldump -u$LOGIN -p$PASS $databases &gt; $TMPDIR/$databases-`date +%y%m%d`.sql &amp;&amp; baksql=$baksql`echo &quot;Sauvegarde de la base $databases - OK&#160;; &quot;` || baksql=$baksql`echo &quot;Sauvegarde de la base $databases - FAILED&#160;; &quot;`
 done
&#160;
 # Compressing and emailing
 tar -czf $TMPDIR/mysql_backup.tgz $TMPDIR/*.sql &amp;&amp; echo &quot;`echo $baksql`&quot; | mutt -x -a $TMPDIR/mysql_backup.tgz -s &quot;MySQL backup - `date +%d\-%m\-%Y` - fire&quot; $ADMINMAIL
 rm -Rf $TMPDIR</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Sauvegarde_et_compression_de_toutes_les_bases"><span class="mw-headline-number">4.2</span> Sauvegarde et compression de toutes les bases</span></h2>
<p>Cette méthode plus fastidieuse à pour avantage la sauvegarde base par base qui permet de restaurer que la base qui vous intéresse en cas de problème.
</p><p>De plus, elle comprends de la compression à la volée de votre base. Il faudra cependant installer 7zip au préalable (j'ai fais le choix de 7zip pour avoir une meilleure compression).
</p><p>Nous allons créer un script que nous allons placer dans /etc/scripts par exemple&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/scripts/backup_mysql_databases.sh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">#!/bin/bash
user='root'
password='password'
destination='/tmp/backups_sql'
mail='my@mail.com'
&#160;
mkdir -p $destination
for i in `echo &quot;show databases;&quot; | mysql -u$user -p$password | grep -v Database`; do
       mysqldump -u$user -p$password --opt --add-drop-table --routines --triggers --events --single-transaction --master-data=2 -B $i | 7z a -t7z -mx=9 -si $destination/$i.sql.7z
done
&#160;
problem_text=''
problem=0
for i in `ls $destination/*`&#160;; do
    size=`du -sk $i | awk '{ print $1 }'`
    if [ $size -le 4 ]&#160;; then
        problem_text=&quot;$problem_text- $i database. Backupped database size is equal or under 4k ($size)\n&quot;
        problem=1
    fi  
done
&#160;
if [ $problem -ne 0 ]&#160;; then
    echo -e &quot;Backups problem detected on&#160;:\n\n$problem_text&quot; | mail -s &quot;$HOSTNAME - MySQL backup problem&quot; $mail
fi</pre></div></div>
</td></tr></table><br />
<p>Le problème ici est le mot de passe en clair. Vérifiez donc à bien restreindre à l'utilisateur qui va backuper&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>chmod 700 /etc/scripts/backup_mysql_databases.sh
</pre>
</td></tr></table><br />
<h2><span class="mw-headline" id="Transferts_d.27une_base_mysql_vers_une_autre_via_SSH"><span class="mw-headline-number">4.3</span> Transferts d'une base mysql vers une autre via SSH</span></h2>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> transfert.sh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">#!/bin/sh
## MySQL Backup Script
## Made by Pierre Mavro
&#160;
## INFOS MYSQL ##
LOGIN=root # Login for mysql
PASS=toto # Pass for mysql
&#160;
## SSH SERVER FOR TRANSFERT &amp; REINJECTION ##
MYSQLSRV2=&quot;192.168.0.1&quot;
&#160;
## Email ##
ADMINMAIL=user@fqdn.com # This is the mail were the transferts failures will be notified
&#160;
## Vars ##
TMPDIR=/tmp/baksql # Temp directory
&#160;
## DO NOT MODIFY NOW ##
mkdir $TMPDIR
# Backuping databases
for databases in &quot;bugzilla&quot; &quot;cacti&quot; &quot;mysql&quot; &quot;networkdb&quot; &quot;wiki&quot;&#160;; do
       mysqldump -u$LOGIN -p$PASS $databases &gt; $TMPDIR/$databases-`date +%y%m%d`.sql &amp;&amp; baksql=$baksql`echo &quot;Sauvegarde de la base $databases - OK&#160;; &quot;` || baksql=$baksql`echo &quot;Sauvegarde de la base $databases - FAILED&#160;; &quot;`
done
&#160;
# Transfering databases to the other SQL server (need ssh key)
tar -czf $TMPDIR/mysql_backup.tgz $TMPDIR/*.sql
scp $TMPDIR/mysql_backup.tgz $MYSQLSRV2:~/
ssh $MYSQLSRV2 tar -xzvf ~/mysql_backup.tgz
for databases in &quot;bugzilla&quot; &quot;cacti&quot; &quot;mysql&quot; &quot;networkdb&quot; &quot;wiki&quot;&#160;; do
        ssh $MYSQLSRV2 &quot;mysql -u$LOGIN -p$PASS $databases &lt; ~/tmp/baksql/$databases-`date +%y%m%d`.sql&quot; &amp;&amp; baksql=$baksql`echo &quot;Reinjection de la base $databases - OK&#160;; &quot;` || baksql=$baksql`echo &quot;Reinjection de la base $databases - FAILED&#160;; &quot;`
done
&#160;
# Delete temps
ssh $MYSQLSRV2 rm -Rf /root/tmp/baksql ~/mysql_backup.tgz ~/tmp
rm -Rf $TMPDIR
&#160;
# Send mail
echo $baksql | mail -s &quot;Mysql transferts&quot; $ADMINMAIL</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Ressources"><span class="mw-headline-number">5</span> Ressources</span></h1>
<p><a href="./File:How_To_Back_Up_MySQL_Databases_With_mylvmbackup.pdf.html" title="File:How To Back Up MySQL Databases With mylvmbackup.pdf">How To Back Up MySQL Databases With mylvmbackup</a>
</p>
<!-- 
NewPP limit report
CPU time usage: 0.040 seconds
Real time usage: 0.041 seconds
Preprocessor visited node count: 242/1000000
Preprocessor generated node count: 664/1000000
Post‐expand include size: 4059/2097152 bytes
Template argument size: 969/2097152 bytes
Highest expansion depth: 4/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    9.335      1 - -total
 39.51%    3.689     12 - Template:Command
 29.88%    2.790      3 - Template:Config
 21.93%    2.047      1 - Template:Mysql_backup_alldb_7z
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:1012-0!*!0!1!en!5!* and timestamp 20181111230656 and revision id 13013
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=Sauvegardes,_restaurations_et_transferts&amp;oldid=13013">https://wiki.deimos.fr/index.php?title=Sauvegardes,_restaurations_et_transferts&amp;oldid=13013</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=Sauvegardes%2C+restaurations+et+transferts" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="Sauvegardes,_restaurations_et_transferts.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="Sauvegardes,_restaurations_et_transferts.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="Sauvegardes,_restaurations_et_transferts.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=Sauvegardes,_restaurations_et_transferts&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=Sauvegardes,_restaurations_et_transferts&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="Sauvegardes,_restaurations_et_transferts.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/Sauvegardes,_restaurations_et_transferts.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/Sauvegardes,_restaurations_et_transferts" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=Sauvegardes,_restaurations_et_transferts&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=Sauvegardes,_restaurations_et_transferts&amp;oldid=13013" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=Sauvegardes,_restaurations_et_transferts&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 15 November 2013, at 12:46.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":31});
}</script>
	</body>
</html>
	
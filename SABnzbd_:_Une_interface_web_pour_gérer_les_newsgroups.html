<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>SABnzbd : Une interface web pour gérer les newsgroups - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=ext.cite.styles|mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups","wgTitle":"SABnzbd : Une interface web pour gérer les newsgroups","wgCurRevisionId":12585,"wgRevisionId":12585,"wgArticleId":3347,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups","wgRelevantArticleId":3347,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
.source-apache {line-height: normal;}
.source-apache li, .source-apache pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for apache
 * CSS class: source-apache, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.apache.source-apache .de1, .apache.source-apache .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.apache.source-apache  {font-family:monospace;}
.apache.source-apache .imp {font-weight: bold; color: red;}
.apache.source-apache li, .apache.source-apache .li1 {font-weight: normal; vertical-align:top;}
.apache.source-apache .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.apache.source-apache .li2 {font-weight: bold; vertical-align:top;}
.apache.source-apache .kw1 {color: #00007f;}
.apache.source-apache .kw2 {color: #0000ff;}
.apache.source-apache .kw3 {color: #000000; font-weight:bold;}
.apache.source-apache .co1 {color: #adadad; font-style: italic;}
.apache.source-apache .es0 {color: #000099; font-weight: bold;}
.apache.source-apache .br0 {color: #339933;}
.apache.source-apache .sy0 {color: #008000;}
.apache.source-apache .st0 {color: #7f007f;}
.apache.source-apache .nu0 {color: #ff0000;}
.apache.source-apache .ln-xtra, .apache.source-apache li.ln-xtra, .apache.source-apache div.ln-xtra {background-color: #ffc;}
.apache.source-apache span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
.source-bash {line-height: normal;}
.source-bash li, .source-bash pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for bash
 * CSS class: source-bash, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.bash.source-bash .de1, .bash.source-bash .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.bash.source-bash  {font-family:monospace;}
.bash.source-bash .imp {font-weight: bold; color: red;}
.bash.source-bash li, .bash.source-bash .li1 {font-weight: normal; vertical-align:top;}
.bash.source-bash .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.bash.source-bash .li2 {font-weight: bold; vertical-align:top;}
.bash.source-bash .kw1 {color: #000000; font-weight: bold;}
.bash.source-bash .kw2 {color: #c20cb9; font-weight: bold;}
.bash.source-bash .kw3 {color: #7a0874; font-weight: bold;}
.bash.source-bash .co0 {color: #666666; font-style: italic;}
.bash.source-bash .co1 {color: #800000;}
.bash.source-bash .co2 {color: #cc0000; font-style: italic;}
.bash.source-bash .co3 {color: #000000; font-weight: bold;}
.bash.source-bash .co4 {color: #666666;}
.bash.source-bash .es1 {color: #000099; font-weight: bold;}
.bash.source-bash .es2 {color: #007800;}
.bash.source-bash .es3 {color: #007800;}
.bash.source-bash .es4 {color: #007800;}
.bash.source-bash .es5 {color: #780078;}
.bash.source-bash .es_h {color: #000099; font-weight: bold;}
.bash.source-bash .br0 {color: #7a0874; font-weight: bold;}
.bash.source-bash .sy0 {color: #000000; font-weight: bold;}
.bash.source-bash .st0 {color: #ff0000;}
.bash.source-bash .st_h {color: #ff0000;}
.bash.source-bash .nu0 {color: #000000;}
.bash.source-bash .re0 {color: #007800;}
.bash.source-bash .re1 {color: #007800;}
.bash.source-bash .re2 {color: #007800;}
.bash.source-bash .re4 {color: #007800;}
.bash.source-bash .re5 {color: #660033;}
.bash.source-bash .ln-xtra, .bash.source-bash li.ln-xtra, .bash.source-bash div.ln-xtra {background-color: #ffc;}
.bash.source-bash span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
.source-python {line-height: normal;}
.source-python li, .source-python pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for python
 * CSS class: source-python, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.python.source-python .de1, .python.source-python .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.python.source-python  {font-family:monospace;}
.python.source-python .imp {font-weight: bold; color: red;}
.python.source-python li, .python.source-python .li1 {font-weight: normal; vertical-align:top;}
.python.source-python .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.python.source-python .li2 {font-weight: bold; vertical-align:top;}
.python.source-python .kw1 {color: #ff7700;font-weight:bold;}
.python.source-python .kw2 {color: #008000;}
.python.source-python .kw3 {color: #dc143c;}
.python.source-python .kw4 {color: #0000cd;}
.python.source-python .co1 {color: #808080; font-style: italic;}
.python.source-python .coMULTI {color: #808080; font-style: italic;}
.python.source-python .es0 {color: #000099; font-weight: bold;}
.python.source-python .br0 {color: black;}
.python.source-python .sy0 {color: #66cc66;}
.python.source-python .st0 {color: #483d8b;}
.python.source-python .nu0 {color: #ff4500;}
.python.source-python .me1 {color: black;}
.python.source-python .ln-xtra, .python.source-python li.ln-xtra, .python.source-python div.ln-xtra {background-color: #ffc;}
.python.source-python span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-SABnzbd_Une_interface_web_pour_gérer_les_newsgroups skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">SABnzbd : Une interface web pour gérer les newsgroups</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#mw-navigation">navigation</a>, 					<a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#Configuration"><span class="tocnumber">3</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#Apache"><span class="tocnumber">3.1</span> <span class="toctext">Apache</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#Lancement"><span class="tocnumber">4</span> <span class="toctext">Lancement</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#Scripts_de_post-traitement"><span class="tocnumber">5</span> <span class="toctext">Scripts de post-traitement</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#Am.C3.A9liorer_les_performances"><span class="tocnumber">6</span> <span class="toctext">Améliorer les performances</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#Sabnzbd"><span class="tocnumber">6.1</span> <span class="toctext">Sabnzbd</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#Syst.C3.A8me"><span class="tocnumber">6.2</span> <span class="toctext">Système</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#Outils_tiers"><span class="tocnumber">7</span> <span class="toctext">Outils tiers</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#Firefox"><span class="tocnumber">7.1</span> <span class="toctext">Firefox</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#sabnzbd_api.py"><span class="tocnumber">7.2</span> <span class="toctext">sabnzbd_api.py</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#References"><span class="tocnumber">8</span> <span class="toctext">References</span></a></li>
</ul>
</div>

<table class="config_array" align="right" style="width:20em; font-size:90%; text-align:left; border: 1px #d0e7ff solid; margin-left:10px;">
   <tr>
      <td class="config_subarray" colspan="2" style="text-align:center;"><a href="./File:Sabnzbd_logo.png.html" class="image" title="Sabnzbd"><img alt="Sabnzbd" src="images/3/3e/Sabnzbd_logo.png" width="220" height="60" /></a></td>
   </tr><tr><td colspan="2" style="text-align:center;"><hr class="gradient" /></td></tr><tr>
      <th>Software version</th>
      <td>0.6.15+</td>
   </tr><tr>
      <th>Operating System</th>
      <td>Debian 6/7</td>
   </tr><tr>
      <th>Website</th>
      <td><a rel="nofollow" class="external text" href="http://sabnzbd.org/">Sabnzbd Website</a></td>
   </tr><tr>
      <th>Last Update</th>
      <td>19/06/2013</td>
   </tr><tr>
      <th>Others</th>
      <td></td>
   </tr>
</table>
<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p>Vous n'avez peut être pas envie d'avoir un soft lourd qui tourne sur votre machine pour faire des newsgroups. C'est alors qu'un pote me parle de <a rel="nofollow" class="external text" href="http://sabnzbd.org/">SABnzbd</a>. Après avoir regardé un peu comment ça fonctionne, il s'avère effectivement que c'est particulièrement redoutable.<br />
J'ai donc décidé de faire une petite documentation pour la mise en place sur une Debian Squeeze.
</p>
<h1><span class="mw-headline" id="Installation"><span class="mw-headline-number">2</span> Installation</span></h1>
<p>Voici le minimum à installer pour Debian 6&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude install python-cheetah python-pyopenssl python-yenc</pre></div></div>
</td></tr></table><br />
<p>Pour Debian 7&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude install python-cheetah python-openssl python-yenc</pre></div></div>
</td></tr></table><br />
<p>Puis nous allons installer SABnzbd&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cd /var/www
wget &quot;http://downloads.sourceforge.net/project/sabnzbdplus/sabnzbdplus/sabnzbd-0.6.15/SABnzbd-0.6.15-src.tar.gz?r=http%3A%2F%2Fsabnzbd.org%2Fdownload%2F&amp;ts=1332934860&amp;use_mirror=freefr&quot; -o sab.tgz
tar -xzf sab.tgz
mv SABnzbd-0.6.15 sabnzbd
cd sabnzbd</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Configuration"><span class="mw-headline-number">3</span> Configuration</span></h1>
<h2><span class="mw-headline" id="Apache"><span class="mw-headline-number">3.1</span> Apache</span></h2>
<p>Vous n'avez peut être pas envie de devoir taper un autre port pour accéder à l'interface web. Le but donc est de le mettre derrière Apache qui fera lui même la redirection. Il va déjà falloir activer le module proxy d'apache&#160;:
</p><p><br />
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td>
<pre>aptitude install apache2 apache2-utils apache2.2-common libapache2-mod-proxy-html
</pre>
</td></tr></table><br />
<p>Then activate modules&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> a2enmod</font>
</td></tr>
<tr>
<td>
<pre>a2enmod proxy_connect
a2enmod proxy_http
a2enmod proxy_html
</pre>
</td></tr></table><br />
<p>And restart Apache.
</p><p>Et voici la configuration à appliquer et adapter à vos besoins&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/apache2/sites-enabled/000-default</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="apache source-apache"><pre class="de1">[...]
&lt;<span class="kw3">Location</span> /sabnzbd&gt;
<span class="kw1">order</span> <span class="kw1">deny</span>,<span class="kw1">allow</span>
<span class="kw1">deny</span> from <span class="kw2">all</span>
<span class="kw1">allow</span> from <span class="kw2">all</span>
<span class="kw1">ProxyPass</span> http://localhost:<span class="nu0">8080</span>/sabnzbd
<span class="kw1">ProxyPassReverse</span> http://localhost:<span class="nu0">8080</span>/sabnzbd
&lt;/<span class="kw3">Location</span>&gt;</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Lancement"><span class="mw-headline-number">4</span> Lancement</span></h1>
<p>Pour lancer le seveur&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> python</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">python ./SABnzbd.py -d</pre></div></div>
</td></tr></table><br />
<p>Connectez vous ensuite sur <a rel="nofollow" class="external free" href="http://localhost/SABnzbd">http://localhost/SABnzbd</a> (ou <a rel="nofollow" class="external free" href="http://localhost:8080/SABnzbd">http://localhost:8080/SABnzbd</a> si vous n'avez pas mis de conf apache) et configurez comme le vous voulez.
</p>
<h1><span class="mw-headline" id="Scripts_de_post-traitement"><span class="mw-headline-number">5</span> Scripts de post-traitement</span></h1>
<p>Il est possible que vous souhaitiez qu'une action se fasse automatiquement après chaque téléchargement. Dans mon cas, je souhaites que les fichiers présents ne restent pas plus de 15 jours. J'ai donc un script qui me fait le nettoyage que j'ai placé en crontab&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> /etc/scripts/delete_old_files.sh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1"><span class="co0">#!/bin/sh</span>
<span class="re2">folder</span>=<span class="st0">&quot;/mnt/sabnzbd/downloads&quot;</span>
<span class="re2">max_day</span>=<span class="nu0">15</span>
&#160;
<span class="kw1">for</span> user <span class="kw1">in</span> <span class="sy0">`</span><span class="kw2">ls</span> <span class="re1">$folder</span><span class="sy0">/`</span>&#160;; <span class="kw1">do</span>
    <span class="kw3">cd</span> <span class="re1">$folder</span>
    <span class="kw2">find</span> . <span class="re5">-mtime</span> +<span class="re1">$max_day</span> <span class="sy0">!</span> <span class="re5">-name</span> <span class="st_h">'.'</span> <span class="sy0">!</span> <span class="re5">-exec</span> <span class="kw2">rm</span> <span class="re5">-f</span> <span class="br0">&#123;</span><span class="br0">&#125;</span> \;
    <span class="kw2">find</span> . <span class="re5">-type</span> d <span class="sy0">!</span> <span class="re5">-name</span> <span class="st_h">'.'</span> <span class="sy0">!</span> <span class="re5">-name</span> <span class="st_h">'..'</span> <span class="re5">-exec</span> <span class="kw2">rmdir</span> <span class="br0">&#123;</span><span class="br0">&#125;</span> \;
<span class="kw1">done</span></pre></div></div>
</td></tr></table><br />
<p>Le soucis c'est qu'il me dégage des fichiers qui ont été créer il y a plus de 15 jours mais que j'ai téléchargé il y a moins de 15 jours.<br />
Exemple&#160;: je télécharge une ISO Ubuntu qui date d'il y a 5 mois. Elle figure dans un fichier compressé (zip par exemple) que je télécharge, Sabnzbd s'occupe de le décompresser, mais le fichier au final date d'il y a 5 mois et non de la date de décompression. Il faut donc une solution pour modifier la date du fichier à aujourd'hui. Créons par exemple un dossier de scripts&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mkdir</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1"><span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="sy0">/</span>etc<span class="sy0">/</span>scripts<span class="sy0">/</span>sabnzbd</pre></div></div>
</td></tr></table><br />
<p>Puis nous allons mettre un script de post traitement&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/scripts/sabnzbd/postscript.sh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1"><span class="co0">#!/bin/sh</span>
<span class="re2">tmp_renamed_folder</span>=<span class="sy0">`</span><span class="kw3">echo</span> <span class="st0">&quot;$1&quot;</span> <span class="sy0">|</span> <span class="kw2">perl</span> <span class="re5">-pe</span> <span class="st_h">'s/\ |-/_/g'</span><span class="sy0">`</span>
<span class="re2">renamed_folder</span>=<span class="sy0">`</span><span class="kw3">echo</span> <span class="st0">&quot;<span class="es2">$tmp_renamed_folder</span>&quot;</span> <span class="sy0">|</span> <span class="kw2">perl</span> <span class="re5">-pe</span> <span class="st_h">'s/_+/_/g'</span><span class="sy0">`</span>
<span class="kw2">mv</span> <span class="st0">&quot;$1&quot;</span> <span class="re1">$renamed_folder</span> <span class="nu0">2</span><span class="sy0">&gt;/</span>dev<span class="sy0">/</span>null
<span class="kw2">find</span> <span class="re1">$renamed_folder</span> <span class="re5">-exec</span> <span class="kw2">touch</span> <span class="br0">&#123;</span><span class="br0">&#125;</span> \;
<span class="kw3">exit</span> <span class="nu0">0</span></pre></div></div>
</td></tr></table><br />
<p>Ce script renomme les dossiers contenant un - ou des espaces par des _. Et il concatène les multiples _ par un seul. Ensuite il change la date des fichiers et dossier. Pourquoi faire ça alors que des options de renommage sont disponibles directement dans SABnzbd&#160;? Tout simplement parce que ces opérations se font lors de l'import d'un nzb et non lors d'un renommage. Mais vu que ça pose des problèmes pour la commande find, j'ai choisis de faire du renommage.
</p><p>Mettez les bons droits&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> chmod</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">chmod 755 /etc/scripts/sabnzbd/postscript.sh</pre></div></div>
</td></tr></table><br />
<p>Pour savoir comment ça fonctionne, je vous invite à lire <a rel="nofollow" class="external text" href="http://wiki.sabnzbd.org/user-scripts">ce lien</a><sup id="cite_ref-1" class="reference"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#cite_note-1">[1]</a></sup>
</p><p>Ensuite, configurez comme ceci Sabnzbd (depuis l'interface web) pour qu'il connaisse le lieu de vos scripts et qu'il les utilise automatiquement&#160;:
</p>
<ol><li> Configuration -&gt; Répertoires -&gt; Dossier des scripts de post-traitement -&gt; /etc/scripts/sabnzbd</li>
<li> Configuration -&gt; Catégories -&gt; Par Défaut -&gt; Script -&gt; postscript.sh</li></ol>
<p>Et voilà&#160;:-). Vos téléchargements seront post processés et auront la date et l'heure de fin de téléchargement des fichiers&#160;:-)
</p>
<h1><span class="mw-headline" id="Am.C3.A9liorer_les_performances"><span class="mw-headline-number">6</span> Améliorer les performances</span></h1>
<h2><span class="mw-headline" id="Sabnzbd"><span class="mw-headline-number">6.1</span> Sabnzbd</span></h2>
<p>Par défaut, le téléchargement et le yencode se passe sur disque. Il est possible de tout faire en RAM. Évidement c'est consommateur de RAM, mais la différence de vitesse est phénoménale&#160;! C'est à dire que vous doublerez au moins les performances&#160;! Personnellement j'ai quadruplé les vitesses de download&#160;:-). Voici comment j'ai procédé, allez dans l'interface graphique puis&#160;:<br />
Configuration -&gt; Générale -&gt; Réglages -&gt; Limite d'article en cache -&gt; 250M
</p>
<h2><span class="mw-headline" id="Syst.C3.A8me"><span class="mw-headline-number">6.2</span> Système</span></h2>
<p>Au niveau du système, <a href="Optimisation_des_filesystems_extX_et_du_RAID_sous_Linux.html#noatime" title="Optimisation des filesystems extX et du RAID sous Linux">activez le noatime sur vos partitions</a><sup id="cite_ref-2" class="reference"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#cite_note-2">[2]</a></sup>.
</p>
<h1><span class="mw-headline" id="Outils_tiers"><span class="mw-headline-number">7</span> Outils tiers</span></h1>
<h2><span class="mw-headline" id="Firefox"><span class="mw-headline-number">7.1</span> Firefox</span></h2>
<p>Je vous recommande <a rel="nofollow" class="external text" href="https://addons.mozilla.org/en-US/firefox/addon/nzbdstatus/?src=external-sabfront">nzbdStatus</a> pour Firefox et <a rel="nofollow" class="external text" href="http://itunes.apple.com/fr/app/sabmobile/id392506842?mt=8">SABMobile pour iPhone</a> ou pour <a rel="nofollow" class="external text" href="https://play.google.com/store/apps/details?id=com.patey.SABMobile&amp;hl=fr">Android</a>.
</p>
<h2><span class="mw-headline" id="sabnzbd_api.py"><span class="mw-headline-number">7.2</span> sabnzbd_api.py</span></h2>
<p>J'ai écris un script en python permettant de jouer avec l'API que délivre Sabnzbd. Je l'ai créer dans l'idée qu'il soit facile de rajouter une fonctionnalité via l'API. Ce script permet&#160;:
</p>
<ul><li> De voir les éléments que fournit l'API XML</li>
<li> De supprimer un certain nombre d'éléments dans l'historique</li></ul>
<p>Voici le script. Editez le début du script et insérez l'URL, ainsi que la clé API &#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> sabnzbd_api.py</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="python source-python"><pre class="de1"><span class="co1">#!/usr/bin/env python</span>
<span class="co1"># Made by Deimos &lt;deimos@deimos.fr&gt;</span>
<span class="co1"># Under GPL2 licence</span>
&#160;
<span class="co1"># Set Sabnzbd URL</span>
sabnzbd_url <span class="sy0">=</span> <span class="st0">'http://127.0.0.1:8080/sabnzbd'</span>
<span class="co1"># Set Sabnzbd API</span>
sabnzbd_api <span class="sy0">=</span> <span class="st0">'2d872eb6257123a9579da906b487e1de'</span>
&#160;
<span class="co1">#############################################################</span>
&#160;
<span class="co1"># Load modules</span>
<span class="kw1">import</span> argparse
<span class="kw1">from</span> <span class="kw3">urllib2</span> <span class="kw1">import</span> Request<span class="sy0">,</span> urlopen<span class="sy0">,</span> URLError
<span class="kw1">from</span> lxml <span class="kw1">import</span> etree
<span class="kw1">import</span> <span class="kw3">sys</span>
&#160;
<span class="kw1">def</span> Debug<span class="br0">&#40;</span>debug_text<span class="br0">&#41;</span>:
    <span class="st0">&quot;&quot;&quot;Debug function&quot;&quot;&quot;</span>
    <span class="kw1">if</span> debug_mode <span class="sy0">==</span> <span class="kw2">True</span>:
        <span class="kw1">print</span> debug_text
&#160;
<span class="kw1">def</span> args<span class="br0">&#40;</span><span class="br0">&#41;</span>:
    <span class="st0">&quot;&quot;&quot;Command line parameters&quot;&quot;&quot;</span>
    <span class="co1"># Define globla vars</span>
    <span class="kw1">global</span> sabnzbd_url<span class="sy0">,</span> sabnzbd_api<span class="sy0">,</span> debug_mode<span class="sy0">,</span> mode<span class="sy0">,</span> keep_history
&#160;
    <span class="co1"># Main informations</span>
    <span class="kw3">parser</span> <span class="sy0">=</span> argparse.<span class="me1">ArgumentParser</span><span class="br0">&#40;</span>description<span class="sy0">=</span><span class="st0">&quot;Sabnzbd API usage in python&quot;</span><span class="br0">&#41;</span>
    subparsers <span class="sy0">=</span> <span class="kw3">parser</span>.<span class="me1">add_subparsers</span><span class="br0">&#40;</span>title<span class="sy0">=</span><span class="st0">'Available sub-commands'</span><span class="sy0">,</span> <span class="kw2">help</span><span class="sy0">=</span><span class="st0">'Choose a subcommand (-h for help)'</span><span class="sy0">,</span> description<span class="sy0">=</span><span class="st0">'Set a valid subcommand'</span><span class="sy0">,</span> dest<span class="sy0">=</span><span class="st0">&quot;subcmd_name&quot;</span><span class="br0">&#41;</span>
    <span class="co1"># Default args</span>
    <span class="kw3">parser</span>.<span class="me1">add_argument</span><span class="br0">&#40;</span><span class="st0">'-u'</span><span class="sy0">,</span> <span class="st0">'--url'</span><span class="sy0">,</span> action<span class="sy0">=</span><span class="st0">'store'</span><span class="sy0">,</span> dest<span class="sy0">=</span><span class="st0">'url'</span><span class="sy0">,</span> <span class="kw2">type</span><span class="sy0">=</span><span class="kw2">str</span><span class="sy0">,</span> default<span class="sy0">=</span>sabnzbd_url<span class="sy0">,</span> <span class="kw2">help</span><span class="sy0">=</span><span class="st0">'Set Sabnzbd URL (default&#160;:&#160;%(default)s)'</span><span class="br0">&#41;</span>
    <span class="kw3">parser</span>.<span class="me1">add_argument</span><span class="br0">&#40;</span><span class="st0">'-a'</span><span class="sy0">,</span> <span class="st0">'--api'</span><span class="sy0">,</span> action<span class="sy0">=</span><span class="st0">'store'</span><span class="sy0">,</span> dest<span class="sy0">=</span><span class="st0">'api'</span><span class="sy0">,</span> <span class="kw2">type</span><span class="sy0">=</span><span class="kw2">str</span><span class="sy0">,</span> default<span class="sy0">=</span>sabnzbd_api<span class="sy0">,</span> <span class="kw2">help</span><span class="sy0">=</span><span class="st0">'Set Sabnzbd API key'</span><span class="br0">&#41;</span>
    <span class="kw3">parser</span>.<span class="me1">add_argument</span><span class="br0">&#40;</span><span class="st0">'-v'</span><span class="sy0">,</span> <span class="st0">'--version'</span><span class="sy0">,</span> action<span class="sy0">=</span><span class="st0">'version'</span><span class="sy0">,</span> version<span class="sy0">=</span><span class="st0">'v0.1 Licence GPLv2'</span><span class="sy0">,</span> <span class="kw2">help</span><span class="sy0">=</span><span class="st0">'Version 0.1'</span><span class="br0">&#41;</span>
    <span class="kw3">parser</span>.<span class="me1">add_argument</span><span class="br0">&#40;</span><span class="st0">'-d'</span><span class="sy0">,</span> <span class="st0">'--debug'</span><span class="sy0">,</span> action<span class="sy0">=</span><span class="st0">'store_true'</span><span class="sy0">,</span> default<span class="sy0">=</span><span class="kw2">False</span><span class="sy0">,</span> <span class="kw2">help</span><span class="sy0">=</span><span class="st0">'Debug mode'</span><span class="br0">&#41;</span>
    <span class="co1"># Show XML API</span>
    parser_xa <span class="sy0">=</span> subparsers.<span class="me1">add_parser</span><span class="br0">&#40;</span><span class="st0">'xa'</span><span class="sy0">,</span> <span class="kw2">help</span><span class="sy0">=</span><span class="st0">'Show XML Elements from API'</span><span class="br0">&#41;</span>
    <span class="co1"># Delete history</span>
    parser_dh <span class="sy0">=</span> subparsers.<span class="me1">add_parser</span><span class="br0">&#40;</span><span class="st0">'dh'</span><span class="sy0">,</span> <span class="kw2">help</span><span class="sy0">=</span><span class="st0">'Delete old history'</span><span class="br0">&#41;</span>
    parser_dh.<span class="me1">add_argument</span><span class="br0">&#40;</span><span class="st0">'-k'</span><span class="sy0">,</span> <span class="st0">'--keep'</span><span class="sy0">,</span> action<span class="sy0">=</span><span class="st0">'store'</span><span class="sy0">,</span> dest<span class="sy0">=</span><span class="st0">'num'</span><span class="sy0">,</span> <span class="kw2">type</span><span class="sy0">=</span><span class="kw2">int</span><span class="sy0">,</span> default<span class="sy0">=</span><span class="nu0">150</span><span class="sy0">,</span> <span class="kw2">help</span><span class="sy0">=</span><span class="st0">'Number of items to keep in history (default&#160;:&#160;%(default)s)'</span><span class="br0">&#41;</span>
&#160;
    result <span class="sy0">=</span> <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
&#160;
    <span class="co1"># Set debug to True if requested by command line</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>result.<span class="me1">debug</span> <span class="sy0">==</span> <span class="kw2">True</span><span class="br0">&#41;</span>:
        debug_mode<span class="sy0">=</span><span class="kw2">True</span>
    <span class="kw1">else</span>:
        debug_mode<span class="sy0">=</span><span class="kw2">False</span>
    <span class="co1"># Send debug informations</span>
    Debug<span class="br0">&#40;</span><span class="st0">'Command line&#160;: '</span> + <span class="kw2">str</span><span class="br0">&#40;</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
    Debug<span class="br0">&#40;</span><span class="st0">'Command line vars&#160;: '</span> + <span class="kw2">str</span><span class="br0">&#40;</span><span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
&#160;
    <span class="co1"># Check defaults options</span>
    <span class="kw1">if</span> result.<span class="me1">url</span> <span class="sy0">!=</span> sabnzbd_url:
        sabnzbd_url <span class="sy0">=</span> result.<span class="me1">url</span>
    <span class="kw1">elif</span> result.<span class="me1">api</span> <span class="sy0">!=</span> sabnzbd_api:
        sabnzbd_api <span class="sy0">=</span> result.<span class="me1">api</span>
&#160;
    <span class="co1"># Managing options</span>
    mode<span class="sy0">=</span>result.<span class="me1">subcmd_name</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>mode <span class="sy0">==</span> <span class="st0">'dh'</span><span class="br0">&#41;</span>:
        keep_history<span class="sy0">=</span>result.<span class="me1">num</span>
&#160;
<span class="kw1">def</span> GetSabUrl<span class="br0">&#40;</span>sabnzbd_url<span class="sy0">,</span> sabnzbd_api<span class="br0">&#41;</span>:
    <span class="st0">&quot;&quot;&quot;Concat Sabnzbd URL
    Check that the connection to URL is correct and TCP is OK&quot;&quot;&quot;</span>
    <span class="co1"># Concat</span>
    sab_url <span class="sy0">=</span> sabnzbd_url + <span class="st0">'/api?mode=history&amp;output=xml&amp;apikey='</span> + sabnzbd_api
    Debug<span class="br0">&#40;</span><span class="st0">'Concatened Sabnzbd URL&#160;: '</span> + <span class="kw2">str</span><span class="br0">&#40;</span>sab_url<span class="br0">&#41;</span><span class="br0">&#41;</span>
&#160;
    <span class="co1"># Connectivity test</span>
    request <span class="sy0">=</span> Request<span class="br0">&#40;</span>sab_url<span class="br0">&#41;</span>
    <span class="kw1">try</span>:
        response <span class="sy0">=</span> urlopen<span class="br0">&#40;</span>request<span class="br0">&#41;</span>
    <span class="kw1">except</span> URLError<span class="sy0">,</span> e:
        <span class="kw1">if</span> <span class="kw2">hasattr</span><span class="br0">&#40;</span>e<span class="sy0">,</span> <span class="st0">'reason'</span><span class="br0">&#41;</span>:
            <span class="kw1">print</span> <span class="st0">'Can<span class="es0">\'</span>t connect to server&#160;: '</span> + <span class="kw2">str</span><span class="br0">&#40;</span>e.<span class="me1">reason</span><span class="br0">&#41;</span>
            <span class="kw3">sys</span>.<span class="me1">exit</span><span class="br0">&#40;</span><span class="nu0">1</span><span class="br0">&#41;</span>
        <span class="kw1">elif</span> <span class="kw2">hasattr</span><span class="br0">&#40;</span>e<span class="sy0">,</span> <span class="st0">'code'</span><span class="br0">&#41;</span>:
            <span class="kw1">print</span> <span class="st0">'The server couldn<span class="es0">\'</span>t fulfill the request.'</span> + <span class="kw2">str</span><span class="br0">&#40;</span>e.<span class="kw3">code</span><span class="br0">&#41;</span>
            <span class="kw3">sys</span>.<span class="me1">exit</span><span class="br0">&#40;</span><span class="nu0">1</span><span class="br0">&#41;</span>
    <span class="kw1">else</span>:
        Debug<span class="br0">&#40;</span><span class="st0">'Sabnzbd TCP connection OK'</span><span class="br0">&#41;</span>
    <span class="kw1">return</span> sab_url
&#160;
<span class="kw1">def</span> GetXmlHistory<span class="br0">&#40;</span>sab_url<span class="br0">&#41;</span>:
    <span class="st0">&quot;&quot;&quot;Get XML nzo_id entries&quot;&quot;&quot;</span>
    xml_history <span class="sy0">=</span>  <span class="br0">&#91;</span><span class="br0">&#93;</span>
    <span class="co1"># Parse XML from given url</span>
    xml_content <span class="sy0">=</span> etree.<span class="me1">parse</span><span class="br0">&#40;</span>sab_url<span class="br0">&#41;</span>
    <span class="co1"># Select only the wished tag and push it in xml_history list</span>
    <span class="kw1">for</span> node <span class="kw1">in</span> xml_content.<span class="me1">xpath</span><span class="br0">&#40;</span><span class="st0">&quot;///*&quot;</span><span class="br0">&#41;</span>:
        <span class="kw1">if</span> <span class="br0">&#40;</span>node.<span class="me1">tag</span> <span class="sy0">==</span> <span class="st0">'nzo_id'</span><span class="br0">&#41;</span>:
            <span class="co1"># Reencode value to avoid errors</span>
            tag_value <span class="sy0">=</span> <span class="kw2">unicode</span><span class="br0">&#40;</span>node.<span class="me1">text</span><span class="br0">&#41;</span>.<span class="me1">encode</span><span class="br0">&#40;</span><span class="st0">'utf8'</span><span class="br0">&#41;</span>
            <span class="co1">#Debug(node.tag + '&#160;: ' + tag_value)</span>
            xml_history.<span class="me1">append</span><span class="br0">&#40;</span>tag_value<span class="br0">&#41;</span>
    Debug<span class="br0">&#40;</span><span class="st0">'XML history has '</span> + <span class="kw2">str</span><span class="br0">&#40;</span><span class="kw2">len</span><span class="br0">&#40;</span>xml_history<span class="br0">&#41;</span><span class="br0">&#41;</span> + <span class="st0">' entries'</span><span class="br0">&#41;</span>
&#160;
    <span class="co1"># If there were no entry in the list, check if the API failed</span>
    <span class="kw1">if</span> <span class="kw2">len</span><span class="br0">&#40;</span>xml_history<span class="br0">&#41;</span> <span class="sy0">==</span> <span class="nu0">0</span>:
        Debug<span class="br0">&#40;</span><span class="st0">'Checking why there is no datas'</span><span class="br0">&#41;</span>
        xml_content <span class="sy0">=</span> etree.<span class="me1">parse</span><span class="br0">&#40;</span>sab_url<span class="br0">&#41;</span>
        <span class="kw1">for</span> node <span class="kw1">in</span> xml_content.<span class="me1">xpath</span><span class="br0">&#40;</span><span class="st0">&quot;//*&quot;</span><span class="br0">&#41;</span>:
            <span class="kw1">if</span> <span class="br0">&#40;</span>node.<span class="me1">tag</span> <span class="sy0">==</span> <span class="st0">'error'</span><span class="br0">&#41;</span>:
                <span class="kw1">print</span> <span class="st0">'Can<span class="es0">\'</span>t connect to server&#160;: '</span> + <span class="kw2">unicode</span><span class="br0">&#40;</span>node.<span class="me1">text</span><span class="br0">&#41;</span>.<span class="me1">encode</span><span class="br0">&#40;</span><span class="st0">'utf8'</span><span class="br0">&#41;</span>
                <span class="kw3">sys</span>.<span class="me1">exit</span><span class="br0">&#40;</span><span class="nu0">1</span><span class="br0">&#41;</span>
&#160;
    <span class="kw1">return</span> xml_history
&#160;
<span class="kw1">def</span> DeleteHistory<span class="br0">&#40;</span>xml_history<span class="sy0">,</span>keep_history<span class="br0">&#41;</span>:
    <span class="st0">&quot;&quot;&quot;Delete old history&quot;&quot;&quot;</span>
    <span class="co1"># Create a new list contaning elements to remove</span>
    elements2delete <span class="sy0">=</span> <span class="br0">&#91;</span><span class="br0">&#93;</span>
    element_number<span class="sy0">=</span><span class="nu0">1</span>
    <span class="kw1">for</span> element <span class="kw1">in</span> xml_history:
        <span class="kw1">if</span> element_number <span class="sy0">&gt;</span> keep_history:
            elements2delete.<span class="me1">append</span><span class="br0">&#40;</span>element<span class="br0">&#41;</span>
        element_number +<span class="sy0">=</span> <span class="nu0">1</span>
    queue_elements2remove<span class="sy0">=</span><span class="st0">','</span>.<span class="me1">join</span><span class="br0">&#40;</span>elements2delete<span class="br0">&#41;</span>
    Debug<span class="br0">&#40;</span><span class="st0">'Elements to delete ('</span> + <span class="kw2">str</span><span class="br0">&#40;</span><span class="kw2">len</span><span class="br0">&#40;</span>xml_history<span class="br0">&#41;</span><span class="br0">&#41;</span> + <span class="st0">' - '</span> + <span class="kw2">str</span><span class="br0">&#40;</span>keep_history<span class="br0">&#41;</span>  + <span class="st0">' = '</span> + <span class="kw2">str</span><span class="br0">&#40;</span><span class="kw2">len</span><span class="br0">&#40;</span>elements2delete<span class="br0">&#41;</span><span class="br0">&#41;</span>  + <span class="st0">')'</span><span class="br0">&#41;</span>
&#160;
    <span class="co1"># Concat URL with elements to remove and then remove</span>
    sab_url_remove <span class="sy0">=</span> sabnzbd_url + <span class="st0">'/api?mode=history&amp;name=delete&amp;value='</span> + queue_elements2remove + <span class="st0">'&amp;apikey='</span> + sabnzbd_api
    urlopen<span class="br0">&#40;</span>sab_url_remove<span class="br0">&#41;</span>
&#160;
<span class="kw1">def</span> ShowXMLElements<span class="br0">&#40;</span>sab_url<span class="br0">&#41;</span>:
    <span class="st0">&quot;&quot;&quot;Show XML code from URL&quot;&quot;&quot;</span>
    xml_content <span class="sy0">=</span> etree.<span class="me1">parse</span><span class="br0">&#40;</span>sab_url<span class="br0">&#41;</span>
    <span class="kw1">for</span> node <span class="kw1">in</span> xml_content.<span class="me1">xpath</span><span class="br0">&#40;</span><span class="st0">&quot;//*&quot;</span><span class="br0">&#41;</span>:
        <span class="kw1">print</span> node.<span class="me1">tag</span> + <span class="st0">'&#160;: '</span> + <span class="kw2">unicode</span><span class="br0">&#40;</span>node.<span class="me1">text</span><span class="br0">&#41;</span>.<span class="me1">encode</span><span class="br0">&#40;</span><span class="st0">'utf8'</span><span class="br0">&#41;</span>
&#160;
<span class="kw1">def</span> main<span class="br0">&#40;</span><span class="br0">&#41;</span>:
    <span class="st0">&quot;&quot;&quot;Main function that launch all of them&quot;&quot;&quot;</span>
    <span class="co1"># Set args and get debug mode</span>
    args<span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="co1"># Get Sabnzbd URL and check connectivity</span>
    sab_url <span class="sy0">=</span> GetSabUrl<span class="br0">&#40;</span>sabnzbd_url<span class="sy0">,</span> sabnzbd_api<span class="br0">&#41;</span>
    <span class="co1"># Delete old history</span>
    <span class="kw1">if</span> mode <span class="sy0">==</span> <span class="st0">'dh'</span>:
        xml_history <span class="sy0">=</span> GetXmlHistory<span class="br0">&#40;</span>sab_url<span class="br0">&#41;</span>
        DeleteHistory<span class="br0">&#40;</span>xml_history<span class="sy0">,</span>keep_history<span class="br0">&#41;</span>
    <span class="kw1">elif</span> mode <span class="sy0">==</span> <span class="st0">'xa'</span>:
        ShowXMLElements<span class="br0">&#40;</span>sab_url<span class="br0">&#41;</span>
&#160;
<span class="kw1">if</span> __name__ <span class="sy0">==</span> <span class="st0">&quot;__main__&quot;</span>:
    main<span class="br0">&#40;</span><span class="br0">&#41;</span></pre></div></div>
</td></tr></table><br />
<p>Pour la partie utilisation, elle se découpe en 2&#160;:
</p>
<ul><li> Les commandes principales</li>
<li> Les sous commandes (fonctions demandées)</li></ul>
<p>Voici comment l'utiliser&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> sabnzbd_api.py</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; sabnzbd_api.py -h
usage: sabnzbd_api.py [-h] [-u URL] [-a API] [-v] [-d] {xa,dh} ...
&#160;
Sabnzbd API usage in python
&#160;
optional arguments:
  -h, --help         show this help message and exit
  -u URL, --url URL  Set Sabnzbd URL (default&#160;: http://127.0.0.1:8080/sabnzbd)
  -a API, --api API  Set Sabnzbd API key
  -v, --version      Version 0.1
  -d, --debug        Debug mode
&#160;
Available sub-commands:
  Set a valid subcommand
&#160;
  {xa,dh}            Choose a subcommand (-h for help)
    xa               Show XML Elements from API
    dh               Delete old history</pre></div></div>
</td></tr></table><br />
<p>Pour utiliser la sous commande dh qui permet de supprimer l'historique&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> sabnzbd_api.py</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; sabnzbd_api.py dh -h
usage: sabnzbd_api.py dh [-h] [-k NUM]
&#160;
optional arguments:
  -h, --help          show this help message and exit
  -k NUM, --keep NUM  Number of items to keep in history (default&#160;: 150)</pre></div></div>
</td></tr></table><br />
<p>Ici, si je supprime -h, il supprimera l'historique de queue suppérieur à 150 entrées.
</p>
<h1><span class="mw-headline" id="References"><span class="mw-headline-number">8</span> References</span></h1>
<ol class="references">
<li id="cite_note-1"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#cite_ref-1">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://wiki.sabnzbd.org/user-scripts">http://wiki.sabnzbd.org/user-scripts</a></span>
</li>
<li id="cite_note-2"><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#cite_ref-2">^</a> <span class="reference-text"><a href="Optimisation_des_filesystems_extX_et_du_RAID_sous_Linux.html#noatime" title="Optimisation des filesystems extX et du RAID sous Linux">Optimisation des filesystems extX et du RAID sous Linux#noatime</a></span>
</li>
</ol>

<!-- 
NewPP limit report
CPU time usage: 0.088 seconds
Real time usage: 0.086 seconds
Preprocessor visited node count: 346/1000000
Preprocessor generated node count: 1020/1000000
Post‐expand include size: 4141/2097152 bytes
Template argument size: 1059/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   48.814      1 - -total
 48.70%   23.774      3 - Template:Config
 33.27%   16.240     11 - Template:Command
  4.35%    2.122      1 - Template:Infobox
  3.10%    1.513      1 - Template:Apache_proxy_installation
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:3347-0!*!0!1!en!5!* and timestamp 20181111230641 and revision id 12585
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups&amp;oldid=12585">https://wiki.deimos.fr/index.php?title=SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups&amp;oldid=12585</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=SABnzbd+%3A+Une+interface+web+pour+g%C3%A9rer+les+newsgroups" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=SABnzbd_:_Une_interface_web_pour_g%C3%A9rer_les_newsgroups&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=SABnzbd_:_Une_interface_web_pour_g%C3%A9rer_les_newsgroups&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="./SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/SABnzbd_:_Une_interface_web_pour_gérer_les_newsgroups.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/SABnzbd_:_Une_interface_web_pour_g%C3%A9rer_les_newsgroups" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=SABnzbd_:_Une_interface_web_pour_g%C3%A9rer_les_newsgroups&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=SABnzbd_:_Une_interface_web_pour_g%C3%A9rer_les_newsgroups&amp;oldid=12585" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=SABnzbd_:_Une_interface_web_pour_g%C3%A9rer_les_newsgroups&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 19 June 2013, at 11:48.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["ext.cite.a11y","mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":31});
}</script>
	</body>
</html>
	
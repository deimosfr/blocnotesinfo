<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>Introduction à Packet Filter - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="Introduction_à_Packet_Filter.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Introduction_à_Packet_Filter","wgTitle":"Introduction à Packet Filter","wgCurRevisionId":9398,"wgRevisionId":9398,"wgArticleId":1977,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Introduction_à_Packet_Filter","wgRelevantArticleId":1977,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
.source-pf {line-height: normal;}
.source-pf li, .source-pf pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for pf
 * CSS class: source-pf, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.pf.source-pf .de1, .pf.source-pf .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.pf.source-pf  {font-family:monospace;}
.pf.source-pf .imp {font-weight: bold; color: red;}
.pf.source-pf li, .pf.source-pf .li1 {font-weight: normal; vertical-align:top;}
.pf.source-pf .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.pf.source-pf .li2 {font-weight: bold; vertical-align:top;}
.pf.source-pf .kw1 {color: #009900; font-weight: bold;}
.pf.source-pf .kw2 {color: #990000; font-weight: bold;}
.pf.source-pf .kw3 {color: #7a0874;}
.pf.source-pf .kw4 {color: #336699;}
.pf.source-pf .co0 {color: #666666; font-style: italic;}
.pf.source-pf .co1 {color: #800000;}
.pf.source-pf .co2 {color: #cc0000; font-style: italic;}
.pf.source-pf .co3 {color: #000000; font-weight: bold;}
.pf.source-pf .es1 {color: #000099; font-weight: bold;}
.pf.source-pf .es2 {color: #007800;}
.pf.source-pf .es3 {color: #007800;}
.pf.source-pf .es4 {color: #007800;}
.pf.source-pf .es5 {color: #780078;}
.pf.source-pf .es_h {color: #000099; font-weight: bold;}
.pf.source-pf .br0 {color: #7a0874; font-weight: bold;}
.pf.source-pf .sy0 {color: #000000; font-weight: bold;}
.pf.source-pf .st0 {color: #CC0000;}
.pf.source-pf .st_h {color: #CC0000;}
.pf.source-pf .nu0 {color: #ff00cc;}
.pf.source-pf .re0 {color: #007800;}
.pf.source-pf .re1 {color: #007800;}
.pf.source-pf .re2 {color: #007800;}
.pf.source-pf .re4 {color: #007800;}
.pf.source-pf .re5 {color: #660033;}
.pf.source-pf .re6 {color: #000099; font-weight: bold;}
.pf.source-pf .re7 {color: #0000ff;}
.pf.source-pf .ln-xtra, .pf.source-pf li.ln-xtra, .pf.source-pf div.ln-xtra {background-color: #ffc;}
.pf.source-pf span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Introduction_à_Packet_Filter skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Introduction à Packet Filter</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="Introduction_à_Packet_Filter.html#mw-navigation">navigation</a>, 					<a href="Introduction_à_Packet_Filter.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Introduction_à_Packet_Filter.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Introduction_à_Packet_Filter.html#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="Introduction_à_Packet_Filter.html#FreeBSD"><span class="tocnumber">2.1</span> <span class="toctext">FreeBSD</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="Introduction_à_Packet_Filter.html#OpenBSD"><span class="tocnumber">2.2</span> <span class="toctext">OpenBSD</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="Introduction_à_Packet_Filter.html#Configuration"><span class="tocnumber">3</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="Introduction_à_Packet_Filter.html#Macros_.26_Listes"><span class="tocnumber">3.1</span> <span class="toctext">Macros &amp; Listes</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="Introduction_à_Packet_Filter.html#Macros"><span class="tocnumber">3.1.1</span> <span class="toctext">Macros</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="Introduction_à_Packet_Filter.html#Listes"><span class="tocnumber">3.1.2</span> <span class="toctext">Listes</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="Introduction_à_Packet_Filter.html#Mix_des_Macros_et_Listes"><span class="tocnumber">3.1.3</span> <span class="toctext">Mix des Macros et Listes</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-10"><a href="Introduction_à_Packet_Filter.html#Les_Tables"><span class="tocnumber">3.2</span> <span class="toctext">Les Tables</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="Introduction_à_Packet_Filter.html#NAT"><span class="tocnumber">3.3</span> <span class="toctext">NAT</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="Introduction_à_Packet_Filter.html#Redirections_de_paquets"><span class="tocnumber">3.4</span> <span class="toctext">Redirections de paquets</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="Introduction_à_Packet_Filter.html#Les_r.C3.A8gles_de_filtrage"><span class="tocnumber">3.5</span> <span class="toctext">Les règles de filtrage</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14"><a href="Introduction_à_Packet_Filter.html#Utilisation"><span class="tocnumber">4</span> <span class="toctext">Utilisation</span></a>
<ul>
<li class="toclevel-2 tocsection-15"><a href="Introduction_à_Packet_Filter.html#Modifications_.C3.A0_la_vol.C3.A9e"><span class="tocnumber">4.1</span> <span class="toctext">Modifications à la volée</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-16"><a href="Introduction_à_Packet_Filter.html#Exemples_pratique"><span class="tocnumber">5</span> <span class="toctext">Exemples pratique</span></a>
<ul>
<li class="toclevel-2 tocsection-17"><a href="Introduction_à_Packet_Filter.html#Simple"><span class="tocnumber">5.1</span> <span class="toctext">Simple</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="Introduction_à_Packet_Filter.html#Avanc.C3.A9"><span class="tocnumber">5.2</span> <span class="toctext">Avancé</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="Introduction_à_Packet_Filter.html#Ma_config"><span class="tocnumber">5.3</span> <span class="toctext">Ma config</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-20"><a href="Introduction_à_Packet_Filter.html#Les_Logs"><span class="tocnumber">6</span> <span class="toctext">Les Logs</span></a></li>
<li class="toclevel-1 tocsection-21"><a href="Introduction_à_Packet_Filter.html#Fonctions_avanc.C3.A9es_de_PF"><span class="tocnumber">7</span> <span class="toctext">Fonctions avancées de PF</span></a></li>
<li class="toclevel-1 tocsection-22"><a href="Introduction_à_Packet_Filter.html#FAQ"><span class="tocnumber">8</span> <span class="toctext">FAQ</span></a>
<ul>
<li class="toclevel-2 tocsection-23"><a href="Introduction_à_Packet_Filter.html#no_IP_address_found_for_tun0"><span class="tocnumber">8.1</span> <span class="toctext">no IP address found for tun0</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-24"><a href="Introduction_à_Packet_Filter.html#Ressources"><span class="tocnumber">9</span> <span class="toctext">Ressources</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p><a rel="nofollow" class="external text" href="http://fr.wikipedia.org/wiki/Packet_Filter">Packet Filter</a> (ou PF) est le pare-feu logiciel et officiel de <b>OpenBSD</b>, écrit à l'origine par Daniel Hartmeier. C'est un Logiciel Libre gratuit.
</p><p>Il remplace IPFilter de Darren Reed depuis la version 3.0 de OpenBSD, suite à des problèmes de licence mais aussi des refus systématiques de Reed d'incorporer des modifications de code venant de développeurs OpenBSD.
</p><p>Il a été porté sur DragonflyBSD 1.2 et NetBSD 3.0&#160;; il est fourni en standard sur FreeBSD (version 5.3 et ultérieures).
</p><p>Un port gratuit de PF a également été réalisé pour les systèmes d'exploitation Windows 2000 et XP par la communauté Core FORCE. Ce port n'est cependant qu'un firewall personnel&#160;: il n'implémente pas les fonctions de PF permettant de faire du NAT ou d'utiliser ALTQ
</p>
<h1><span class="mw-headline" id="Installation"><span class="mw-headline-number">2</span> Installation</span></h1>
<h2><span class="mw-headline" id="FreeBSD"><span class="mw-headline-number">2.1</span> FreeBSD</span></h2>
<p>Insérez dans /etc/rc.conf les entrées suivantes:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/rc.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">pf_enable=&quot;YES&quot;                 # Charger PF
pf_rules=&quot;/etc/pf.conf&quot;         # Règles, chemin par défaut par défaut.
pf_flags=&quot;&quot;                     # Bonus
pflog_enable=&quot;YES&quot;              # démarrer le journal
pflog_logfile=&quot;/var/log/pflog&quot;  # où trouver le journal
pflog_flags=&quot;&quot;                  # Bonus</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="OpenBSD"><span class="mw-headline-number">2.2</span> OpenBSD</span></h2>
<p>Vive OpenBSD&#160;:-), pas besoin d'installer quoi que ce soit, il est par défaut sur le système. Il suffit juste de le configurer et l'activer. Pour le configurer éditez le fichier /etc/pf.conf.
</p>
<h1><span class="mw-headline" id="Configuration"><span class="mw-headline-number">3</span> Configuration</span></h1>
<p>Nous allons voir ici plusieurs exemples pour apprendre à l'utiliser.
</p>
<h2><span class="mw-headline" id="Macros_.26_Listes"><span class="mw-headline-number">3.1</span> Macros &amp; Listes</span></h2>
<h3><span class="mw-headline" id="Macros"><span class="mw-headline-number">3.1.1</span> Macros</span></h3>
<p>On peu définir des macros pour remplacer des variables revenant souvent (IP, interfaces...)&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"> <span class="re2">if_ext</span><span class="sy0">=</span><span class="st0">&quot;ne0&quot;</span>
 <span class="re2">ssh</span><span class="sy0">=</span><span class="st0">&quot;192.168.0.1&quot;</span></pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="Listes"><span class="mw-headline-number">3.1.2</span> Listes</span></h3>
<p>Les listes permettent de rassembler des critères dans une variable&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"> <span class="kw2">block</span> <span class="kw4">out</span> <span class="kw3">on</span> <span class="re1">$if_ext</span> <span class="kw4">proto</span> tcp from <span class="br0">&#123;</span> <span class="re6">192.168.0.1</span>, <span class="re6">10.8.0.6</span> <span class="br0">&#125;</span> to any port <span class="br0">&#123;</span> <span class="nu0">22</span> <span class="nu0">80</span> <span class="br0">&#125;</span></pre></div></div>
</td></tr></table><br />
<p>Cette ligne permet d'exécuter 4 règles d'un coup&#160;! Pour les plus newbies cette ligne va bloquer&#160;:
</p>
<ul><li> 192.168.0.1 sur le port 80</li>
<li> 192.168.0.1 sur le port 22</li>
<li> 10.8.0.6 sur le port 80</li>
<li> 10.8.0.6 sur le port 22</li></ul>
<h3><span class="mw-headline" id="Mix_des_Macros_et_Listes"><span class="mw-headline-number">3.1.3</span> Mix des Macros et Listes</span></h3>
<p>Pour mixer le tout&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"> <span class="re2">if_ext</span><span class="sy0">=</span><span class="st0">&quot;ne0&quot;</span>
 <span class="re2">trusted</span><span class="sy0">=</span><span class="st0">&quot;{ 192.168.0.1, 10.8.0.6 }&quot;</span>
 <span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$if_ext</span> inet <span class="kw4">proto</span> tcp from <span class="br0">&#123;</span> <span class="re6">10.10.0.0</span><span class="sy0">/</span><span class="nu0">24</span> <span class="re1">$trusted</span> <span class="br0">&#125;</span> to port <span class="nu0">22</span></pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Les_Tables"><span class="mw-headline-number">3.2</span> Les Tables</span></h2>
<p>Les tables permettent de stocker un grand nombre d'adresses (50 ou 50000, même combat), et sont ensuite utilisées directement dans les règles de filtrage/NAT/redirection. La recherche d'une adresse dans une table en mémoire est beaucoup plus rapide, et moins coûteuse en temps processeur/mémoire que la recherche dans un jeu de règles correspondant chacune à une valeur d'une liste d'adresses.
</p><p>Il existe plusieurs mots clefs pour les tables avec des fonctions différentes&#160;:
</p>
<ul><li> <b>cont</b>&#160;: utilisé lorsqu'on veut que la table ne puisse pas être modifiée</li>
<li> <b>persist</b>&#160;: indique à PF de ne pas supprimer une table non référencée par une règle.</li></ul>
<p>L'avantage d'une table <b>non</b> const par rapport aux listes est que l'on peut ajouter/supprimer à la volée des adresses ou sous-réseaux dans une table, <b>utile pour bloquer un certain temps l'adresses d'un spammeur, d'un script-kiddie ou gérer la redirection vers un ensemble de serveurs faisant de la haute disponibilité.</b>
</p><p>Enfin cerise sur le gâteau, on peut initialiser une table avec un fichier contenant une liste d'adresses&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"> <span class="kw3">table</span> <span class="re7">&lt;privateip&gt;</span> const <span class="br0">&#123;</span> <span class="re6">192.168.0.0</span><span class="sy0">/</span><span class="nu0">24</span>, <span class="re6">10.8.0.0</span><span class="sy0">/</span><span class="nu0">8</span> <span class="br0">&#125;</span>
 <span class="kw3">table</span> <span class="re7">&lt;spammers&gt;</span> <span class="kw3">persist</span> <span class="kw3">file</span> <span class="st0">&quot;/etc/spammers&quot;</span>
 <span class="kw2">block</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$if_ext</span> from <span class="br0">&#123;</span> <span class="re7">&lt;privateip&gt;, &lt;spammer&gt;</span> <span class="br0">&#125;</span> to any</pre></div></div>
</td></tr></table><br />
<p>Et donc maintenant, si nous voulons ajouter ou supprimer des IP&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> pfctl</font>
</td></tr>
<tr>
<td>
<pre>pfctl -t spammers -T add 218.70.0.0/16
pfctl -t spammers -T delete 218.70.0.12
</pre>
</td></tr></table><br />
<p>Pour tout supprimer&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> pfctl</font>
</td></tr>
<tr>
<td>
<pre>pfctl -t spammers -T flush
</pre>
</td></tr></table><br />
<h2><span class="mw-headline" id="NAT"><span class="mw-headline-number">3.3</span> NAT</span></h2>
<p>Je vais pas expliquer ce que fais la NAT ici, mais comment l'utiliser sous PF. On va donc d'abord activer le forwarding de paquet, il faut mettre dans /etc/sysctl.conf&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/sysctl.conf</font>
</td></tr>
<tr>
<td>
<pre>net.inet.ip.forwarding=1
</pre>
</td></tr></table><br />
<p>Ceci rendra persistant la NAT.<br />
Il ne faut pas oublier que les paquets vont passer à travers le filtre de paquets après avoir été modifés, sauf si l'on utilise le mot-clé <b>pass</b>. Et ceci s'applique aussi à <b>RDR</b> que nous verrons plus bas. Voici une règle NAT&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"> nat <span class="br0">&#91;</span><span class="kw1">pass</span><span class="br0">&#93;</span> <span class="kw3">on</span> interface <span class="br0">&#91;</span>address_family<span class="br0">&#93;</span> from src_addr <span class="br0">&#91;</span>port src_port<span class="br0">&#93;</span> to dst_addr <span class="br0">&#91;</span>port dst_port<span class="br0">&#93;</span> -<span class="sy0">&gt;</span> ext_addr</pre></div></div>
</td></tr></table><br />
<p>Si on décortique (entre crochets&#160;: variable, italique&#160;: facultatif)&#160;:
</p>
<ul><li> nat&#160;: indique que c'est une règle nat</li>
<li> pass&#160;: le paquet est NATé, et envoyé directement sans passer par le filtre de paquet</li>
<li> on <i>interface</i>&#160;: le paquet est arrivé sur telle interface réseau ($if_ext, ne0...)</li>
<li> <i>address_family</i>&#160;: <b>inet ou niet6</b>, c'est un détail qui peut avoir son importance</li>
<li> from <i>src_addr'</i>&#160;: le paquet provient de telle adresse. Ici pour l'adresse, on peut spécifier plein de trucs&#160;:
<ul><li> une adresse IP</li>
<li> un CIDR</li>
<li> un DNS qui sera résolu par PF lors du chargement des règles</li>
<li> une interface réseau</li>
<li> une <a href="Introduction_à_Packet_Filter.html#Les_Tables" title="Introduction à Packet Filter">Table</a> ou une <a href="Introduction_à_Packet_Filter.html#Listes" title="Introduction à Packet Filter">Liste</a></li>
<li> n'importe laquelle de ces notations, précédée d'un&#160;! pour signifier la négation</li>
<li> enfin <b>any</b> pour n'importe quelle adresse</li></ul></li>
<li> port <i>src_port</i>&#160;: si on veut NATer uniquement un certain port ou une plage de ports...rarement utiliser</li>
<li> to <i>dst_addr</i>&#160;: le paquet est destiné à telle adresse. Mêmes possibilités que pour src_addr</li>
<li> -&gt; ext&#160;: remplacer l'adresse source par cette adresse. Le reoutr se fera tout seul par magie. Et si cette adresse change (attribuée par DHCP), on peut ici spécifier le nom de l'interface réseau entre parenthèses (rl0), et l'adresse sera automatiquement mise à jour dans la règle.</li></ul>
<p>Maintenant un petit exemple. Si on souhaites partager sa connexion internet avec son réseau local&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"> nat <span class="kw3">on</span> r10 inet from ne3&#160;: network to any -<span class="sy0">&gt;</span> <span class="br0">&#40;</span>r10<span class="br0">&#41;</span></pre></div></div>
</td></tr></table><br />
<p>Ouala, c'est pas la même avec Iptables hein&#160;!
</p>
<h2><span class="mw-headline" id="Redirections_de_paquets"><span class="mw-headline-number">3.4</span> Redirections de paquets</span></h2>
<p>RDR est le petit frère caché de NAT, à savoir qu'il fait tout l'inverse de son grand frère&#160;: il prend les paquets arrivant de l'extérieur pour les rediriger sur le réseau local. Voici un exemple de syntaxe&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"> rdr <span class="kw1">pass</span> <span class="kw3">on</span> interface <span class="br0">&#91;</span>address_family<span class="br0">&#93;</span> from src_addr <span class="br0">&#91;</span>port src_port<span class="br0">&#93;</span> to dst_addr <span class="br0">&#91;</span>port dst_port<span class="br0">&#93;</span> -<span class="sy0">&gt;</span> int_addr <span class="br0">&#91;</span>port int_port<span class="br0">&#93;</span></pre></div></div>
</td></tr></table><br />
<p>C'est la même syntaxe que pour la NAT à quelques exceptions près du genre&#160;: Je redirige ce qui était à destination de <b>dst_addr:dst_port</b> version <b>int_addr:int_port</b> et comme pour la NAT, le retour se fera tout seul.
</p><p>Si par exemple je veux accéder depuis l'extérieur sur le SSH d'une de mes machines sur le réseau local&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"> rdr <span class="kw1">pass</span> <span class="kw3">on</span> <span class="re1">$external</span> <span class="kw4">proto</span> tcp to port <span class="nu0">35422</span> -<span class="sy0">&gt;</span> <span class="re1">$diane</span> port ssh</pre></div></div>
</td></tr></table><br />
<p>Et maintenant, on peut accéder depuis l'extérieur à la machine dans mon lan via mon adresse ip externe et le port 35422.
</p><p>Vous remarquerez que j'ai utiliser ssh comme nom. Tous les noms présents dans /etc/services peuvent être utilisés.
</p>
<h2><span class="mw-headline" id="Les_r.C3.A8gles_de_filtrage"><span class="mw-headline-number">3.5</span> Les règles de filtrage</span></h2>
<p>Les règles de filtrage sont évaluées de façon séquentielle de la prmière à la dernière (du haut vers le bas dans les fichiers de règles utilisés). Ce qui veut dire que chaque paquet va être évalué oar chaque règle, et la dernière règle correspondant au paquet emporte la décision (<b>block</b> ou <b>pass</b>). Au contraire, si on utilise le mot clef <b>quick</b>, l'évaluation s'arrête dès qu'une règle correspond au paquet. La prmière règle (implicite) est un "tout laisser passer' de sorte que si aucune règle n'est applicable à un paquet, celui-ci est accepté. C'est pourquoi généralement la première règle explicite est un <b>block all</b>.
</p><p>Voici la syntaxe&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"> action <span class="br0">&#91;</span>direction<span class="br0">&#93;</span> <span class="br0">&#91;</span>log<span class="br0">&#93;</span> <span class="br0">&#91;</span><span class="kw3">quick</span><span class="br0">&#93;</span> <span class="br0">&#91;</span><span class="kw3">on</span> interface<span class="br0">&#93;</span> <span class="br0">&#91;</span>address_family<span class="br0">&#93;</span> <span class="br0">&#91;</span><span class="kw4">proto</span> protocol<span class="br0">&#93;</span> <span class="br0">&#91;</span>from src_addr <span class="br0">&#91;</span>port src_port<span class="br0">&#93;</span><span class="br0">&#93;</span> <span class="br0">&#91;</span>to dst_addr <span class="br0">&#91;</span>port dst_port<span class="br0">&#93;</span><span class="br0">&#93;</span> <span class="br0">&#91;</span><span class="kw3">flags</span> tcp_flags<span class="br0">&#93;</span> <span class="br0">&#91;</span><span class="kw3">state</span><span class="br0">&#93;</span></pre></div></div>
</td></tr></table><br />
<ul><li> action&#160;: au choix, <b>block</b> ou <b>pass</b>. La politique pour les paquets bloqués sera <b>drop</b> ou <b>return</b> en fonction de l'option <b>block-policy</b>. Par défaut c'est drop.</li>
<li> direction&#160;: <b>in</b> ou <b>out</b>, si on veut filtrer le trafic entrant ou sortant de l'interface. Si on ne met rien, la règle sera évaluée pour les deux sens.</li>
<li> log&#160;: si ce flag est présent, on enregistre la décision prise pour cette règle concernant le paquet. Pour analyser ceci, <b>pflog</b> sera notre ami.</li>
<li> quick&#160;: J'en ai déjà parlé, si ce flag est aussi présent et que le paquet matche la règle, il ne sera plus analysé/trituré, et la décision prise par cette règle sera notre dernié mot Jean-Pierre (ok elle est pas terrible celle là m'enfin bon...)</li>
<li> proto protocol&#160;: un protocol de niveau 4, généralement tcp,udp ou icmp, mais on peut aussi rencontrer n'importe quel protocole de niveau 4 référencé dans /etc/protocols. On peut même l'appeller par son petit numéro&#160;!</li>
<li> port dst_port&#160;: On peut ici spécifier un intervalle complexe de ports avec les opérateurs &lt;, &lt;=, &gt;=, &gt;, &lt;&gt; et&#160;:, voyez avec man pf.conf.</li>
<li> flags tcp_flags_check/mask&#160;: on peut spécifier des vérifications supplémentaires sur les drapeaux d'un paquet TCP, par exemple pour traiter les ouvertures de session TCP. On utilise souvent flag S/SA que je traduirais par "cette règle s'applique sur les paquets TCP qui ont, sur les deux drapeaux SYN et ACK, eulement SYN positionné". Si les 2 drapeaux sont positionnés, le paquet ne matchera pas la règle. Pour les autres flags, RTFM un peu.</li>
<li> state&#160;: ici on utilise généralement deux possibilité&#160;:
<ul><li> keep state&#160;: utilisé quand on veut créer une entrée dans la table des états de connexions lorsqu'un paquet matche la règle, et appliquer la même politique aux paquets suivants prenant part à la connexion. Tous ces packets sont donc rattachés à cette entrée, et on peut aussi du coup vérifier que la séquence des paquets TCP est bien respectée.</li>
<li> synproxy state est utilisé quand on veut quePF joue le rôle d'un proxy TCP pour l'établissement d'une connexion. Dans ce cas, PF va traiter la demande en lieu et place du destinataire et ne transfèrera qu'ensuite les paquets à ce dernier. Aucun paquet n'est transmis au destinataire avant que le client n'ait terminé l'échange initial. <b>Cette technique permet de protéger le destinataire des attaques de type TCP SYN flood, lorsqu'on demande un grand nombre d'ouvertures de connexions en vue de provoquer un deni de service</b>.</li></ul></li></ul>
<p>Voici un petit exemple pour éclairsir tout ça&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"> <span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">quick</span> <span class="kw3">on</span> <span class="re1">$external</span> inet <span class="kw4">proto</span> tcp from any to any port <span class="br0">&#123;</span> http, https, smtp, imaps <span class="br0">&#125;</span> <span class="kw3">flags</span> S<span class="sy0">/</span>SA <span class="kw3">keep</span> <span class="kw3">state</span></pre></div></div>
</td></tr></table><br />
<p>J'autorise tous les paquets TCP/IPv4 arrivant sur l'interface externe à destination des ports http/https/smtp/imaps à passer. Je vérifie que ce sont des ouvertures de connexion TCP, j'enregistre leur état dans la table, et j'arrête l'analyse de ces paquets sur cette règle (quick).
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"> <span class="kw2">block</span> <span class="kw4">in</span> log <span class="kw3">on</span> <span class="re1">$external</span> from <span class="br0">&#123;</span> <span class="re6">192.168.0.0</span><span class="sy0">/</span><span class="nu0">16</span>, <span class="re6">172.16.0.0</span><span class="sy0">/</span><span class="nu0">12</span> <span class="br0">&#125;</span> to any.</pre></div></div>
</td></tr></table><br />
<p>Ici, je bloque les paquets arrivant sur l'interface externe avec une adresse de source privée, et j'enregistre les information du paquet bloqué. <b>Ca permet de parer certaines attques de type spoofing</b> où l'on envoie des paquets usurpés dans le but d'induire en erreur les équipements réseau.
</p><p>Bon évidement, il y a encore pleins d'options de détails et de particularités (comme les ancres, le <b>scrubbing</b>, l'antispoofing...) dont je n'ai pas parlé. Pour plus d'informations, se reporter à la doc de pf.conf.
</p>
<h1><span class="mw-headline" id="Utilisation"><span class="mw-headline-number">4</span> Utilisation</span></h1>
<p>Le binaire d'utilisation de pf est <b>pfctl</b>. Avant de commencer, il faut activer PF au niveau du noyau. 2 solutions&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> pfctl</font>
</td></tr>
<tr>
<td>
<pre>pfctl -e
</pre>
</td></tr></table><br />
<p>ou ajouter pf=YES au niveau du /etc/rc.conf.local.
</p><p>Pour désactiver pf, il suffit de faire&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> pfctl</font>
</td></tr>
<tr>
<td>
<pre>pfctl -d
</pre>
</td></tr></table><br />
<p>Si l'on souhaite faire une analyse syntaxique du fichier sans charger les règles de filtrage, utilisez l'argument -n&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> pfctl</font>
</td></tr>
<tr>
<td>
<pre>pfctl -n
</pre>
</td></tr></table><br />
<p>Si l'on souhaite optimiser PF, il faut ajouter l'option -O, ce qui permettra de supprimer les doublons et réordonner les règles.
</p>
<h2><span class="mw-headline" id="Modifications_.C3.A0_la_vol.C3.A9e"><span class="mw-headline-number">4.1</span> Modifications à la volée</span></h2>
<ul><li> <b>-T (kill/flush/add/delete/show/test..)</b>&#160;: utilisé avec -t table, permet de manipuler une table&#160;: la supprimer, vider, ajouter une adresse, supprimer, l'affichier, vérifier qu'elle est dans la table. Exemple&#160;:</li></ul>
<pre>pfctl -t blocked-hosts -T show
</pre>
<p>Ceci va m'afficher les adresses de toutes les machines ayant été ajoutées dans la table blocked-hosts, déclarée un peu plus haut dans /etc/pf.conf.
</p>
<ul><li> <b>-F (nat/rules/state/Tables/..)</b>&#160;: remet respectivement à zero les règles de NAT, de filtrage, les états des connexions ouvertes ou les tables. Pratique si l'on veut faire un peu de ménage, remettre à zéro les compteurs ou des connexions, désactiver la NAT, supprimer toutes les entrées de toutes les tables, etc...</li>
<li> <b>-k (host/network)'</b>&#160;: Permet de tuer toutes les entrées dans la table d'état concernant les connexions venant d'une machine/d'un réseau. Si on utilise 2 fois cette option, on supprime les états des connexiosn venant de la première adresse vers la deuxième. Exemple&#160;:</li></ul>
<pre>pfctl -k 192.168.1.0/24 -k 172.16.0.0/16
</pre>
<p>Ceci supprimera tous les états des connexions entre ces 2 sous réseaux.
</p>
<ul><li> <b>-s modifieur</b>&#160;: Cette option permet d'obtenir beaucoup d'informations sur le status de PF. Si on l'utilise avec -r, PF fera du reverse-dns lookup pour les adresses qu'il affiche. Les valeurs les plus intéressantes pour modifieur sont&#160;:
<ul><li> rules: afficher respectivement les règles de filtrage chargées en mémoire</li>
<li> nat&#160;: celle de NAT</li>
<li> state&#160;: les connexions ouvertes</li>
<li> info&#160;: les statistiques globales sur PF</li>
<li> all&#160;: affichera tout ce que PF a à nous dire</li></ul></li></ul>
<p>ex&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> pfctl</font>
</td></tr>
<tr>
<td>
<pre>pfctl -sr
</pre>
</td></tr></table><br />
<ul><li> <b>-v, -vv, -g, -x, -q</b>&#160;: pour avoir des modes un peu plus verbeux, et même le mode debug (-v -&gt; -x). Le -q le repassera en mode quiet.</li></ul>
<h1><span class="mw-headline" id="Exemples_pratique"><span class="mw-headline-number">5</span> Exemples pratique</span></h1>
<h2><span class="mw-headline" id="Simple"><span class="mw-headline-number">5.1</span> Simple</span></h2>
<p>Cahier des charges&#160;:
</p>
<ul><li> On a une machine connectée à internet via une interface réseau en IP fixe appellée bge0</li>
<li> Elle doit être accessible depuis l'extérieur via 3 IP de confiance</li>
<li> Le serveur Apache doit être accessible à tous</li>
<li> Elle doit répondre aux ping depuis l'extérieur</li>
<li> On veut pouvoir accéder à internet à partir de cette mahcine</li>
<li> On bloquera silencieusement tous les autres packets</li></ul>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"> <span class="co0"># Notre interface réseau</span>
 iface <span class="sy0">=</span> <span class="st0">&quot;bge0&quot;</span>
&#160;
 <span class="co0"># Les machines de confiance pour les connexions SSH&#160;:</span>
 trusted_hosts <span class="sy0">=</span> <span class="st0">&quot;{ 131.25.4.12, 88.12.74.5, 207.124.20.9 }&quot;</span>
&#160;
 <span class="co0"># On s'occupe pas de l'interface de loopback utilisée par plusieurs services en interne de la machine&#160;:</span>
 <span class="kw3">set</span> <span class="kw3">skip</span> <span class="kw3">on</span> lo
&#160;
 <span class="co0"># On active la normalisation des paquets en entrée. PF va réassembler les paquets fragmentés et faire des vérifications supplémentaires dessus&#160;:</span>
 match <span class="kw4">in</span> all <span class="kw3">scrub</span> <span class="br0">&#40;</span>no-df<span class="br0">&#41;</span>
&#160;
 <span class="co0"># Par défaut, on bloque tous les paquets&#160;:</span>
 <span class="kw2">block</span> all
&#160;
 <span class="co0"># On autorise les paquets ICMP de type &quot;echo request&quot; pour les pings venant de l'extérieur, et echo reply/time exceeded/destination</span>
 <span class="co0"># unreachable pour les réponses aux pings que l'on avait initié vers l'extérieur&#160;:</span>
 <span class="kw1">pass</span> <span class="kw4">in</span> inet <span class="kw4">proto</span> icmp form any to <span class="re1">$iface</span> icmp-type <span class="br0">&#123;</span> echoreq, echorep, timex, unreach <span class="br0">&#125;</span>
&#160;
 <span class="co0"># On autorise les connexions au serveur Apache et on les enregistre dans la table d'état&#160;:</span>
 <span class="kw1">pass</span> <span class="kw4">in</span> inet <span class="kw4">proto</span> tcp from any to <span class="re1">$iface</span> port www <span class="kw3">flags</span> S<span class="sy0">/</span>SA <span class="kw3">keep</span> <span class="kw3">state</span>
&#160;
 <span class="co0"># On autorise les connexions SSH uniquement à partir des machines de confiance&#160;:</span>
 <span class="kw1">pass</span> <span class="kw4">in</span> inet <span class="kw4">proto</span> tcp from <span class="re1">$trusted_hosts</span> to <span class="re1">$iface</span> port ssh <span class="kw3">flags</span> S<span class="sy0">/</span>SA <span class="kw3">keep</span> <span class="kw3">state</span>
&#160;
 <span class="co0"># Enfin on autorise tout le traffic sortant&#160;:</span>
 <span class="kw1">pass</span> <span class="kw4">out</span> inet <span class="kw4">proto</span> tcp from <span class="re1">$iface</span> to any <span class="kw3">flags</span> S<span class="sy0">/</span>SA <span class="kw3">keep</span> <span class="kw3">state</span>
 <span class="kw1">pass</span> <span class="kw4">out</span> inet <span class="kw4">proto</span> <span class="br0">&#123;</span> udp, icmp <span class="br0">&#125;</span> from <span class="re1">$iface</span> to any <span class="kw3">keep</span> <span class="kw3">state</span></pre></div></div>
</td></tr></table><br />
<p>Maintenant on active notre nouvelle configuration&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> pfctl</font>
</td></tr>
<tr>
<td>
<pre>pfctl -e -f /etc/pf.conf
</pre>
</td></tr></table><br />
<p>Cette conf est assez restrictive dans le sens ou en générale, on met all à la place de "from any to $iface" et on utilise "quick" à outrance.
</p>
<h2><span class="mw-headline" id="Avanc.C3.A9"><span class="mw-headline-number">5.2</span> Avancé</span></h2>
<p>Cahier des charges&#160;:
</p>
<ul><li> Notre passerelle (renton) dispose de 2 interfaces, r10 côté internet et ne3 côté réseau local</li>
<li> La première carte possède une IP fixe (celle de notre FAI)</li>
<li> La seconde interface côté réseau local est configurée avec l'adresse 192.168.1.1 sur le réseau local en 192.168.1.0/24</li>
<li> On protègera tout ceci du monde extérieur, et comme on est parano, on fera un peu de logging</li>
<li> On veut pouvoir accéder à internet à partir de notre réseau local sans limitations</li>
<li> Une machine particulière (diane) devra être accessible via ssh et https</li>
<li> On voudra accéder au multiposte de Free sur la machine (sickboy), c'est juste un flux RTSP/UDP classique</li>
<li> Notre machine principale (tommy) aimerait bien faire marcher des trucs clicka-compliants comme le transfert de fichier Jabber</li>
<li> On autorisera le SSH depuis l'extérieur</li></ul>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"><span class="co0"># /etc/pf.conf</span>
&#160;
<span class="co0"># Déclaration des interfaces réseau</span>
<span class="re2">ext</span><span class="sy0">=</span><span class="st0">&quot;r10&quot;</span>
<span class="re2">int</span><span class="sy0">=</span><span class="st0">&quot;ne3&quot;</span>
&#160;
<span class="co0"># Déclaration des ports à ne pas logguer</span>
ports_not_logged <span class="sy0">=</span> <span class="st0">&quot;{ netbios-ssn, microsoft-ds, epmap, ms-sql-s, 5900 }&quot;</span>
&#160;
<span class="co0"># Déclaration des hôtes sur mon réseau local</span>
diane <span class="sy0">=</span> <span class="st0">&quot;192.168.1.2&quot;</span>
tommy <span class="sy0">=</span> <span class="st0">&quot;192.168.1.20&quot;</span>
sickboy <span class="sy0">=</span> <span class="st0">&quot;192.168.1.21&quot;</span>
&#160;
<span class="co0"># Déclaration du port utilisé à l'extérieur pour accéder au SSH de diane</span>
ssh_diane <span class="sy0">=</span> <span class="st0">&quot;65322&quot;</span>
&#160;
<span class="kw3">set</span> <span class="kw3">skip</span> <span class="kw3">on</span> lo
match <span class="kw4">in</span> all <span class="kw3">scrub</span> <span class="br0">&#40;</span>no-df<span class="br0">&#41;</span>
&#160;
<span class="co0"># Tout d'abord, la règle principale de NAT pour le réseau local. Ici, je ne mets pas &quot;pass&quot; car après j'autorise explicitement tout le</span>
<span class="co0"># traffic sortant. Le suffix&#160;:network est utilisé pour dire &quot;le sous-réseau correspondant à l'adresse de cette interface&quot;</span>
nat <span class="kw3">on</span> <span class="re1">$ext</span> from <span class="re1">$int</span>:network to any -<span class="sy0">&gt;</span> <span class="re1">$ext</span>
&#160;
<span class="co0"># Ensuite, les règles de redirection. J'ai mis le mot-clé 'pass' pour ne pas faire de filtrage supplémentaire sur ces connexions, sinon</span>
<span class="co0"># il aurait fallu rajouter les ports correspondants dans la règle de filtrage sur le trafic venant de l'extérieur.</span>
&#160;
<span class="co0"># Le flux rtsp du multiposte de free est de l'udp provenant de freeplayer.freebox.fr</span>
rdr <span class="kw1">pass</span> <span class="kw3">on</span> <span class="re1">$ext</span> protoudp from <span class="re6">212.27.38.253</span> -<span class="sy0">&gt;</span> <span class="re1">$sickboy</span>
&#160;
<span class="co0"># On redirige le port 8010 utilisé par Jabber pour l'ouverture des transferts de fichiers entrant</span>
rdr <span class="kw1">pass</span> <span class="kw3">on</span> <span class="re1">$ext</span> <span class="kw4">proto</span> tcp to port <span class="nu0">8010</span> -<span class="sy0">&gt;</span> <span class="re1">$tommy</span>
&#160;
<span class="co0"># Enfin on redirige le SSH (sur le port particulier utilisé à l'extérieur) et le https vers diane</span>
rdr <span class="kw1">pass</span> <span class="kw3">on</span> <span class="re1">$ext</span> <span class="kw4">proto</span> tcp to port <span class="re1">$ssh_diane</span> -<span class="sy0">&gt;</span> <span class="re1">$diane</span> port ssh
rdr <span class="kw1">pass</span> <span class="kw3">on</span> <span class="re1">$ext</span> <span class="kw4">proto</span> tcp to port https -<span class="sy0">&gt;</span> <span class="re1">$diane</span>
&#160;
<span class="co0"># On active l'antispoofing sur l'interface externe afin de bloquer les paquets venant de l'extérieur essayent d'utiliser froduleusement</span>
<span class="co0"># notre adresse pour passer à travers le filtre</span>
<span class="kw3">antispoof</span> for <span class="re1">$ext</span>
&#160;
<span class="co0"># On ne filtre pas les paquets sur l'interface interne</span>
<span class="kw1">pass</span> <span class="kw3">quick</span> <span class="kw3">on</span> <span class="re1">$int</span>
&#160;
<span class="co0"># Maintenant les règles de filtrage</span>
<span class="co0"># Par défaut on bloque et on loggue tous les paquets venant de l'extérieur</span>
<span class="kw2">block</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$ext</span> log all
&#160;
<span class="co0"># On n'a pas envie de remplir nos logs en 5 min avec les quelques vers bien connus qui traient sur le net. Donc on bloque certains</span>
<span class="co0"># paquets sans les logger</span>
<span class="kw2">block</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$ext</span> inet <span class="kw4">proto</span> tcp from any to any port <span class="re1">$ports_not_logged</span>
&#160;
<span class="co0"># On autorise les pings en provenance de l'extérieur</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$ext</span> inet <span class="kw4">proto</span> icmp from any to any icmp-type <span class="br0">&#123;</span> chorep, echoreq, timex, unreach <span class="br0">&#125;</span>
&#160;
<span class="co0"># On autorise le SSH venant de l'extérieur</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$ext</span> inet <span class="re1">$proto</span> tcp from any to any port ssh <span class="kw3">flags</span> S<span class="sy0">/</span>SA <span class="kw3">keep</span> <span class="kw3">state</span>
&#160;
<span class="co0"># On autorise tout le traffic sortant (le NATé du réseau local passera par ces règles)</span>
<span class="kw1">pass</span> <span class="kw4">out</span> inet <span class="kw4">proto</span> tcp from <span class="re1">$iface</span> to any <span class="kw3">flags</span> S<span class="sy0">/</span>SA <span class="kw3">keep</span> <span class="kw3">state</span>
<span class="kw1">pass</span> <span class="kw4">out</span> inet <span class="kw4">proto</span> <span class="br0">&#123;</span> udp, icmp <span class="br0">&#125;</span> from <span class="re1">$iface</span> to any <span class="kw3">keep</span> <span class="kw3">state</span></pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Ma_config"><span class="mw-headline-number">5.3</span> Ma config</span></h2>
<p>J'ai donc une Soekris avec plusieurs interfaces réseaux&#160;:
</p>
<ul><li> Wan</li>
<li> DMZ</li>
<li> Lan</li>
<li> Wifi</li>
<li> VPN</li></ul>
<p>Et je veux que la configuration soit la suivante&#160;:
</p>
<ul><li> Le wifi et le lan ont accès à tout</li>
<li> La DMZ n'a accès qu'au Wan</li>
<li> Il y a du nat sur toutes les interfaces sauf wan évidement</li>
<li> Une protection contre le bruteforce SSH</li>
<li> Le VPN est accessible sur la passerelle depuis l'extérieur</li></ul>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"><span class="co0">#       $OpenBSD: pf.conf,v 1.37 2008/05/09 06:04:08 reyk Exp $</span>
<span class="co0">#</span>
<span class="co0"># See pf.conf(5) for syntax and examples.</span>
<span class="co0"># Remember to set net.inet.ip.forwarding=1 and/or net.inet6.ip6.forwarding=1</span>
<span class="co0"># in /etc/sysctl.conf if packets are to be forwarded between interfaces.</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Physical and virtual interfaces definitions</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Physical Interfaces</span>
<span class="re2">wan_if</span><span class="sy0">=</span><span class="st0">&quot;sis0&quot;</span>
<span class="re2">lan_if</span><span class="sy0">=</span><span class="st0">&quot;vr0&quot;</span>
<span class="re2">dmz_if</span><span class="sy0">=</span><span class="st0">&quot;sis1&quot;</span>
<span class="re2">wifi_if</span><span class="sy0">=</span><span class="st0">&quot;vr1&quot;</span>
<span class="co0"># VLAN Interfaces</span>
<span class="re2">vlan99_if</span><span class="sy0">=</span><span class="st0">&quot;vlan99&quot;</span>
<span class="re2">vlan110_if</span><span class="sy0">=</span><span class="st0">&quot;vlan110&quot;</span>
<span class="re2">vlan120_if</span><span class="sy0">=</span><span class="st0">&quot;vlan120&quot;</span>
<span class="co0"># TUN Interfaces</span>
<span class="re2">openvpn_if</span><span class="sy0">=</span><span class="st0">&quot;tun0&quot;</span>
<span class="re2">sshvpn_if</span><span class="sy0">=</span><span class="st0">&quot;tun1&quot;</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Networks definitions</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Wan</span>
<span class="re2">wan_net</span><span class="sy0">=</span><span class="st0">&quot;192.168.10.0/24&quot;</span>
&#160;
<span class="co0"># Trusted networks</span>
<span class="re2">lan_net</span><span class="sy0">=</span><span class="st0">&quot;192.168.0.0/24&quot;</span>
<span class="re2">vlan99_net</span><span class="sy0">=</span><span class="st0">&quot;192.168.99.0/24&quot;</span>
<span class="re2">wifi_net</span><span class="sy0">=</span><span class="st0">&quot;192.168.200.0/24&quot;</span>
&#160;
<span class="co0"># Remote trusted networks</span>
<span class="re2">openvpn_net</span><span class="sy0">=</span><span class="st0">&quot;192.168.20.0/24&quot;</span>
<span class="re2">openvpn_net_nat</span><span class="sy0">=</span><span class="st0">&quot;10.0.0.0/24&quot;</span>
<span class="re2">sshvpn_net</span><span class="sy0">=</span><span class="st0">&quot;192.168.30.0/24&quot;</span>
&#160;
<span class="co0"># DMZ</span>
<span class="re2">dmz_net</span><span class="sy0">=</span><span class="st0">&quot;192.168.100.0/24&quot;</span>
<span class="re2">vlan110_net</span><span class="sy0">=</span><span class="st0">&quot;192.168.110.0/24&quot;</span>
<span class="re2">vlan120_net</span><span class="sy0">=</span><span class="st0">&quot;192.168.120.0/24&quot;</span>
&#160;
<span class="co0"># OpenVPN Shenzi network</span>
<span class="re2">openvpn_shenzi_net</span><span class="sy0">=</span><span class="st0">&quot;192.168.90.0/24&quot;</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># IP definitions</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Router IP interfaces</span>
<span class="re2">wan_sks_ip</span><span class="sy0">=</span><span class="st0">&quot;192.168.10.254&quot;</span>
<span class="re2">dmz_sks_ip</span><span class="sy0">=</span><span class="st0">&quot;192.168.100.254&quot;</span>
<span class="re2">vlan110_sks_ip</span><span class="sy0">=</span><span class="st0">&quot;192.168.110.254&quot;</span>
<span class="re2">vlan120_sks_ip</span><span class="sy0">=</span><span class="st0">&quot;192.168.120.254&quot;</span>
&#160;
<span class="co0"># Others IP</span>
<span class="re2">dedibox_ip</span><span class="sy0">=</span><span class="st0">&quot;x.x.x.x&quot;</span>
<span class="re2">work_ip</span><span class="sy0">=</span><span class="st0">&quot;x.x.x.x&quot;</span>
<span class="re2">freebox_tv_ip</span><span class="sy0">=</span><span class="st0">&quot;212.27.38.253&quot;</span>
&#160;
<span class="co0"># Services IP</span>
<span class="re2">dmz_mail_ip</span><span class="sy0">=</span><span class="st0">&quot;192.168.100.3&quot;</span>
<span class="re2">dmz_web_ip</span><span class="sy0">=</span><span class="st0">&quot;192.168.110.2&quot;</span>
<span class="re2">dmz_dns_ip</span><span class="sy0">=</span><span class="st0">&quot;192.168.100.3&quot;</span>
<span class="re2">dmz_sftp_ip</span><span class="sy0">=</span><span class="st0">&quot;192.168.100.6&quot;</span>
<span class="re2">apt_cacher_ip</span><span class="sy0">=</span><span class="st0">&quot;192.168.120.2&quot;</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Ports definitions and options</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Port descriptions</span>
<span class="re2">imaps_ports</span><span class="sy0">=</span><span class="st0">&quot;143, 993&quot;</span>
<span class="re2">smtps_ports</span><span class="sy0">=</span><span class="st0">&quot;25, 465&quot;</span>
<span class="re2">ssh_ports</span><span class="sy0">=</span><span class="st0">&quot;22, 222&quot;</span>
<span class="re2">dns_port</span><span class="sy0">=</span><span class="st0">&quot;53&quot;</span>
<span class="re2">webs_ports</span><span class="sy0">=</span><span class="st0">&quot;80, 443&quot;</span>
<span class="re2">openvpn_port</span><span class="sy0">=</span><span class="st0">&quot;1194&quot;</span>
<span class="re2">proxy_port</span><span class="sy0">=</span><span class="st0">&quot;3128&quot;</span>
<span class="re2">apt_cacher_port</span><span class="sy0">=</span><span class="st0">&quot;3142&quot;</span>
<span class="re2">mysql_port</span><span class="sy0">=</span><span class="st0">&quot;3306&quot;</span>
<span class="re2">git_port</span><span class="sy0">=</span><span class="st0">&quot;9418&quot;</span>
<span class="re2">free_multiposte</span><span class="sy0">=</span><span class="st0">&quot;31336, 31337&quot;</span>
&#160;
<span class="co0"># Whitelist / Blacklist table</span>
<span class="kw3">table</span> <span class="re7">&lt;blacklist&gt;</span> <span class="kw3">persist</span>
<span class="kw3">table</span> <span class="re7">&lt;whitelist&gt;</span> <span class="kw3">persist</span> <span class="kw3">file</span> <span class="st0">&quot;/etc/ssh/whitelist&quot;</span>
&#160;
<span class="co0"># Do not touch lo interface</span>
<span class="kw3">set</span> <span class="kw3">skip</span> <span class="kw3">on</span> lo0
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Packet Normalization: reassemble fragments</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
match <span class="kw4">in</span> all <span class="kw3">scrub</span> <span class="br0">&#40;</span>no-df<span class="br0">&#41;</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Nat for all internal interfaces</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
match <span class="kw4">out</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> from <span class="sy0">!</span><span class="br0">&#40;</span><span class="re1">$wan_if</span><span class="br0">&#41;</span> nat-to <span class="br0">&#40;</span><span class="re1">$wan_if</span><span class="br0">&#41;</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># block in all with no usurpation</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="kw2">block</span> <span class="kw4">in</span> log all
<span class="kw2">block</span> <span class="kw4">in</span> log <span class="kw3">quick</span> from urpf-failed
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Redirections for incoming connections (wan)</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># From WAN</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from any to <span class="re1">$wan_if</span> port <span class="nu0">25</span> rdr-to <span class="re1">$dmz_mail_ip</span> port <span class="nu0">25</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> udp from any to <span class="re1">$wan_if</span> port <span class="re1">$dns_port</span> rdr-to <span class="re1">$dmz_dns_ip</span> port <span class="re1">$dns_port</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from any to <span class="re1">$wan_if</span> port <span class="re1">$dns_port</span> rdr-to <span class="re1">$dmz_dns_ip</span> port <span class="re1">$dns_port</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from any to <span class="re1">$wan_if</span> port <span class="nu0">80</span> rdr-to <span class="re1">$dmz_web_ip</span> port <span class="nu0">80</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from any to <span class="re1">$wan_if</span> port <span class="nu0">143</span> rdr-to <span class="re1">$dmz_mail_ip</span> port <span class="nu0">143</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from any to <span class="re1">$wan_if</span> port <span class="nu0">222</span> rdr-to <span class="re1">$dmz_sftp_ip</span> port <span class="nu0">22</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from any to <span class="re1">$wan_if</span> port <span class="nu0">443</span> rdr-to <span class="re6">127.0.0.1</span> port <span class="nu0">443</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from any to <span class="re1">$wan_if</span> port <span class="nu0">465</span> rdr-to <span class="re1">$dmz_mail_ip</span> port <span class="nu0">465</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from any to <span class="re1">$wan_if</span> port <span class="nu0">993</span> rdr-to <span class="re1">$dmz_mail_ip</span> port <span class="nu0">993</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from any to <span class="re1">$wan_if</span> port <span class="nu0">9418</span> rdr-to <span class="re1">$dmz_web_ip</span> port <span class="nu0">9418</span>
&#160;
<span class="co0"># Apt-cacher-ng</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$vlan120_if</span> <span class="kw4">proto</span> tcp from any to <span class="re1">$vlan120_if</span> port <span class="re1">$apt_cacher_port</span> rdr-to <span class="re1">$apt_cacher_ip</span> port <span class="re1">$apt_cacher_port</span>
&#160;
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from <span class="re1">$dedibox_ip</span> to <span class="re1">$wan_if</span> port <span class="re1">$mysql_port</span> rdr-to <span class="re1">$dmz_web_ip</span> port <span class="re1">$mysql_port</span>
&#160;
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> udp from <span class="re1">$freebox_tv_ip</span> to <span class="re1">$wan_if</span> rdr-to <span class="re6">192.168.0.100</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from <span class="re1">$freebox_tv_ip</span> to <span class="re1">$wan_if</span> rdr-to <span class="re6">192.168.0.100</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Global Rules pass and block</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Allow Free Multiposte</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">quick</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> udp from <span class="re1">$freebox_tv_ip</span> to <span class="re6">192.168.0.100</span>
<span class="kw1">pass</span> <span class="kw4">out</span> <span class="kw3">quick</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> udp from <span class="re1">$freebox_tv_ip</span> to <span class="re6">192.168.0.100</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">quick</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from <span class="re1">$freebox_tv_ip</span> to <span class="re6">192.168.0.100</span>
<span class="kw1">pass</span> <span class="kw4">out</span> <span class="kw3">quick</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from <span class="re1">$freebox_tv_ip</span> to <span class="re6">192.168.0.100</span>
&#160;
<span class="co0"># Allow all outgoing from $lan_net, $wifi_net and $openvpn_net</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="br0">&#123;</span> <span class="re1">$lan_if</span>, <span class="re1">$vlan99_if</span>, <span class="re1">$wifi_if</span>, <span class="re1">$openvpn_if</span>, <span class="re1">$sshvpn_if</span> <span class="br0">&#125;</span> from <span class="br0">&#123;</span> <span class="re1">$lan_net</span>, <span class="re1">$vlan99_net</span>, <span class="re1">$wifi_net</span>, <span class="re1">$openvpn_net</span>, <span class="re1">$sshvpn_net</span> <span class="br0">&#125;</span> to any
<span class="kw1">pass</span> <span class="kw4">out</span> <span class="kw3">on</span> <span class="br0">&#123;</span> <span class="re1">$lan_if</span>, <span class="re1">$vlan99_if</span>, <span class="re1">$wifi_if</span>, <span class="re1">$openvpn_if</span>, <span class="re1">$sshvpn_if</span> <span class="br0">&#125;</span> from <span class="br0">&#123;</span> <span class="re1">$lan_net</span>, <span class="re1">$vlan99_net</span>, <span class="re1">$wifi_net</span>, <span class="re1">$openvpn_net</span>, <span class="re1">$sshvpn_net</span> <span class="br0">&#125;</span> to any
<span class="kw1">pass</span> <span class="kw4">out</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> from <span class="re1">$wan_net</span> to any
<span class="kw3">antispoof</span> <span class="kw3">quick</span> for <span class="br0">&#123;</span> <span class="re1">$wan_if</span>, <span class="re1">$dmz_if</span>, <span class="re1">$vlan110_if</span>, <span class="re1">$vlan120_if</span> <span class="br0">&#125;</span>
&#160;
<span class="co0"># block all incoming on lan_if, wifi_if and openvpn_if</span>
<span class="kw2">block</span> <span class="kw4">out</span> log <span class="kw3">on</span> <span class="br0">&#123;</span> <span class="re1">$lan_if</span>, <span class="re1">$vlan99_if</span>, <span class="re1">$wifi_if</span>, <span class="re1">$openvpn_if</span>, <span class="re1">$sshvpn_if</span> <span class="br0">&#125;</span> from <span class="br0">&#123;</span> <span class="sy0">!</span><span class="re1">$lan_if</span>, <span class="sy0">!</span><span class="re1">$vlan99_if</span>, <span class="sy0">!</span><span class="re1">$wifi_if</span>, <span class="sy0">!</span><span class="br0">&#40;</span><span class="re1">$openvpn_if</span><span class="br0">&#41;</span>, <span class="sy0">!</span><span class="br0">&#40;</span><span class="re1">$sshvpn_if</span><span class="br0">&#41;</span> <span class="br0">&#125;</span> to any
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># VPN Access</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Allow to access shenzi VE</span>
<span class="kw1">pass</span> <span class="kw4">out</span> <span class="kw3">on</span> <span class="re1">$openvpn_if</span> from any to <span class="re1">$openvpn_shenzi_net</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Specific ports on dmz</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># DNS</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$dmz_if</span> <span class="kw4">proto</span> tcp from <span class="re1">$dmz_dns_ip</span> to <span class="re1">$dmz_sks_ip</span> port <span class="re1">$dns_port</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$dmz_if</span> <span class="kw4">proto</span> udp from <span class="re1">$dmz_dns_ip</span> to <span class="re1">$dmz_sks_ip</span> port <span class="re1">$dns_port</span>
&#160;
<span class="co0"># Apt-cacher</span>
<span class="kw1">pass</span> <span class="kw4">out</span> <span class="kw3">on</span> <span class="re1">$vlan120_if</span> <span class="kw4">proto</span> tcp to <span class="br0">&#40;</span><span class="re1">$vlan120_if</span><span class="br0">&#41;</span> port <span class="re1">$apt_cacher_port</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$vlan120_if</span> <span class="kw4">proto</span> tcp to <span class="br0">&#40;</span><span class="re1">$vlan120_if</span><span class="br0">&#41;</span> port <span class="re1">$apt_cacher_port</span>
&#160;
<span class="co0"># DMZ and Vlan autorisations</span>
<span class="co0">#pass in on $vlan110_if from $vlan110_net to {&#160;!$lan_net,&#160;!$wifi_net,&#160;!$openvpn_net,&#160;!$sshvpn_net,&#160;!$vlan120_net,&#160;!$vlan110_sks_ip }</span>
<span class="co0"># Arrive pas a avoir juste any -&gt; 3142</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$vlan110_if</span> from <span class="re1">$vlan110_net</span> to <span class="br0">&#123;</span> <span class="sy0">!</span><span class="re1">$lan_net</span>, <span class="sy0">!</span><span class="re1">$wifi_net</span>, <span class="sy0">!</span><span class="re1">$openvpn_net</span>, <span class="sy0">!</span><span class="re1">$sshvpn_net</span>, <span class="sy0">!</span><span class="re1">$vlan110_sks_ip</span> <span class="br0">&#125;</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$vlan120_if</span> from <span class="re1">$vlan120_net</span> to <span class="br0">&#123;</span> <span class="sy0">!</span><span class="re1">$lan_net</span>, <span class="sy0">!</span><span class="re1">$wifi_net</span>, <span class="sy0">!</span><span class="re1">$openvpn_net</span>, <span class="sy0">!</span><span class="re1">$sshvpn_net</span>, <span class="sy0">!</span><span class="re1">$vlan120_sks_ip</span> <span class="br0">&#125;</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$dmz_if</span> from <span class="re1">$dmz_net</span> to <span class="br0">&#123;</span> <span class="sy0">!</span><span class="re1">$lan_net</span>, <span class="sy0">!</span><span class="re1">$wifi_net</span>, <span class="sy0">!</span><span class="re1">$openvpn_net</span>, <span class="sy0">!</span><span class="re1">$sshvpn_net</span>, <span class="sy0">!</span><span class="re1">$dmz_sks_ip</span> <span class="br0">&#125;</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Specific Rules pass and block</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Allow all incoming ICMP</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> icmp to any
&#160;
<span class="co0"># Autoblacklist on SSH</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from <span class="sy0">!</span><span class="re7">&lt;whitelist&gt;</span> to <span class="br0">&#40;</span><span class="re1">$wan_if</span><span class="br0">&#41;</span> port <span class="br0">&#123;</span> <span class="re1">$ssh_ports</span> <span class="br0">&#125;</span> \
        <span class="kw3">flags</span> S<span class="sy0">/</span>SA <span class="kw3">keep</span> <span class="kw3">state</span> \
        <span class="br0">&#40;</span>max-src-conn-rate <span class="nu0">3</span><span class="sy0">/</span><span class="nu0">60</span>, \
        overload <span class="re7">&lt;blacklist&gt;</span> flush global<span class="br0">&#41;</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from <span class="re7">&lt;whitelist&gt;</span> to <span class="re1">$wan_if</span> port <span class="br0">&#123;</span> <span class="re1">$ssh_ports</span> <span class="br0">&#125;</span> <span class="kw3">flags</span> S<span class="sy0">/</span>SA <span class="kw3">keep</span> <span class="kw3">state</span>
&#160;
<span class="co0"># block the ssh bruteforce bastards</span>
<span class="kw2">block</span> drop <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> from <span class="re7">&lt;blacklist&gt;</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp from <span class="re7">&lt;whitelist&gt;</span> port <span class="br0">&#123;</span> <span class="re1">$ssh_ports</span> <span class="br0">&#125;</span>
&#160;
<span class="co0"># Allow OpenVPN</span>
<span class="kw1">pass</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp to <span class="re1">$wan_if</span> port <span class="re1">$openvpn_port</span>
&#160;
<span class="co0"># Allow DNS TCP from DMZ (Bind SRV) to secondary (Soekris)</span>
<span class="co0">#pass in quick on $dmz_if proto tcp from $dmz_dns_ip to $dmz_sks_ip port $dns_port</span>
&#160;
<span class="co0"># Allow on wan interface from wan for tcp</span>
<span class="kw1">pass</span> <span class="kw4">out</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> tcp to <span class="br0">&#40;</span><span class="re1">$wan_if</span><span class="br0">&#41;</span> port <span class="br0">&#123;</span> <span class="re1">$ssh_ports</span>, <span class="re1">$smtps_ports</span>, <span class="re1">$imaps_ports</span>, <span class="re1">$dns_port</span>, <span class="re1">$webs_ports</span>, <span class="re1">$git_port</span>, <span class="re1">$mysql_port</span> <span class="br0">&#125;</span>
<span class="co0"># Allow on dmz interface from wan for udp</span>
<span class="kw1">pass</span> <span class="kw4">out</span> <span class="kw3">on</span> <span class="re1">$wan_if</span> <span class="kw4">proto</span> udp to <span class="br0">&#40;</span><span class="re1">$dmz_if</span><span class="br0">&#41;</span> port <span class="br0">&#123;</span> <span class="re1">$dns_port</span> <span class="br0">&#125;</span>
&#160;
<span class="co0"># Allow all outbound traffic</span>
<span class="kw1">pass</span> <span class="kw4">out</span> inet from <span class="sy0">!</span><span class="br0">&#40;</span><span class="re1">$wan_if</span><span class="br0">&#41;</span> to any <span class="kw3">flags</span> S<span class="sy0">/</span>SA <span class="kw3">keep</span> <span class="kw3">state</span></pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Les_Logs"><span class="mw-headline-number">6</span> Les Logs</span></h1>
<p>Quand PF aura envie de cafter un peu, il va envoyer des informations en binaire (histoire que ce soit plus rigolo, c'est du PCAP/TCPdump standard) sur une pseudo interface (pflog0), et un de ses bon potes <b>pflogd</b> qui va tout stocker dans /var/log/pflog.
</p><p>Tout d'abord, il faut activer/lancer le démon pflogd. Normalement il doit se lancer tout seul si PF est activé au démarrage de la machine. Si ce n'est pas le cas&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>ifconfig pflog0 up &amp;&amp; pflogd
</pre>
</td></tr></table><br />
<p>On peut vérifier que tout va bien&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>ps waux 
</pre>
</td></tr></table><br />
<p>Maintenant que PF cause sur pflog0, lorsqu'un paquet matche une règle où le mot clé log est utilisé, passons à tcpdump. On peut l'utiliser selon 2 modes&#160;:
</p>
<ul><li> Interactif&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> tcpdump</font>
</td></tr>
<tr>
<td>
<pre>tcpdump -n -e -ttt -i pflog0
</pre>
</td></tr></table><br />
<p>Il ira directement lire ce qui ce passe en direct sur pflog0, pflogd sera donc utile.
</p>
<ul><li> Passif&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>tcpdump -r /var/log/pflog
</pre>
</td></tr></table><br />
<p>Il lira ce qui a été enregistré par pflogd dans son fichier de sortie.
</p><p>On peut aussi passer une expression à tcpdump pour qu'il filtre sa sortie selon des critères précis&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> tcpdump</font>
</td></tr>
<tr>
<td>
<pre>tcpdump -ttt -r /var/log/pflog port 80 and host 192.168.1.2
</pre>
</td></tr></table><br />
<p>Enfin tcpdump comprend aussi la syntaxe de configuration de PF. On peut donc lui demander des choses de ce style&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> tcpdump</font>
</td></tr>
<tr>
<td>
<pre>tcpdump -ttt -i pflog0 inbound and action pass and on wi0
</pre>
</td></tr></table><br />
<p>Avec cette commande, il n'affichera que les paquets autorisés à passer, logués et entrants sur l'interface wi0. tcpdump est également capable de lire des infos tel que le passive OS fingerprint.
</p>
<h1><span class="mw-headline" id="Fonctions_avanc.C3.A9es_de_PF"><span class="mw-headline-number">7</span> Fonctions avancées de PF</span></h1>
<p>Si l'on souhaite bloquer par exemple les machines sour Windows 95/98&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"> <span class="kw2">block</span> <span class="kw4">in</span> <span class="kw3">on</span> <span class="re1">$ext</span> <span class="kw4">proto</span> tcp from any os <span class="br0">&#123;</span> <span class="st0">&quot;Windows 95&quot;</span>, <span class="st0">&quot;Windows 98&quot;</span> <span class="br0">&#125;</span> to any port smtp</pre></div></div>
</td></tr></table><br />
<p>Pour obtenir la liste des OS que PF reconnait&#160;:
</p>
<pre>pfctl -so
</pre>
<p>Pour faire de l'analyse d'OS avec tcpdump&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> tcpdump</font>
</td></tr>
<tr>
<td>
<pre>tcpdump -o -r /var/log/pflog
</pre>
</td></tr></table><br />
<p>Evidement ces techniques bouffent du CPU et ne sont pas en plus infaillibles.
</p>
<h1><span class="mw-headline" id="FAQ"><span class="mw-headline-number">8</span> FAQ</span></h1>
<h2><span class="mw-headline" id="no_IP_address_found_for_tun0"><span class="mw-headline-number">8.1</span> no IP address found for tun0</span></h2>
<p>Si vous avez ce genre de messages, c'est parce qu'une interface (ici tun0) essaye d'être initialisée avec PF, alors que le service associé (sensé créer ce device) n'a pas encore démarrer.
</p><p>Pour éviter que ce soit donc trop le dawa, il suffit d'essayer de mettre vos devices entre parenthèses (!($vpn_if)) ex&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pf.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="pf source-pf"><pre class="de1"> <span class="kw2">block</span> <span class="kw4">out</span> <span class="kw3">quick</span> <span class="kw3">on</span> <span class="br0">&#123;</span> <span class="re1">$wifi_if</span> <span class="br0">&#125;</span> from <span class="br0">&#123;</span> <span class="sy0">!</span><span class="re1">$lan_if</span>, <span class="sy0">!</span><span class="re1">$wifi_if</span>, <span class="sy0">!</span><span class="br0">&#40;</span><span class="re1">$vpn_if</span><span class="br0">&#41;</span> <span class="br0">&#125;</span> to any</pre></div></div>
</td></tr></table><br />
<p>Et si des parenthèses existent déjà, essayez de les retirer.
</p>
<h1><span class="mw-headline" id="Ressources"><span class="mw-headline-number">9</span> Ressources</span></h1>
<p><a href="./File:Secure_bsd_pf.pdf.html" title="File:Secure bsd pf.pdf">Documentation pour Sécuriser sa BSD avec PF</a><br />
<a href="./File:Pf-firewall.pdf.html" title="File:Pf-firewall.pdf">Firewalling with OpenBSD’s PF packet Fillter</a><br />
<a href="./File:Filtrage_des_paquets_avec_le_logiciel_IPFilter.pdf.html" title="File:Filtrage des paquets avec le logiciel IPFilter.pdf">Filtrage des paquets avec le logiciel IPFilter</a><br />
<a rel="nofollow" class="external free" href="http://www.openbsd.org/faq/pf/filter.html">http://www.openbsd.org/faq/pf/filter.html</a>
</p>
<!-- 
NewPP limit report
CPU time usage: 0.104 seconds
Real time usage: 0.101 seconds
Preprocessor visited node count: 544/1000000
Preprocessor generated node count: 1522/1000000
Post‐expand include size: 6398/2097152 bytes
Template argument size: 1672/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   38.175      1 - -total
 82.57%   31.520     18 - Template:Config
  6.79%    2.593     14 - Template:Command
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:1977-0!*!0!1!en!5!* and timestamp 20181111230705 and revision id 9398
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=Introduction_à_Packet_Filter&amp;oldid=9398">https://wiki.deimos.fr/index.php?title=Introduction_à_Packet_Filter&amp;oldid=9398</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=Introduction+%C3%A0+Packet+Filter" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="Introduction_à_Packet_Filter.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="Introduction_à_Packet_Filter.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="Introduction_à_Packet_Filter.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=Introduction_%C3%A0_Packet_Filter&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=Introduction_%C3%A0_Packet_Filter&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="Introduction_à_Packet_Filter.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/Introduction_à_Packet_Filter.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/Introduction_%C3%A0_Packet_Filter" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=Introduction_%C3%A0_Packet_Filter&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=Introduction_%C3%A0_Packet_Filter&amp;oldid=9398" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=Introduction_%C3%A0_Packet_Filter&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 13 December 2010, at 17:15.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":36});
}</script>
	</body>
</html>
	
<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>Template:Linux RAID performances - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="./Template:Linux_RAID_performances.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=ext.cite.styles|mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"Template","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":10,"wgPageName":"Template:Linux_RAID_performances","wgTitle":"Linux RAID performances","wgCurRevisionId":11530,"wgRevisionId":11530,"wgArticleId":3450,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Template:Linux_RAID_performances","wgRelevantArticleId":3450,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-10 ns-subject page-Template_Linux_RAID_performances skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Template:Linux RAID performances</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="./Template:Linux_RAID_performances.html#mw-navigation">navigation</a>, 					<a href="./Template:Linux_RAID_performances.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>Je ne parlerais des différents Raid, mais vous laisserais plutôt Wikipedia pour cela<sup id="cite_ref-1" class="reference"><a href="./Template:Linux_RAID_performances.html#cite_note-1">[1]</a></sup>. Pour l'utilisation d'un RAID software sous Linux, <a href="Configuration_d'un_Raid_logiciel.html" title="Configuration d'un Raid logiciel">je vous recommande cette documentation</a><sup id="cite_ref-2" class="reference"><a href="./Template:Linux_RAID_performances.html#cite_note-2">[2]</a></sup>. Nous parlerons plutôt des performances puisque c'est le sujet ici. Le RAID 0 est le plus performant de tous les raid, mais il connait évidement ses problèmes de sécurité des données lors de la perte d'un disque.
</p><p>Le MTBF (Mean Time Between Failure) est également important sur les RAID. C'est une estimation du bon fonctionnement du RAID avant qu'un disque soit détecté comme défaillant.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="./Template:Linux_RAID_performances.html#Chunk_size"><span class="tocnumber">1</span> <span class="toctext">Chunk size</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="./Template:Linux_RAID_performances.html#Stride"><span class="tocnumber">2</span> <span class="toctext">Stride</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="./Template:Linux_RAID_performances.html#Le_Round_Robin"><span class="tocnumber">3</span> <span class="toctext">Le Round Robin</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="./Template:Linux_RAID_performances.html#Les_RAIDs_.C3.A0_parit.C3.A9"><span class="tocnumber">4</span> <span class="toctext">Les RAIDs à parité</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="./Template:Linux_RAID_performances.html#Le_RAID_1"><span class="tocnumber">5</span> <span class="toctext">Le RAID 1</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Chunk_size"><span class="mw-headline-number">1</span> Chunk size</span></h2>
<p>La "Chunck size" (ou taille du stripe ou encore element size pour certains revendeurs) est le nombre (en taille de segments (KiB)) de données écrites ou lues pour chaque périphérique avant le déplacement sur un autre segment. L'algorithme de déplacement utilisé est le Round Robin. La chunk size doit être un entier, multiple de la taille d'un block. Plus la taille des chunk est grande, plus la vitesse d'écriture est rapide sur les données de très grosse capacité, mais inversement est lente sur les petites données. Si la taille moyenne est requêtes IO est plus petite que la taille d'un chunck, la requête sera alors placée sur un seul disque du RAID, annulant tout les avantages du RAID. Réduire la taille de la chunck size, découpera les gros fichiers en plus petits qui seront répartis sur plusieurs disques ce qui améliorera les performances. Cependant le temps de positionnement des chunk sera réduit. Certains matériels ne permettent pas l'écriture tant qu'un stripe n'est pas complet, annulant cet effet de latence de positionnement.
</p><p>Une bonne règle pour définir la chunk size est de diviser environ la taille des opération IO par le nombre de disques sur le RAID (enlevez les disques de parités si RAID5 ou 6).
</p>
<table width="100%" class="notes_array">
<tr>
<td class="notes_subarray"> <font size="-1"><a href="./File:Notes_file.png.html" class="image" title="Notes"><img alt="Notes" src="images/2/20/Notes_file.png" width="31" height="32" /></a> Notes</font>
</td></tr>
<tr>
<td>Petit rappel&#160;:
<ul><li> Raid 0&#160;: Pas de parité</li>
<li> Raid 1&#160;: Pas de parité</li>
<li> Raid 5&#160;: 1 disque de parité</li>
<li> Raid 6&#160;: 2 disque de parité</li>
<li> Raid 10&#160;: Pas de disques de parité</li></ul>
</td></tr></table><br />
<p>Si vous n'avez aucunes idées de vos IO, prenez une valeur entre 32KB et 128KB en prenant un multiple de 2KB (ou 4KB si vous avez des tailles de blocks plus grandes). La chunk size (taille du stripe) est un facteur important sur les performances de votre RAID. Si le stripe est trop large, le raid peut avoir un "hot spot" qui sera le disque qui recevra le plus d'IO et réduira les performances de votre RAID. Il est évident que les meilleures performances sont lorsque les données sont éclatées sur tous les disques. La bonne formule est donc&#160;:
</p>
<dl><dd>Chunk size = average request IO size (avgrq-sz) / number of disks</dd></dl>
<p>Pour obtenir la taille des requêtes moyennes, je vous invite à faire un tour sur la documentation sur Systat<sup id="cite_ref-3" class="reference"><a href="./Template:Linux_RAID_performances.html#cite_note-3">[3]</a></sup> ou l'on parle d'<a href="./Sysstat_:_Des_outils_indispensable_pour_analyser_des_problèmes_de_performances.html#iostat" title="Sysstat : Des outils indispensable pour analyser des problèmes de performances">Iostat</a> et de <a href="./Sysstat_:_Des_outils_indispensable_pour_analyser_des_problèmes_de_performances.html#sar" title="Sysstat : Des outils indispensable pour analyser des problèmes de performances">Sar</a>.
</p>
<ul><li> Pour voir la chunk size sur un RAID (ici md0)&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; cat /sys/block/md0/md/chunk_size 
131072</pre></div></div>
</td></tr></table><br />
<p>Il est donc ici de 128KB.
</p><p>Voici une autre façon de le voir&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cat</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; cat /proc/mdstat 
Personalities&#160;: [raid10] 
md0&#160;: active raid10 sdc2[3] sda2[1] sdb2[0] sdd2[2]
<span class="xtra ln-xtra">      1949426688 blocks super 1.0 128K chunks 2 near-copies [4/4] [UUUU]</span>&#160;
unused devices: &lt;none&gt;</pre></div></div>
</td></tr></table><br />
<p>Ou bien encore&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mdadm</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; mdadm --detail /dev/md0 
/dev/md0:
        Version&#160;: 1.0
  Creation Time&#160;: Sat May 12 09:35:34 2012
     Raid Level&#160;: raid10
     Array Size&#160;: 1949426688 (1859.12 GiB 1996.21 GB)
  Used Dev Size&#160;: 974713344 (929.56 GiB 998.11 GB)
   Raid Devices&#160;: 4
  Total Devices&#160;: 4
    Persistence&#160;: Superblock is persistent
&#160;
    Update Time&#160;: Thu Aug 30 12:53:20 2012
          State&#160;: clean 
 Active Devices&#160;: 4
Working Devices&#160;: 4
 Failed Devices&#160;: 0
  Spare Devices&#160;: 0
&#160;
         Layout&#160;: near=2
<span class="xtra ln-xtra">     Chunk Size&#160;: 128K</span>&#160;
           Name&#160;: N7700:2
           UUID&#160;: 1a83e7dc:daa7d822:15a1de4d:e4f6fd19
         Events&#160;: 64
&#160;
    Number   Major   Minor   RaidDevice State
       0       8       18        0      active sync   /dev/sdb2
       1       8        2        1      active sync   /dev/sda2
       2       8       50        2      active sync   /dev/sdd2
       3       8       34        3      active sync   /dev/sdc2</pre></div></div>
</td></tr></table><br />
<ul><li> Il est possible de définir la chunk size à la création du RAID avec l'argument -c ou --chunk. Nous allons également voir comment le calculer au mieux. Utilisons d'abord iostat pour récupérer la valeur avgrq-sz&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> iostat</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; iostat -x sda 1 5
&#160;
<span class="xtra ln-xtra">avg-cpu: &#160;%user  &#160;%nice&#160;%system&#160;%iowait &#160;%steal  &#160;%idle</span><span class="xtra ln-xtra">           0,21    0,00    0,29    0,05    0,00   99,45</span><span class="xtra ln-xtra">&#160;</span><span class="xtra ln-xtra">Device:         rrqm/s   wrqm/s     r/s     w/s   rsec/s   wsec/s avgrq-sz avgqu-sz   await  svctm &#160;%util</span><span class="xtra ln-xtra">sda               0,71     1,25    1,23    0,76    79,29    15,22    47,55     0,01    2,84   0,73   0,14</span>&#160;
avg-cpu: &#160;%user  &#160;%nice&#160;%system&#160;%iowait &#160;%steal  &#160;%idle
           0,00    0,00    0,00    0,00    0,00  100,00
&#160;
Device:         rrqm/s   wrqm/s     r/s     w/s   rsec/s   wsec/s avgrq-sz avgqu-sz   await  svctm &#160;%util
sda               0,00     0,00    1,00    0,00    16,00     0,00    16,00     0,00    1,00   1,00   0,10
&#160;
avg-cpu: &#160;%user  &#160;%nice&#160;%system&#160;%iowait &#160;%steal  &#160;%idle
           0,00    0,00    0,00    0,00    0,00  100,00</pre></div></div>
</td></tr></table><br />
<p>Faisons ensuite le calcul pour obtenir la chunk size en KiB&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> echo</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; echo &quot;47.55*512/1024&quot; | bc -l
23.77500000000000000000</pre></div></div>
</td></tr></table><br />
<p>Nous devons ensuite diviser cette valeur par le nombre de disques (admettons 2) et l'arrondir au multiple de 2 plus proche&#160;:
</p>
<dl><dd>Chunk Size(KB) = 23.775/2 = 11.88&#160;? 8</dd></dl>
<p>Ici la chunk size à mettre est de 8, puisque c'est le multiple de 2 qui se rapproche le plus de 11.88.
</p>
<table width="100%" class="warning_array">
<tr>
<td class="warning_subarray"> <font size="-1"><a href="./File:Warning_file.png.html" class="image" title="Warning"><img alt="Warning" src="images/0/09/Warning_file.png" width="39" height="32" /></a> <b>WARNING</b></font>
</td></tr>
<tr>
<td>Rappelez vous qu'il n'est pas conseillé de descendre en dessous de 32K&#160;!
</td></tr></table><br />
<p>Pour créer un raid 0 en définissant la chunk size&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">mdadm -C /dev/md0 -l 0 -n 2 --chunk-size=32 /dev/sd[ab]1</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Stride"><span class="mw-headline-number">2</span> Stride</span></h2>
<p>Le Stride est un paramètre que l'on passe lors de la construction d'un RAID qui permet d'optimiser la façon dont le filesystem va placer ses blocks données sur les disques avant de passer aux suivants. Avec de l'extXn on peut optimiser en utilisant l'option -E qui correspond au nombre de filesystems blocks dans un chunk. Pour calculer le stride&#160;:
</p>
<dl><dd>Stride =  chunk size / block size</dd></dl>
<p>Pour un raid 0 ayant un chunk size de 64KiB (64 KiB / 4KiB = 16) par exemple&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mkfs.ext4</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">mkfs.ext4 -b 4096 -E stride=16 /dev/mapper/vg1-lv0</pre></div></div>
</td></tr></table><br />
<p>Certains contrôleurs disques font une abstraction physique des groupes de blocks rendant impossible au kernel de les connaitre. Voici un exemple pour voir la taille d'un stride&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> dumpe2fs</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; dumpe2fs /dev/mapper/vg1-lv0 | grep -i stride        
dumpe2fs 1.42 (29-Nov-2011)
<span class="xtra ln-xtra">RAID stride:              16</span></pre></div></div>
</td></tr></table><br />
<p>Ici, la taille est 16 KiB.
</p><p>Pour calculer le stride, il existe un site web également&#160;: <a rel="nofollow" class="external free" href="http://busybox.net/~aldot/mkfs_stride.html">http://busybox.net/~aldot/mkfs_stride.html</a>
</p>
<h2><span class="mw-headline" id="Le_Round_Robin"><span class="mw-headline-number">3</span> Le Round Robin</span></h2>
<p>Les RAID sans parités permettent de segmenter les données à travers de multiple disques pour augmenter les performances en utilisant l'algorithme Round Robin. La taille des segments est définit à la création du RAID et fait référence à la chunk size.<br />
La taille d'un RAID est définit par le disque le plus petit lors de la création du RAID. La taille peut varier dans le futur si tous les disques sont remplacés par des disques de plus grosse capacité. Une resynchronisation des disques se fera et le filesystem pourra être étendu.
</p><p>Donc pour le tuning du Round Robin, il vous faut correctement tuner la chunk size et le stride pour que l'utilisation de l'algorithme soit optimale&#160;! C'est tout&#160;:-)
</p>
<h2><span class="mw-headline" id="Les_RAIDs_.C3.A0_parit.C3.A9"><span class="mw-headline-number">4</span> Les RAIDs à parité</span></h2>
<p>Une des grosses contraintes de performances des RAID 5 et 6 est le calcul des parités. Pour que les données y soient écrites, il faut que le calcul de parité soit effectué sur le raid au préalable. et ce n'est seulement ensuite que la parité et les données peuvent y être écrites.
</p>
<table width="100%" class="warning_array">
<tr>
<td class="warning_subarray"> <font size="-1"><a href="./File:Warning_file.png.html" class="image" title="Warning"><img alt="Warning" src="images/0/09/Warning_file.png" width="39" height="32" /></a> <b>WARNING</b></font>
</td></tr>
<tr>
<td>Evitez les RAID 5 et 6 si l'écriture de vos données représentent <b>+ de 20% de l'activité</b>
</td></tr></table><br />
<p>Chaque mise à jour de données requiert 4 opérations de type IO&#160;:
</p>
<ol><li> Les données à mettre à jour sont d'abord lues des disques</li>
<li> Mise à jour des nouvelles données (mais la parité n'est pas encore correcte)</li>
<li> Lecture des blocks du même stripe et calcul de parité</li>
<li> Écriture définitive des nouvelles données sur disques et de la parité</li></ol>
<p>En RAID 5, il est conseillé d'utiliser le cache du stripe&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> echo</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">echo 256 &gt; /sys/block/md0/md/stripe_cache_size</pre></div></div>
</td></tr></table><br />
<p>Pour plus d'informations sur les optimisations des RAID&#160;: <a rel="nofollow" class="external free" href="http://kernel.org/doc/Documentation/md.txt">http://kernel.org/doc/Documentation/md.txt</a><sup id="cite_ref-4" class="reference"><a href="./Template:Linux_RAID_performances.html#cite_note-4">[4]</a></sup><sup id="cite_ref-5" class="reference"><a href="./Template:Linux_RAID_performances.html#cite_note-5">[5]</a></sup>. Pour la partie optimisation, regardez les paramètres suivants&#160;: 
</p>
<ul><li> chunk_size</li>
<li> component_size</li>
<li> new_dev</li>
<li> safe_mode_delay</li>
<li> sync_speed_{min,max}</li>
<li> sync_action</li>
<li> stripe_cache_size</li></ul>
<h2><span class="mw-headline" id="Le_RAID_1"><span class="mw-headline-number">5</span> Le RAID 1</span></h2>
<p>Le driver RAID effectue une écriture dans le bitmap lorsque des changements ont été détectés depuis la dernière synchronisation. Un inconvénient majeure du RAID 1 est lors d'une coupure de courant, puisque celui ci doit se reconstruire intégralement. Avec la 'write-intent' bitmap,seul les parties qui ont changées auront à être synchroniser, ce qui réduit grandement le temps de reconstruction.
</p><p>Si un disque tombe en panne et est retiré du RAID, md arrête l'effacement des bits dans la bitmap. Si ce même disque est de nouveau introduit dans le RAID, md n'aura qu'à resynchroniser la différence. Lors de la création du RAID, si l'option '--write-intent' bitmap est combinée avec '--write-behind', les requêtes d'écritures vers des périphériques ayant l'option '--write-mostly' n'attendront pas que les requêtes soient complète avant d'écrire sur le disque. L'option '--write-behind' peut être utiliser pour les RAID1 avec liaisons lentes.
</p><p>Les nouvelles matrices mdraid prennent en charge l'utilisation de write intent bitmaps. Ceci aide le système à identifier les parties problématiques d'une matrice&#160;; ainsi, au cas où il se produirait un arrêt incorrect, les parties problématiques devront être resynchronisées, et non le disque entier. Cela permet de réduire de manière drastique le temps requis pour effectuer une resynchronisation. Des matrices nouvellement créées auront automatiquement un write intent bitmap ajouté lorsque possible. Par exemple, les matrices utilisées comme swap et les matrices de très petite taille (telles que les matrices /boot) ne bénéficieront pas de l'obtention de write intent bitmaps. Il est possible d'ajouter write intent bitmap aux matrices existant précédemment une fois que la mise à jour sur le périphérique est terminée via la commande mdadm --grow. Cependant, write intent bitmaps n'encourt pas d'impact sur la performance (environ 3-5% sur un bitmap d'une taille de 65536, mais peut augmenter jusqu'à 10% ou plus sur des bitmaps de plus petite taille, tels que 8192). Cela signifie que si write intent bitmap est ajouté à une matrice, il est préférable de conserver la taille relativement grande. La taille recommandée est 65536.<sup id="cite_ref-6" class="reference"><a href="./Template:Linux_RAID_performances.html#cite_note-6">[6]</a></sup>
</p><p>Pour voir si un RAID est bien persistant&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mdadm</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; mdadm --detail /dev/md0 
/dev/md0:
        Version&#160;: 1.0
  Creation Time&#160;: Sat May 12 09:35:34 2012
     Raid Level&#160;: raid10
     Array Size&#160;: 1949426688 (1859.12 GiB 1996.21 GB)
  Used Dev Size&#160;: 974713344 (929.56 GiB 998.11 GB)
   Raid Devices&#160;: 4
  Total Devices&#160;: 4
<span class="xtra ln-xtra">    Persistence&#160;: Superblock is persistent</span>&#160;
    Update Time&#160;: Thu Aug 30 16:43:17 2012
          State&#160;: clean 
 Active Devices&#160;: 4
Working Devices&#160;: 4
 Failed Devices&#160;: 0
  Spare Devices&#160;: 0
&#160;
         Layout&#160;: near=2
     Chunk Size&#160;: 128K
&#160;
           Name&#160;: N7700:2
           UUID&#160;: 1a83e7dc:daa7d822:15a1de4d:e4f6fd19
         Events&#160;: 64
&#160;
    Number   Major   Minor   RaidDevice State
       0       8       18        0      active sync   /dev/sdb2
       1       8        2        1      active sync   /dev/sda2
       2       8       50        2      active sync   /dev/sdd2
       3       8       34        3      active sync   /dev/sdc2</pre></div></div>
</td></tr></table><br />
<p>Pour ajouter le write intent bitmap (interne)&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mdadm</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">mdadm /dev/md0 --grow --bitmap=internal</pre></div></div>
</td></tr></table><br />
<p>Pour ajouter le write intent bitmap (externe)&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mdadm</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">mdadm /dev/md0 --grow --bitmap=/mnt/mon_fichier</pre></div></div>
</td></tr></table><br />
<p>Et pour le retirer&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mdadm</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">mdadm /dev/md0 --grow --bitmap=none</pre></div></div>
</td></tr></table><br />
<p>Pour définir le disque lent et celui le plus rapide&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mdadm</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">mdadm -C /dev/md0 -l1 -n2 -b /tmp/md0 --write-behind=256 /dev/sdal --write-mostly /dev/sdbl</pre></div></div>
</td></tr></table><br /><ol class="references">
<li id="cite_note-1"><a href="./Template:Linux_RAID_performances.html#cite_ref-1">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://fr.wikipedia.org/wiki/RAID_%28informatique%29">http://fr.wikipedia.org/wiki/RAID_%28informatique%29</a></span>
</li>
<li id="cite_note-2"><a href="./Template:Linux_RAID_performances.html#cite_ref-2">^</a> <span class="reference-text"><a href="Configuration_d'un_Raid_logiciel.html" title="Configuration d'un Raid logiciel">Configuration d'un Raid logiciel</a></span>
</li>
<li id="cite_note-3"><a href="./Template:Linux_RAID_performances.html#cite_ref-3">^</a> <span class="reference-text"><a href="./Sysstat_:_Des_outils_indispensable_pour_analyser_des_problèmes_de_performances.html" title="Sysstat : Des outils indispensable pour analyser des problèmes de performances">Sysstat : Des outils indispensable pour analyser des problèmes de performances</a></span>
</li>
<li id="cite_note-4"><a href="./Template:Linux_RAID_performances.html#cite_ref-4">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://kernel.org/doc/Documentation/md.txt">http://kernel.org/doc/Documentation/md.txt</a></span>
</li>
<li id="cite_note-5"><a href="./Template:Linux_RAID_performances.html#cite_ref-5">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://makarevitch.org/rant/raid/">http://makarevitch.org/rant/raid/</a></span>
</li>
<li id="cite_note-6"><a href="./Template:Linux_RAID_performances.html#cite_ref-6">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="https://access.redhat.com/knowledge/docs/fr-FR/Red_Hat_Enterprise_Linux/6/html/Migration_Planning_Guide/chap-Migration_Guide-File_Systems.html">https://access.redhat.com/knowledge/docs/fr-FR/Red_Hat_Enterprise_Linux/6/html/Migration_Planning_Guide/chap-Migration_Guide-File_Systems.html</a></span>
</li>
</ol>

<!-- 
NewPP limit report
CPU time usage: 0.056 seconds
Real time usage: 0.055 seconds
Preprocessor visited node count: 359/1000000
Preprocessor generated node count: 1254/1000000
Post‐expand include size: 3687/2097152 bytes
Template argument size: 1126/2097152 bytes
Highest expansion depth: 4/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   14.841      1 - -total
 46.83%    6.949     14 - Template:Command
  9.55%    1.417      1 - Template:Iostat_cmd_output
  5.54%    0.822      2 - Template:Warning
  5.34%    0.793      1 - Template:Notes
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:3450-0!*!0!1!en!5!* and timestamp 20181111232129 and revision id 11530
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=Template:Linux_RAID_performances&amp;oldid=11530">https://wiki.deimos.fr/index.php?title=Template:Linux_RAID_performances&amp;oldid=11530</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=Template%3ALinux+RAID+performances" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-template" class="selected"><span><a href="./Template:Linux_RAID_performances.html"  title="View the template [c]" accesskey="c">Template</a></span></li>
															<li  id="ca-talk" class="new"><span><a href="https://wiki.deimos.fr/index.php?title=Template_talk:Linux_RAID_performances&amp;action=edit&amp;redlink=1"  title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="./Template:Linux_RAID_performances.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="./Template:Linux_RAID_performances.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=Template:Linux_RAID_performances&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=Template:Linux_RAID_performances&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="./Template:Linux_RAID_performances.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/Template:Linux_RAID_performances.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/Template:Linux_RAID_performances" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=Template:Linux_RAID_performances&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=Template:Linux_RAID_performances&amp;oldid=11530" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=Template:Linux_RAID_performances&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 31 August 2012, at 20:45.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["ext.cite.a11y","mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":90});
}</script>
	</body>
</html>
	
<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>La gestion de la mémoire sous Linux - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="La_gestion_de_la_mémoire_sous_Linux.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=ext.cite.styles|mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"La_gestion_de_la_mémoire_sous_Linux","wgTitle":"La gestion de la mémoire sous Linux","wgCurRevisionId":12454,"wgRevisionId":12454,"wgArticleId":3471,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"La_gestion_de_la_mémoire_sous_Linux","wgRelevantArticleId":3471,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-La_gestion_de_la_mémoire_sous_Linux skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">La gestion de la mémoire sous Linux</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="La_gestion_de_la_mémoire_sous_Linux.html#mw-navigation">navigation</a>, 					<a href="La_gestion_de_la_mémoire_sous_Linux.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="La_gestion_de_la_mémoire_sous_Linux.html#Les_pages"><span class="tocnumber">1</span> <span class="toctext">Les pages</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="La_gestion_de_la_mémoire_sous_Linux.html#La_r.C3.A9clamation_des_dirty_pages"><span class="tocnumber">2</span> <span class="toctext">La réclamation des dirty pages</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="La_gestion_de_la_mémoire_sous_Linux.html#La_r.C3.A9clamation_des_clean_pages"><span class="tocnumber">3</span> <span class="toctext">La réclamation des clean pages</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="La_gestion_de_la_mémoire_sous_Linux.html#OOM"><span class="tocnumber">4</span> <span class="toctext">OOM</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="La_gestion_de_la_mémoire_sous_Linux.html#D.C3.A9tecter_les_fuites_m.C3.A9moires"><span class="tocnumber">5</span> <span class="toctext">Détecter les fuites mémoires</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="La_gestion_de_la_mémoire_sous_Linux.html#La_swap"><span class="tocnumber">6</span> <span class="toctext">La swap</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="La_gestion_de_la_mémoire_sous_Linux.html#References"><span class="tocnumber">7</span> <span class="toctext">References</span></a></li>
</ul>
</div>

<table class="config_array" align="right" style="width:20em; font-size:90%; text-align:left; border: 1px #d0e7ff solid; margin-left:10px;">
   <tr>
      <td class="config_subarray" colspan="2" style="text-align:center;"><a href="./File:Poweredbylinux.jpg.html" class="image" title="Linux"><img alt="Linux" src="images/2/2f/Poweredbylinux.jpg" width="100" height="150" /></a></td>
   </tr><tr><td colspan="2" style="text-align:center;"><hr class="gradient" /></td></tr><tr>
      <th>Software version</th>
      <td>Kernel 2.6.32+</td>
   </tr><tr>
      <th>Operating System</th>
      <td>Red Hat 6.3<br />Debian 7</td>
   </tr><tr>
      <th>Website</th>
      <td><a rel="nofollow" class="external text" href="http://www.kernel.org">Kernel Website</a></td>
   </tr><tr>
      <th>Last Update</th>
      <td>06/05/2013</td>
   </tr><tr>
      <th>Others</th>
      <td></td>
   </tr>
</table>
<h1><span class="mw-headline" id="Les_pages"><span class="mw-headline-number">1</span> Les pages</span></h1>
<p>Lorsque l'on regarde dans /proc/meminfo, les pages 'Inactive Clean' correspondent aux pages libres. Si le kernel doit allouer des pages à un process, il peut prendre ces pages depuis la liste de pages libres ou l'inactive clean. Les pages étant utilisées par les process sont référencées comme étant des pages actives. Dans le cas de mémoire partagée, une page peut avoir plusieurs process qui la référencent.
</p>
<ul><li> Aussi longtemps que la page aura au moins un process qui la référencera, elle restera dans la liste active.</li>
<li> A partir du moment ou tous les process ont relâchés leur référence à la page, elle devient inactive. Si une page active a été modifiée par le process qui a été référencé, elle deviendra une page inactive dirty. Les dirty pages contiennent des données qui peuvent être écrites sur le disque.</li>
<li> Si la page n'a pas été modifiée depuis la dernière lecture sur disque, elle sera une page inactive clean. Elle est alors disponible pour une allocation.</li>
<li> Les pages libres sont les pages qui n'ont pas encore été allouées à un process</li></ul>
<p>Pour trouver la mémoire dirty et clean&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> awk</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">awk 'BEGIN {}
/Shared_Clean/{ CLEAN += $2; }
/Shared_Dirty/{ DIRTY += $2; }
END {
print &quot;Shared_Clean: &quot; CLEAN;
print &quot;Shared_Dirty: &quot; DIRTY;
}' /proc/1/smaps</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="La_r.C3.A9clamation_des_dirty_pages"><span class="mw-headline-number">2</span> La réclamation des dirty pages</span></h1>
<p>La mémoire n'étant pas illimité, le kernel ne peut garder les dirty pages en RAM éternellement. Les pages qui sont dirty mais qui ne sont plus utilisées, sont vidées sur le disque. C'est le thread kernel pdflush qui gère cette tâche, il y a d'ailleurs 2 thread minimum pour gérer cette opération. L'utilisation du cache mémoire créer un fort besoin de control sur la façon dont les pages sont réclamées. Pour voir le nombre de thread pdflush actuellement présents&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> sysctl</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; sysctl vm.nr_pdflush_threads
vm.nr_pdflush_threads = 0</pre></div></div>
</td></tr></table><br />
<p>Lorsque l'on vide les dirty pages sur le disque, le but est d'éviter les burst IO pour ne pas saturer le disque. Le démond pdflush écrit les données sur le disque de manière constante et douce. Par défaut les 2 threads pdflush vont faire leurs actions mais d'autres peuvent se lancer (jusqu'à 8), si les 2 saturent afin d'assurer des écritures parallèles sur plusieurs disques. Si le ratio du nombre de pages qui sont dirty par rapport au nombre de pages RAM disponibles atteint un certain pourcentage, les process vont se bloquer pendant que le pdflush écrira les données de façon synchrone. Il existe plusieurs options pour améliorer le pdflush&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/sysctl.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># Pourcentage (totale de mémoire) de dirty pages a partir duquel le pdflush doit commencer à écrire
vm.dirty_background_ratio=&lt;value&gt;
# Pourcentage (totale de mémoire) de dirty pages a partir duquel le process lui même doit commencer à écrire les données dirty
vm.dirty_ratio=&lt;value&gt;
# Intervalle entre lequel le pdflush va se réveiller (100ths/sec) (Temps d'observation). Mettez 0 pour désactiver
vm.dirty_writeback_centisecs=&lt;value&gt;
# Définit quand les données sont assez vieilles (100ths/sec) pour être interceptées par pdflush (temps d'attente).
vm.dirty_expire_centisecs=&lt;value&gt;</pre></div></div>
</td></tr></table><br />
<p>Si lors d'un ps, il est possible de voir kswap et pdflush. Si ces 2 éléments sont en état D (iowait), c'est probablement causé par le kernel.
</p><p>Pour commiter toutes les dirty pages et buffers&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">sync
echo s &gt; /proc/sysrq-trigger</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="La_r.C3.A9clamation_des_clean_pages"><span class="mw-headline-number">3</span> La réclamation des clean pages</span></h1>
<p>Il existe plusieurs façons de vider les caches. Pour écrire toutes les clean pages présentent dans le page cache sur le disque&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> echo</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">echo 1 &gt; /proc/sys/vm/drop_caches</pre></div></div>
</td></tr></table><br />
<table width="100%" class="warning_array">
<tr>
<td class="warning_subarray"> <font size="-1"><a href="./File:Warning_file.png.html" class="image" title="Warning"><img alt="Warning" src="images/0/09/Warning_file.png" width="39" height="32" /></a> <b>WARNING</b></font>
</td></tr>
<tr>
<td>Attention toutefois à ne pas faire ça pendant les heures de production due aux IO provoquées
</td></tr></table><br />
<p>Il est également possible de flusher les dentries et les indoes&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> echo</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">echo 2 &gt; /proc/sys/vm/drop_caches</pre></div></div>
</td></tr></table><br />
<p>Pour flusher la totalité des cleans pages, dentries et inodes:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">echo 3 &gt; /proc/sys/vm/drop_caches</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="OOM"><span class="mw-headline-number">4</span> OOM</span></h1>
<p>OOM (Out Of Memory) peut arriver. Il existe pour cela un processus appellé l'oomkiller. Lorsqu'il n'y a plus de swap, plus de RAM, il va tuer des processus. Il se déclenchera si&#160;:
</p>
<ul><li> Vous n'avez plus d'espace en mémoire (incluant la RAM)</li>
<li> Il n'y a plus de pages disponibles dans la <a href="L'adressage_mémoire_et_son_allocation.html#UMA" title="L'adressage mémoire et son allocation">ZONE_NORMAL ou ZONE_HIGHMEM</a><sup id="cite_ref-1" class="reference"><a href="La_gestion_de_la_mémoire_sous_Linux.html#cite_note-1">[1]</a></sup></li>
<li> Il n'y a plus de mémoire disponible dans la table des mapping de pages</li></ul>
<p>Il est également possible de <a href="./SWAP_:_Création_de_swap_dynamique.html" title="SWAP : Création de swap dynamique">rajouter de la swap à chaud</a><sup id="cite_ref-2" class="reference"><a href="La_gestion_de_la_mémoire_sous_Linux.html#cite_note-2">[2]</a></sup> pour éviter un plantage dû à un OOM.
</p><p>Pour voir le niveau l'immunité de l'OOM-Kill sur un processus, il faut regarder le score des process (ici PID 1)&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cat</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; cat /proc/1/oom_score
0</pre></div></div>
</td></tr></table><br />
<p>Pour demander manuellement à l'oom-kill de se lancer&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> echo</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">echo f &gt; /proc/sysrq-trigger</pre></div></div>
</td></tr></table><br />
<p>Cependant, il ne tuera pas de process s'il y a suffisamment d’espace mémoire. Vous pouvez regarder dans les logs (messages ou syslog) afin de voir le résultat de celui ci.
</p><p>Il est possible de protéger des démons de l'oom-kill de cette façon&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> echo</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">echo n &gt; /proc/&lt;PID&gt;/oom_adj</pre></div></div>
</td></tr></table><br />
<ul><li> n&#160;: correspond au score qui sera multiplié par 2</li></ul>
<table width="100%" class="notes_array">
<tr>
<td class="notes_subarray"> <font size="-1"><a href="./File:Notes_file.png.html" class="image" title="Notes"><img alt="Notes" src="images/2/20/Notes_file.png" width="31" height="32" /></a> Notes</font>
</td></tr>
<tr>
<td>Il faut savoir que l'oom_adj est déprécié sur les kernel récent. Il faut utiliser /proc/&lt;PID&gt;/oom_score_adj à la place
</td></tr></table><br />
<table width="100%" class="warning_array">
<tr>
<td class="warning_subarray"> <font size="-1"><a href="./File:Warning_file.png.html" class="image" title="Warning"><img alt="Warning" src="images/0/09/Warning_file.png" width="39" height="32" /></a> <b>WARNING</b></font>
</td></tr>
<tr>
<td>Ce n'est pas parce que vous réglez le le score OOM d'un processus que ses fils en hériteront&#160;! Faites attention à cela&#160;!
</td></tr></table><br />
<p>Enfin, il est possible de désactiver l'oom-kill&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/sysctl.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">vm.panic_on_oom=1</pre></div></div>
</td></tr></table><br />
<p>Une petite dédicace pour les développeurs en herbe&#160;: ceci n'est pas une solution pour régler les fuites mémoire&#160;!
</p>
<h1><span class="mw-headline" id="D.C3.A9tecter_les_fuites_m.C3.A9moires"><span class="mw-headline-number">5</span> Détecter les fuites mémoires</span></h1>
<p>Il existe 2 types de fuites mémoire&#160;:
</p>
<ul><li> Les virtuelles&#160;: lorsqu'un process fait des requêtes qui ne sont pas dans l’espace virtuelle d'adresses (vsize)</li>
<li> Les réelles&#160;: lorsqu'un process n'arrive pas à libérer la mémoire (RSS)</li></ul>
<ul><li> On utilise <a href="./Sysstat_:_Des_outils_indispensable_pour_analyser_des_problèmes_de_performances.html" title="Sysstat : Des outils indispensable pour analyser des problèmes de performances">sar</a> pour voir les échanges côté système&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> sar</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">sar -R 1 120</pre></div></div>
</td></tr></table><br />
<ul><li> On utilise la commande ps combinée avec watch&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> watch</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">watch -n 1 'ps axo pid,comm,rss,vsize | grep sshd'</pre></div></div>
</td></tr></table><br />
<ul><li> Utiliser Valgrind pour les programmes en C&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> valgrind</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">valgrind --tool=memcheck cat /prox/$$/maps</pre></div></div>
</td></tr></table><br />
<p>Afin de comprendre un peu mieux ce qui se passe avec ps ou top&#160;:
</p>
<ul><li> VIRT stands for the virtual size of a process, which is the sum of memory it is actually using, memory it has mapped into itself (for instance the video card's RAM for the X server), files on disk that have been mapped into it (most notably shared libraries), and memory shared with other processes. VIRT represents how much memory the program is able to access at the present moment.</li></ul>
<ul><li> RES stands for the resident size, which is an accurate representation of how much actual physical memory a process is consuming. (This also corresponds directly to the&#160;%MEM column) This will virtually always be less than the VIRT size, since most programs depend on the C or other library.</li></ul>
<ul><li> SHR indicates how much of the VIRT size is actually sharable memory or libraries. In the case of libraries, it does not necessarily mean that the entire library is resident. For example, if a program only uses a few functions in a library, the whole library is mapped and will be counted in VIRT and SHR, but only the parts of the library file containing the functions being used will actually be loaded in and be counted under RES.</li></ul>
<h1><span class="mw-headline" id="La_swap"><span class="mw-headline-number">6</span> La swap</span></h1>
<p>Il est parfois nécessaire de supprimer toutes les pages ou segments d'un processus de la mémoire centrale. Dans ce cas le processus sera dit swappé, et toutes les données lui appartenant seront stockées en mémoire de masse. Cela peut survenir pour des processus dormant depuis longtemps, alors que le système d'exploitation a besoin d'allouer de la mémoire aux processus actifs. Les pages ou segments de code (programme) ne seront jamais swappés, mais tout simplement réassignés, car on peut les retrouver dans le fichier correspondant au programme (le fichier de l'exécutable). Pour cette raison, le système d'exploitation interdit l'accès en écriture à un fichier exécutable en cours d'utilisation&#160;; symétriquement, il est impossible de lancer l'exécution d'un fichier tant qu'il est tenu ouvert pour un accès en écriture par un autre processus.<sup id="cite_ref-3" class="reference"><a href="La_gestion_de_la_mémoire_sous_Linux.html#cite_note-3">[3]</a></sup>
</p><p>Il est important d'allouer suffisamment de swap à vos systèmes, même si vous avez largement assez de mémoire RAM. Si vous avez plusieurs disques, n'hésitez pas à créer plusieurs partitions et à leur mettre une priorité égale au niveau du montage dans fstab&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/fstab</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">[...]
/dev/mapper/vg0-swap none            swap    sw,pri=3              0       0
/dev/mapper/vg1-swap none            swap    sw,pri=3              0       0
/dev/mapper/vg2-swap none            swap    sw,pri=3              0       0
[...]</pre></div></div>
</td></tr></table><br />
<p>Grâce à cela, le démon kswapd ferra du round robin, tout comme un RAID 0 ferrait afin d'augmenter les performances.
</p><p>Comment savoir quelle taille de swap allouer à un système&#160;? C'est une question assez complexe qui a déjà fait beaucoup de débat. Voici une formule qui fonctionne plutôt pas mal&#160;:
</p>
<table class="wikitable sortable" border="0">
<tr>
<th>RAM
</th>
<th>SWAP
</th></tr>
<tr>
<td align="center">Entre 1 et 2 GB
</td>
<td align="left">1,5 x la taille de la RAM
</td></tr>
<tr>
<td align="center">Entre 2 et 8 GB
</td>
<td align="left">égale à la taille de la RAM
</td></tr>
<tr>
<td align="center">Plus de 8 GB
</td>
<td align="left">0,75 x la taille de la RAM
</td></tr></table>
<p>La recherche de pages inactive peut prendre du CPU. Sur des systèmes disposant de beaucoup de RAM, rechercher et démapper des pages inactives consomment plus de disque et CPU que d'écrire des pages anonymes sur le disque. Il est donc possible de paramétrer la façon dont le kernel va swapper. Ceci allant de 0 à 100. Plus on monte la valeur du swappiness, plus on force le système à swapper, ce qui réduit les I/O comme le montre le tableau ci dessous<sup id="cite_ref-4" class="reference"><a href="La_gestion_de_la_mémoire_sous_Linux.html#cite_note-4">[4]</a></sup>&#160;:
</p>
<table class="wikitable sortable" border="0">
<tr>
<th>vm.swappiness value
</th>
<th>Total I/O
</th>
<th>Average Swap
</th></tr>
<tr>
<td align="center">0
</td>
<td align="left">273.57 MB/s
</td>
<td align="left">0 MB
</td></tr>
<tr>
<td align="center">20
</td>
<td align="left">273.75 MB/s
</td>
<td align="left">0 MB
</td></tr>
<tr>
<td align="center">40
</td>
<td align="left">273.52 MB/s
</td>
<td align="left">0 MB
</td></tr>
<tr>
<td align="center">60
</td>
<td align="left">229.01 MB/s
</td>
<td align="left">23068 MB
</td></tr>
<tr>
<td align="center">80
</td>
<td align="left">195.63 MB/s
</td>
<td align="left">25587 MB
</td></tr>
<tr>
<td align="center">100
</td>
<td align="left">184.30 MB/s
</td>
<td align="left">26006 MB
</td></tr></table>
<p>Voilà comment modifier la swapiness&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/sysctl.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">vm.swappiness=60</pre></div></div>
</td></tr></table><br />
<p>Il faut savoir que le kernel aime swaper les pages anonymes lorsque le&#160;% de la mémoire mappée dans les tables de pages + vm.swappiness &gt;= 100
</p><p>Il existe également d'autres paramètres intéressant pour réduire le temps d'attente&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/sysctl.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># Nombre de pages que le kernel va lire pour une page fault. Ca aide à réduire les mouvements de tête de lecture de disque. Par défaut c'est 2 puissance page-cluster
vm.page-cluster=&lt;value&gt;
# Permet de controller pour combien de temps un process est protégé de la pagination lorsqu'il y a un vidage mémoire (en secondes)
vm.swap_token_timeout=&lt;seconds&gt;</pre></div></div>
</td></tr></table><br />
<p>S'il ne reste que peu de mémoire, le kernel va commencer par tuer les processus en espace utilisateur en commençant par ceux qui font la plus mauvaise utilisation de la mémoire (accès mémoire par rapport à l'allocation que les processus en font).
</p>
<h1><span class="mw-headline" id="References"><span class="mw-headline-number">7</span> References</span></h1>
<ol class="references">
<li id="cite_note-1"><a href="La_gestion_de_la_mémoire_sous_Linux.html#cite_ref-1">^</a> <span class="reference-text"><a href="L'adressage_mémoire_et_son_allocation.html#UMA" title="L'adressage mémoire et son allocation">L'adressage mémoire et son allocation#UMA</a></span>
</li>
<li id="cite_note-2"><a href="La_gestion_de_la_mémoire_sous_Linux.html#cite_ref-2">^</a> <span class="reference-text"><a href="./SWAP_:_Création_de_swap_dynamique.html" title="SWAP : Création de swap dynamique">SWAP : Création de swap dynamique</a></span>
</li>
<li id="cite_note-3"><a href="La_gestion_de_la_mémoire_sous_Linux.html#cite_ref-3">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://fr.wikipedia.org/wiki/M%C3%A9moire_virtuelle#Swapping">http://fr.wikipedia.org/wiki/M%C3%A9moire_virtuelle#Swapping</a></span>
</li>
<li id="cite_note-4"><a href="La_gestion_de_la_mémoire_sous_Linux.html#cite_ref-4">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://www.linuxvox.com/2009/10/what-is-the-linux-kernel-parameter-vm-swappiness/">http://www.linuxvox.com/2009/10/what-is-the-linux-kernel-parameter-vm-swappiness/</a></span>
</li>
</ol>
<p><a href="images/8/89/Memory_management_and_tuning_options_in_Red_Hat_Enterprise_Linux.pdf" class="internal" title="Memory management and tuning options in Red Hat Enterprise Linux.pdf">Memory management and tuning options in Red Hat Enterprise Linux</a>
</p>
<!-- 
NewPP limit report
CPU time usage: 0.068 seconds
Real time usage: 0.070 seconds
Preprocessor visited node count: 531/1000000
Preprocessor generated node count: 1764/1000000
Post‐expand include size: 5588/2097152 bytes
Template argument size: 1690/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   23.339      1 - -total
 23.55%    5.496     12 - Template:Command
 12.14%    2.834      5 - Template:Config
  8.38%    1.956      1 - Template:Infobox
  7.14%    1.667      6 - Template:Array_3col_cll
  4.50%    1.051      3 - Template:Array_2col_cl
  3.57%    0.833      2 - Template:Warning
  3.25%    0.759      1 - Template:Notes
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:3471-0!*!0!1!en!5!* and timestamp 20181111230639 and revision id 12454
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=La_gestion_de_la_mémoire_sous_Linux&amp;oldid=12454">https://wiki.deimos.fr/index.php?title=La_gestion_de_la_mémoire_sous_Linux&amp;oldid=12454</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=La+gestion+de+la+m%C3%A9moire+sous+Linux" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="La_gestion_de_la_mémoire_sous_Linux.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="La_gestion_de_la_mémoire_sous_Linux.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="La_gestion_de_la_mémoire_sous_Linux.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=La_gestion_de_la_m%C3%A9moire_sous_Linux&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=La_gestion_de_la_m%C3%A9moire_sous_Linux&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="La_gestion_de_la_mémoire_sous_Linux.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/La_gestion_de_la_mémoire_sous_Linux.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/La_gestion_de_la_m%C3%A9moire_sous_Linux" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=La_gestion_de_la_m%C3%A9moire_sous_Linux&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=La_gestion_de_la_m%C3%A9moire_sous_Linux&amp;oldid=12454" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=La_gestion_de_la_m%C3%A9moire_sous_Linux&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 6 May 2013, at 14:41.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["ext.cite.a11y","mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":31});
}</script>
	</body>
</html>
	
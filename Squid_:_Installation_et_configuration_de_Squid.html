<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>Squid : Installation et configuration de Squid - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="./Squid_:_Installation_et_configuration_de_Squid.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Squid_:_Installation_et_configuration_de_Squid","wgTitle":"Squid : Installation et configuration de Squid","wgCurRevisionId":11000,"wgRevisionId":11000,"wgArticleId":3102,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Squid_:_Installation_et_configuration_de_Squid","wgRelevantArticleId":3102,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Squid_Installation_et_configuration_de_Squid skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Squid : Installation et configuration de Squid</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="./Squid_:_Installation_et_configuration_de_Squid.html#mw-navigation">navigation</a>, 					<a href="./Squid_:_Installation_et_configuration_de_Squid.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="./Squid_:_Installation_et_configuration_de_Squid.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="./Squid_:_Installation_et_configuration_de_Squid.html#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="./Squid_:_Installation_et_configuration_de_Squid.html#Debian"><span class="tocnumber">2.1</span> <span class="toctext">Debian</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="./Squid_:_Installation_et_configuration_de_Squid.html#FreeBSD"><span class="tocnumber">2.2</span> <span class="toctext">FreeBSD</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="./Squid_:_Installation_et_configuration_de_Squid.html#Configuration"><span class="tocnumber">3</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="./Squid_:_Installation_et_configuration_de_Squid.html#Exemple_1"><span class="tocnumber">3.1</span> <span class="toctext">Exemple 1</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="./Squid_:_Installation_et_configuration_de_Squid.html#Exemple_2"><span class="tocnumber">3.2</span> <span class="toctext">Exemple 2</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="./Squid_:_Installation_et_configuration_de_Squid.html#V.C3.A9rifier_ses_r.C3.A8gles"><span class="tocnumber">3.3</span> <span class="toctext">Vérifier ses règles</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="./Squid_:_Installation_et_configuration_de_Squid.html#Get"><span class="tocnumber">3.3.1</span> <span class="toctext">Get</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="./Squid_:_Installation_et_configuration_de_Squid.html#Connect"><span class="tocnumber">3.3.2</span> <span class="toctext">Connect</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="./Squid_:_Installation_et_configuration_de_Squid.html#FAQ"><span class="tocnumber">4</span> <span class="toctext">FAQ</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="./Squid_:_Installation_et_configuration_de_Squid.html#WARNING.21_Your_cache_is_running_out_of_filedescriptors"><span class="tocnumber">4.1</span> <span class="toctext">WARNING! Your cache is running out of filedescriptors</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="./Squid_:_Installation_et_configuration_de_Squid.html#Ressources"><span class="tocnumber">5</span> <span class="toctext">Ressources</span></a></li>
</ul>
</div>

<table class="config_array" align="right" style="width:20em; font-size:90%; text-align:left; border: 1px #d0e7ff solid; margin-left:10px;">
   <tr>
      <td class="config_subarray" colspan="2" style="text-align:center;"><a href="./File:Squid_logo.png.html" class="image" title="Squid"><img alt="Squid" src="images/9/98/Squid_logo.png" width="220" height="123" /></a></td>
   </tr><tr><td colspan="2" style="text-align:center;"><hr class="gradient" /></td></tr><tr>
      <th>Software version</th>
      <td>2.7</td>
   </tr><tr>
      <th>Operating System</th>
      <td>FreeBSD 9<br />Debian 6</td>
   </tr><tr>
      <th>Website</th>
      <td><a rel="nofollow" class="external text" href="http://www.squid-cache.org/">Squid Website</a></td>
   </tr><tr>
      <th>Last Update</th>
      <td>06/06/2012</td>
   </tr><tr>
      <th>Others</th>
      <td></td>
   </tr>
</table>
<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p>Un serveur Squid est un serveur mandataire (proxy) capable d'utiliser les protocoles FTP, HTTP, Gopher, et HTTPS. Contrairement aux serveurs proxy classiques, un serveur Squid gère toutes les requêtes en un seul processus d'entrée/sortie, non bloquant.
</p><p>C'est un logiciel libre distribué selon les termes de la licence GNU GPL.
</p><p>Squid garde les meta-données et plus particulièrement les données les plus fréquemment utilisées en mémoire. Il conserve aussi en mémoire les requêtes DNS, ainsi que les requêtes ayant échoué. Les requêtes DNS sont non bloquantes.
</p><p>Les données mémorisées peuvent être rangées en hiérarchies ou en mailles pour utiliser moins de bande passante.
</p><p>Squid est inspiré du projet Harvest. Il est compatible avec IPv6 à partir de sa version 3.
</p>
<h1><span class="mw-headline" id="Installation"><span class="mw-headline-number">2</span> Installation</span></h1>
<h2><span class="mw-headline" id="Debian"><span class="mw-headline-number">2.1</span> Debian</span></h2>
<p>L'installation est simple&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td>
<pre>aptitude install squid
</pre>
</td></tr></table><br />
<h2><span class="mw-headline" id="FreeBSD"><span class="mw-headline-number">2.2</span> FreeBSD</span></h2>
<p>L'installation se fait facilement&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> pkg_add</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">pkg_add -vr squid</pre></div></div>
</td></tr></table><br />
<p>Initialisez ensuite le cache&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> squid</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; squid -z
2012/05/29 05:20:40| Creating Swap Directories</pre></div></div>
</td></tr></table><br />
<p>Puis mettez Squid en démarrage au boot&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/rc.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># Squid
squid_enable=&quot;YES&quot;</pre></div></div>
</td></tr></table><br />
<p>Et enfin nous allons nous faire un fichier de configuration le plus basique possible&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cp /usr/local/etc/squid/squid.conf /usr/local/etc/squid/squid.conf.default
grep -v &quot;^#&quot; &lt; /usr/local/etc/squid/squid.conf.default | sed '/^$/d' &gt; /usr/local/etc/squid/squid.conf</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Configuration"><span class="mw-headline-number">3</span> Configuration</span></h1>
<h2><span class="mw-headline" id="Exemple_1"><span class="mw-headline-number">3.1</span> Exemple 1</span></h2>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /usr/local/etc/squid/squid.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">#-------------------------------------------------------------------------------
# Minimum configuration
#-------------------------------------------------------------------------------
acl all src all
acl manager proto cache_object
acl localhost src 127.0.0.1/32
acl to_localhost dst 127.0.0.0/8 0.0.0.0/32
# Squid listening port
http_port 3128
&#160;
#-------------------------------------------------------------------------------
# Security
#-------------------------------------------------------------------------------
#chroot on                            # Chroot Squid deamon
forwarded_for off                    # Hide source IP
visible_hostname proxy.deimos.fr     # Mask proxy name
httpd_suppress_version_string on     # Hide squid version
&#160;
#-------------------------------------------------------------------------------
# ACL network definition
#-------------------------------------------------------------------------------
acl wifi_net src x.x.x.x/24  	# Wifi network
acl wan_net src x.x.x.x/24	# Wan local network
&#160;
#-------------------------------------------------------------------------------
# ACL Ports definition
#-------------------------------------------------------------------------------
acl SSL_ports port 443
acl Safe_ports port 80		    # http
acl Safe_ports port 21		    # ftp
acl Safe_ports port 443		    # https
acl Safe_ports port 70		    # gopher
acl Safe_ports port 210		    # wais
acl Safe_ports port 1025-65535	# unregistered ports
acl CONNECT method CONNECT
&#160;
#-------------------------------------------------------------------------------
# Specific ACL
#-------------------------------------------------------------------------------
# Apache mod_gzip and mod_deflate known to be broken so don't trust
# Apache to signal ETag correctly on such responses
acl apache rep_header Server ^Apache
broken_vary_encoding allow apache
#We recommend you to use at least the following line
hierarchy_stoplist cgi-bin&#160;? 
&#160;
#-------------------------------------------------------------------------------
# Allow/Deny access
#-------------------------------------------------------------------------------
# Minimal access
http_access allow manager localhost
http_access deny manager
# Deny requests to unknown ports
http_access deny&#160;!Safe_ports
# Deny CONNECT to other than SSL ports
http_access deny CONNECT&#160;!SSL_ports
http_access deny to_localhost
# Custom access
http_access allow wifi_net
# And finally deny all other access to this proxy
http_access deny all
&#160;
#-------------------------------------------------------------------------------
# Internet Cache Protocol
#-------------------------------------------------------------------------------
icp_access allow wifi_net
icp_access deny all
&#160;
#-------------------------------------------------------------------------------
# Cache properties
#-------------------------------------------------------------------------------
cache_mgr root                     # Email contact in cache die case
# cache_dir ufs Directory-Name Mbytes L1 L2 [options]
cache_dir ufs /var/squid/cache 1024 16 256
maximum_object_size 10240000 KB    # Set maximum file size to be cached
# Cache expiration patterns
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320
&#160;
#-------------------------------------------------------------------------------
# Performances Tuning
#-------------------------------------------------------------------------------
pipeline_prefetch on    # To boost the performance of pipelined requests
&#160;
#-------------------------------------------------------------------------------
# Logs
#-------------------------------------------------------------------------------
access_log /var/squid/logs/access.log squid
cache_log /var/squid/logs/cache.log
cache_store_log /var/squid/logs/store.log
coredump_dir /var/squid/cache
buffered_logs on            # Will speed up if there is not a lot of logs
debug_options ALL,1         # Set log level 1 -&gt; 9</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Exemple_2"><span class="mw-headline-number">3.2</span> Exemple 2</span></h2>
<p>Pour la configuration, je ne vais pas rentrer dans les détails, mais voici un aperçu d'une configuration qui fonctionne et qui est assez restrictive&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/squid/squid.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">http_port 3129 
http_port 3128 
icp_port 3131
&#160;
# Be more anonymous
# That’s three pieces of information you may not want to give away:
# - The host name of your proxy server
# - The version of Squid it’s running
# - The IP address of the system that’s making the request via the proxy
forwarded_for off
visible_hostname proxy.local
httpd_suppress_version_string on
&#160;
####auth_param basic program /usr/lib/squid/squid_ldap_auth -b dc=openldap,dc=mycompany,dc=lan -f 'uid=%s' -s sub ldap
#auth_param basic program /usr/lib/squid/squid_ldap_auth -v 3 -b dc=openldap,dc=mycompany,dc=lan -f &quot;(&amp;(objectClass=mycompanyUser)(uid=%s))&quot; -s sub -H ldap://ldap
auth_param basic credentialsttl 2 hours
#auth_param basic realm Web-Proxy
&#160;
#acl Authentified proxy_auth REQUIRED
acl all	src 0.0.0.0/0
acl mycompany dstdomain mycompany.net
acl mycompany dstdomain mycompany.com
acl mycompany dstdomain mycompany.lan
&#160;
# Concurent access
#url_rewrite_concurrency 20
&#160;
# White and Black lists
#acl url_blacklist dstdom_regex -i &quot;/etc/squid/bidon.txt&quot; 
#acl good_domains dstdom_regex -i &quot;/etc/squid/good_domains&quot;
acl url_whitelist dstdom_regex -i &quot;/etc/squid/url_whitelist.txt&quot; 
acl url_blacklist dstdom_regex -i &quot;/etc/squid/url_blacklist.txt&quot; 
acl dst_whitelist dst &quot;/etc/squid/dst_whitelist.txt&quot;
acl dst_blacklist dst &quot;/etc/squid/dst_blacklist.txt&quot; 
&#160;
# Facebook
acl facebook dstdom_regex facebook.com
acl srcfacebook src 10.101.4.253/32
acl srcfacebook src 10.101.0.253/32 
acl srcfacebook src 10.101.0.107/32
acl srcfacebook src 10.101.4.23/32 
&#160;
# SuperUser
acl SuperUser src 10.101.4.253/32
&#160;
# Monster
acl monsternet	dst 208.71.196.0/24
acl monsternet	dst 63.112.169.0/24
acl monsterdom  dstdom_regex newjobs.com monster.com
&#160;
# Bypass proxy
acl binaries_ext  url_regex -i \.iso$ \.zip$ \.deb$ \.rpm$ \.gz$ \.bz2$ \.exe$ \.cab$ \.bin$ \.tgz$ \.msi$ \.sh$
acl binaries_mime req_mime_type -i ^application/x-debian-package$ ^application/x-bzip2$
&#160;
acl tunnelurl     url_regex ^http://.*/IDLE/[0-9]+$
acl tunnelurl     url_regex ^http://.*/SEND/[0-9]+$
acl tunnelmethod  method POST
acl videoreq req_mime_type -i ^video/x-ms-wmv$
acl audioreq req_mime_type -i ^audio/mpeg$
acl tunnelreq req_mime_type -i ^application/x-fcs$
acl videorep rep_mime_type -i ^video/x-ms-wmv$
acl audiorep rep_mime_type -i ^audio/mpeg$
acl tunnelrep rep_mime_type -i ^application/x-fcs$
acl manager proto cache_object
acl localhost src 127.0.0.1/32
acl to_localhost dst 127.0.0.0/8
acl localnet src 10.0.0.0/8    # RFC1918 possible internal network
acl localnet src 172.16.0.0/12 # RFC1918 possible internal network
acl localnet src 192.168.0.0/16        # RFC1918 possible internal network
&#160;
# SSL Ports
acl SSL_ports port 443
acl SSL_ports port 5050	# yahoo
&#160;
# Allow outbound ports
acl Safe_ports port 80		# http
acl Safe_ports port 8080	# http
acl Safe_ports port 11371	# gpg key
acl Safe_ports port 21		# ftp
acl Safe_ports port 21		# ftp
&#160;
acl CVS_port port 2401		# CVS
acl CONNECT method CONNECT
&#160;
# Bypass hours
acl timeok time 18:00-23:59
acl timeok time 00:00-09:00
acl timeok time 12:00-14:00
acl timeok time AS
&#160;
acl visio src 10.101.3.17/32
acl visio src 10.101.3.9/32
&#160;
# Google talk ACL
acl	port_gtalk	port 5222
acl gtalk_dst dstdom_regex talk.*.google.com
&#160;
# ulbridge and co
acl	port_63007	port 63007
acl	port_63005	port 63005
acl	port_8090	port 8090
acl	port_2000	port 2000
acl	snutulbrlbnuat01 dstdom_regex 	snutulbrlbnuat01
acl	cnutulomlnprd-om01 dstdom_regex cnutulomlnprd-om01
acl cnutulbrlnprd-br01 dstdom_regex cnutulbrlnprd-br01
acl	public_ip	dst 62.23.35.231/32
&#160;
http_access allow Superuser
http_access allow timeok
http_access allow url_whitelist
http_access allow dst_whitelist
http_access allow srcfacebook facebook
http_access deny url_blacklist
http_access deny dst_blacklist
http_access deny tunnelurl tunnelmethod
http_access deny audioreq
http_access deny videoreq
http_access deny tunnelreq
&#160;
http_reply_access allow timeok
http_reply_access allow url_whitelist
http_reply_access deny audiorep
http_reply_access deny videorep
http_reply_access deny tunnelrep
&#160;
http_access allow snutulbrlbnuat01 port_63005
http_access allow snutulbrlbnuat01 port_63007
http_access allow cnutulomlnprd-om01 port_63007
http_access allow cnutulbrlnprd-br01 port_63005
http_access allow stmartin port_8003
http_access allow public_ip port_2000
&#160;
# Google talk
http_access allow gtalk_dst port_gtalk
&#160;
http_access allow manager localhost
http_access deny manager
http_access allow localhost
#http_access allow localnet Safe_ports mycompany Authentified
#http_access deny localnet Safe_ports mycompany&#160;!Authentified
#http_access allow localnet Authentified
#http_access allow localnet CONNECT Authentified
http_access allow localnet Safe_ports 
http_access allow localnet CVS_port
#Authentified
http_access allow localnet SSL_ports CONNECT 
http_access allow localnet CVS_port CONNECT 
#Authentified
#http_access deny&#160;!Safe_ports
#http_access deny CONNECT&#160;!SSL_ports
http_access deny all
&#160;
icp_access deny all
htcp_access deny all
&#160;
cache deny monsternet
cache deny monsterdom
&#160;
deny_info http://proxy.mycompany.lan/not-allowed-new.html all
deny_info http://proxy.mycompany.lan/not-allowed-new.html url_blacklist.txt
deny_info http://proxy.mycompany.lan/not-allowed-new.html dst_blacklist.txt
&#160;
#hierarchy_stoplist cgi-bin&#160;?
acl QUERY urlpath_regex cgi-bin \?
no_cache deny QUERY
&#160;
# comment it out to desactivate squidGuard
url_rewrite_program /usr/bin/squidGuard -c /etc/squid/squidGuard.conf
&#160;
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern (cgi-bin|\?)	0	0%	0
#refresh_pattern -i \.(gif|jpg|avi|iso|txt)$ 60 20% 120
refresh_pattern .		0	20%	4320
#refresh_pattern -i \.(gif|jpg|avi|iso|txt)$ 30 20% 60
&#160;
coredump_dir /var/spool/squid
access_log /var/log/squid/access.log squid
&#160;
cache_dir ufs /var/spool/squid 25000 16 256
maximum_object_size 1024000 KB
&#160;
delay_pools 3
&#160;
delay_class 1 2
delay_parameters 1 -1/-1 -1/-1
&#160;
delay_class 2 3
##delay_parameters 2 256000/256000 64000/64000 16000/48000
delay_parameters 2 256000/256000 64000/64000 -1/-1
#delay_parameters 2 -1/-1 256000/1280000 -1/-1
#delay_parameters 2 256000/256000 -1/-1 -1/-1
&#160;
delay_class 3 1
delay_parameters 3 256000/256000
#delay_parameters 3 1024000/1024000
&#160;
&#160;
delay_access 1 deny localnet
delay_access 3 allow binaries_ext
delay_access 3 allow visio
delay_access 2 deny  binaries_ext
delay_access 2 allow localnet
&#160;
&#160;
#debug_options ALL,1 29,6 28,6
ignore_expect_100 on</pre></div></div>
</td></tr></table><br />
<p>Maintenant, il ne reste plus qu'a adapter et relancer le serveur.
</p>
<h2><span class="mw-headline" id="V.C3.A9rifier_ses_r.C3.A8gles"><span class="mw-headline-number">3.3</span> Vérifier ses règles</span></h2>
<h3><span class="mw-headline" id="Get"><span class="mw-headline-number">3.3.1</span> Get</span></h3>
<p>Pour les méthodes Get, il est possible de vérifier ce qui est disponible de cette façon&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> nc</font>
</td></tr>
<tr>
<td>
<pre>printf "GET <a rel="nofollow" class="external free" href="http://">http://</a>&lt;destination_ip&gt;:&lt;destination_port&gt;\r\n" |  nc -w 1 &lt;proxy&gt; &lt;proxy_port&gt;
</pre>
</td></tr></table><br />
<h3><span class="mw-headline" id="Connect"><span class="mw-headline-number">3.3.2</span> Connect</span></h3>
<p>Il faut limiter au maximum les méthodes CONNECT et laisser uniquement la méthode GET. CONNECT est généralement utilisé par le port 443 et est potentiellement dangereux car il permet de faire du tunneling. Pour exploiter un tunnel, voici comment faire&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> nc</font>
</td></tr>
<tr>
<td>
<pre>nc -w 1 -v -X connect -x &lt;proxy&gt;:&lt;proxy_port&gt; &lt;destination&gt; &lt;destination_port&gt;
</pre>
</td></tr></table><br />
<p>On peut donc voir si ça fonctionne (et qu'un port est ouvert de l'autre côté) un résultat du type&#160;:
</p>
<pre>Connection to 88.191.144.199 873 port [tcp/rsync] succeeded!
</pre>
<p>ou
</p>
<pre>nc: Proxy error: "HTTP/1.0 504 Gateway Time-out"
</pre>
<p>A ce moment là, on sait que le mode CONNECT fonctionne sur ce port. Sinon, on aura&#160;:
</p>
<pre>nc: Proxy error: "HTTP/1.0 302 Moved Temporarily"
</pre>
<h1><span class="mw-headline" id="FAQ"><span class="mw-headline-number">4</span> FAQ</span></h1>
<h2><span class="mw-headline" id="WARNING.21_Your_cache_is_running_out_of_filedescriptors"><span class="mw-headline-number">4.1</span> WARNING! Your cache is running out of filedescriptors</span></h2>
<p>Cela arrive quand squid vient taper le max des ulimit. Cela se manifeste par de gros ralentissements sur Internet. Pour résoudre ce problème, augmentez simplement la taille des file descriptor (par défaut à 1024)&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/default/squid</font>
</td></tr>
<tr>
<td>
<pre>SQUID_MAXFD=<b>4096</b>
</pre>
</td></tr></table><br />
<p>Puis redémarrez le service
</p>
<h1><span class="mw-headline" id="Ressources"><span class="mw-headline-number">5</span> Ressources</span></h1>
<p><a rel="nofollow" class="external free" href="http://www.squid-cache.org/">http://www.squid-cache.org/</a><br />
<a rel="nofollow" class="external free" href="http://www.visolve.com/squid/squid27/contents.php">http://www.visolve.com/squid/squid27/contents.php</a><br />
<a rel="nofollow" class="external free" href="http://www.visolve.com/squid/squid27/accesscontrols.php">http://www.visolve.com/squid/squid27/accesscontrols.php</a><br />
<a rel="nofollow" class="external free" href="http://www.davidandrzejewski.com/2011/11/06/squid-proxy-make-outgoing-headers-anonymous/?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+davidandrzejewski+%28David+Andrzejewski%29">http://www.davidandrzejewski.com/2011/11/06/squid-proxy-make-outgoing-headers-anonymous/?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+davidandrzejewski+%28David+Andrzejewski%29</a>
</p>
<!-- 
NewPP limit report
CPU time usage: 0.040 seconds
Real time usage: 0.037 seconds
Preprocessor visited node count: 237/1000000
Preprocessor generated node count: 674/1000000
Post‐expand include size: 2898/2097152 bytes
Template argument size: 829/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   11.443      1 - -total
 46.16%    5.282      4 - Template:Config
 24.57%    2.811      6 - Template:Command
 17.47%    1.999      1 - Template:Infobox
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:3102-0!*!*!1!en!5!* and timestamp 20181111230822 and revision id 11000
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=Squid_:_Installation_et_configuration_de_Squid&amp;oldid=11000">https://wiki.deimos.fr/index.php?title=Squid_:_Installation_et_configuration_de_Squid&amp;oldid=11000</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=Squid+%3A+Installation+et+configuration+de+Squid" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="./Squid_:_Installation_et_configuration_de_Squid.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="./Squid_:_Installation_et_configuration_de_Squid.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="./Squid_:_Installation_et_configuration_de_Squid.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=Squid_:_Installation_et_configuration_de_Squid&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=Squid_:_Installation_et_configuration_de_Squid&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="./Squid_:_Installation_et_configuration_de_Squid.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/Squid_:_Installation_et_configuration_de_Squid.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/Squid_:_Installation_et_configuration_de_Squid" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=Squid_:_Installation_et_configuration_de_Squid&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=Squid_:_Installation_et_configuration_de_Squid&amp;oldid=11000" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=Squid_:_Installation_et_configuration_de_Squid&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 6 June 2012, at 08:31.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":74});
}</script>
	</body>
</html>
	
<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>Les flux réseaux - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="Les_flux_réseaux.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Les_flux_réseaux","wgTitle":"Les flux réseaux","wgCurRevisionId":6627,"wgRevisionId":6627,"wgArticleId":2706,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Les_flux_réseaux","wgRelevantArticleId":2706,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Les_flux_réseaux skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Les flux réseaux</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="Les_flux_réseaux.html#mw-navigation">navigation</a>, 					<a href="Les_flux_réseaux.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Les_flux_réseaux.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Les_flux_réseaux.html#Netflow"><span class="tocnumber">2</span> <span class="toctext">Netflow</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="Les_flux_réseaux.html#Netflow_ou_PCAP_.3F"><span class="tocnumber">3</span> <span class="toctext">Netflow ou PCAP&#160;?</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="Les_flux_réseaux.html#D.C3.A9tection"><span class="tocnumber">4</span> <span class="toctext">Détection</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="Les_flux_réseaux.html#D.C3.A9couverte_de_son_r.C3.A9seau"><span class="tocnumber">4.1</span> <span class="toctext">Découverte de son réseau</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="Les_flux_réseaux.html#Scan"><span class="tocnumber">4.2</span> <span class="toctext">Scan</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="Les_flux_réseaux.html#Virus_et_vers"><span class="tocnumber">4.3</span> <span class="toctext">Virus et vers</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="Les_flux_réseaux.html#Spyware.2C_IM_et_auto-update"><span class="tocnumber">4.4</span> <span class="toctext">Spyware, IM et auto-update</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="Les_flux_réseaux.html#FTP.2C_P2P.2C_etc."><span class="tocnumber">4.5</span> <span class="toctext">FTP, P2P, etc.</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="Les_flux_réseaux.html#Recherche_historique"><span class="tocnumber">4.6</span> <span class="toctext">Recherche historique</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="Les_flux_réseaux.html#Conclusion"><span class="tocnumber">5</span> <span class="toctext">Conclusion</span></a></li>
<li class="toclevel-1 tocsection-12"><a href="Les_flux_réseaux.html#Ressources"><span class="tocnumber">6</span> <span class="toctext">Ressources</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p>Les flux réseau portant sur les dénis de services réseau, voici le sujet abordé ici. En effet, les flux réseau («&#160;net flows&#160;») permettent de détecter de manière très simple les dénis de services mutualisés vu la quantité de flux générés par l’armée de zombies qui vous attaque.
</p><p>Nous allons nous attacher à vous présenter dans cet article d’autres applications de ces flux réseau&#160;: détection d’intrusion ou violation de politique, détection de canaux cachés ou encore prolifération d’un vers pour ne citer que quelques exemples. Alors que la détection de dénis de services mutualisés est quelque chose de relativement spécifique aux opérateurs et fournisseurs de services Internet, les autres applications sont-elles bien adaptées à un réseau interne&#160;?
</p>
<h1><span class="mw-headline" id="Netflow"><span class="mw-headline-number">2</span> Netflow</span></h1>
<p>Netflow est l’implémentation Cisco de la technologie. A l’origine, Netflow était une technologie de routage qui consistait à «&#160;router&#160;» par flux qui n’est plus très utilisée de nos jours. Chaque paquet qui traverse un routeur génère soit un nouveau flux, soit fait partie d’un flux existant. Les principales caractéristiques du datagramme IP (au standard de l’époque, ce qui n’est plus forcément le cas aujourd’hui vu que beaucoup d’applications encapsulent dans d’autres protocoles), à savoir adresses IP source et destination, ports source et destination (ou d’autres caractéristiques comme le type de message et le code pour ICMP), le protocole de transport, le ToS (Type of Service) ainsi que l’interface d’entrée forment le sept-tuble de base. Viennent s’ajouter d’autres informations comme les compteurs de données et de paquets, l’interface de sortie, les drapeaux TCP (ici s’arrête les caractéristiques de la version 1), le numéro d’AS (version 5) et l’adresse du prochain saut (i.e. le prochain routeur traversé). La durée de vie d’un flux dans le cache est limitée&#160;: sur un routeur, il est détruit après 15 secondes d’inactivité, 30 minutes d’activités, lors d’un RST/FIN TCP ou lorsque le cache est plein. A noter également&#160;: un flux est unidirectionnel, une session TCP génère donc deux flux (un entrant, un sortant).<br />
Avec l’apogée des réseaux MPLS, le paquet n’est plus routé mais commuté sur la base de labels. Netflow a été adapté pour permettre la comptabilisation dans de tels environnements (version 9 de Netflow). La version la plus couramment déployée est la version 5. La version 8 ajoute le support de l’agrégation de flux côté routeur, la version 9 quant à elle, outre le support MPLS et une plus grande flexibilité, ajoute le support IPv6 et se rapproche d’IPFIX (pour ne pas dire l’inverse), le standard IETF pour les flux réseau.<br />
Jusqu’à récemment, Netflow était ingress-only, c’est-à-dire que seuls les paquets qui entraient sur une interface étaient comptabilisés. Dans les versions récentes d’IOS (si le matériel le supporte), egress netflow peut-être configuré. Cela permet par exemple de détecter les attaques entrantes et sortantes sans avoir à configurer Netflow sur toutes les interfaces du routeur et avoir à vérifier que l’on ne compte pas le flux plusieurs fois lors de la traversée d’un réseau de taille conséquente.<br />
</p><p>Il existe trois méthodes d'échantillonnage&#160;: «&#160;full&#160;», «&#160;sampled&#160;», «&#160;random sampled&#160;».
</p>
<ul><li> Full génère pour chaque flux réseau une information qui va être exportée. Cette méthode est la plus ancienne et celle qui est supportée quasiment sur tous les routeurs mais n’est plus très courante chez les opérateurs car la charge routeur et la quantité d’informations de comptabilisation générées tout particulièrement lors d’un déni de service mutualisé sont trop importantes. En revanche, dans le cadre d’un réseau interne, celle-ci est quasiment obligatoire si l’on veut pouvoir détecter des reconnaissances lentes ou des violations de politiques qui essaient de se faire discrètes.</li>
<li> Sampled permet de définir le pourcentage de flux à exporter sur le nombre total de flux générés. En général les opérateurs se limitent à 1 pour 100, voire 1 pour 1000. Même à 1 pour 1000, un déni de service mutualisé reste relativement facile ä détecter. L’avantage de cette méthode est la réduction de la charge CPU du routeur et de la quantité de Netflow exporté. L’inconvénient est qu’elle n’est pas bonne du point de vue statistique (fonction déterministe).</li>
<li> Random Sampled a été introduit relativement récemment et sur les plateformes du type 72xx/75xx (alors que sampled n’était disponible que sur les GSR et les 76xx, i.e. les routeurs qui supportent CEF distribué). La différence entre sampled et random sampled est que le deuxième sélectionne un datagramme au hasard parmi les &lt;x&gt; configurés, ce qui est statistiquement meilleur.</li></ul>
<p>Jusqu’à récemment le sampling était par routeur&#160;; dans les versions très récentes d’IOS il est possible de classifier les datagrammes en fonction de différents attributs (champs de l’en-tête IP, NBAR, etc.) et d’avoir des sampling levels par classe.
</p><p>Les exemples de configuration pour un routeur et un commutateur multi-niveaux sont disponibles dans le numéro 4 de MISC. A noter que dans les versions récentes d’IOS pour les commutateurs de la famille 65xx/76xx les versions 5 et 8 sont supportées (le drapeau TCP n’était entre autres pas présent dans la version 7) mais la configuration, les différences de fonctionnalités en fonction des cartes de supervision et de routage, et le choix du bon IOS restent un peu un casse-tête.
</p><p>Dans les réseaux sans routeur ou avec des équipements qui ne peuvent générer du Netflow, une alternative est de brancher un PC sur un port en mode écoute (SPAN ou mirror port) est de s’en servir pour exporter des informations Netflow. Une liste d’outils (clients et serveurs Netflow, générateurs PCAP-&gt;Netflow) est disponible ici&#160;: <a rel="nofollow" class="external free" href="http://www.switch.ch/tf-tant/floma/software.html">http://www.switch.ch/tf-tant/floma/software.html</a>. Cette approche ne résiste bien sûr pas vraiment au facteur d’échelle, même sur un réseau interne dès qu’il devient grand et que tout le trafic ne transite pas via un cœur bien défini.<br />
</p><p>Nous avons discuté des sondes et des sources Netflow, mais qu’en est-il du côté serveur&#160;?
</p><p>La méthode de stockage (fichier texte, base de données, etc.) et la politique de conservation ont un impact sur la taille des disques dont il faudra disposer, mais un autre élément important est l’agrégation des flux. Cette fonction est également disponible dans la version 8 Netflow et peut donc s’activer à la source, sur le routeur, mais on évitera de l’activer pour ne pas perdre en granularité. Sur le serveur, la politique de consolidation doit tenir compte des flux actifs ou non et du temps&#160;: si l’on agrège sur un jour il se pourrait qu’un couple IP source/destination et port source/destination (tout particulièrement si ce sont des services très demandés comme le DNS) apparaissent plusieurs fois et soient consolidés en un seul flux, ce qui serait faux.
</p>
<h1><span class="mw-headline" id="Netflow_ou_PCAP_.3F"><span class="mw-headline-number">3</span> Netflow ou PCAP&#160;?</span></h1>
<p>La meilleure réponse est sans doute&#160;: les deux. En effet, Netflow ignore le contenu applicatif transporté (uniquement des éléments de l’en-tête IP et des en-têtes des protocoles de la couche transport sont traités) alors qu’une trace réseau complète permet elle d’avoir toutes ces informations. Netflow permet d’avoir une vision macroscopique du réseau, la trace PCAP une vision microscopique. A force de vouloir faire dans le microscopique on a bien souvent tendance à oublier la vision globale, surtout dans le cadre de la résolution de problèmes réseau. De plus, comme pour les journaux générés par les systèmes et les applications, il convient de définir une politique de centralisation des «&#160;journaux&#160;» réseau, c’est un pré-requis pour l’analyste post-mortem d’incidents.
Pour des raisons de coût et de gestion, pour ne citer que ces deux facteurs, il devient très vite clair qu’on ne peux pas déployer une sonde en écoute sur tous les commutateurs d’un réseau. Alors pourquoi ne pas faire tout simplement des captures PCAP dans des endroits stratégiques du réseau&#160;? Cette alternative est une approche qui s’avère assez bonne dans bien des cas, mais un problème de taille doit être résolu avant&#160;: quelle est la capacité de mon système de stockage&#160;? En effet, une capture complète occupe beaucoup de place et la quantité de Go (ou de To) disponibles (ainsi que leur coût) vont rapidement limiter le nombre de sondes et la durée de conservation…
</p><p>L’approche la plus intéressante consiste à déployer Netflow sur l’ensemble du réseau et des sondes en écoute au niveau des endroits stratégiques&#160;: communication entre l’intérieur et l’extérieur du réseau (accès Internet, télémaintenance, accès VPN, extranet partenaire, etc.), le cœur du réseau (si vous concentrez tout votre trafic sur quelques «&#160;gros&#160;» commutateurs), en frontal de serveurs critiques, etc. Si vous décidez de centraliser ces informations il faudra également tenir compte du fait que votre trafic réseau va doubler (trafic normal + trafic PCAP entre les sondes et base de stockage), ou monter un réseau dédié à cet effet (ce qui évitera également de re-renifler les traces PCAP).
</p><p>Rien ne vous empêche de lier ces deux systèmes. Par exemple, il n’est pas inintéressant de connecter un système de détection d’anomalies fondé sur Netflow avec un outil de détection d’intrusion réseau (NIDS). Par cette approche, si Netflow détecte une anomalie vous pouvez soit activer les sondes PCAP pour essayer d’obtenir plus d’informations (si l’événement ou l’attaque est toujours en cours), soit si vous avez un snapshot tournant sur quelques heures stocké dans une base, de lancer une requête. Ou inversement, le NIDS remonte une alerte et vous récupérez un historique Netflow depuis votre base.
</p>
<h1><span class="mw-headline" id="D.C3.A9tection"><span class="mw-headline-number">4</span> Détection</span></h1>
<p>Avant de parler de détection il convient d’aborder le sujet de la découverte… Combien d’administrateurs ou de responsables réseau connaissent bien l’architecture de leur réseau et le trafic qu’il transporte&#160;?
</p>
<h2><span class="mw-headline" id="D.C3.A9couverte_de_son_r.C3.A9seau"><span class="mw-headline-number">4.1</span> Découverte de son réseau</span></h2>
<p>Une application très intéressante des flux réseau est la découverte du réseau&#160;: ils permettent de le cartographier, de découvrir les applications l’utilisant, de caractériser un comportement «&#160;habituel&#160;» (baseline), etc. Cette étape de découverte engendre souvent une étape de «&#160;ménage&#160;», voire de définition d’une nouvelle architecture en fonction des besoins de segmentation sécurité (réseaux avec différents niveaux de sensibilité).
</p>
<h2><span class="mw-headline" id="Scan"><span class="mw-headline-number">4.2</span> Scan</span></h2>
<p>Un scan (surtout si ce n’est pas un scan lent) est relativement simple à détecter&#160;: beaucoup de petits flux vers la même destination (adresse IP ou port) avec, si c’est un scan TCP, peu de sessions établies (en surveillant les drapeaux TCP) et pour un scan UDP, beaucoup de messages ICMP en retour pour signaler que le port est fermé (ou absence de réponse si le pare-feu est de l’hôte est strict).
</p>
<h2><span class="mw-headline" id="Virus_et_vers"><span class="mw-headline-number">4.3</span> Virus et vers</span></h2>
<p>La détection de virus et de vers reste une application relativement simple à mettre en place. En effet, la majorité d’entre eux ne sont pas très discrets et cherchent à se propager très rapidement, le plus souvent soit par tentative d’infection directe, soit après une recherche de ports ouverts. Une même machine infectée générera beaucoup de flux très courts et très petits vers un grand nombre de machines et/ou de ports.
</p><p>Un grand nombre de vers intègrent un moteur qui va chercher de nouvelles machines à infecter suivant un algorithme plus ou moins aléatoire. Le plus souvent, le préfixe réseau de la machine source est le premier à être scanné, puis le sous-réseau supérieur, et enfin des adresses prises plus ou moins au hasard (pseudo-aléatoire). A ce moment, il se peut que des datagrammes aient comme destination un préfixe réseau dit «&#160;bogon&#160;» (<a rel="nofollow" class="external free" href="http://www.cymru.com/Documents/bogon-dd.html#dd-route-non">http://www.cymru.com/Documents/bogon-dd.html#dd-route-non</a>), c’est-à-dire qu’il n’est pas encore alloué ou n’est pas censé être présent dans les tables de routage BGP de l’Internet.
Bien souvent, lorsqu’un attaquant décide de lancer un déni de service, il communique aux agents qui font partie de son armée de zombies de forger (spoofer) leur adresse IP source. Si vous voyez des flux sortants avec des adresses source qui ne font pas partie de votre plan d’adressage interne alors la probabilité d’infection est forte.
</p><p>Pour détecter les virus qui se connectent à des sites (souvent en HTTP) pour récupérer une nouvelle charge (payload), il peut être intéressant de placer dans une règle spéciale tous les sites listés par les éditeurs d’anti-virus dans les descriptions publiques qu’ils mettent à disposition sur leurs sites.
Canaux cachés et portes dérobées
</p><p>Les canaux cachés les plus courants sur les réseaux WiFi reposent sur de l’encapsulation dans ICMP ou DNS. En entreprise, c’est le tunnel sur HTTP qui est le plus courant. Ces flux sont en général depuis et vers les mêmes adresses IP, le port destination est fixe et la taille du flux est importante&#160;: un flux ICMP ou DNS qui dure plus de quelques secondes et qui dépasse les quelques kilo-octets est bien vite suspect, de même qu’un flux HTTP relativement symétrique au niveau de sa taille et long (alors qu’un flux HTTP est plutôt court – sauf téléchargement – et très asymétrique – envoi vs. réception).
Une porte dérobée quant à elle se traduit très souvent par un flux à destination d’un port non standard sur le système infecté, tout particulièrement si ce flux apparaît à des heures bizarres. Il peut également être intéressant de mettre en place des règles pour détecter les chevaux de Troie qui se mettent en écoute sur leur port par défaut. Un autre type de porte dérobée est l’accès à Internet «&#160;alternatif&#160;»&#160;: dans bon nombre de sociétés la politique de filtrage très stricte n’est plus (du tout) du goût de certaines personnes. Des flux vers ou depuis des adresses IP publiques qui ne transitent pas via votre passerelle d’accès à Internet méritent d’être analysés.
Machines compromises  et violation de politique
</p><p>Les machines compromises, et tout particulièrement si ce sont des serveurs, peuvent se détecter lors de la prise de contrôle à distance par l’attaquant&#160;: celle-ci se fait souvent via la connexion à un port non standard en écoute. Cependant certains exploits utilisent un mécanisme qui permet de repasser par le même port que celui de l’application, voire d’utiliser la même session. Ceux-ci ne sont pas simples à détecter, mais à moins de mettre en place une porte dérobée, il n’est pas toujours facile de ré-exploiter la même faille plusieurs fois de suite (pour cause de crash lors ou à cause de l’exploitation), et le fait de maintenir la session ouverte pourrait également être détecté.
</p><p>Il est également important d’observer les drapeaux TCP (attention, il faut vérifier si celui-ci est bien envoyé, ce n’est pas toujours le cas) qui permettent souvent de déterminer le sens de la communication, à savoir quel côté est le client et quel côté serveur.
Le fait de définir une politique de flux pour les différents systèmes (clients et serveurs) permet de détecter facilement un événement qui dérive de la baseline. Les systèmes sont groupés en fonction de leur comportement réseau et les différents échanges, soit entre ces groupes (pour une vue grossière), soit entre tous les systèmes (pour une vision très fine). La complexité du système allant grandissant avec le nombre de flux et le nombre de systèmes, il faut en tenir compte lors de la phase de design (complexité de la détection, mais surtout de la définition de la politique).
</p><p>Pour pousser plus loin, on peut très bien envisager de stocker dans la base de données les couples adresse MAC/port physique@équipement. Ceci permet de suivre les déplacements de ces adresses sur le réseau (portables, WiFI, DHCP, etc.), d’alerter si de nouvelles adresses apparaissent et, couplé aux données historiques Netflow, de détecter des déviations majeures dans le comportement. Il est probable que des informations comme l’adresse MAC et le VLAN ID soient rajoutées aux exports Netflow dans un futur proche ce qui évitera d’avoir à combiner Netflow avec des polls SNMP pour récupérer ces informations.
</p>
<h2><span class="mw-headline" id="Spyware.2C_IM_et_auto-update"><span class="mw-headline-number">4.4</span> Spyware, IM et auto-update</span></h2>
<p>Il peut être intéressant de surveiller les premiers flux qui suivent l’allocation via DHCP des paramètres réseau, l’ouverture de session sur la station ou la première communication sortante&#160;: en effet, c’est à ce moment-là que la majorité des «&#160;outils espions&#160;» et les fonctionnalités de mise à jour ou de reporting des logiciels se mettent à «&#160;téléphoner à la maison&#160;». Il est également très courant de voir des flux qui reviennent toutes les &lt;x&gt; secondes ou minutes avec le même couple source/destination (spyware qui récupère un bandeau de publicité à afficher ou cheval de Troie qui envoie les frappes capturées par exemple), mais dans ce cas, le risque de faux positif est fort (rafraîchissement automatique de la page dans un navigateur). Un autre moyen de détecter les spywares et les outils de messagerie instantanée (voire certains clients P2P) consiste à surveiller les changements de protocoles pour un même couple source/destination&#160;: ces outils rivalisent d’ingéniosité pour essayer de trouver une faille dans le pare-feu (connexion TCP directe, «&#160;connexion&#160;» UDP directe, HTTP en direct ou via le proxy configuré pour les navigateurs, encapsulation sur ICMP ou DNS, etc.).
</p><p>Et même si vous ne déployez pas de solution d’analyse des flux réseau, il est très intéressant de renifler les communications de votre ordinateur tout particulièrement au démarrage. On découvre souvent des choses intéressantes et inattendues.
</p>
<h2><span class="mw-headline" id="FTP.2C_P2P.2C_etc."><span class="mw-headline-number">4.5</span> FTP, P2P, etc.</span></h2>
<p>Les protocoles et applications qui utilisent des ports dynamiques ou qui reposent sur une connexion de contrôle et une connexion de données ne sont pas simples à traiter. En effet, Netflow ne maintient pas d’état ni de relation entre deux flux, et n’effectue aucune analyse protocolaire qui serait nécessaire pour identifier les connexions de données gérées par une connexion de contrôle.
Il est donc possible d’identifier sur la base de flux réseau uniquement les applications P2P qui reposent sur des ports fixes. Pour contourner cette limitation, certains vendeurs ont rajouté une couche qui permet d’identifier le protocole P2P sur la base de signatures, mais cela n’a déjà plus rien à voir avec Netflow. Une fonctionnalité comme NBAR (Network-Based Application Recognition) ou mieux, des équipements dédiés à la gestion de trafic P2P, sont des options possibles.
</p><p>Les implémentations FTP qui respectent la RFC et quelques applications P2P sont une exception car le port de données et celui de contrôle + ou –1. Donc, même si le serveur écoute sur un autre port que le port standard (21/TCP pour FTP et 20/TCP pour FTP-DATA), il est possible d’identifier le couple contrôle+données.
</p><p>Historiquement, les groupes qui publient des applications «&#160;piratées&#160;» génèrent des fichiers d’une taille standard (comme les 1.44 Mo à l’époque où l’on utilisait encore des disquettes) ce qui permet également de renforcer la qualité de la détection en se basant sur la taille du flux.
</p>
<h2><span class="mw-headline" id="Recherche_historique"><span class="mw-headline-number">4.6</span> Recherche historique</span></h2>
<p>On a souvent tendance à ne regarder que les 10 premiers d’un classement (comme par exemple l’utilisateur qui abuse le plus de la connexion Internet de l’entreprise), mais dans le cadre de la mise en place de mécanismes de recherche dans les données historiques, le top 10 est aussi important que le low 10. Et ceci sur tous les paramètres que permet d’avoir Netflow. De cette façon on peut souvent détecter les flux «&#160;perdus&#160;» qui peuvent donner des indications intéressantes sur une attaque bien dissimulée ou des reconnaissantes lentes de ports.
</p><p>Il est également intéressant de noter que, dans certains environnements (et en fonction des lois et des régulations locales), le fait de ne stocker que des informations Netflow ne constitue pas une atteinte à la vie privée. Ce côté moins intrusif permet bien souvent de «&#160;vendre&#160;» cette solution en interne. Et bien souvent, le flux en dit assez et les données transportées ne sont qu’un «&#160;bonus&#160;», un peu comme un le sujet d’un e-mail en clair et son contenu chiffré…
</p><p>Il existe un risque lié à l’injection de faux messages de comptabilisation Netflow. En effet, ils ne sont ni signés ni chiffrés et le seul mécanisme de défense (bien faible) est le numéro de séquence. Il est relativement simple de forger de tels paquets, vu qu’ils sont transportés sur UDP.
</p>
<h1><span class="mw-headline" id="Conclusion"><span class="mw-headline-number">5</span> Conclusion</span></h1>
<p>Nous nous sommes attachés à décrire différentes applications des flux réseau. Comme vous avez pu le constater, leur déploiement sur un réseau interne d’entreprise peut apporter une visibilité sans précédent, tout particulièrement de nos jours où les réseaux sont de plus en plus ouverts et les flux de plus en plus complexes. Un déploiement, même de test, permet de découvrir bien des choses insoupçonnées…
Si votre réseau est très segmenté, avec de nombreux pare-feu, le fait d’avoir des sources Netflow dans ces différents segments et un collecteur qui centralise les flux pourra vous aider à valider votre politique de sécurité et surtout son implémentation.
</p><p>Les différents exemples sont loin d’être une liste exhaustive, à vous de trouver de nouvelles applications et de définir les critères de détection qui correspondent à votre environnement particulier. Et n’oubliez pas que tout comme avec un outil de détection d’intrusion, la qualité des alertes et leur nombre sont fonction du temps passé à fignoler sa configuration.
</p><p>La prochaine étape consistera peut-être à lier ces mécanismes de détection avec des mécanismes de protection automatiques (désactivation du port sur le commutateur par exemple). Des technologies existent, l’avenir nous dira si elles seront adoptées.
</p>
<h1><span class="mw-headline" id="Ressources"><span class="mw-headline-number">6</span> Ressources</span></h1>
<p><a rel="nofollow" class="external free" href="http://www.unixgarden.com/index.php/administration-reseau/les-flux-reseau">http://www.unixgarden.com/index.php/administration-reseau/les-flux-reseau</a>
</p>
<!-- 
NewPP limit report
CPU time usage: 0.012 seconds
Real time usage: 0.012 seconds
Preprocessor visited node count: 51/1000000
Preprocessor generated node count: 60/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:2706-0!*!*!1!en!*!* and timestamp 20181111230846 and revision id 6627
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=Les_flux_réseaux&amp;oldid=6627">https://wiki.deimos.fr/index.php?title=Les_flux_réseaux&amp;oldid=6627</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=Les+flux+r%C3%A9seaux" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="Les_flux_réseaux.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="Les_flux_réseaux.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="Les_flux_réseaux.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=Les_flux_r%C3%A9seaux&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=Les_flux_r%C3%A9seaux&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="Les_flux_réseaux.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/Les_flux_réseaux.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/Les_flux_r%C3%A9seaux" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=Les_flux_r%C3%A9seaux&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=Les_flux_r%C3%A9seaux&amp;oldid=6627" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=Les_flux_r%C3%A9seaux&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 24 September 2008, at 11:21.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":49});
}</script>
	</body>
</html>
	
<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>Varnish : un accélérateur de site web - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="./Varnish_:_un_accélérateur_de_site_web.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Varnish_:_un_accélérateur_de_site_web","wgTitle":"Varnish : un accélérateur de site web","wgCurRevisionId":12601,"wgRevisionId":12601,"wgArticleId":3272,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Varnish_:_un_accélérateur_de_site_web","wgRelevantArticleId":3272,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-ruby {line-height: normal;}
.source-ruby li, .source-ruby pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for ruby
 * CSS class: source-ruby, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.ruby.source-ruby .de1, .ruby.source-ruby .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.ruby.source-ruby  {font-family:monospace;}
.ruby.source-ruby .imp {font-weight: bold; color: red;}
.ruby.source-ruby li, .ruby.source-ruby .li1 {font-weight: normal; vertical-align:top;}
.ruby.source-ruby .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.ruby.source-ruby .li2 {font-weight: bold; vertical-align:top;}
.ruby.source-ruby .kw1 {color:#9966CC; font-weight:bold;}
.ruby.source-ruby .kw2 {color:#0000FF; font-weight:bold;}
.ruby.source-ruby .kw3 {color:#CC0066; font-weight:bold;}
.ruby.source-ruby .kw4 {color:#CC00FF; font-weight:bold;}
.ruby.source-ruby .co1 {color:#008000; font-style:italic;}
.ruby.source-ruby .co4 {color: #cc0000; font-style: italic;}
.ruby.source-ruby .coMULTI {color:#000080; font-style:italic;}
.ruby.source-ruby .es0 {color:#000099;}
.ruby.source-ruby .br0 {color:#006600; font-weight:bold;}
.ruby.source-ruby .sy0 {color:#006600; font-weight:bold;}
.ruby.source-ruby .st0 {color:#996600;}
.ruby.source-ruby .nu0 {color:#006666;}
.ruby.source-ruby .me1 {color:#9900CC;}
.ruby.source-ruby .re0 {color:#ff6633; font-weight:bold;}
.ruby.source-ruby .re1 {color:#0066ff; font-weight:bold;}
.ruby.source-ruby .re2 {color:#6666ff; font-weight:bold;}
.ruby.source-ruby .re3 {color:#ff3333; font-weight:bold;}
.ruby.source-ruby .ln-xtra, .ruby.source-ruby li.ln-xtra, .ruby.source-ruby div.ln-xtra {background-color: #ffc;}
.ruby.source-ruby span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Varnish_un_accélérateur_de_site_web skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Varnish : un accélérateur de site web</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="./Varnish_:_un_accélérateur_de_site_web.html#mw-navigation">navigation</a>, 					<a href="./Varnish_:_un_accélérateur_de_site_web.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="./Varnish_:_un_accélérateur_de_site_web.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="./Varnish_:_un_accélérateur_de_site_web.html#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="./Varnish_:_un_accélérateur_de_site_web.html#Configuration"><span class="tocnumber">3</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="./Varnish_:_un_accélérateur_de_site_web.html#La_base"><span class="tocnumber">3.1</span> <span class="toctext">La base</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="./Varnish_:_un_accélérateur_de_site_web.html#Les_VCLs"><span class="tocnumber">3.1.1</span> <span class="toctext">Les VCLs</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="./Varnish_:_un_accélérateur_de_site_web.html#Le_d.C3.A9mon"><span class="tocnumber">3.1.2</span> <span class="toctext">Le démon</span></a>
<ul>
<li class="toclevel-4 tocsection-7"><a href="./Varnish_:_un_accélérateur_de_site_web.html#Cache_sur_disque"><span class="tocnumber">3.1.2.1</span> <span class="toctext">Cache sur disque</span></a></li>
<li class="toclevel-4 tocsection-8"><a href="./Varnish_:_un_accélérateur_de_site_web.html#Cache_en_RAM"><span class="tocnumber">3.1.2.2</span> <span class="toctext">Cache en RAM</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-9"><a href="./Varnish_:_un_accélérateur_de_site_web.html#Le_Cache"><span class="tocnumber">3.2</span> <span class="toctext">Le Cache</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="./Varnish_:_un_accélérateur_de_site_web.html#La_Compression"><span class="tocnumber">3.3</span> <span class="toctext">La Compression</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="./Varnish_:_un_accélérateur_de_site_web.html#Le_Loadbalancing"><span class="tocnumber">3.4</span> <span class="toctext">Le Loadbalancing</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="./Varnish_:_un_accélérateur_de_site_web.html#Reverse_Proxy"><span class="tocnumber">3.5</span> <span class="toctext">Reverse Proxy</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="./Varnish_:_un_accélérateur_de_site_web.html#S.C3.A9curiser_et_nettoyage_HTTP"><span class="tocnumber">3.6</span> <span class="toctext">Sécuriser et nettoyage HTTP</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="./Varnish_:_un_accélérateur_de_site_web.html#Uniformisation_des_Logs_d.E2.80.99acc.C3.A8s"><span class="tocnumber">3.7</span> <span class="toctext">Uniformisation des Logs d’accès</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15"><a href="./Varnish_:_un_accélérateur_de_site_web.html#Ressources"><span class="tocnumber">4</span> <span class="toctext">Ressources</span></a></li>
</ul>
</div>

<table class="config_array" align="right" style="width:20em; font-size:90%; text-align:left; border: 1px #d0e7ff solid; margin-left:10px;">
   <tr>
      <td class="config_subarray" colspan="2" style="text-align:center;"><a href="./File:Varnish_logo.png.html" class="image" title="Varnish"><img alt="Varnish" src="images/8/80/Varnish_logo.png" width="220" height="70" /></a></td>
   </tr><tr><td colspan="2" style="text-align:center;"><hr class="gradient" /></td></tr><tr>
      <th>Software version</th>
      <td>Varnish 2</td>
   </tr><tr>
      <th>Operating System</th>
      <td>Debian 6</td>
   </tr><tr>
      <th>Website</th>
      <td><a rel="nofollow" class="external text" href="https://www.varnish-cache.org/">Varnish Website</a></td>
   </tr><tr>
      <th>Last Update</th>
      <td>25/06/2013</td>
   </tr><tr>
      <th>Others</th>
      <td></td>
   </tr>
</table>
<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p><a rel="nofollow" class="external text" href="http://www.varnish-cache.org/">Varnish</a> est un serveur de cache pour serveurs Web. Ce qui rends les sites Internet beaucoup plus rapide. Il est également capable de faire du load balancing sur plusieurs serveurs web en backend ou encore du reverse proxy. En gros nous allons le placer en amont des serveurs Web pour intercepter les requêtes, mettre en cache ce qui est généré par les backends et resservir le contenu généré depuis son cache. Mais son fonctionnement peut aller plus loin.
</p><p>Varnish se configure simplement grâce à deux types de fichiers. Le fichier de configuration de Varnish où nous allons définir certains paramètres internes et les fichiers VCL qui permettent de configurer le comportement de Varnish via une sorte de langage de programmation.
</p><p><a rel="nofollow" class="external text" href="https://www.varnish-cache.org/trac/wiki/VCLExampleDefault">Le principe de Varnish</a> s’appuie sur la machine à état suivante&#160;:<br />
<a href="./File:Varnish_vcl.png.html" class="image"><img alt="Varnish vcl.png" src="images/3/33/Varnish_vcl.png" width="649" height="1024" /></a>
</p><p>Varnish permet d’intervenir au niveau de chacun des états pour effectuer des opérations sur HTTP ou sur lui-même. C’est cette finesse d’intervention qui permet à Varnish d’être véloce et complet.
</p><p>Un client effectue une requête sur une ressource qui n’est pas en cache suivra le cheminement suivant&#160;:<br />
<a href="./File:Varnish_cache_miss.png.html" class="image"><img alt="Varnish cache miss.png" src="images/3/30/Varnish_cache_miss.png" width="532" height="109" /></a>
</p><p>Si cette ressource est demandée à nouveau, le chemin suivi change car la ressource est maintenant en cache&#160;:<br />
<a href="./File:Varnish_cache_hit.png.html" class="image"><img alt="Varnish cache hit.png" src="images/9/92/Varnish_cache_hit.png" width="404" height="116" /></a>
</p><p>Toutes ces étapes sont symbolisées en VCL par des “procédures standards” (vcl_recv, vcl_fetch, vcl_deliver… etc). Toutes ces procédures sont surchargables et nous pouvons aussi déclarer les nôtres qui seront appelées dans les procédures standards. Le langage VCL ne tolère aucun code orphelin, tout ce qui est déclaré doit être utilisé.
</p>
<h1><span class="mw-headline" id="Installation"><span class="mw-headline-number">2</span> Installation</span></h1>
<p>Sur Debian...toujours aussi simple&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td>
<pre>aptitude install varnish
</pre>
</td></tr></table><br />
<h1><span class="mw-headline" id="Configuration"><span class="mw-headline-number">3</span> Configuration</span></h1>
<h2><span class="mw-headline" id="La_base"><span class="mw-headline-number">3.1</span> La base</span></h2>
<h3><span class="mw-headline" id="Les_VCLs"><span class="mw-headline-number">3.1.1</span> Les VCLs</span></h3>
<p>Tout d'abord, dans le cas ou Varnish tournerait sur la même machine que votre serveur web, faites pointer votre serveur web actuel non pas sur un autre port (8080 par exemple), puis redémarrez le pour appliquer la nouvelle configuration.
</p><p>Maintenant nous allons toucher à la configuration de Varnish pour lui dire sur quel serveur backend taper. Adaptez ces lignes à votre configuration&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/varnish/default.vcl</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="ruby source-ruby"><pre class="de1">...
<span class="me1">backend</span> default <span class="br0">&#123;</span>
<span class="xtra ln-xtra">    .<span class="me1">host</span> = <span class="st0">&quot;127.0.0.1&quot;</span>;</span><span class="xtra ln-xtra">    .<span class="me1">port</span> = <span class="st0">&quot;8080&quot;</span>;</span><span class="br0">&#125;</span>
...</pre></div></div>
</td></tr></table><br />
<ul><li> 127.0.0.1&#160;: le serveur web sur lequel Varnish doit rediriger le traffic</li>
<li> 8080&#160;: le port du serveur web en question</li></ul>
<h3><span class="mw-headline" id="Le_d.C3.A9mon"><span class="mw-headline-number">3.1.2</span> Le démon</span></h3>
<h4><span class="mw-headline" id="Cache_sur_disque"><span class="mw-headline-number">3.1.2.1</span> Cache sur disque</span></h4>
<p>Ensuite, nous allons toucher la configuration du serveur Varnish pour lui donner quelques informations supplémentaires&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/default/varnish</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">...
# Should we start varnishd at boot?  Set to &quot;yes&quot; to enable.
<span class="xtra ln-xtra">START=yes</span>[...]
<span class="xtra ln-xtra">DAEMON_OPTS=&quot;-a&#160;:80 \</span><span class="xtra ln-xtra">             -b localhost:8080 \</span>             -u varnish -g varnish \
             -S /etc/varnish/secret \
<span class="xtra ln-xtra">             -s file,/var/lib/varnish/$INSTANCE/varnish_storage.bin,1G&quot;</span>[...]</pre></div></div>
</td></tr></table><br />
<ul><li> -a&#160;: le port sur lequel le serveur Varnish va écouter</li>
<li> -b&#160;: le serveur web sur lequel Varnish doit rediriger le traffic</li>
<li> -s&#160;: le fichier de cache de 1G situé sur le disque (moins bonnes performances qu'en RAM)</li></ul>
<h4><span class="mw-headline" id="Cache_en_RAM"><span class="mw-headline-number">3.1.2.2</span> Cache en RAM</span></h4>
<p>Vous avez peut être envie que votre cache se situe en RAM pour avoir des accès encore meilleurs&#160;! C'est tout à fait possible&#160;:-). J'en ai profité pour rajouter quelques éléments pour optimiser le tout&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/default/varnish</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">...
# Should we start varnishd at boot?  Set to &quot;yes&quot; to enable.
<span class="xtra ln-xtra">START=yes</span>[...]
<span class="xtra ln-xtra">DAEMON_OPTS=&quot;-a&#160;:80 \</span><span class="xtra ln-xtra">             -b localhost:8080 \</span>             -S /etc/varnish/secret \
<span class="xtra ln-xtra">             -p thread_pools=2 \</span><span class="xtra ln-xtra">             -p thread_pool_min=100 \</span><span class="xtra ln-xtra">             -p thread_pool_max=2000 \</span><span class="xtra ln-xtra">             -p thread_pool_add_delay=2 \</span><span class="xtra ln-xtra">             -p session_linger=50 \</span><span class="xtra ln-xtra">             -s malloc,512m&quot;</span>[...]</pre></div></div>
</td></tr></table><br />
<ul><li> -a&#160;: le port sur lequel le serveur Varnish va écouter</li>
<li> -b&#160;: le serveur web sur lequel Varnish doit rediriger le traffic</li>
<li> -p thread_pools&#160;: insérez le nombre de cores sur votre machine</li>
<li> -p thread_pool_min (default: 5)&#160;: Les threads inactifs sont inoffensifs. Ce nombre est multipliée par le nombre de pools de threads dont vous disposez, et le total devrait être à peu près ce que vous avez besoin pour fonctionner sur une journée normale.</li>
<li> -p thread_pool_max (default 1000)&#160;: Le nombre maximal de threads est par limité par les descripteurs de fichiers disponibles, cependant, le placer trop haut n'augmentera pas les performances. Avoir un nombre de threads inactifs est raisonnablement inoffensif, mais ne n'augmentez pas ce nombre au-dessus de 5000 ou vous risquez d'avoir des problèmes avec les descripteurs de fichier ou pire encore.</li>
<li> -p thread_pool_add_delay=2 (default 20ms): La réduction de l'option add_delay vous permet de créer des threads plus rapide ce qui est essentiel, spécialement au démarrage pour éviter de remplir la file d'attente et d'abandonner des requêtes.</li>
<li> -p session_linger&#160;: pour éviter les context switch lorsque l'on burst le CPU.</li>
<li> -s malloc&#160;: certainement l'option la plus intéressante ici, permet d'utiliser le cache en RAM. L'idéale est de prendre 80% de votre mémoire si possible.</li></ul>
<p><br />
Commentez ensuite le bloc VCL car nous venons de le remplacer&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/default/varnish</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">#DAEMON_OPTS=&quot;-a&#160;:6081 \
#             -T localhost:6082 \
#             -f /etc/varnish/default.vcl \
#             -S /etc/varnish/secret \
#             -s file,/var/lib/varnish/$INSTANCE/varnish_storage.bin,1G&quot;</pre></div></div>
</td></tr></table><br />
<p>Puis on redémarre Varnish&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>/etc/init.d/varnish restart
</pre>
</td></tr></table><br />
<p>et c'est bon&#160;:-)
</p>
<h2><span class="mw-headline" id="Le_Cache"><span class="mw-headline-number">3.2</span> Le Cache</span></h2>
<p>Varnish propose un cache en mémoire et un cache sur disque. Mais il faut faire un choix, les deux ne sont pas cumulables. Le cache accepte à peu près tout ce qui passe dans les mains de Varnish (pages HTML, fichiers statics, flux de données en JSON… etc), à partir du moment où l’on déclare l’objet cachable et qu’il a une TTL.
</p><p>Le cache est alimenté juste après l’étape “Fetch”, en réalité c’est juste après la récupération de la donnée sur le backend. C’est à cet endroit que l’on va faire toutes les modifications de l’entête HTTP de la ressource cachée. Faire ces modifications au niveau du “Fetch” va permettre de garantir une entrée cache propre (ne pas avoir plusieurs entrées cache car une même ressource va avoir un payload différent). De plus l’objet est stocké dans le cache avec son entête HTTP, il est donc plus efficace de traiter une fois pour toute l’entête et la resservir avec l’objet.
</p><p>Comme nous le verrons plus loin, la compression d’objet influe aussi sur les performances du cache. Il est préférable de stocker un objet compressé et laisser Varnish le délivrer compressé ou non suivant l’entête “Accept-Encoding”.
</p><p>La définition correct de la TTL d’un objet pour manager le cache-control est un élément important de Varnish. Nous pouvons contrôler le cache de façon précise en définissant la TTL pour un type de ressource ou pour une url par exemple&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/varnish/default.vcl</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="ruby source-ruby"><pre class="de1">...
    <span class="kw1">if</span><span class="br0">&#40;</span>beresp.<span class="me1">ttl</span> <span class="sy0">&gt;</span> 0s<span class="br0">&#41;</span><span class="br0">&#123;</span>
      unset beresp.<span class="me1">http</span>.<span class="me1">Expires</span>;
      <span class="kw1">if</span> <span class="br0">&#40;</span> req.<span class="me1">backend</span> == backend_S3 <span class="br0">&#41;</span> <span class="br0">&#123;</span>
         set beresp.<span class="me1">http</span>.<span class="me1">Cache</span><span class="sy0">-</span>Control = <span class="st0">&quot;public, max-age=60&quot;</span>;
<span class="xtra ln-xtra">         set beresp.<span class="me1">ttl</span> = 60s;</span>      <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
         set beresp.<span class="me1">http</span>.<span class="me1">Cache</span><span class="sy0">-</span>Control = <span class="st0">&quot;public, max-age=7200&quot;</span>;
<span class="xtra ln-xtra">         set beresp.<span class="me1">ttl</span> = 2h;</span>      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
...</pre></div></div>
</td></tr></table><br />
<p>Ici nous demandons à Varnish de cacher sur 60 secondes tout ce qui vient de le backend “backend_S3” et le reste sera caché deux heures.
</p><p>Le cache peut se manager de deux façons différentes&#160;:
</p>
<ul><li> Via des appels HTTP par la méthode PURGE et en gérant des ACLs pour sécuriser l’appel.</li>
<li> Via les “Bans” que l’on peut inclure dans le VCL ou effectuer via varnishadm.</li></ul>
<h2><span class="mw-headline" id="La_Compression"><span class="mw-headline-number">3.3</span> La Compression</span></h2>
<p>Depuis la version 3.0, Varnish a la possibilité de compresser et décompresser des ressources. Cette fonctionnalité est importante pour 3 raisons&#160;:
</p>
<ul><li> Économiser de la bande passante entre le backend et Varnish.</li>
<li> Économiser de la place dans le cache de Varnish surtout quand il est en mémoire.</li>
<li> Économiser de la bande passante entre Varnish et le Client.</li></ul>
<p>Elle peut être activée simplement en harmonisant l’entête “Accept-Encoding” et en positionnant la variable “do_gzip” au niveau du backend ou de la réponse du backend. Pour le reste Varnish va adapter la réponse (objet compressé ou non) au client en s’appuyant sur le “Accept encoding” de la requête.<br />
Il est bien sûr évident que la stratégie de compression doit être adaptée au type d’objet. On ne compressera pas un objet déjà compressé (gif, jpg…etc)&#160;:).
</p>
<h2><span class="mw-headline" id="Le_Loadbalancing"><span class="mw-headline-number">3.4</span> Le Loadbalancing</span></h2>
<p>Varnish peut gérer des backends de tous horizons. Avec des sites de plus en plus chargés, il est capable d’offrir la possibilité de faire du loadbalancing. Varnish dispose de 3 types de loadbalancing qui sont appelés “Director”&#160;:
</p>
<ul><li> RoundRobin</li>
<li> Client (permet de faire du sticky session sur n’importe quel élément du header).</li>
<li> Random (disponible… utile c’est une autre histoire).</li></ul>
<p>Varnish sait gérer l’éviction d’un backend lorsqu’il est indisponible. Cette fonctionnalité est d’autant plus utile quand nous activons le “probe” sur les backends.
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/varnish/default.vcl</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="ruby source-ruby"><pre class="de1">...
    <span class="me1">backend</span> server1 <span class="br0">&#123;</span>
       .<span class="me1">host</span> = <span class="st0">&quot;server1.deimos.fr&quot;</span>;
       .<span class="me1">probe</span> = <span class="br0">&#123;</span>
         .<span class="me1">url</span> = <span class="st0">&quot;/&quot;</span>;
         .<span class="me1">interval</span> = 5s;
         .<span class="me1">timeout</span> = 1s;
         .<span class="me1">window</span> = <span class="nu0">5</span>;
         .<span class="me1">threshold</span> = <span class="nu0">3</span>;
       <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
...</pre></div></div>
</td></tr></table><br />
<p>Varnish dispose aussi d’un mécanisme pour palier complètement à la défaillance d’un backend ou d’un Director. Nous appelons cela “Grace mode” ou “Saint mode”. Ces termes cachent la possibilité de servir un contenu caché même x minutes après la TTL en cas de non réponse d’un serveur. Il est aussi capable d’aiguiller une requête vers un autre serveur répondant correctement quand le serveur cible initial donne des réponses HTTP 500 à cause d’une trop grande charge par exemple.
</p>
<h2><span class="mw-headline" id="Reverse_Proxy"><span class="mw-headline-number">3.5</span> Reverse Proxy</span></h2>
<p>Nous avons vu que Varnish se place devant toute notre infrastructure. Il va permettre de masquer complètement l’architecture déployée en utilisant toute la puissance de Reverse Proxy qu’il met à notre disposition.<br />
<a href="./File:Varnish_reverse_proxy.png.html" class="image"><img alt="Varnish reverse proxy.png" src="images/c/c6/Varnish_reverse_proxy.png" width="382" height="370" /></a>
</p><p>En fait, il nous permet de faire un découplage complet entre l’organisation des URIs d’appels et l’organisation de leurs traitements sur l’infrastructure.
</p><p>Voici un exemple d’une requête cliente que nous arrivons à aiguiller avec Varnish vers un bucket S3 public du nom de “ressources” et l’aiguillage prend en compte ce qu’il y a dans le nom du host de la requete&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/varnish/default.vcl</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="ruby source-ruby"><pre class="de1">...
    <span class="me1">set</span> req.<span class="me1">backend</span> = backend_s3;
    <span class="kw1">if</span><span class="br0">&#40;</span>req.<span class="me1">url</span> == <span class="st0">&quot;/ressources1.xml&quot;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      set req.<span class="me1">url</span> = regsuball<span class="br0">&#40;</span>req.<span class="me1">http</span>.<span class="me1">host</span>,
                  <span class="st0">&quot;^(?:.*[.])?([a-z]+)[.](?:net|com)$&quot;</span>, <span class="st0">&quot;/ressource1.<span class="es0">\1</span>.xml&quot;</span><span class="br0">&#41;</span>;
    <span class="br0">&#125;</span><span class="kw1">else</span> <span class="kw1">if</span><span class="br0">&#40;</span>req.<span class="me1">url</span> == <span class="st0">&quot;/ressource2.txt&quot;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      set req.<span class="me1">url</span> = regsuball<span class="br0">&#40;</span>req.<span class="me1">http</span>.<span class="me1">host</span>,
                  <span class="st0">&quot;^(?:([a-z]+)[0-9]*[.])(?:([a-z]+)*[.])[a-z]+$&quot;</span>,<span class="st0">&quot;/ressources.<span class="es0">\1</span>.<span class="es0">\2</span>.txt&quot;</span><span class="br0">&#41;</span>;
    <span class="br0">&#125;</span>
    set req.<span class="me1">http</span>.<span class="me1">host</span> = <span class="st0">&quot;resources.s3.amazonaws.com&quot;</span>;
&#160;
    backend  backend_s3 <span class="br0">&#123;</span>
      .<span class="me1">host</span> = <span class="st0">&quot;ressources.s3.amazonaws.com&quot;</span>;
      .<span class="me1">port</span> = <span class="st0">&quot;80&quot;</span>;
      .<span class="me1">connect_timeout</span> = 5s;
      .<span class="me1">first_byte_timeout</span> = 3s;
      .<span class="me1">between_bytes_timeout</span> = 2s;
      .<span class="me1">max_connections</span> = <span class="nu0">1000</span>;
    <span class="br0">&#125;</span>
...</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="S.C3.A9curiser_et_nettoyage_HTTP"><span class="mw-headline-number">3.6</span> Sécuriser et nettoyage HTTP</span></h2>
<p>Le protocole HTTP permet d’utiliser plusieurs types de méthodes (GET, POST, DELETE… etc). Ces méthodes peuvent être utilisées de différentes manières pour déclencher des actions spécifiques (cas de services REST) sur les services abrités sur les backends. Or la protection au niveau HTTP de ce genre de services est assez fastidieuse côté serveurs d’applications. Varnish va permettre de filtrer précisément ce qui doit passer et pour quelle utilisation. Nous allons donc limiter les effets de bords.
</p><p>Imaginons que nous avons un service accessible uniquement en GET /service1/ et un deuxième /service2/ accessible lui en GET et POST nous allons écrire quelque chose comme ceci&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/varnish/default.vcl</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="ruby source-ruby"><pre class="de1">...
    <span class="kw1">if</span> <span class="br0">&#40;</span>req.<span class="me1">request</span>&#160;!= <span class="st0">&quot;GET&quot;</span> <span class="sy0">&amp;&amp;</span> req.<span class="me1">request</span>&#160;!= <span class="st0">&quot;POST&quot;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
      call error;
    <span class="br0">&#125;</span>
&#160;
    <span class="kw1">if</span> <span class="br0">&#40;</span>req.<span class="me1">url</span> ~ <span class="st0">&quot;^/service2&quot;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
    call service2;
    <span class="br0">&#125;</span>
&#160;
    <span class="kw1">if</span><span class="br0">&#40;</span>req.<span class="me1">request</span> == <span class="st0">&quot;POST&quot;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
      call error;
    <span class="br0">&#125;</span>
&#160;
    <span class="kw1">if</span> <span class="br0">&#40;</span>req.<span class="me1">url</span> ~ <span class="st0">&quot;^/service1&quot;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
      call service1;
    <span class="br0">&#125;</span>
&#160;
    call error;
...</pre></div></div>
</td></tr></table><br />
<p>Dans cet exemple nous interdisons systématiquement tout ce qui n’est pas méthode GET ou POST. Ensuite pour une url qui commence par /service2 nous allons vers la routine qui va traiter le payload pour ce service. Puis nous bannissons la méthode POST et nous traitons les urls avec /service1 et enfin nous bannissons le reste.
</p><p>Avec cette méthode aucune requête non prévue peut remonter vers un backend. Nous avons deux avantages&#160;:
</p>
<ul><li> Le code pour traiter les cas aux limites sera plus simple.</li>
<li> Une majorité d’erreurs ne remonteront pas vers le backend, celles-ci ne provoqueront donc aucune exception ni saturation.</li></ul>
<p>Dans un deuxième cas de figure il peut être intéressant de normaliser les entêtes HTTP. Prenons l’exemple de l’Accept-Encoding. Varnish préconise de le normaliser ainsi&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/varnish/default.vcl</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="ruby source-ruby"><pre class="de1">...
    <span class="kw1">if</span> <span class="br0">&#40;</span>req.<span class="me1">http</span>.<span class="me1">Accept</span><span class="sy0">-</span>Encoding<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>req.<span class="me1">http</span>.<span class="me1">Accept</span><span class="sy0">-</span>Encoding ~ <span class="st0">&quot;gzip&quot;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        set req.<span class="me1">http</span>.<span class="me1">Accept</span><span class="sy0">-</span>Encoding = <span class="st0">&quot;gzip&quot;</span>;
      <span class="br0">&#125;</span> <span class="kw1">elsif</span> <span class="br0">&#40;</span>req.<span class="me1">http</span>.<span class="me1">Accept</span><span class="sy0">-</span>Encoding ~ <span class="st0">&quot;deflate&quot;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        set req.<span class="me1">http</span>.<span class="me1">Accept</span><span class="sy0">-</span>Encoding = <span class="st0">&quot;deflate&quot;</span>;
      <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
        remove req.<span class="me1">http</span>.<span class="me1">Accept</span><span class="sy0">-</span>Encoding;
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
...</pre></div></div>
</td></tr></table><br />
<p>Tout simplement pour éviter de créer des entrées cache différentes pour un même payload uniquement parce que tous les clients n’écrivent pas cet entête de la même façon.
</p><p>Nous pouvons aussi enlever certains headers qui peuvent donner trop d’informations sur l’infrastructure. Pour S3 par exemple nous allons passer ces commandes dans le fetch&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/varnish/default.vcl</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="ruby source-ruby"><pre class="de1">...
    <span class="me1">unset</span> beresp.<span class="me1">http</span>.<span class="me1">x</span><span class="sy0">-</span>amz<span class="sy0">-</span>id<span class="sy0">-</span><span class="nu0">2</span>;
    unset beresp.<span class="me1">http</span>.<span class="me1">x</span><span class="sy0">-</span>amz<span class="sy0">-</span>request<span class="sy0">-</span>id;
    unset beresp.<span class="me1">http</span>.<span class="me1">x</span><span class="sy0">-</span>amz<span class="sy0">-</span>meta<span class="sy0">-</span>s3cmd<span class="sy0">-</span>attrs;
    unset beresp.<span class="me1">http</span>.<span class="me1">x</span><span class="sy0">-</span>amz<span class="sy0">-</span>meta<span class="sy0">-</span>s3fox<span class="sy0">-</span>filesize;
    unset beresp.<span class="me1">http</span>.<span class="me1">x</span><span class="sy0">-</span>amz<span class="sy0">-</span>meta<span class="sy0">-</span>s3fox<span class="sy0">-</span>modifiedtime;
...</pre></div></div>
</td></tr></table><br />
<p>Ou positionner des entêtes plus personnelles&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/varnish/default.vcl</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="ruby source-ruby"><pre class="de1">...
    <span class="me1">set</span> beresp.<span class="me1">http</span>.<span class="me1">Server</span> = «&#160;ServeurPerso&#160;»;
...</pre></div></div>
</td></tr></table><br />
<p>La dernière petite chose à penser pour le nettoyage réside dans le positionnement d’un content-type correct pour toutes des ressources. Cette opération se fait de la même manière que pour le nettoyage des headers en positionnant “set beresp.http.Content-Type” par groupe de ressources.
</p><p>De par ces fonctionnalités, Varnish est capable d’assurer l’orchestration de la haute disponibilité d’une architecture. Il est capable de détecter les backends défaillants et même de les remplacer en s’appuyant sur son cache. Il va les protéger en prenant en compte une grande partie de la gestion des erreurs 404.
</p>
<h2><span class="mw-headline" id="Uniformisation_des_Logs_d.E2.80.99acc.C3.A8s"><span class="mw-headline-number">3.7</span> Uniformisation des Logs d’accès</span></h2>
<p>Le process “varnishd” ne produit aucun log. Il se contente d’écrire les informations dans des segments de mémoire partagée. Ces segments sont consommés par des outils comme varnishadm, varnishlog ou encore varnishncsa. C’est principalement varnishncsa qui nous intéresse. C’est ce process qui va lire les informations et créer un fichier de log au format NCSA.
</p><p>L’avantage ici est énorme. Nous pouvons décharger les serveurs d’applications et front http de la production de ces logs. De plus ces logs seront moins éparpillés (quoi que, avec l’utilisation de syslog-ng ça ne soit pas un problème). Enfin les logs seront tous normalisés qu’ils soient sur Apache, Tomcat, JBoss ou encore lighttp et NginX. Nous pouvons donc penser uniquement aux traitements que nous allons bien pouvoir leur faire subir et ne plus passer du temps à tout reformater. Cette considération prend tout son sens quand on commence à atteindre plusieurs gigas de logs d’accès par jour.
</p><p>Depuis la version 3.0, Varnishncsa permet de ne pas suivre la norme NCSA et nous laisse le choix du format de sortie.
</p>
<h1><span class="mw-headline" id="Ressources"><span class="mw-headline-number">4</span> Ressources</span></h1>
<p><a rel="nofollow" class="external free" href="http://blog.bigdinosaur.org/adventures-in-varnish/">http://blog.bigdinosaur.org/adventures-in-varnish/</a><br />
<a rel="nofollow" class="external free" href="http://decrypt.ysance.com/2012/02/le-web-accelere-avec-varnish/">http://decrypt.ysance.com/2012/02/le-web-accelere-avec-varnish/</a><br />
<a rel="nofollow" class="external free" href="https://www.varnish-cache.org/trac/wiki/Performance">https://www.varnish-cache.org/trac/wiki/Performance</a><br />
<a rel="nofollow" class="external free" href="http://kristianlyng.wordpress.com/2010/01/26/varnish-best-practices/">http://kristianlyng.wordpress.com/2010/01/26/varnish-best-practices/</a>
</p>
<!-- 
NewPP limit report
CPU time usage: 0.064 seconds
Real time usage: 0.064 seconds
Preprocessor visited node count: 300/1000000
Preprocessor generated node count: 846/1000000
Post‐expand include size: 3607/2097152 bytes
Template argument size: 994/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   26.627      1 - -total
 82.12%   21.865     11 - Template:Config
  7.58%    2.017      1 - Template:Infobox
  3.63%    0.967      2 - Template:Command
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:3272-0!*!*!1!en!5!* and timestamp 20181111230821 and revision id 12601
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=Varnish_:_un_accélérateur_de_site_web&amp;oldid=12601">https://wiki.deimos.fr/index.php?title=Varnish_:_un_accélérateur_de_site_web&amp;oldid=12601</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=Varnish+%3A+un+acc%C3%A9l%C3%A9rateur+de+site+web" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="./Varnish_:_un_accélérateur_de_site_web.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="./Varnish_:_un_accélérateur_de_site_web.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="./Varnish_:_un_accélérateur_de_site_web.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=Varnish_:_un_acc%C3%A9l%C3%A9rateur_de_site_web&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=Varnish_:_un_acc%C3%A9l%C3%A9rateur_de_site_web&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="./Varnish_:_un_accélérateur_de_site_web.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/Varnish_:_un_accélérateur_de_site_web.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/Varnish_:_un_acc%C3%A9l%C3%A9rateur_de_site_web" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=Varnish_:_un_acc%C3%A9l%C3%A9rateur_de_site_web&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=Varnish_:_un_acc%C3%A9l%C3%A9rateur_de_site_web&amp;oldid=12601" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=Varnish_:_un_acc%C3%A9l%C3%A9rateur_de_site_web&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 25 June 2013, at 14:57.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":100});
}</script>
	</body>
</html>
	
<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>Tests d'intrusion - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="Tests_d'intrusion.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Tests_d'intrusion","wgTitle":"Tests d'intrusion","wgCurRevisionId":2753,"wgRevisionId":2753,"wgArticleId":1733,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Tests_d'intrusion","wgRelevantArticleId":1733,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Tests_d_intrusion skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Tests d'intrusion</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="Tests_d'intrusion.html#mw-navigation">navigation</a>, 					<a href="Tests_d'intrusion.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Tests_d'intrusion.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Tests_d'intrusion.html#La_guerre_de_l.27information"><span class="tocnumber">2</span> <span class="toctext">La guerre de l'information</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="Tests_d'intrusion.html#Les_requ.C3.AAtes_indirectes"><span class="tocnumber">2.1</span> <span class="toctext">Les requêtes indirectes</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="Tests_d'intrusion.html#Interrogation_des_bases_whois"><span class="tocnumber">2.1.1</span> <span class="toctext">Interrogation des bases whois</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="Tests_d'intrusion.html#News_Group"><span class="tocnumber">2.1.2</span> <span class="toctext">News Group</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="Tests_d'intrusion.html#Moteur_de_recherche"><span class="tocnumber">2.1.3</span> <span class="toctext">Moteur de recherche</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="Tests_d'intrusion.html#Social_Engineering"><span class="tocnumber">2.1.4</span> <span class="toctext">Social Engineering</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="Tests_d'intrusion.html#Divers"><span class="tocnumber">2.1.5</span> <span class="toctext">Divers</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-9"><a href="Tests_d'intrusion.html#Les_requ.C3.AAtes_directes"><span class="tocnumber">2.2</span> <span class="toctext">Les requêtes directes</span></a>
<ul>
<li class="toclevel-3 tocsection-10"><a href="Tests_d'intrusion.html#Interrogation_des_DNS"><span class="tocnumber">2.2.1</span> <span class="toctext">Interrogation des DNS</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="Tests_d'intrusion.html#Utilisation_de_ping"><span class="tocnumber">2.2.2</span> <span class="toctext">Utilisation de ping</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="Tests_d'intrusion.html#Utilisation_de_traceroute"><span class="tocnumber">2.2.3</span> <span class="toctext">Utilisation de traceroute</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="Tests_d'intrusion.html#Port_Scan"><span class="tocnumber">2.2.4</span> <span class="toctext">Port Scan</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="Tests_d'intrusion.html#OS_Fingerprinting"><span class="tocnumber">2.2.5</span> <span class="toctext">OS Fingerprinting</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="Tests_d'intrusion.html#Banni.C3.A8res"><span class="tocnumber">2.2.6</span> <span class="toctext">Bannières</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="Tests_d'intrusion.html#Informations_relatives_.C3.A0_des_protocoles_sp.C3.A9cifiques"><span class="tocnumber">2.2.7</span> <span class="toctext">Informations relatives à des protocoles spécifiques</span></a></li>
<li class="toclevel-3 tocsection-17"><a href="Tests_d'intrusion.html#Envoie_de_mail"><span class="tocnumber">2.2.8</span> <span class="toctext">Envoie de mail</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="Tests_d'intrusion.html#Scan_CGI"><span class="tocnumber">2.2.9</span> <span class="toctext">Scan CGI</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="Tests_d'intrusion.html#War_Dialing"><span class="tocnumber">2.2.10</span> <span class="toctext">War Dialing</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-20"><a href="Tests_d'intrusion.html#L.27utilisation_des_informations"><span class="tocnumber">3</span> <span class="toctext">L'utilisation des informations</span></a>
<ul>
<li class="toclevel-2 tocsection-21"><a href="Tests_d'intrusion.html#La_recherche_de_vuln.C3.A9rabilit.C3.A9s"><span class="tocnumber">3.1</span> <span class="toctext">La recherche de vulnérabilités</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="Tests_d'intrusion.html#L.27exploitation_des_vuln.C3.A9rabilit.C3.A9s"><span class="tocnumber">3.2</span> <span class="toctext">L'exploitation des vulnérabilités</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-23"><a href="Tests_d'intrusion.html#Conclusion"><span class="tocnumber">4</span> <span class="toctext">Conclusion</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p>Une fois le réseau installé et configuré, celui-ci ne va cesser d'évoluer. De nouveaux systèmes viennent s'y ajouter, de vieilles et fidéles machines disparaissent, bref, tout change tout le temps. Les utilisateurs peuvent également agir dans le dos de l'administrateur et apporter leurs propres modifications au réseau.
</p><p>Pour vérifier l'état de son réseau, un administrateur doit se comporter comme un pirate et tenter de pénétrer ses propres défenses. Cet article présente la démarche à suivre.
</p><p>Il est important de tester la sécurité de son propre réseau en se mettant à la place du pirate pour découvrir d'éventuelles failles. Ces tests se décomposent en plusieurs étapes&#160;:
</p>
<ul><li> <b>Phase d'approche</b>&#160;: récupération d'informations sur le réseau cible<br /></li>
<li> <b>Phase d'analyse</b>&#160;: détermination, à l'aide des résultats obtenus à l'étape précédente, des vulnérabilités potentielles et des outils nécessaires à leur exploitation<br /></li>
<li> <b>Phase d'attaques</b>&#160;: passage à l'acte.</li></ul>
<p>Avant d'entreprendre la derniére étape, l'administrateur du réseau doit impérativement vous avoir donné son consentement, et pas uniquement oral. Le chapitre III du code pénal traite des atteintes aux systémes de traitement automatisé de données. On y trouve 7 articles, dont voici les trois premiers&#160;:
</p>
<ul><li> Article 323-1&#160;: Le fait d'accéder ou de se maintenir, frauduleusement, dans tout ou partie d'un systéme de traitement automatisé de données est puni d'un an d'emprisonnement et de 15 000 Euros d'amende.<br /></li></ul>
<p>Lorsqu'il en est résulté soit la suppression ou la modification de données contenues dans le système, soit une altération du fonctionnement de ce systéme, la peine est de deux ans d'emprisonnement et de 17 500 Euros d'amende.
</p>
<ul><li> Article 323-2&#160;: Le fait d'entraver ou de fausser le fonctionnement d'un système de traitement automatisé de données est puni de trois ans d'emprisonnement et de 30 000 euros d'amende.</li>
<li> Article 323-3&#160;: Le fait d'introduire frauduleusement des données dans un système de traitement automatisé ou de supprimer ou de modifier frauduleusement les données qu'il contient est puni de trois ans d'emprisonnement et de 15 000 Euros d'amende.</li></ul>
<p>Le 323-1 concerne l'intrusion en elle-méme. Lorsque que, de plus, elle induit des altérations des données du systéme, la peine est majorée. Le 323-2 porte sur des nuisances faites au réseau (virus, mail bombing, DoS, ...). Enfin, le 323-3 punit les modifications faites volontairement aux données présentes sur le réseaux (comprendre par "données" aussi bien les meilleurs scores à xbill que les fichiers de configuration du réseau).
</p><p>Mettre à l'épreuve la sécurité d'un réseau signifie en général "résistance aux menaces externes". Cependant, de nombreuses opérations malveillantes sont facilement menées depuis une machine du réseau lui-méme (virus, backdoor, sniffer...). Ces sources de danger sont rarement prises en considération lors de l'évaluation du réseau. De méme, la plupart des attaques présentées dans l'article d'éric Detoisien doivent également étre évaluées (spoofing, (D)Dos...).
</p><p>Des scénarii variés sont envisageables en guise de tests d'intrusion&#160;:
</p>
<ul><li> Le testeur ne connait rien du réseau cible et ne dispose d'aucun accés à celui-ci, nous sommes dans le cas d'un test d'intrusion externe</li>
<li> Le testeur dispose de priviléges minimaux sur le réseau cible (compte utilisateur quelconque). Il cherche à accroétre ses priviléges depuis l'intérieur méme du réseau (écrans de veille non activés, sniffing, exploitation de vulnérabilités locales..). Dans ce cas, il s'agit d'un test d'intrusion interne.</li></ul>
<p>Les résultats obtenus doivent permettre de mieux cerner, afin de les corriger, les problémes potentiels ou existants sur le réseau cible. Par exemple, il faut évaluer le comportement de l'administrateur face aux tentatives d'intrusion ou à l'intrusion elle-méme si elle réussit (sera-t-elle détectée&#160;? Au bout de combien de temps&#160;? ...)
</p>
<h1><span class="mw-headline" id="La_guerre_de_l.27information"><span class="mw-headline-number">2</span> La guerre de l'information</span></h1>
<p>Nous nous plaçons donc dans la peau d'une personne qui cherche à récolter un maximum de renseignements sur un réseau cible. Cette collecte se divise en deux étapes. Dans un premier temps, nous allons récupérer toutes les informations disponibles sans accéder directement aux ressources de la cible. Ensuite, lorsque nous commencerons à avoir une idée plus précise de ce dont il retourne, nous accéderons directement aux moyens fournis par la cible.
</p>
<h2><span class="mw-headline" id="Les_requ.C3.AAtes_indirectes"><span class="mw-headline-number">2.1</span> Les requêtes indirectes</span></h2>
<p>Dans cette catégorie, nous plaçons tous les moyens qui permettent d'en apprendre plus sur la cible, mais sans la contacter directement. Ces informations sont disponibles, il suffit de savoir où chercher.
</p>
<h3><span class="mw-headline" id="Interrogation_des_bases_whois"><span class="mw-headline-number">2.1.1</span> Interrogation des bases whois</span></h3>
<p>Les serveurs whois, aussi appelés nicname (port 43), permettent d'accéder à la base de données des renseignements fournis lors de l'enregistrement d'un nom de domaine&#160;:
</p>
<ul><li> Des informations administratives comme des noms, téléphones et adresses pour différents contacts (admin-c, tech-c, zone-c, bill-c...)&#160;;</li>
<li> Des informations techniques telles que le(s) nom(s) du(des) DNS(s), les adresses emails des responsables évoqués ci-dessus, les ensembles d'adresses IP alloués à la cible...</li></ul>
<p>Cette base de données, autrefois gérée par InterNIC et maintenant par Network Solutions, reste simplement accessible à tous car elle permet de vérifier si un nom de domaine existe déjà.
</p><p>Les sociétés qui enregistrent les noms de domaine offrent généralement un service d'interrogation en ligne (voir le tableau 1). Sous Unix, il existe également la commande whois.
</p>
<table border="1" width="100%">
<tr>
<th>Noms
</th>
<th>Significations
</th>
<th>URL
</th>
<th>Descriptions
</th></tr>
<tr>
<td>AFNIC
</td>
<td>Association Française pour le Nommage Internet en Coopération
</td>
<td><a rel="nofollow" class="external free" href="http://www.nic.fr/cgi-bin/whois">http://www.nic.fr/cgi-bin/whois</a>
</td>
<td>tous les ".fr"
</td></tr>
<tr>
<td>RIPE
</td>
<td>Réseau IP Européen
</td>
<td><a rel="nofollow" class="external free" href="http://www.ripe.net/cgi-bin/whois">http://www.ripe.net/cgi-bin/whois</a>
</td>
<td>couvre l'Europe, le Moyen-Orient et quelques pays d'Asie et d'Afrique
</td></tr>
<tr>
<td>InterNIC
</td>
<td>Pris sur leur page web&#160;: "InterNIC is a registered service mark of the U.S. Department of Commerce. This site is being hosted by ICANN on behalf of the U.S. Department of Commerce".
</td>
<td><a rel="nofollow" class="external free" href="http://www.internic.net/whois.html">http://www.internic.net/whois.html</a>
</td>
<td>les ".com", ".net", ".edu" et autres ".org"
</td></tr></table>
<p>Pour vous montrer la richesses des informations contenues dans ce type de base, rien de tel qu'un petit exemple sur un nom de domaine (fictif pour des raisons de confidentialité)&#160;:
</p>
<pre>whois pigeons.fr(at)whois.nic.fr
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">[whois.nic.fr]
&#160;
Tous droits reserves par copyright.
Voir http://www.nic.fr/outils/dbcopyright.html
Rights restricted by copyright.
See http://www.nic.fr/outils/dbcopyright.html
&#160;
domain:      pigeons.fr
descr:       PIGEON ET CIE
descr:       10 RUE DE PARIS
descr:       75001 Paris 
admin-c:     BPxxx-FRNIC
tech-c:      LPxxx-FRNIC
zone-c:      CPxxx-FRNIC
&#160;
nserver:     ns1.pigeons.fr
nserver:     ns2.pigeons.fr
nserver:     ns.heberge.fr
&#160;
mnt-by:      FR-NIC-MNT
mnt-lower:   FR-NIC-MNT
changed:     frnic-dbm-updates(at)nic.fr 20001229
source:      FRNIC
&#160;
role:        HEBERGE Hostmaster
address:     Heberge Telecom
address:     10 rue de Gennevilliers
address:     92230 Gennevilliers
phone:       +33 1 41 00 00 00
fax-no:      +33 1 41 00 00 01
e-mail:      hostmaster(at)heberge.fr
admin-c:     AAxxx-FRNIC
tech-c:      BBxxx-FRNIC
nic-hdl:     CCxxx-FRNIC
notify:      hm-dbm-msgs(at)ripe.net
mnt-by:      HEBERGE-NOC
changed:     hostmaster(at)heberge.fr 20000814
changed:     migration-dbm(at)nic.fr 20001015
source:      FRNIC
&#160;
person:      Bernard Pigeon
address:     PIGEON ET CIE
address:     10 RUE DE PARIS
address:     75001 Paris
address:     France
phone:       +33 1 53 00 00 00
fax-no:      +33 1 53 00 00 01
e-mail:      bernard.pigeon(at)pigeons.fr
nic-hdl:     BPxxxx-FRNIC
notify:      bernard.pigeon(at)pigeons.fr
mnt-by:      HEBERGE-NOC
changed:     bernard.pigeon(at)pigeons.fr 20001228
source:      FRNIC
&#160;
person:      Luc Pigeon
address:     PIGEON ET CIE
address:     10 RUE DE PARIS
address:     75001 Paris
address:     France
phone:       +33 1 53 00 00 00
fax-no:      +33 1 53 00 00 01
e-mail:      luc.pigeon(at)pigeons.fr
nic-hdl:     LPxxx-FRNIC
mnt-by:      HEBERGE-NOC
changed:     aaa(at)heberge.fr 20001228
source:      FRNIC</pre></div></div>
<p>Nous apprenons que la société Pigeon et Cie est en fait hébergée par Heberge Telecom. Les adresses emails correspondent sans doute à des alias, mais elles nous fournissent également une piste sur l'existence de comptes sur des machines&#160;: si les mots de passe correspondant sont faibles (comme les prénoms, dates de naissance...), cette information peut se révéler utile.
</p><p>Toujours via les bases whois des recherches plus poussées à partir d'une adresse IP appartenant à la société Pigeon et Cie nous amènent à découvrir les classes d'adresses IP qui lui ont été allouées. Pour cela, nous utilisons la base whois de RIPE qui se révéle être la plus pertinente&#160;:
</p>
<pre>whois 10.51.23.246(at)whois.ripe.net
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">% This is the RIPE Whois server.
% The objects are in RPSL format.
% Please visit http://www.ripe.net/rpsl for more information.
% Rights restricted by copyright.
% See http://www.ripe.net/ripencc/pub-services/db/copyright.html
&#160;
inetnum:      10.51.23..0 - 10.51.23.255
netname:      PIGEON-CIE
descr:        Pigeon et Cie
country:      FR
admin-c:      OMxxxx-RIPE
tech-c:       OMxxxx-RIPE
status:       ASSIGNED PA
notify:       admin(at)pigeons.fr
mnt-by:       PC-XXX
changed:      admin(at)pigeons.fr 20000223
source:       RIPE</pre></div></div>
<p>En outre, des recherches croisées sur les noms récupérés peuvent nous donner des informations supplémentaires sur la cible (découvrir de nouvelles adresses IP ou de nouveaux serveurs DNS).
</p><p>Le bilan des recherches via les bases whois est très concluant puisque nous avons récupéré&#160;:
</p>
<ul><li> Les serveurs DNS ayant autorité sur le domaine pigeons.fr</li>
<li> Les coordonnées des contacts administratifs et techniques liés à Pigeon et Cie</li>
<li> Les classes d'adresses IP alloués à la société Pigeon et Cie.</li></ul>
<p>Nous pouvons tout de même continuer à glaner des informations sur Internet.
</p>
<h3><span class="mw-headline" id="News_Group"><span class="mw-headline-number">2.1.2</span> News Group</span></h3>
<p>Souvent les administrateurs ou les développeurs se retrouvent face à des problèmes. Pour les résoudre, ils utilisent les NewsGroup pour poser des questions. Malheureusement, ils donnent souvent beaucoup trop d'informations sur leur système d'information (technologie, version des applications utilisées, fragment de code...). Pour faire des recherches, nous pouvons demander à groups.google.com avec comme critère de recherche (at)pigeons.fr par exemple. Ce moteur, très performant, remonte alors tous les messages postés par des personnes de la société Pigeon et Cie. Outre les informations techniques, nous pouvons obtenir des renseignements sur les goûts personnels de certaines personnes de la société. Ces indications servirons lors de recherche de mots de passe ou pour améliorer une éventuelle tentative Social Engineering (expliqué ultérieurement).
</p>
<h3><span class="mw-headline" id="Moteur_de_recherche"><span class="mw-headline-number">2.1.3</span> Moteur de recherche</span></h3>
<p>Même principe que pour les NewsGroup, nous essayons de récupérer d'autres données sur le système d'information cible en utilisant un moteur de recherche. Dès lors, les mots clés employer ne seront limités que par notre imagination. Là encore, www.google.com est très performant surtout grâce à son cache. Néanmoins, des méta-moteurs comme www.dogpile.com donnent des résultats pertinents en multipliant les recherches sur plusieurs moteurs. 
</p>
<h3><span class="mw-headline" id="Social_Engineering"><span class="mw-headline-number">2.1.4</span> Social Engineering</span></h3>
<p>Nous sortons un peu des requêtes indirectes puisque cette technique implique un contact direct avec la cible. Néanmoins, cette démarche n'est toujours pas technique c'est pourquoi elle ne fait pas partie des requêtes directes. Le social engineering se pratique pour obtenir des informations confidentielles (mot de passe, renseignements techniques, numéro de téléphone, adresse IP...) des utilisateurs du système d'information cible. Tous les moyens possibles et imaginables sont à disposition (téléphone, mail, fax...). Avec une usurpation d'identité et une exploitation habile des informations récoltées au préalable sur les personnes et la société, la crédibilité est au rendez-vous ainsi que de précieuses données.
</p>
<h3><span class="mw-headline" id="Divers"><span class="mw-headline-number">2.1.5</span> Divers</span></h3>
<p>Les requêtes indirectes sont quasiment illimités, un pirate a le temps pour lui, il ira jetter un oeil sur le site de la société ou de ces filiales. D'autres données sur les sociétés et sur les marques se retrouvent sur des sites comme www.societe.com ou celui des pages jaunes (les num?ros de téléphone ou des noms de personnes). Les résultats dépendent evidemment de l'inventivité du pirate.
</p>
<h2><span class="mw-headline" id="Les_requ.C3.AAtes_directes"><span class="mw-headline-number">2.2</span> Les requêtes directes</span></h2>
<p>Les informations récupérées jusqu'ici ne proviennent pas directement de la cible. Nous allons maintenant lancer quelques sondes dans sa direction et voir tout ce que nous pouvons récupérer.
</p><p>Du point de vue de la cible, nous verrons également comment déjouer certaine interrogation. A la différence des étapes précédentes, la cible contrôle maintenant les données que le testeur recherche. C'est donc à elle de faire en sorte de les limiter au minimum.
</p>
<h3><span class="mw-headline" id="Interrogation_des_DNS"><span class="mw-headline-number">2.2.1</span> Interrogation des DNS</span></h3>
<p>La requête whois nous montre les DNS utilisés. Que peuvent nous révéler ces derniers&#160;?<br />
Pour obtenir des informations de ces serveurs, il suffit de les interroger dans un langage qu'ils comprennent à savoir le protocole DNS. Plusieurs requêtes sont à notre disposition&#160;:
</p>
<ul><li> Récupération de tous les serveurs DNS ayant autorités sur le domaine</li></ul>
<pre>host -v -t ns pigeons.fr ns1.pigeons.fr
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      Using domain server:
      Name: ns1.pigeons.fr
      Address: 10.250.149.163
      Aliases:
&#160;
      Trying null domain
      rcode = 0 (Success), ancount=3
&#160;
      The following answer is not verified as authentic by the server:
      pigeons.fr	172800 IN	NS	ns1.pigeons.fr
      pigeons.fr	172800 IN	NS	ns2.pigeons.fr
      pigeons.fr	172800 IN	NS	ns.heberge.fr
&#160;
      Additional information:
      ns1.pigeons.fr	172800 IN	A	10.250.149.163
      ns2.pigeons.fr	172800 IN	A	10.250.149.165
      ns.heberge.fr	345317 IN	A	10.51.3.65</pre></div></div>
<p>Nous avons donc la confirmation des serveurs DNS utilisés ainsi que leur adresse IP.
</p>
<ul><li> Récupération des serveurs de messagerie (Mail eXchanger) du domaine</li></ul>
<pre>host -v -t mx pigeons.fr ns1.pigeons.fr
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      Using domain server:
      Name: ns1.pigeons.fr
      Address: 10.250.149.163
&#160;
      Aliases:
&#160;
      Trying null domain
      rcode = 0 (Success), ancount=1
&#160;
      The following answer is not verified as authentic by the server:
      pigeons.fr	172800 IN	MX	0 smtp1.pigeons.fr
&#160;
      For authoritative answers, see:
      pigeons.fr	172800 IN	NS	ns1.pigeons.fr
      pigeons.fr	172800 IN	NS	ns2.pigeons.fr
      pigeons.fr	172800 IN	NS	ns.heberge.fr
&#160;
      Additional information:
      smtp1.pigeons.fr	172800 IN	A	10.250.149.35
      ns1.pigeons.fr		172800 IN	A	10.250.149.163
      ns2.pigeons.fr		172800 IN	A	10.250.149.165
      ns.heberge.fr		345239 IN	A	10.51.3.65</pre></div></div>
<ul><li> Vérification des deux requêtes précédentes</li></ul>
<pre>host -a pigeons.fr ns1.pigeons.fr
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      Using domain server:
      Name: ns1.pigeons.fr
      Address: 10.250.149.163
      Aliases:
&#160;
      Trying null domain
      rcode = 0 (Success), ancount=5
      The following answer is not verified as authentic by the server:
&#160;
      pigeons.fr	172800 IN   NS	ns1.pigeons.fr
      pigeons.fr	172800 IN   SOA	ns1.pigeons.fr dnsmaster.pigeons.fr(
				      2000060601    &#160;;;serial (version)
				      21600	    &#160;;refresh period
				      3600	    &#160;;retry refresh this often
				      3600000	    &#160;;expiration period
				      172800	    &#160;;minimum TTL
				     )
&#160;
      pigeons.fr	172800 IN	NS	ns2.pigeons.fr
      pigeons.fr	172800 IN	NS	ns.heberge.com
      pigeons.fr	172800 IN	MX	0 smtp1.pigeons.fr
&#160;
      For authoritative answers, see:
      pigeons.fr	172800 IN	NS	ns1.pigeons.fr
      pigeons.fr	172800 IN	NS	ns2.pigeons.fr
      pigeons.fr	172800 IN	NS	ns.heberge.fr
&#160;
      Additional information:
      ns1.pigeons.fr	172800 IN	A	10.250.149.163
      ns2.pigeons.fr	172800 IN	A	10.250.149.165
      ns.heberge.fr	345225 IN	A	10.51.3.65
      smtp1.pigeons.fr	172800 IN	A	10.250.149.35</pre></div></div>
<p>Désormais nous avons toutes les informations que nous pouvions recupérer facilement et à tous les coups. Explorons plus avant le domaine pigeons.fr en recherchant des informations sur les machines présentes sur le réseau&#160;:
</p><p>Le transfert de zone renvoie toute la configuration du serveur DNS
</p>
<ul><li> host -l pigeons.fr ns1.pigeons.fr</li></ul>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      Using domain server:
      Name: ns1.pigeons.fr
      Address: 10.250.149.163
      Aliases:
&#160;
      pigeons.fr name server ns1.pigeons.fr
      pigeons.fr name server ns2.pigeons.fr
      pigeons.fr name server ns.heberge.fr
&#160;
      m01.pigeons.fr has address 10.51.23.226
      m02.pigeons.fr has address 10.51.23.227
      www2.pigeons.fr has address 10.51.23.247
      m03.pigeons.fr has address 10.51.23.228
      m04.pigeons.fr has address 10.51.23.229
      m05.pigeons.fr has address 10.51.23.230
      m10.pigeons.fr has address 10.51.23.238
      m09.pigeons.fr has address 10.51.23.237
      m12.pigeons.fr has address 10.250.149.162
      m13.pigeons.fr has address 10.250.149.163
&#160;
      m14.pigeons.fr has address 10.250.149.165
      m16.pigeons.fr has address 10.51.23.251
      m39.pigeons.fr has address 10.51.23.249
      w3.pigeons.fr has address 10.101.154.68
      w5.pigeons.fr has address 10.101.154.67
      w7.pigeons.fr has address 10.101.154.73
      w8.pigeons.fr has address 10.101.154.77
      w9.pigeons.fr has address 10.101.154.79
      w5-private.pigeons.fr has address 10.101.154.70
      w3-ccc.pigeons.fr has address 10.101.154.72
      w3-bbb.pigeons.fr has address 10.101.154.71
      www.pigeons.fr has address 10.51.23.246</pre></div></div>
<p>La chance est avec nous, une mauvaise configuration nous a permis de lister toutes les machines du domaine pigeons.fr. Dans le cas contraire, nous aurions refait la même opération sur les autres serveurs DNS car souvent le serveur principale est bien configuré contrairement aux autres.
</p>
<ul><li> D'autres tests sont intéressants quand le transfert de zone est impossible. Par exemple, nous pouvons regarder s'il est possible de récupérer l'adressage interne.</li></ul>
<pre>host -a 0.168.192.in-addr.arpa ns1.pigeon2.com
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      Using domain server:
      Name: ns1.pigeons2.fr
      Address: 10.81.144.121
      Aliases:
&#160;
      Trying null domain
      rcode = 0 (Success), ancount=4
      The following answer is not verified as authentic by the server:
      0.168.192.in-addr.arpa 3600 IN NS   server2.pigeons2.fr
      0.168.192.in-addr.arpa 3600 IN NS   server1.pigeons2.fr
      0.168.192.in-addr.arpa 3600 IN NS   echange.pigeons2.fr
      0.168.192.in-addr.arpa 3600 IN SOA  server1.pigeons2.fr root.pigeons2.fr(
					      585    &#160;;serial (version)
					      900    &#160;;refresh period
					      600    &#160;;retry refresh this often
					      86400  &#160;;expiration period
					      3600   &#160;;minimum TTL
					     )
      Additional information:
      server2.pigeons2.fr       3600 IN A       192.168.0.1
&#160;
      server1.pigeons2.fr       3600 IN A       192.168.0.2
      server1.pigeons2.fr       3600 IN A       10.81.144.121
      echange.pigeons2.fr       3600 IN A       192.168.0.3</pre></div></div>
<p>Nous avons pris ici une autre cible puisque le transfert de zone précédent nous a montré aucune machine avec un adressage privé (192.168.0.1 par exemple). Nous voyons donc que la zone 0.168.192.in-addr.arpa est gérée par le serveur DNS ns1.pigeons2.fr. Il suffit donc de tester toutes les machines du réseau 192.168.0.*.
</p>
<pre>host 192.168.0.1 ns1.pigeons2.fr
</pre>
<pre>1.0.168.192.IN-ADDR.ARPA        1200 IN PTR     server1.pigeons2.fr
</pre>
<p>Il ne reste plus qu'à créer un petit script (en Perl par exemple) qui répéte cette commande pour les adresses de 192.168.0.1 à 192.168.0.254.
</p>
<ul><li> Enfin, dans le cas d'un Bind uniquement, nous pouvons obtenir sa version, ce qui est très intéressant quand on connait le long passé de ce serveur en terme d'exploits à distance.</li></ul>
<pre>nslookup
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      Default Server:  ns1.pigeons.fr
      Address:  10.250.149.163
&#160;
      &gt; set class=chaos
      &gt; set query=txt
      &gt; version.bind
      Server:  ns1.pigeons.fr
      Address:  10.250.149.163
&#160;
      VERSION.BIND    text = &quot;8.2.3-REL&quot;</pre></div></div>
<p>Nous obtenons bien la version de Bind, ce qui pourra nous permettre de trouver une éventuelle vulnérabilité sur cette version (un buffer overflow par exemple).
</p>
<h3><span class="mw-headline" id="Utilisation_de_ping"><span class="mw-headline-number">2.2.2</span> Utilisation de ping</span></h3>
<p>Les requêtes indirectes (whois) et l'interrogation des DNS nous ont permis de récupérer des adresses IP et des classes d'adresses IP appartenant à la cible. En effectuant, un ping sur chacune de ces adresses IP, nous allons savoir lesquelles sont accessibles. Il faut néanmoins prendre en compte le fait que la présence d'un firewall peut empêcher la machine de répondre au ping. Le scan de port solutionnera se problème en détectant la présence de la machine dans le cas où elle a un port ouvert. Nmap effectue très bien cette tâche&#160;:
</p>
<pre>nmap -sP 10.51.23.* -n
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">Starting nmap V. 2.54BETA25 ( www.insecure.org/nmap/ )
Host  (10.51.23.226) appears to be up.
Host  (10.51.23.227) appears to be up.
Host  (10.51.23.228) appears to be up.
Host  (10.51.23.229) appears to be up.
Host  (10.51.23.230) appears to be up.
Host  (10.51.23.237) appears to be up.
Host  (10.51.23.238) appears to be up.
Host  (10.51.23.246) appears to be up.
Host  (10.51.23.247) appears to be up.
Host  (10.51.23.249) appears to be up.
Host  (10.51.23.251) appears to be up.
&#160;
Nmap run completed -- 256 IP addresses (11 hosts up) scanned in 2 seconds</pre></div></div>
<h3><span class="mw-headline" id="Utilisation_de_traceroute"><span class="mw-headline-number">2.2.3</span> Utilisation de traceroute</span></h3>
<p>Le but du jeu est d'obtenir l'adresse IP d'un routeur d'accès aux machines cibles. Pour cela, il suffit de faire un traceroute en direction d'une machine du réseau cible&#160;:
</p>
<pre>traceroute 10.51.23.251
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">traceroute 10.101.154.70
&#160;
 1  10.0.0.1        1.612 ms  1.443 ms  1.532 ms
 2  10.18.23.5      5.790 ms  5.454 ms  5.536 ms
 3  10.20.20.1      5.605 ms  5.453 ms  5.338 ms
 4  10.51.15.1      6.805 ms  6.437 ms  6.552 ms
 5  10.51.192.7     7.783 ms  7.246 ms  7.329 ms
 6  10.51.173.65    7.402 ms  7.246 ms  7.732 ms
 7  10.51.159.33    7.582 ms  7.844 ms  7.935 ms
 8  10.51.23.1      8.202 ms  7.639 ms  7.909 ms
 9  10.51.23.251    7.807 ms  7.633 ms  7.733 ms</pre></div></div>
<p>La machine juste avant la destination est un routeur.
</p>
<h3><span class="mw-headline" id="Port_Scan"><span class="mw-headline-number">2.2.4</span> Port Scan</span></h3>
<p>Il existe une grande variétés de méthodes pour scanner, dont la description dépasse largement le cadre de cet article. Le principe général de toute méthode de scan est d'envoyer un paquet (TCP, UDP, ICMP...) sur la machine cible et de voir ce qui se passe. Selon la méthode employées, le testeur détermine l'état du port (ouvert, fermé, filtré).
</p><p>Le but du scan est similaire à celui de l'éclaireur. Le testeur (ou le pirate) détermine ainsi le rôle des machines, les services accessibles, les protocoles supportés... A la fin de l'opération, les informations suivantes sont obtenues&#160;:
</p>
<ul><li> Les adresses IP des machines du réseau</li>
<li> La liste des services disponibles</li>
<li> La liste des différents protocoles supportés (TCP, UDP, ICMP...)</li>
<li> Pour un maximum de machines, l'état de chacun de ses ports.</li></ul>
<p>Pour un administrateur, cette étape dévoile les accès à ses machines. Il doit également installer des outils lui permettant de détecter les scans qu'il n'a pas lui-même dilligentés (iplog ou portsentry par exemple).
</p><p>Il existe différentes solutions pour échapper à ce genre de détecteurs, en spoofant des adresses IP ou en distribuant le scan depuis plusieurs machines.
</p><p>Par exemple, lorsque l'adresse source du paquet est spoofée, la machine de test reste inconnue de la machine cible, bien que celle-ci sache alors qu'elle a été scannée&#160;:
</p>
<ul><li> kelly (192.168.1.3) la machine de tests </li>
<li> bosley (192.168.1.2) une machine calme (i.e. qui ne génére pas beaucoup de trafic)</li>
<li> charly (192.168.1.1) la machine cible.</li></ul>
<p>Pour détecter si un port TCP laisse passer les paquets, kelly envoie régulièrement des paquets à bosley. Si bosley génère peu de trafic sur le réseau, le champs id de ses paquets varie peu. Dans le même temps, kelly envoie à charly des paquets TCP avec le drapeau SYN activé (comme pour une demande de connexion normale), mais en mettant comme adresse source celle de bosley. Ainsi, charly répond à bosley avec des paquets SYN-ACK si le port est ouvert. bosley, qui n'a rien demandé, envoie un paquet RST à charly pour couper la connexion. Du coup, le champs id augmente puisque deux paquets sont émis (le RST et la réponse à kelly&#160;:
</p>
<pre>hping -r bosley
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">46 bytes from 192.168.1.2: flags=RA seq=1 ttl=255 id=+1 win=0 rtt=0.3 ms
46 bytes from 192.168.1.2: flags=RA seq=2 ttl=255 id=+1 win=0 rtt=0.3 ms
46 bytes from 192.168.1.2: flags=RA seq=3 ttl=255 id=+1 win=0 rtt=0.4 ms
46 bytes from 192.168.1.2: flags=RA seq=4 ttl=255 id=+1 win=0 rtt=0.3 ms
&#160;
46 bytes from 192.168.1.2: flags=RA seq=5 ttl=255 id=+2 win=0 rtt=0.4 ms
46 bytes from 192.168.1.2: flags=RA seq=6 ttl=255 id=+2 win=0 rtt=0.4 ms
46 bytes from 192.168.1.2: flags=RA seq=7 ttl=255 id=+3 win=0 rtt=0.3 ms
46 bytes from 192.168.1.2: flags=RA seq=8 ttl=255 id=+2 win=0 rtt=0.4 ms
46 bytes from 192.168.1.2: flags=RA seq=9 ttl=255 id=+2 win=0 rtt=0.3 ms
&#160;
46 bytes from 192.168.1.2: flags=RA seq=10 ttl=255 id=+1 win=0 rtt=0.4 ms
46 bytes from 192.168.1.2: flags=RA seq=11 ttl=255 id=+1 win=0 rtt=0.4 ms</pre></div></div>
<p>Simultanément depuis un autre terminal&#160;:
</p>
<pre>hping -a bosley -p 22 -S charly
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">eth0 default routing interface selected (according to /proc)
HPING charly (eth0 192.168.1.1): S set, 40 headers + 0 data bytes
&#160;
--- charly hping statistic ---
6 packets tramitted, 0 packets received, 100% packet loss</pre></div></div>
<p>Il est normal que kelly ne recoive aucune réponse de charly puisqu'elles sont envoyées à bosley.
</p><p>Au contraire, lorsque le port cible n'est pas ouvert, charly n'émet aucun paquet. Le champs id ne varie alors pas&#160;:
</p>
<pre>hping -r bosley
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">..
46 bytes from 192.168.1.2: flags=RA seq=61 ttl=255 id=+1 win=0 rtt=0.3 ms
46 bytes from 192.168.1.2: flags=RA seq=62 ttl=255 id=+1 win=0 rtt=0.3 ms
46 bytes from 192.168.1.2: flags=RA seq=63 ttl=255 id=+1 win=0 rtt=0.4 ms
46 bytes from 192.168.1.2: flags=RA seq=64 ttl=255 id=+1 win=0 rtt=0.3 ms
..</pre></div></div>
<p>Le port cible (hping -a bosley -p 80 -S charly) est donc fermé. Les logs de charly contiennent une tentative de connexion provenant de bosley.
</p><p>Pour induire un scan en erreur, il est également possible de laisser tourner un pot de miel (honney pot). Ceci ressemble à un serveur, a le goût d'un serveur, mais ce n'est pas un vrai serveur&#160;:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">/* fake.c&#160;: just a socket bound to a port */
#include &lt;stdlib.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
&#160;
main(int argc,char *argv[]) {
&#160;
  int port;                 //port number
  struct sockaddr_in sock;  //the socket for the server
  int sd;                   //socket descriptor
&#160;
  if (argc!=2) exit(EXIT_FAILURE);
  port = htons(atoi(argv[1]));
&#160;
  if ( (sd = socket(AF_INET, SOCK_STREAM, 0)) == -1) {
    perror(&quot;No socket&quot;);
    exit(EXIT_FAILURE);
  }
&#160;
  sock.sin_family = AF_INET;
  sock.sin_port = port;
&#160;
  sock.sin_addr.s_addr = INADDR_ANY;
  if (bind(sd, (struct sockaddr*)&amp;sock, sizeof(struct sockaddr)) == -1) {
    perror(&quot;can't bind&quot;);
    exit(EXIT_FAILURE);
  }
&#160;
  /* Let's go for LISTEN mode */
  if (listen(sd, 2) == -1) {
    perror(&quot;Bad listen&quot;);
    exit(EXIT_FAILURE);
  }
&#160;
  while(1) sleep(1);
}</pre></div></div>
<p>Il suffit alors de le mettre sur le port de son choix&#160;:
</p>
<pre>gcc -o fake fake.c
./fake 21 &amp;
</pre>
<pre>[2] 3373
</pre>
<pre>lsof -ni | grep fake
</pre>
<pre>fake    3373   root    3u  IPv4 201230       TCP *:ftp (LISTEN)
</pre>
<pre>nmap charly          
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">Starting nmap V. 2.54BETA22 ( www.insecure.org/nmap/ )
Interesting ports on charly (192.168.1.1):
(The 1538 ports scanned but not shown below are in state: closed)
Port       State       Service
21/tcp     open        ftp                     
22/tcp     open        ssh                     
6000/tcp   open        X11</pre></div></div>
<p>Nous lançons notre serveur fake sur le port 21 (ftp). lsof nous révèle bien qu'un serveur écoute sur ce port 21. Toutefois, nmap (scanner de port) se laisse abuser car il tente juste d'ouvrir une connexion sur le port 21. Comme il réussit, il croit que c'est bien un serveur ftp. L'illusion fonctionne avec ce type de scanners réseau car ils ne cherchent pas réellement à se connecter. Toute connexion plus approfondie révèlera la supercherie, à moins d'affiner le faux serveur (par exemple en ajoutant les bannières pour simuler le service désiré). Signalons enfin que la commande nc (netcat) produit un résultat similaire (nc -l -p 21 pour écouter sur le port 21).
</p><p>Ce genre de défense s'appelle pot de miel. Les projets honeynets et honneypots mettent en place des réseaux, ou des machines, destinés à attirer les pirates pour apprendre leurs techniques.
</p><p>Scanner une machine se résumé toujours à envoyer un paquet de la machine de tests à la machine cible, indépendamment de la méthode employée. Selon les moyens de la machine cible (i.e. la sécurité attendue sur celle-ci), une tentative avec 2 paquets par jour suffit pour détecter le scan. Il faut alors de gros disques et enregistrer tous les paquets qui arrivent sur la machine pour analyser ces données sur plusieurs jours afin de reconstituer le scan.
</p>
<h3><span class="mw-headline" id="OS_Fingerprinting"><span class="mw-headline-number">2.2.5</span> OS Fingerprinting</span></h3>
<p>Grâce au scan du réseau cible, nous connaissons maintenant les machines actives. Nous affinons notre connaissance en déterminant leur système d'exploitation. Cette connaissance nous permettra, lorsque nous aurons également déterminé la version des daemons qui attendent sur les ports de la machine cible, de rechercher les exploits nécessaires à nos tests d'intrusion.
</p><p>Chaque OS possède sa propre conception de la gestion des protocoles réseaux. D'une part, certains champs sont laissés à la charge de l'OS (TTL, ToS, Win, DF...). D'autre part, même si les RFC définissent l'essentiel, elles ne sont pas toujours scrupuleusement respectées. De plus, si elles interdisent bien certaines configurations de paquets, elles ne précisent toutefois pas comment y répondre. Par exemple, que faire d'un paquet qui contient le flag 64, non défini&#160;? A Chacun a sa solution.
</p><p><b>Valeurs par défaut dans les paquets&#160;:</b>
</p><p>En récupérant des paquets émis par la cible, nous découvrons la valeur de paramètres&#160;:
</p>
<ul><li> le champs TTL (time to live) des paquets sortants&#160;;</li>
<li> la taille de la fenêtre (window)&#160;;</li>
<li> le bit DF (Don't Fragment)&#160;;</li>
<li> le champs TOS (Type Of Service).</li>
<li> ...</li></ul>
<p>Selon les OS, tous ces paramètres changent. Une base de données contenant leur valeur par défaut facilite alors l'identification. Il suffit ainsi d'envoyer des paquets différents pour tester les réponses puis de comparer ces dernières à une base de signatures pour identifier l'OS.
</p><p>Par exemple, le champs id permet de distinguer facilement les linux 2.2.x des 2.4.x (la commande hping -1 -c 3 émet 3 paquets de type 1 i.e. ICMP)&#160;:
</p>
<pre>uname -a
</pre>
<pre>Linux charly 2.4.4 #4 Wed May 23 10:18:08 CEST 2001 i686 unknown
</pre>
<pre>hping -1 -c 3 charly
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">28 bytes from 192.168.1.1: icmp_seq=0 ttl=255 id=0 rtt=0.4 ms
28 bytes from 192.168.1.1: icmp_seq=1 ttl=255 id=0 rt
t=0.3 ms
28 bytes from 192.168.1.1: icmp_seq=2 ttl=255 id=0 rtt=0.3 ms</pre></div></div>
<pre>uname -a
</pre>
<pre>Linux kelly 2.2.19ow1 #2 Mon May 21 12:29:48 CEST 2001 i686 unknown
</pre>
<pre>hping -1 -c 3 kelly
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">28 bytes from 128.93.24.10: icmp_seq=0 ttl=255 id=4901 rtt=0.3 ms
28 bytes from 128.93.24.10: icmp_seq=1 ttl=255 id=4903 rtt=0.2 ms
28 bytes from 128.93.24.10: icmp_seq=2 ttl=255 id=4906 rtt=0.2 ms</pre></div></div>
<p><b>La pile TCP/IP</b>
</p><p>Cependant, cette méthode n'est pas très fiable car les OS permettent souvent de modifier certaines de ces valeurs (avec sysctl sous Linux ou dans la base de registres pour Windows).
</p><p>Une méthode plus performante consiste à analyser les réponses de l'OS cible face à certains paquets&#160;: le testeur connait alors le comportement de la pile TCP/IP de la cible, ce qui est suffisant pour identifier l'OS si les t ests sont bien choisis.
</p><p>nmap (encore et toujours&#160;;) utilise exactement cette démarche lorsque l'option -O (OS identification) est activée. Une base de données contient les réponses types selon les OS. Ainsi, l'empreinte des noyaux Linux 2.4.0 - 2.4.5 correspond à&#160;:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">Contributed by  root(at)dexter.dynu.com
Fingerprint Linux Kernel 2.4.0 - 2.4.5 (X86)
TSeq(Class=RI%gcd=&lt;6%SI=&lt;2983C7E&amp;&gt;3DAF6%IPID=Z%TS=100HZ)
T1(DF=Y%W=16A0|7FFF%ACK=S++%Flags=AS%Ops=MNNTNW)
T2(Resp=N)
T3(Resp=Y%DF=Y%W=16A0|7FFF%ACK=S++%Flags=AS%Ops=MNNTNW)
T4(DF=Y%W=0%ACK=O%Flags=R%Ops=)
T5(DF=Y%W=0%ACK=S++%Flags=AR%Ops=)
T6(DF=Y%W=0%ACK=O%Flags=R%Ops=)
T7(DF=Y%W=0%ACK=S++%Flags=AR%Ops=)
PU(DF=Y|N%TOS=C0|0%IPLEN=164%RIPTL=148%RID=E%RIPCK=E%UCK=E|F%ULEN=134%DAT=E)</pre></div></div>
<p>Les tests en eux-mêmes sont décrits par les lignes Ti. La lecture de l'article de Fyodor paru dans phrack vous les détaillera (phrack 54, fichier 9/12). Toutefois, dévoilons succinctement la signification de chacun&#160;:
</p>
<ul><li> TSeq&#160;: décrit la nature de l'incrémentation des numéros de séquence</li>
<li> T1&#160;: paquet TCP avec le flag SYN|64 (comme 64 ne correspond à aucune valeur de flag, le paquet est "syn-bogué") vers un port ouvert</li>
<li> T2&#160;: paquet TCP NULL, i.e. ne contenant aucune option ni aucun flag, vers un port ouvert</li>
<li> T3&#160;: paquet TCP avec les flags SYN|FIN|URG|PSH vers un port ouvert</li>
<li> T4&#160;: paquet TCP avec le flag ACK vers un port ouvert</li>
<li> T5&#160;: paquet TCP avec le flag SYN vers un port fermé</li>
<li> T6&#160;: paquet TCP avec le flag ACK vers un port fermé</li>
<li> T7&#160;: paquet TCP avec le flag FIN|PSH|URG vers un port fermé</li>
<li> PU&#160;: paquet UDP envoyé à un port fermé afin de récupérer un paquet ICMP "port unreachable".</li></ul>
<p>S'il est souvent possible de modifier les valeurs de certains paramètres, modifier le comportement complet de la pile est autrement difficile, voire impossible avec certains OS dont les sources ne sont pas disponibles.
</p>
<h3><span class="mw-headline" id="Banni.C3.A8res"><span class="mw-headline-number">2.2.6</span> Bannières</span></h3>
<p>L'objectif est simple&#160;: connaître la version de l'application utilisé pour un service spécifique. La plupart du temps, un simple telnet sur le port désiré nous donne le renseignement. Signalons les quelques services qui ne délivrent pas cette information&#160;: finger (port 79), exec (port 512), login (port 513), printer (port 515).
</p><p>Il existe également un article sur ce wiki&#160;: <a href="./Banières_:_Cacher_les_banières_de_ses_applications_(Service_banner_faking).html" title="Banières : Cacher les banières de ses applications (Service banner faking)">Banières : Cacher les banières de ses applications (Service banner faking)</a>
</p>
<ul><li> FTP (port 21)&#160;:<br /></li></ul>
<p>Souvent la version est dévoilée dès le login&#160;:
</p>
<pre>telnet ftp.pigeons.fr
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      Trying 192.168.14.35...
      Connected to ftp.pigeons.fr
      Escape character is '^]'.
      220 ProFTPD 1.2.0pre9 Server (ProFTPD) [ftp1-1.pigeons.fr</pre></div></div>
<p>Cependant, certains serveurs autorisent la dissimulation de la bannière. La commande STAT peut nous sauver&#160;:
</p>
<pre>telnet ftp.pigeons2.fr 21
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      Trying 192.168.96.24...
      Connected to ftp.pigeons2.fr.
      Escape character is '^]'.
      220 ftp.pigeons2.fr FTP server ready.
      USER ftp
      331 Guest login ok, send your complete e-mail address as password.
      PASS raynal(at)home.net
      230 Guest login ok, access restrictions apply.
      STAT
      211-ftp.pigeons2.fr FTP server status:
         Version wu-2.6.1(1) Fri Feb 16 19:32:14 CET 2001
         Connected to bosley (192.168.1.2)
         Logged in anonymously
         TYPE: ASCII, FORM: Nonprint; STRUcture: File; transfer MODE: Stream
         No data connection
         0 data bytes received in 0 files
         0 data bytes transmitted in 0 files
         0 data bytes total in 0 files
         144 traffic bytes received in 0 transfers
         2502 traffic bytes transmitted in 0 transfers
         2696 traffic bytes total in 0 transfers
      211 End of status</pre></div></div>
<ul><li> telnet (port 23):<br /></li></ul>
<p>Avant même que la connexion soit validée par le mot de passe, le serveur renvoie les informations recherchées&#160;:
</p>
<pre>telnet 192.168.1.1
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      Trying 192.168.1.1...
      Connected to charly (192.168.1.1).
      Escape character is '^]'.
&#160;
      Red Hat Linux release 7.1 (Seawolf)
      Kernel 2.4.4 on an i686</pre></div></div>
<p>Si vous tenez vraiment à utiliser telnet, l'option -h ne les affichera qu'une fois le client authentifié.
</p>
<ul><li> DNS (port 53)&#160;:<br /></li></ul>
<p>Nous avons vu qu'il était assez simple de récupérer la version d'un serveur DNS. Il est cependant possible de fausser cette information en modifiant le champs options dans /etc/named.conf&#160;:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      # /etc/named.conf
      ...
      options {
                 directory &quot;/var/named&quot;;
                 version &quot;What are you doing, dude&#160;!&quot;;
              };</pre></div></div>
<ul><li> HTTP (port 80)&#160;:<br /></li></ul>
<p>La commande HEAD ne renvoie que les méta-informations constituant l'en-tête HTTP&#160;:
</p>
<pre>telnet minimum 80
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      Trying 192.168.1.1...
      Connected to charly (192.168.1.1).
      Escape character is '^]'.
      HEAD / HTTP/1.0
&#160;
      HTTP/1.1 200 OK
      Date: Mon, 11 Jun 2001 19:28:57 GMT
      Server: Apache/1.3.19 (Unix)  (Red-Hat/Linux)
      mod_ssl/2.8.1 OpenSSL/0.9.6 DAV/1.0.2 PHP/4.0.4pl1 mod_perl/1.24_01
&#160;
      Last-Modified: Thu, 29 Mar 2001 17:53:01 GMT
      ETag: &quot;731a-b4a-3ac3767d&quot;
      Accept-Ranges: bytes
      Content-Length: 78208
      Connection: close
      Content-Type: text/html
&#160;
      Connection closed by foreign host.</pre></div></div>
<p>L'ajout de la ligne <i>ServerToken Prod</i> limite l'information au nom du serveur, i.e. Apache.
</p>
<ul><li> portmap (port 111) et les RPCs&#160;:<br /></li></ul>
<p>Comme nous le détaillons dans la suite de cet article, la commande rpcinfo fournit toutes les versions des services RPCs qui tournent sur la cible.
</p>
<ul><li> identd (port 113)&#160;:<br /></li></ul>
<p>Certaines versions supportent une extension à la <a class="external mw-magiclink-rfc" rel="nofollow" href="https://tools.ietf.org/html/rfc1413">RFC 1413</a>&#160;: la commande VERSION&#160;:
</p>
<pre>telnet charly 113
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      Connected to charly...
      VERSION
      0 , 0&#160;: X-VERSION&#160;: pidentd 3.0.10 for Linux 2.2.5-22smp (Jul 20 2000 15:09:20)</pre></div></div> 
<p>Les serveurs qui supportent cette commande dispose également souvent d'une option pour la désactiver.
</p>
<h3><span class="mw-headline" id="Informations_relatives_.C3.A0_des_protocoles_sp.C3.A9cifiques"><span class="mw-headline-number">2.2.7</span> Informations relatives à des protocoles spécifiques</span></h3>
<p>Nous savons maintenant ce qui tourne précisément sur chacun des systèmes (OS, serveurs, version des serveurs...). Nous continuons notre quête de renseignements car de nombreux serveurs en dévoilent encore beaucoup sur le réseau et ses utilisateurs&#160;:
</p>
<ul><li> finger fournit des informations sur les utilisateurs du système&#160;:</li></ul>
<pre>finger (at)charly
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      Login     Name              Tty     Idle  Login Time   Office  Office Phone
      detoisien Eric Detoisien    pts/7     3d  Jun  5 09:47 (jil)
      detoisien Eric Detoisien   *pts/10  160d  Jun  5 11:08 (kelly)
      raynal    Frederic Raynal   tty1     10d  May 31 09:57  
      raynal    Frederic Raynal   pts/1     3d  Jun  5 09:26 (:0)
      raynal    Frederic Raynal   pts/3     3d  May 31 09:58 (:0)
      raynal    Frederic Raynal   pts/11    3d  May 31 11:52 (:0)
      raynal    Frederic Raynal   pts/7     3d  Jun  6 12:08 (:0)
      raynal    Frederic Raynal   pts/2         Jun 10 09:35 (bosley)
      root      root              pts/4     5d  May 31 09:58</pre></div></div> 
<p>En outre, il est possible d'enchaîner les requêtes avec la notation finger raynal(at)hots1(at)host2.
</p>
<ul><li> Le serveur de mails&#160;: le protocole SMTP (<a class="external mw-magiclink-rfc" rel="nofollow" href="https://tools.ietf.org/html/rfc821">RFC 821</a>) définit les commandes VRFY et EXPN&#160;:</li></ul>
<pre>VERIFY (VRFY)
</pre>
<p>Cette commande demande au récepteur de confirmer que les arguments fournis désignent bien un utilisateur. S'il s'agit d'un nom d'utilisateur, le nom complet de ce dernier (s'il est connu du récepteur) ainsi que la boîte aux lettres totalement qualifiée doivent être renvoyés au requérant.
</p>
<pre>EXPAND (EXPN)
</pre>
<p>Cette commande demande au récepteur de confirmer si l'argument associé identifie une liste de diffusion, et, si c'est le cas, de renvoyer la liste des membres de cette liste. Le nom complet des utilisateurs (s'il est connu) et les adresses de boîtes-aux-lettres entiérement qualifiées seront renvoyées via une réponse multilignes.
</p><p>Sur charly, nous obtenons les informations suivantes&#160;:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      vrfy root
      250 system PRIVILEGED account &lt;root(at)charly.pigeons.fr&gt;
      vrfy bin
      250 system librarian account &lt;bin(at)charly.pigeons.fr&gt;
      vrfy web
      250 Web Server manager &lt;web(at)charly.pigeons.fr&gt;
      vrfy ftp
      550 ftp... User unknown
      vrfy raynal
      250 Frederic Raynal &lt;raynal(at)charly.pigeons.fr&gt;
      expn pigeons
      050 pigeons... aliased to detoisien, pappy, raynal
      050 /home/detoisien/.forward: line 1: forwarding to detoisien(at)pigeons.fr
      050 /home/raynal/.forward: line 1: forwarding to \raynal(at)charly.pigeons.fr
      050 /home/raynal/.forward: line 2: forwarding to frederic.raynal(at)linuxmag.fr
&#160;
      250-Eric Detoisien &lt;detoisien(at)pigeons.fr&gt;
      250-Frederic Raynal &lt;pappy(at)charly.pigeons.fr&gt;
      250-Frederic Raynal &lt;\raynal(at)charly.pigeons.fr&gt;
      250-Frederic Raynal &lt;frederic.raynal(at)linuxmag.fr&gt;</pre></div></div>
<p>La plupart des serveurs SMTP permettent maintenant de les désactiver, ce qui est donc recommandé&#160;;)
</p>
<ul><li> identd (anciennement appelé auth, port 113 - <a class="external mw-magiclink-rfc" rel="nofollow" href="https://tools.ietf.org/html/rfc1413">RFC 1413</a>) fournit des informations sur l'identité des utilisateurs du système. Il dévoile le détenteur d'une connexion, ce qui nécessite de connaître les ports cible et destination. Pour le port cible, comme nous sommes sur notre machine, la commande netstat -A inet nous le révéle. Quant au port destination, nous avons déjà scann? la machine cible&#160;! Il ne nous reste plus qu'à nous connecter à chacun des ports ouverts puis à demander à identd  qui est en charge de cette connexion.</li></ul>
<p>Le résultat du scan de bosley est le suivant&#160;:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      7/tcp      open        echo                    
      22/tcp     open        ssh                     
      80/tcp     open        http                    
      113/tcp    open        auth                    
      664/tcp    open        unknown                 
      1024/tcp   open        kdm                     
      1025/tcp   open        listen                  
      6000/tcp   open        X11</pre></div></div>
<p>Nous initialisons une connexion sur le port 113 de bosley. Puis, pour chacun des ports ouverts, nous nous connectons avec un simple client telnet (telnet bosley 664). Nous demandons alors à identd de nous donner les informations voulues (la syntaxe des requêtes est &lt;port-sur-serveur&gt;,&lt;port-sur-client&gt;)&#160;:
</p>
<pre>telnet bosley 113
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      Trying 192.168.1.2...
      Connected to bosley.
      Escape character is '^]'.
      7,32924
      7 , 32924&#160;: USERID&#160;: OTHER&#160;:root
      22,32927
      22 , 32927&#160;: USERID&#160;: OTHER&#160;:root
      80,32928
      80 , 32928&#160;: ERROR&#160;: UNKNOWN-ERROR
      113, 32926
      113 , 32926&#160;: USERID&#160;: OTHER&#160;:nobody
      664,32930
      664 , 32930&#160;: USERID&#160;: OTHER&#160;:root
      1024,32931
      1024 , 32931&#160;: USERID&#160;: OTHER&#160;:rpcuser
      1025,32932
      1025 , 32932&#160;: USERID&#160;: OTHER&#160;:root
      6000,32933
      6000 , 32933&#160;: USERID&#160;: OTHER&#160;:root
      Connection closed by foreign host.</pre></div></div>
<p>Nous voyons ici quelques limites à nmap. Tout d'abord, l'erreur obtenue sur le port 80 signifie qu'en fait il n'y a pas de serveur web sur bosley . Ensuite, le kdm qui tourne avec l'identité rpcuser laisse plutôt penser qu'il s'agit en fait d'un programme RPC.
</p><p>Regardez attentivement les indications de configuration de votre daemon. Il est souvent possible de remplacer le nom de l'utilisateur par son UID, mais d'une manière générale, mieux vaut désactiver ce serveur.
</p>
<ul><li> portmap (sunrpc port 111) est le serveur essentiel au bon fonctionnement des services qui reposent sur les RPCs (NIS, NFS, rusers, rstat...). La commande rpcinfo révéle ce qui tourne sur une machine&#160;:</li></ul>
<pre>rpcinfo -p bosley
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      program vers proto   port
      100000    2   tcp    111  portmapper
      100000    2   udp    111  portmapper
      100007    2   udp    661  ypbind
      100007    1   udp    661  ypbind
      100007    2   tcp    664  ypbind
      100007    1   tcp    664  ypbind
      100024    1   udp   1024  status
      100024    1   tcp   1024  status
      100011    1   udp    855  rquotad
      100011    2   udp    855  rquotad
      100005    1   udp   1025  mountd
      100005    1   tcp   1025  mountd
      100005    2   udp   1025  mountd
      100005    2   tcp   1025  mountd
      100003    2   udp   2049  nfs
      100003    3   udp   2049  nfs
      100021    1   udp   1026  nlockmgr
      100021    3   udp   1026  nlockmgr
      100021    4   udp   1026  nlockmgr
      390113    1   tcp   7937</pre></div></div>
<p>rpcinfo se connecte au port 111 de la machine cible et lui demande ce qui fonctionne dessus. portmap n'a pas prévu de mécanismes de contrôle. Il est donc conseillé de bloquer l'accès à ce serveur via le pare-feu et le tcp-wrapper. Dans ce cas, toutes les requêtes fondées sur les RPC (comme les 2 suivantes) échoueront.
</p><p>Cependant, l'authentification de RPCs repose sur l'adresse IP du client. Sur un réseau local, il est très facile d'usurper une adresse et d'accéder ainsi à tous les services RPCs disponibles.
</p>
<ul><li> Un serveur NIS contrôle les clients autorisés à l'interroger par un mécanisme appelé securenets. Par défaut, tout le monde peut se connecter au serveur. N'importe quelle machine peut alors se déclarer client de telle base NIS. Une fois connu le nom de la base NIS (il s'agit souvent du m?me nom que le serveur), nous déclarons notre machine de tests (kelly - 192.168.1.3) comme cliente du serveur NIS (charly - 192.168.1.1)&#160;:</li></ul>
<pre>cat /etc/yp.conf
</pre>
<pre>domain charly server charly
</pre>
<pre>ypwhich        #quel est mon serveur NIS&#160;?
</pre>
<pre>charly        #bingo, il répond&#160;;)
</pre>
<pre>ypcat -k passwd.byname
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      ...
      fguest fguest:B4wLh7jxO1eZA:5555:5555:Compte temporaire:/home/fguest:/bin/bash
      raynal raynal:YP5.ojuxdA/6.:10943:21196:Frederic Raynal:/home/raynal:/bin/bash
      ...
      [raynal(at)kelly intrusion]$ ypcat -k netgroup
      angels (charly,,) (bosley,,) (kelly,,) (jil,,) (sabrina,,)</pre></div></div>
<ul><li> Lorsque la machine cible exporte des répertoires par NFS, il est parfois possible de les connaître en utilisant la commande showmount&#160;:</li></ul>
<pre>showmount -e charly
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      /var/spool/mail  angels
      /home/web/www    (everyone)
      /home            angels
      /opt/download    jil</pre></div></div>
<p>Nous retrouvons ici le netgroup angels découvert précédemment dans la base NIS. Les répertoires exportés à tout le monde (signalés par (everyone)) sont alors accessibles sur la machine tests par mount -t nfs &lt;cible&gt;:&lt;répertoire&gt; /mnt/cible.
</p>
<ul><li> Toujours parmi les RPC, voici quelques serveurs moins courants&#160;:</li></ul>
<p>- ruserd révèle les utilisateurs connectés sur une machine&#160;:
</p>
<pre>rusers -l charly
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      	    raynal   charly:tty1 Jun 16 18:11     &#160;:51 
      	    raynal   charly:pts/ Jun 16 18:11          (:0)
      	    raynal   charly:pts/ Jun 16 18:11     &#160;:19 (:0)
      	    raynal   charly:pts/ Jun 16 18:11     &#160;:06 (:0)
      	    raynal   charly:pts/ Jun 16 18:11     &#160;:20 (:0)
      	    raynal   charly:pts/ Jun 16 18:59     &#160;:03 (bosley)</pre></div></div> 	    
<p>On apprend ainsi les dates de connexion et leur provenance.
</p><p>- rstatd génère des statistiques sur le système, lues par la commande rup&#160;:
</p>
<pre>rup -d charly
</pre>
<pre>charly      19:15pm up      1:05,  load average: 0.09 0.14 0.13
</pre>
<h3><span class="mw-headline" id="Envoie_de_mail"><span class="mw-headline-number">2.2.8</span> Envoie de mail</span></h3>
<p>L'en-tête d'un mail fourmille d'informations pertinentes comme la version du serveur smtp utilisé voir l'adressage interne. Nous obtenons le chemin emprunté par le mail.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">Received: from smtp1.pigeons.fr ([xxx.xxx.xxx.xxx])
	  by front.testeur.fr (8.9.3/No_Relay+No_Spam_MGC990224) with ESMTP id OAA00632
	  for &lt;detoisien(at)testeur.fr&gt;; Wed, 18 Apr 2001 14:18:11 +0200 (MET DST)
Received: from bpigeon ([10.33.11.153]) by smtp1.pigeons.fr
          (Netscape Messaging Server 3.6)  with SMTP id AAA3A01
          for &lt;detoisien(at)testeur.fr&gt;; Wed, 18 Apr 2001 14:14:50 +0200
Message-ID: &lt;004401c0c801$319eff40$990b210a(at)sit.fr&gt;
From: &quot;Bernard Pigeon&quot; bernard.pigeon(at)pigeons.fr
To: detoisien(at)testeur.fr
Subject: Test 
Date: Wed, 18 Apr 2001 14:15:01 +0200
MIME-Version: 1.0
Content-Type: text/plain;
	charset=&quot;iso-8859-1&quot;
Content-Transfer-Encoding: 8bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 5.00.2919.6600
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.2919.6600</pre></div></div>
<p>Nous récupérons le nom et l'adresse d'une machine interne, la version du serveur SMTP ainsi que la version du client SMTP utilisé. Il est fréquent d'envoyer un mail à une adresse inexistante. Ainsi, le serveur SMTP de la cible renvoie automatiquement une réponse avec la plupart des informations.
</p>
<h3><span class="mw-headline" id="Scan_CGI"><span class="mw-headline-number">2.2.9</span> Scan CGI</span></h3>
<p>L'installation par défaut d'un serveur Web et/ou une mauvaise configuration font que de nombreux scripts peuvent être présent sur un serveur Web. Un nombre important de ces scripts sont la source de failles. Un scanner de CGI permet de tester la présence de ces scripts sur un serveur cible. Le pirate pourra ainsi les utiliser pour attaquer la machine cible. Le scanner le plus connu est whisker.
</p>
<pre>perl whisker.pl -h www.pigeons.fr -i
</pre>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">-- whisker / v1.3.0a / rain forest puppy / ADM / wiretrip --
&#160;
= - = - = - = - = - =
= Host: www.pigeons.fr
- Directory index: /
&#160;
= Server: Microsoft-IIS/4.0
&#160;
- Appending&#160;::,&#160;%2E, or 0x81 to URLs may give script source
- Requesting a bogus .pl may give physical path like .idc bug does
- if perl is installed
- Security settings on directories can be bypassed if you use 8.3
- Warning: Syntax Error: names
- http://www.securityfocus.com/templates/archive.pike?list=1
- &amp;date=1999-08-15&amp;msg=37B5D87E.D6600553(at)urban-a.net
- Content-Location: http://10.51.23.246/cfdocs/index.htm
&#160;
+ 200 OK: GET /cfdocs/cfmlsyntaxcheck.cfm
&#160;
+ 200 OK: GET /cfide/Administrator/startstop.html
- can start/stop the server...w00h00
&#160;
+ 200 OK: HEAD /iisadmpwd/aexp4b.htr
- gives domain/system name
&#160;
+ 200 OK: HEAD /msadc/msadcs.dll
- RDS.  See RDS advisory, RDP9902
- Need I remind you, do not abuse, kids?</pre></div></div>
<p>Nous avons une liste de scripts potentiellement vulnérables qui pourront exploités ultérieurement.
</p>
<h3><span class="mw-headline" id="War_Dialing"><span class="mw-headline-number">2.2.10</span> War Dialing</span></h3>
<p>Le War Dialing est une technique un peu à part. En effet, cela consiste à scanner tout un ensemble de numéros de téléphone.
</p><p>Un logiciel (Toneloc, THC-Scan...) appelle chacun des numéros de téléphone et détecte s'il s'agit d'une VMB (Voice Mail Box), d'un fax, d'une personne, d'un type de sonnerie (occupé, pas de réponse...) ou d'une porteuse c'est à dire un modem (ou plus généralement un Remote Access) qui répond. L'attaque suivant cette découverte se focalise sur la découverte d'un login/password permettant d'accéder à la machine derrière le modem.
</p>
<h1><span class="mw-headline" id="L.27utilisation_des_informations"><span class="mw-headline-number">3</span> L'utilisation des informations</span></h1>
<p>Après avoir récupéré tous ces renseignements sur le système d'information cible, nous pouvons planifier la suite du test d'intrusion.
</p>
<h2><span class="mw-headline" id="La_recherche_de_vuln.C3.A9rabilit.C3.A9s"><span class="mw-headline-number">3.1</span> La recherche de vulnérabilités</span></h2>
<p>Cette étape utilise directement les données précédentes. L'objectif de la phase d'analyse est de trouver les vulnérabilités au niveau du réseau, des systèmes, et des applications de la cible. Ces failles se trouvent dans des bases publiques (comme bugtraq qui est la liste la plus connue) et sur des sites de groupe de pirates. Cette recherche aboutit à l'établissement d'une liste des vulnérabilités utilisables contre les machines de la cible.
</p><p>Dans le cas où de nombreuses machines sont à tester, nous pouvons utiliser un scanner de vulnérabilités (comme Nessus). Il s'agit d'un logiciel qui automatise la découverte de vulnérabilités. Celles-ci sont maintenues au sein d'une base qui peut être mise à jour on-line. Ce type d'application est très utile mais a ses limites. En effet, un tel scanner peut remonter de fausses alertes ou, à l'inverse, ne pas détecter certaines vulnérabilités. Il pourra, néanmoins, compléter notre liste de failles qui nous sert dans la dernière étape.
</p>
<h2><span class="mw-headline" id="L.27exploitation_des_vuln.C3.A9rabilit.C3.A9s"><span class="mw-headline-number">3.2</span> L'exploitation des vulnérabilités</span></h2>
<p>Ces failles sont exploitées en utilisant des outils disponibles sur Internet ou développés pour l'occasion (en C ou en Perl la plupart du temps). Cette dernière phase pourra aboutir à la compromission d'une machine. L'exploitation est très spécifique et dépend évidemment des vulnérabilités découvertes.
</p>
<h1><span class="mw-headline" id="Conclusion"><span class="mw-headline-number">4</span> Conclusion</span></h1>
<p>Cet article s'est focalisé sur la recherche d'informations sur la cible dans l'objectif d'un test d'intrusion externe (via Internet). Cette phase d'approche est sensiblement la même à chaque test contrairement à l'attaque en elle-même. En ce qui concerne les tests d'intrusion internes, la méthodologie reste identique mais le nombre de vulnérabilités est souvent plus important et les techniques d'attaque plus nombreuses.
</p>
<!-- 
NewPP limit report
CPU time usage: 0.040 seconds
Real time usage: 0.041 seconds
Preprocessor visited node count: 406/1000000
Preprocessor generated node count: 796/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:1733-0!*!0!1!en!*!* and timestamp 20181111230723 and revision id 2753
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=Tests_d%27intrusion&amp;oldid=2753">https://wiki.deimos.fr/index.php?title=Tests_d%27intrusion&amp;oldid=2753</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=Tests+d%27intrusion" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="Tests_d'intrusion.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="Tests_d'intrusion.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="Tests_d'intrusion.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=Tests_d%27intrusion&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=Tests_d%27intrusion&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="Tests_d'intrusion.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/Tests_d'intrusion.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/Tests_d%27intrusion" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=Tests_d%27intrusion&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=Tests_d%27intrusion&amp;oldid=2753" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=Tests_d%27intrusion&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 28 November 2006, at 22:23.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":31});
}</script>
	</body>
</html>
	
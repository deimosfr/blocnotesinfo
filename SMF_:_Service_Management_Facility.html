<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>SMF : Service Management Facility - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="./SMF_:_Service_Management_Facility.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"SMF_:_Service_Management_Facility","wgTitle":"SMF : Service Management Facility","wgCurRevisionId":8706,"wgRevisionId":8706,"wgArticleId":1744,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"SMF_:_Service_Management_Facility","wgRelevantArticleId":1744,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-SMF_Service_Management_Facility skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">SMF : Service Management Facility</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="./SMF_:_Service_Management_Facility.html#mw-navigation">navigation</a>, 					<a href="./SMF_:_Service_Management_Facility.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="./SMF_:_Service_Management_Facility.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="./SMF_:_Service_Management_Facility.html#Gestion_des_Runlevels_et_Milstones"><span class="tocnumber">2</span> <span class="toctext">Gestion des Runlevels et Milstones</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="./SMF_:_Service_Management_Facility.html#Le_boot"><span class="tocnumber">3</span> <span class="toctext">Le boot</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="./SMF_:_Service_Management_Facility.html#Inittab"><span class="tocnumber">4</span> <span class="toctext">Inittab</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="./SMF_:_Service_Management_Facility.html#SVCS"><span class="tocnumber">5</span> <span class="toctext">SVCS</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="./SMF_:_Service_Management_Facility.html#svcadm"><span class="tocnumber">5.1</span> <span class="toctext">svcadm</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="./SMF_:_Service_Management_Facility.html#Gestion_d.27un_service_non_SMF"><span class="tocnumber">6</span> <span class="toctext">Gestion d'un service non SMF</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="./SMF_:_Service_Management_Facility.html#Cr.C3.A9er_un_service_g.C3.A9r.C3.A9_par_SMF"><span class="tocnumber">7</span> <span class="toctext">Créer un service géré par SMF</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="./SMF_:_Service_Management_Facility.html#Cr.C3.A9er_un_service_non_g.C3.A9r.C3.A9_par_SMF"><span class="tocnumber">8</span> <span class="toctext">Créer un service non géré par SMF</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="./SMF_:_Service_Management_Facility.html#D.C3.A9finir_le_temps_de_boot_des_milestones"><span class="tocnumber">9</span> <span class="toctext">Définir le temps de boot des milestones</span></a></li>
<li class="toclevel-1 tocsection-11"><a href="./SMF_:_Service_Management_Facility.html#Faq"><span class="tocnumber">10</span> <span class="toctext">Faq</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="./SMF_:_Service_Management_Facility.html#svc.configd:_smf.285.29_database_integrity_check_of_:_.2Fetc.2Fsvc.2Frepository.db"><span class="tocnumber">10.1</span> <span class="toctext">svc.configd: smf(5) database integrity check of&#160;: /etc/svc/repository.db</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="./SMF_:_Service_Management_Facility.html#Ressources"><span class="tocnumber">11</span> <span class="toctext">Ressources</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p>Les SMF sont listés par catégories&#160;:
</p>
<ul><li> application</li>
<li> device</li>
<li> legacy</li>
<li> milestone</li>
<li> network</li>
<li> platform</li>
<li> site</li>
<li> system</li></ul>
<p>Exemple&#160;:
</p>
<pre>svc:/system/filesystem/root:default
</pre>
<ul><li> Le prefix svc indique que c'est un service géré par SMF</li>
<li> La catégorie du service est "system"</li>
<li> Le service lui même est un filesystem</li>
<li> L'instance du service est la racine du file system</li>
<li> Le mot "default" identifie le premier, dans ce cas seulement, c'est une instance du service</li></ul>
<p>Un autre exemple&#160;:
</p>
<pre>lrc:/etc/rc3_d/S90samba
</pre>
<ul><li> Le nom "lrc" indique que le service en cours n'est pas géré par SMF</li>
<li> Le pathname "/etc/rc3_d" se réfère au dossier "/etc/rc3.d" ou le script est utilisé pour etre géré</li>
<li> Le nom du script est S90samba</li></ul>
<p>Pour lister les noms et les états des services&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">$ svcs
STATE          STIME    FMRI
legacy_run     Feb_10   lrc:/etc/rc2_d/S10lu
legacy_run     Feb_10   lrc:/etc/rc2_d/S20sysetup
legacy_run     Feb_10   lrc:/etc/rc2_d/S90wbem
legacy_run     Feb_10   lrc:/etc/rc2_d/S99dtlogin
legacy_run     Feb_10   lrc:/etc/rc3_d/S81volmgt
(output removed)
online         Feb_10   svc:/system/system-log:default
online         Feb_10   svc:/system/fmd:default
online         Feb_10   svc:/system/console-login:default
online         Feb_10   svc:/network/smtp:sendmail
online         Feb_10   svc:/milestone/multi-user:default
online         Feb_10   svc:/milestone/multi-user-server:default
online         Feb_10   svc:/system/zones:default
offline        Feb_10   svc:/application/print/ipp-listener:default
offline        Feb_10   svc:/application/print/rfc1179:default
maintenance   10:24:15 svc:/network/rpc/spray:default</pre></div></div>
</td></tr></table><br />
<p>Voici la liste des différents états possibles&#160;:
</p>
<table border="1" width="100%">
<tr>
<th>Etat
</th>
<th>Description
</th></tr>
<tr>
<td>online
</td>
<td>The service instance is enabled and has successfully started.
</td></tr>
<tr>
<td>offline
</td>
<td>The service instance is enabled, but the service is not yet running or available to run.
</td></tr>
<tr>
<td>disabled
</td>
<td>The service instance is not enabled and is not running.
</td></tr>
<tr>
<td>legacy_run
</td>
<td>The legacy service is not managed by SMF, but the service can be observed. This state is only used by legacy services.
</td></tr>
<tr>
<td>uninitialized
</td>
<td>This state is the initial state for all services before their configuration has been read.
</td></tr>
<tr>
<td>maintenance
</td>
<td>The service instance has encountered an error that must be resolved by the administrator.
</td></tr>
<tr>
<td>degraded
</td>
<td>The service instance is enabled, but is running at a limited capacity.
</td></tr></table>
<h1><span class="mw-headline" id="Gestion_des_Runlevels_et_Milstones"><span class="mw-headline-number">2</span> Gestion des Runlevels et Milstones</span></h1>
<p>Voici les différents types de service&#160;:
</p>
<ul><li> single-user</li>
<li> multi-user</li>
<li> multi-user-server</li>
<li> network</li>
<li> name-services</li>
<li> sysconfig</li>
<li> devices</li></ul>
<p><br />
Voici la relation entre le milstone et les services&#160;:<br />
</p><p><a href="./File:Sun-milstone-1.gif.html" class="image"><img alt="Sun-milstone-1.gif" src="images/0/0a/Sun-milstone-1.gif" width="477" height="236" /></a>
</p><p>Voilà un exemple de relation entre les dépendances&#160;:<br />
</p><p><a href="./File:Sun-milstone-2.gif.html" class="image"><img alt="Sun-milstone-2.gif" src="images/f/f5/Sun-milstone-2.gif" width="448" height="450" /></a>
</p><p>Pour déterminer les milstones en cours&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td>
<p>$ svcs 
</p>
</td></tr></table><br />
<p>Voici les états que le milestone peut prendre&#160;:
</p>
<ul><li> none</li>
<li> single-user</li>
<li> multi-user</li>
<li> multi-user-server</li>
<li> all</li></ul>
<p>Pour choisir sur quel milestone vous voulez démarrez&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>ok&gt; boot -m milestone=single-user
</pre>
</td></tr></table><br />
<p>Rappel&#160;: svc.startd est un démon.
</p><p>La base de donnée listant tous ces services se trouve ici&#160;:
</p>
<pre>/etc/svc/repository.db
</pre>
<p>Cette base de donnée est gérée par le service svc.configd.
</p><p>Si il y a une erreur à ce niveau, votre machine ne bootera pas. Pour réparer ceci, mettez vous en mode single user et exécutez cette commande&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>/lib/svc/bin/restore_repository
</pre>
</td></tr></table><br />
<p>Voici une liste des milestones et runlevels&#160;:
</p>
<table border="1" width="100%">
<tr>
<th>Run Level
</th>
<th>Milestone
</th>
<th>Description
</th></tr>
<tr>
<td>0
</td>
<td>
</td>
<td>System is running the PROM monitor.
</td></tr>
<tr>
<td>s or S
</td>
<td>single-user
</td>
<td>Solaris OS single-user mode with critical file systems mounted and accessible.
</td></tr>
<tr>
<td>1
</td>
<td>
</td>
<td>The system is running in a single-user administrative state with access to all available file systems.
</td></tr>
<tr>
<td>2
</td>
<td>multi-user
</td>
<td>The system is supporting multiuser operations. Multiple users can access the system. All system daemons are running except for the Network File System (NFS) server and some other network resource server related daemons.
</td></tr>
<tr>
<td>3
</td>
<td>multi-user-server
</td>
<td>The system is supporting multiuser operations and has NFS resource sharing and other network resource servers available.
</td></tr>
<tr>
<td>4
</td>
<td>
</td>
<td>This level is currently not implemented.
</td></tr>
<tr>
<td>5
</td>
<td>
</td>
<td>A transitional run level in which the Solaris OS is shut down and the system is powered off.
</td></tr>
<tr>
<td>6
</td>
<td>
</td>
<td>A transitional run level in which the Solaris OS is shut down and the system reboots to the default run level.
</td></tr></table>
<p>Pour savoir dans quel runlevel vous vous trouvez, utilisez cette commande&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> who</font>
</td></tr>
<tr>
<td>
<pre>who -r
</pre>
</td></tr></table><br />
<p>Toujours au niveau des Runlevels, vous pouvez trouver dans /etc/ ou /sbin les différents runlevels&#160;:<br />
</p>
<ul><li> rc0</li>
<li> rc1</li>
<li> rc2</li>
<li> rc3</li>
<li> rc4</li>
<li> rc5</li>
<li> rc6</li>
<li> rcS</li></ul>
<p>Lorsque vous regardez dans un de ces dossiers, vous pouvez voir les processus de boot et de stop. Pour les distinguer&#160;:<br />
</p>
<ul><li> K pour Kill</li>
<li> S pour Start</li></ul>
<p>Pour connaitre le processus en cours par rapport au démon&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>$ ls -i S90samba
4715 samba
</pre>
</td></tr></table><br />
<h1><span class="mw-headline" id="Le_boot"><span class="mw-headline-number">3</span> Le boot</span></h1>
<p>Si vous avez tout bien suivit, vous devirez comprendre que l'ordre de boot ressemble à cela&#160;:
</p>
<ul><li> Phase de boot PROM</li>
<li> Phase de progamme de boot</li>
<li> Phase d'initialization du kernel</li>
<li> Phase d'init</li>
<li> Phase de svc.startd</li></ul>
<p><a href="./File:Sun-initd.gif.html" class="image"><img alt="Sun-initd.gif" src="images/5/5f/Sun-initd.gif" width="400" height="437" /></a>
</p><p>Durant la phase de boot, le kernel lit son fichier de configuration "/etc/system", puis charge les modules. Il utilise la commande "ufsboot" pour charger les fichiers.
</p><p>Ensuite il charge le démon /etc/init.
</p><p>Voici ce que l'on peut trouver dans le fichier /etc/system&#160;:
</p>
<ul><li> moddir</li></ul>
<p>Recherche les éventuels modules à charger
</p>
<ul><li> root device and root file system configuration</li></ul>
<p>Par défaut&#160;: rootfs:ufs<br />
Ceci est pour le Système de fichier racine. Ex&#160;:
</p>
<pre>rootdev:/sbus@1,f8000000/esp@0,800000/sd@3,0:a
</pre>
<ul><li> exclude</li></ul>
<p>Ne va pas charger les modules listés. Ex&#160;:
</p>
<pre>exclude: sys/shmsys
</pre>
<ul><li> forceload</li></ul>
<p>Oblige à charger certains modules. Ex&#160;:
</p>
<pre>forceload: drv/vx
</pre>
<ul><li> set</li></ul>
<p>Change les paramètres du kernel pour modifier des opérations système. Ex&#160;:
</p>
<pre>set maxusers=40
</pre>
<p>Faites une copie du fichier /etc/system avant de sauvegarder les modifications. Si le fichier est erroné, vous ne pourrez pas booter. Si vous avez un problème avec le fichier modifié, voici la solution pour réparer&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">$ ok boot -a
Enter filename [kernel/sparcv9/unix]: 
Enter default directory for modules [/platform...]: 
Name of system file [etc/system]: etc/system.orig - or - /dev/null
root filesystem type [ufs]: 
Enter physical name of root device [/...]: 
(further boot messages omitted)</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Inittab"><span class="mw-headline-number">4</span> Inittab</span></h1>
<p>Chaque ligne de ce fichier ressemblent à ceci&#160;:
</p>
<pre>id:rstate:action:process
</pre>
<p>Voilà les champs&#160;:
</p>
<table border="1" width="100%">
<tr>
<th>Champs
</th>
<th>Descriptions
</th></tr>
<tr>
<td>id
</td>
<td>Two character identifier for the entry
</td></tr>
<tr>
<td>rstate
</td>
<td>Run levels to which this entry applies
</td></tr>
<tr>
<td>action
</td>
<td>Defines how the process listed should be run<br />For a description of the action keywords see man inittab
</td></tr>
<tr>
<td>process
</td>
<td>Defines the command to execute
</td></tr></table>
<p>Par défaut, voici ce que l'on trouve dans le fichier inittab&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> inittab</font>
</td></tr>
<tr>
<td>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">ap::sysinit:/sbin/autopush -f /etc/iu.ap
sp::sysinit:/sbin/soconfig -f /etc/sock2path
smf::sysinit:/lib/svc/bin/svc.startd	&gt;/dev/msglog 2&lt;&gt;/dev/msglog &lt;/dev/console
p3:s1234:powerfail:/usr/sbin/shutdown -y -i5 -g0 &gt;/dev/msglog 2&lt;&gt;/dev/msglog</pre></div></div>
</td></tr></table><br />
<p>Dans les actions possibles, nous avons&#160;:
</p>
<ul><li> sysinit</li></ul>
<p>Executes the process before the init process tries to access the console (for example, the console login prompt). The init process waits for completion of the process before it continues to read the inittab file.
</p>
<ul><li> powerfail</li></ul>
<p>Executes the process only if the init process receives a power fail signal.
</p><p>Le démon svc.startd est le remplacant d'init. Pour voir la configuration actuelle&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>/var/svc/manifest
</pre>
</td></tr></table><br />
<p>Si vous souhaitez voir les fichiers milestones pour les éditer&#160;:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">single-user.xml
multi-user.xml
multi-user-server.xml
network.xml
name-services.xml
sysconfig.xml
/sbin/rc2
/lib/svc/method/fs-local</pre></div></div>
<h1><span class="mw-headline" id="SVCS"><span class="mw-headline-number">5</span> SVCS</span></h1>
<p>Voici la commande pour monitorer les services SMF&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">$ svcs
STATE          STIME    FMRI
legacy_run     13:45:11 lrc:/etc/rcS_d/S29wrsmcfg
legacy_run     13:45:37 lrc:/etc/rc2_d/S10lu
legacy_run     13:45:38 lrc:/etc/rc2_d/S20sysetup
legacy_run     13:45:38 lrc:/etc/rc2_d/S40llc2
legacy_run     13:45:38 lrc:/etc/rc2_d/S42ncakmod
legacy_run     13:45:39 lrc:/etc/rc2_d/S47pppd
(output omitted)
online         13:45:36 svc:/network/smtp:sendmail
online         13:45:38 svc:/network/ssh:default
online         13:45:38 svc:/system/fmd:default
online         13:45:38 svc:/application/print/server:default
online         13:45:39 svc:/application/print/rfc1179:default
online         13:45:41 svc:/application/print/ipp-listener:default
online         13:45:45 svc:/milestone/multi-user:default
online         13:45:53 svc:/milestone/multi-user-server:default
online         13:45:54 svc:/system/zones:default
online          8:46:25 svc:/system/filesystem/local:default
online          8:46:26 svc:/network/inetd:default
online          8:46:32 svc:/network/rpc/meta:tcp
online          8:46:32 svc:/system/mdmonitor:default
online          8:46:38 svc:/milestone/multi-user:default
online         13:14:35 svc:/network/telnet:default
maintenance     8:46:21 svc:/network/rpc/keyserv:default</pre></div></div>
</td></tr></table><br />
<p>Pour vérifier l'état d'un service&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td>
<pre>$ svcs svc:/system/console-login:default

STATE          STIME    FMRI
online         14:38:27 svc:/system/console-login:default
</pre>
</td></tr></table><br />
<p>Pour voir les dépendances d'un service&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td>
<pre>svcs -d svc:/system/filesystem/local:default

STATE          STIME    FMRI
online         14:38:15 svc:/system/filesystem/minimal:default
online         14:38:26 svc:/milestone/single-user:default
</pre>
</td></tr></table><br />
<p>Ceci montre ce dont un service à besoin (dépendances)&#160;:<br />
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">$ svcs -d milestone/multi-user:default
STATE          STIME    FMRI
online         13:44:53 svc:/milestone/name-services:default
online         13:45:12 svc:/milestone/single-user:default
online         13:45:13 svc:/system/filesystem/local:default
online         13:45:15 svc:/network/rpc/bind:default
online         13:45:16 svc:/milestone/sysconfig:default
online         13:45:17 svc:/system/utmp:default
online         13:45:19 svc:/network/inetd:default
online         13:45:31 svc:/network/nfs/client:default
online         13:45:34 svc:/system/system-log:default
online         13:45:36 svc:/network/smtp:sendmail</pre></div></div>
</td></tr></table><br />
<p>On peut voir ici les autres services qui dépendent de /system/filesystem/local&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">$ svcs -D svc:/system/filesystem/local
STATE          STIME    FMRI
disabled       14:38:00 svc:/network/inetd-upgrade:default
disabled       14:38:07 svc:/network/nfs/server:default
online         14:38:30 svc:/network/inetd:default
online         14:38:30 svc:/network/smtp:sendmail
online         14:38:30 svc:/system/cron:default
online         14:38:30 svc:/system/sac:default
online         14:38:45 svc:/system/filesystem/autofs:default
online         14:38:47 svc:/system/dumpadm:default
online         14:38:51 svc:/milestone/multi-user:default</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="svcadm"><span class="mw-headline-number">5.1</span> svcadm</span></h3>
<p>Cette commande sert à changer l'état d'un service&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ps</font>
</td></tr>
<tr>
<td>
<pre>$ ps -ef 
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td>
<pre>$ svcs cron
</pre>
<pre>STATE          STIME    FMRI
online         14:38:30 svc:/system/cron:default
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcadm</font>
</td></tr>
<tr>
<td>
<pre>$ svcadm -v disable system/cron:default 
system/cron:default disabled.
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td>
<pre>svcs cron
STATE          STIME    FMRI
disabled       20:35:25 svc:/system/cron:default
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ps</font>
</td></tr>
<tr>
<td>
<pre>ps -ef 
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcadm</font>
</td></tr>
<tr>
<td>
<pre>$ svcadm -v enable system/cron:default
system/cron:default enabled.
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td>
<pre>$ svcs cron
STATE          STIME    FMRI
online         20:35:59 svc:/system/cron:default
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ps</font>
</td></tr>
<tr>
<td>
<pre>$ ps -ef 
</pre>
</td></tr></table><br />
<p>Pour désactiver le service cron&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcadm</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">svcadm -v disable -t system/cron:default
svc:/system/cron:default temporarily disabled.</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Gestion_d.27un_service_non_SMF"><span class="mw-headline-number">6</span> Gestion d'un service non SMF</span></h1>
<p>init.d est là&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td>
<pre>$ svcs 
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ps</font>
</td></tr>
<tr>
<td>
<pre>$ ps -ef 
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>ls /etc/init.d/volmgt
/etc/init.d/volmgt
/etc/init.d/volmgt stop
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>$ ps -ef 
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>$ /etc/init.d/volmgt start
volume management starting.
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>$ ps -ef 
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td>
<pre>svcs 
</pre>
</td></tr></table><br />
<h1><span class="mw-headline" id="Cr.C3.A9er_un_service_g.C3.A9r.C3.A9_par_SMF"><span class="mw-headline-number">7</span> Créer un service géré par SMF</span></h1>
<p>Cette procédure peut être un peu complexe pour les personnes non initiés. Voici l'ordre chronologique à suivre&#160;:<br />
</p>
<ul><li> Determiner quels milestones et run levels ce service doit être disponible et la commande appropriée pour démarrer et arréter le service.</li>
<li> Establire chaque relations entre les dépendances, le service et les autres services.</li>
<li> Créer un script dans /lib/svc/method pour démarrer le process si nécessaire.</li>
<li> créer un fichier .xml dans le sous dossier approprié.</li>
<li> Faire une copie du "Service Repository Database".</li>
<li> Intégrer ce script dans SMF en utilisant l'utilitaire svccfg.</li></ul>
<p>Créer le fichier /lib/svc/method/<b>newservice</b>&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /lib/svc/method/newservice</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">#!/sbin/sh
#
# Copyright 2004 Sun Microsystems, Inc.  All rights reserved.
# Use is subject to license terms.
#
# ident &quot;@(#)newservice 1.14    04/08/30 SMI&quot;
&#160;
case &quot;&quot; in
'start')
        /usr/bin/newservice &amp;
;;
&#160;
'stop')
	/usr/bin/pkill -x -u 0 newservice
       &#160;;;
*)
        echo &quot;Usage: PAGECONTENT { start | stop }&quot;
       &#160;;;
esac
exit 0</pre></div></div>
</td></tr></table><br />
<p>Mettons les droits&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> chmod</font>
</td></tr>
<tr>
<td>
<pre>chmod 744 /lib/svc/method/newservice
</pre>
</td></tr></table><br />
<p>Puis créez le fichier /var/svc/manifest/site/newservice.xml&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/svc/manifest/site/newservice.xml</font>
</td></tr>
<tr>
<td>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE service_bundle SYSTEM &quot;/usr/share/lib/xml/dtd/service_bundle.dtd.1&quot;&gt;
&lt;!--
        Copyright 2004 Sun Microsystems, Inc.  All rights reserved.
        Use is subject to license terms.
&#160;
        ident   &quot;@(#)newservice.xml     1.2     04/09/13 SMI&quot;
--&gt;
&#160;
&lt;service_bundle type='manifest' name='OPTnew:newservice'&gt;
&#160;
&lt;service
        name='site/newservice'
        type='service'
        version='1'&gt;
&#160;
        &lt;single_instance/&gt;
&#160;
        &lt;exec_method
                type='method'
                name='start'
                exec='/lib/svc/method/newservice start'
                timeout_seconds='30' /&gt;
&#160;
        &lt;exec_method
                type='method'
                name='stop'
                exec='/lib/svc/method/newservice stop'
                timeout_seconds='30' /&gt;
&#160;
        &lt;property_group name='startd' type='framework'&gt;
                &lt;propval name='duration' type='astring' value='transient' /&gt;
        &lt;/property_group&gt;
&#160;
        &lt;instance name='default' enabled='true' /&gt;
&#160;
        &lt;stability value='Unstable' /&gt;
&#160;
        &lt;template&gt;
                &lt;common_name&gt;
                        &lt;loctext xml:lang='C'&gt;
                                New service
                        &lt;/loctext&gt;
                &lt;/common_name&gt;
        &lt;/template&gt;
&lt;/service&gt;
&#160;
&lt;/service_bundle&gt;</pre></div></div>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>cd /var/svc/manifest/milestone
cp multi-user.xml /var/tmp
vi multi-user.xml
</pre>
</td></tr></table><br />
<p>Voici un exemple du contenu&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> multi-user.xml</font>
</td></tr>
<tr>
<td>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">	&lt;dependency
                name='fs'
                grouping='require_all'
                restart_on='none'
                type='service'&gt;
                &lt;service_fmri value='svc:/system/filesystem/local' /&gt;
        &lt;/dependency&gt;
&#160;
        &lt;dependency
                name='newservice'
                grouping='require_all'
                restart_on='none'
                type='service'&gt;
                &lt;service_fmri value='svc:/site/newservice' /&gt;
        &lt;/dependency&gt;</pre></div></div>
</td></tr></table><br />
<p>Le nouveau service doit être importer dans SMF&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svccfg</font>
</td></tr>
<tr>
<td>
<pre>svccfg import /var/svc/manifest/site/newservice.xml
</pre>
</td></tr></table><br />
<p>A présent, il doit être visible&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td>
<pre>$ svcs newservice
STATE          STIME    FMRI
online          8:43:45 svc:/site/newservice:default
</pre>
</td></tr></table><br />
<p>Il doit être également possible de manipuler le service en utilisant&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcadm</font>
</td></tr>
<tr>
<td>
<pre>$ svcadm -v disable site/newservice

site/newservice disabled.
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td>
<pre>$ svcs newservice

STATE          STIME    FMRI
disabled        9:11:38 svc:/site/newservice:default
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcadm</font>
</td></tr>
<tr>
<td>
<pre>svcadm -v enable site/newservice

site/newservice enabled.
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td>
<pre>svcs newservice

STATE          STIME    FMRI
online          9:11:54 svc:/site/newservice:default
</pre>
</td></tr></table><br />
<p>On peut voir que le milestone multiuser pour notre nouveau service est nécessaire pour en finir&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcs</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">$ svcs -d milestone/multi-user:default
STATE          STIME    FMRI
disabled        8:43:16 svc:/platform/sun4u/sf880drd:default
online          8:43:16 svc:/milestone/name-services:default
online          8:43:33 svc:/system/rmtmpfiles:default
online          8:43:42 svc:/network/rpc/bind:default
online          8:43:46 svc:/milestone/single-user:default
online          8:43:46 svc:/system/utmp:default
online          8:43:47 svc:/system/system-log:default
online          8:43:47 svc:/system/system-log:default
online          8:43:49 svc:/system/filesystem/local:default
online          8:44:01 svc:/system/mdmonitor:default
online          9:11:54 svc:/site/newservice:default</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Cr.C3.A9er_un_service_non_g.C3.A9r.C3.A9_par_SMF"><span class="mw-headline-number">8</span> Créer un service non géré par SMF</span></h1>
<ul><li> Tout d'abord, nous allons créer notre script dans l'init.d&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>vi /etc/init.d/filename
</pre>
</td></tr></table><br />
<p>Voir plus haut pour le contenu, puis&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>chmod 744 /etc/init.d/filename
chgrp sys /etc/init.d/filename
</pre>
</td></tr></table><br />
<ul><li> Nous allons maintenant créer les bons liens (le faire pour chaque runlevels voulu)&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>cd /etc/init.d
ln filename /etc/rc#.d/S##filename
ln filename /etc/rc#.d/K##filename
</pre>
</td></tr></table><br />
<ul><li> Vérifions&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>ls -li /etc/init.d/filename
ls -li /etc/rc#.d/S##filename
ls -li /etc/rc#.d/K##filename
</pre>
</td></tr></table><br />
<ul><li> Maintenant testons&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>/etc/init.d/filename start
</pre>
</td></tr></table><br />
<h1><span class="mw-headline" id="D.C3.A9finir_le_temps_de_boot_des_milestones"><span class="mw-headline-number">9</span> Définir le temps de boot des milestones</span></h1>
<p>Voici un exemple&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> svcadm</font>
</td></tr>
<tr>
<td>
<pre>svcadm -v milestone -d multi-user-server:default
</pre>
</td></tr></table><br />
<p>Ainsi que les options dispo&#160;:
</p>
<ul><li> all</li>
<li> none</li>
<li> svc:/milestone/single-user:default</li>
<li> svc:/milestone/multi-user:default</li>
<li> svc:/milestone/multi-user-server:default</li></ul>
<p>Pensez également à faire une copie de la base de donnée des milestones&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>pstop svc.startd
pkill svc.configd
cp /etc/svc/repository.db /etc/svc/safe_repository.db
cp /lib/svc/seed/global.db /etc/svc/repository.db
init 0
ok boot -m verbose
</pre>
</td></tr></table><br />
<h1><span class="mw-headline" id="Faq"><span class="mw-headline-number">10</span> Faq</span></h1>
<h2><span class="mw-headline" id="svc.configd:_smf.285.29_database_integrity_check_of_:_.2Fetc.2Fsvc.2Frepository.db"><span class="mw-headline-number">10.1</span> svc.configd: smf(5) database integrity check of&#160;: /etc/svc/repository.db</span></h2>
<p>Je me suis tapé un message pareil après un reboot, merci UFS. Le message en entier était&#160;:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">svc.configd: smf(5) database integrity check of:
&#160;
    /etc/svc/repository.db
&#160;
  failed.  The database might be damaged or a media error might have
  prevented it from being verified.  Additional information useful to
  your service provider is in:
&#160;
    /etc/svc/volatile/db_errors
&#160;
  The system will not be able to boot until you have restored a working
  database.  svc.startd(1M) will provide a sulogin(1M) prompt for recovery
  purposes.  The command:
&#160;
    /lib/svc/bin/restore_repository
&#160;
  can be run to restore a backup version of your repository.  See
  http://sun.com/msg/SMF-8000-MY for more information.</pre></div></div>
<p>Pour résoudre ce problème, il faut&#160;:
</p>
<ul><li> Rebooter en mode failsafe (grub)</li>
<li> Corriger tous les problèmes de fragmentation du filesystem (wizzard)</li>
<li> Monter en lecture et écriture dans le /a votre partition root (wizzard)</li>
<li> Chrooter la partition /a&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> chroot</font>
</td></tr>
<tr>
<td>
<pre>chroot /a /a/bin/bash
</pre>
</td></tr></table><br />
<ul><li> Lancer la commande /lib/svc/bin/restore_repository et lui dire de réparer le /boot&#160;:</li></ul>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">The following backups of /etc/svc/repository.db exists, from
oldest to newest:
&#160;
... list of backups ...
&#160;
The backups are named based on their type and the time when they were taken.
Backups beginning with &quot;boot&quot; are made before the first change is made to
the repository after system boot.  Backups beginning with &quot;manifest_import&quot;
are made after svc:/system/manifest-import:default finishes its processing.
The time of backup is given in YYYYMMDD_HHMMSS format.
&#160;
Please enter one of:
        1) boot, for the most recent post-boot backup
        2) manifest_import, for the most recent manifest_import backup.
        3) a specific backup repository from the above list
        4) -seed-, the initial starting repository.  (All customizations
           will be lost.)
        5) -quit-, to cancel.
&#160;
Enter response [boot]:</pre></div></div>
<p>Il n'y a qu'a faire entrée ici. Et valider en tapant yes&#160;:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">After confirmation, the following steps will be taken:
&#160;
svc.startd(1M) and svc.configd(1M) will be quiesced, if running.
/etc/svc/repository.db
    -- renamed --&gt; /etc/svc/repository.db_old_YYYYMMDD_HHMMSS
/etc/svc/volatile/db_errors
    -- copied --&gt; /etc/svc/repository.db_old_YYYYMMDD_HHMMSS_errors
repository_to_restore
    -- copied --&gt; /etc/svc/repository.db
and the system will be rebooted with reboot(1M).
&#160;
Proceed [yes/no]? yes</pre></div></div>
<h1><span class="mw-headline" id="Ressources"><span class="mw-headline-number">11</span> Ressources</span></h1>
<p><a rel="nofollow" class="external text" href="http://www.c0t0d0s0.org/archives/4149-Solaris-Features-Service-Management-Facility.html">Solaris Features: Service Management Facility</a><br />
<a href="./File:Using_Service_Management_Facility_(SMF).pdf.html" title="File:Using Service Management Facility (SMF).pdf">Using Service Management Facility (SMF)</a>
</p>
<!-- 
NewPP limit report
CPU time usage: 0.104 seconds
Real time usage: 0.104 seconds
Preprocessor visited node count: 680/1000000
Preprocessor generated node count: 2104/1000000
Post‐expand include size: 10041/2097152 bytes
Template argument size: 3115/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   19.497      1 - -total
 54.03%   10.534     46 - Template:Command
 14.40%    2.807      4 - Template:Config
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:1744-0!*!*!1!en!5!* and timestamp 20181111230613 and revision id 8706
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=SMF_:_Service_Management_Facility&amp;oldid=8706">https://wiki.deimos.fr/index.php?title=SMF_:_Service_Management_Facility&amp;oldid=8706</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=SMF+%3A+Service+Management+Facility" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="./SMF_:_Service_Management_Facility.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="./SMF_:_Service_Management_Facility.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="./SMF_:_Service_Management_Facility.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=SMF_:_Service_Management_Facility&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=SMF_:_Service_Management_Facility&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="./SMF_:_Service_Management_Facility.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/SMF_:_Service_Management_Facility.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/SMF_:_Service_Management_Facility" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=SMF_:_Service_Management_Facility&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=SMF_:_Service_Management_Facility&amp;oldid=8706" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=SMF_:_Service_Management_Facility&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 3 February 2010, at 21:43.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":36});
}</script>
	</body>
</html>
	
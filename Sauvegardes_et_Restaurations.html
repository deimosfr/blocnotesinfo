<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>Sauvegardes et Restaurations - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="Sauvegardes_et_Restaurations.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Sauvegardes_et_Restaurations","wgTitle":"Sauvegardes et Restaurations","wgCurRevisionId":5803,"wgRevisionId":5803,"wgArticleId":1754,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Sauvegardes_et_Restaurations","wgRelevantArticleId":1754,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Sauvegardes_et_Restaurations skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Sauvegardes et Restaurations</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="Sauvegardes_et_Restaurations.html#mw-navigation">navigation</a>, 					<a href="Sauvegardes_et_Restaurations.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Sauvegardes_et_Restaurations.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Sauvegardes_et_Restaurations.html#rmt_device"><span class="tocnumber">2</span> <span class="toctext">rmt device</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="Sauvegardes_et_Restaurations.html#mt"><span class="tocnumber">3</span> <span class="toctext">mt</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="Sauvegardes_et_Restaurations.html#Using_the_mt_Command"><span class="tocnumber">3.1</span> <span class="toctext">Using the mt Command</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="Sauvegardes_et_Restaurations.html#Identifying_Incremental_and_Full_Backups"><span class="tocnumber">4</span> <span class="toctext">Identifying Incremental and Full Backups</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="Sauvegardes_et_Restaurations.html#Backing_Up_an_Unmounted_File_System"><span class="tocnumber">5</span> <span class="toctext">Backing Up an Unmounted File System</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="Sauvegardes_et_Restaurations.html#Using_the_ufsdump_Command"><span class="tocnumber">5.1</span> <span class="toctext">Using the ufsdump Command</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="Sauvegardes_et_Restaurations.html#Restoring"><span class="tocnumber">6</span> <span class="toctext">Restoring</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="Sauvegardes_et_Restaurations.html#ufsrestore"><span class="tocnumber">6.1</span> <span class="toctext">ufsrestore</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="Sauvegardes_et_Restaurations.html#Restoring_a_ufs_File_System"><span class="tocnumber">7</span> <span class="toctext">Restoring a ufs File System</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="Sauvegardes_et_Restaurations.html#Alternative_Steps"><span class="tocnumber">7.1</span> <span class="toctext">Alternative Steps</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="Sauvegardes_et_Restaurations.html#Creating_a_UFS_Snapshot"><span class="tocnumber">8</span> <span class="toctext">Creating a UFS Snapshot</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="Sauvegardes_et_Restaurations.html#tar"><span class="tocnumber">8.1</span> <span class="toctext">tar</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="Sauvegardes_et_Restaurations.html#Incrementals_restores"><span class="tocnumber">8.2</span> <span class="toctext">Incrementals restores</span></a></li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p>A crucial function of system administration is to backup file systems. Backups safeguard against data loss, damage, or corruption. Backup tapes are often referred to as dump tapes.
</p>
<h1><span class="mw-headline" id="rmt_device"><span class="mw-headline-number">2</span> rmt device</span></h1>
<p>All tape drives have logical device names that you use to reference the device on the command line. The image shows the format that all logical device names use.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>/dev/rmt/#hn
</pre>
</td></tr></table><br />
<ul><li> #&#160;: Logical Tape number</li>
<li> h&#160;: Tape density (l,m,h,c,u)</li>
<li> No rewind</li></ul>
<p>The logical tape numbers in the tape drive names always start with 0. For example:
</p>
<ul><li> The first instance of a tape drive:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>/dev/rmt/0
</pre>
</td></tr></table><br />
<ul><li> The second instance of a tape drive:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>/dev/rmt/1
</pre>
</td></tr></table><br />
<ul><li> The third instance of a tape drive:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>/dev/rmt/2
</pre>
</td></tr></table><br />
<p>Two optional parameters further define the logical device name:
</p>
<ul><li> Tape density - Five values can be given in the tape device name: l (low), m (medium), h (high), c (compressed), or u (ultra compressed).</li>
<li> No rewind - The letter n at the end of a tape device name indicates that the tape should not be rewound when the current operation completes.</li></ul>
<p>Tape densities depend on the tape drive. Check the manufacturer's documentation to determine the correct densities for the tape media.
</p><p>Tape drives that support data compression contain internal hardware that performs the compression. If you back up a software-compressed file to a tape drive with hardware compression, the resulting file may be larger in size.
</p>
<h1><span class="mw-headline" id="mt"><span class="mw-headline-number">3</span> mt</span></h1>
<p>You use the mt command (magnetic tape control) to send instructions to the tape drive. Not all tape drives support all mt commands.
</p><p>The format for the mt command is:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mt</font>
</td></tr>
<tr>
<td>
<pre>mt -f tape-device-name command count
</pre>
</td></tr></table><br />
<p>You use the -f option to specify the tape device name, typically a no-rewind device name. If no -f option is used, the default tape device file /dev/rmt/0 is used.
</p>
<h2><span class="mw-headline" id="Using_the_mt_Command"><span class="mw-headline-number">3.1</span> Using the mt Command</span></h2>
<p>The table lists some of the mt commands that you can use to control a magnetic tape drive.
</p>
<table border="1" width="100%">
<tr>
<th>Command
</th>
<th>Definition
</th></tr>
<tr>
<td>mt status
</td>
<td>Displays status information about the tape drive
</td></tr>
<tr>
<td>mt rewind
</td>
<td>Rewinds the tape
</td></tr>
<tr>
<td>mt offline
</td>
<td>Rewinds the tape and, if appropriate, takes the drive unit offline and if the hardware supports it, unloads
</td></tr>
<tr>
<td>mt fsf count
</td>
<td>Moves the tape forward count records
</td></tr></table>
<p>Assuming the tape was rewound to the start of tape, the following command positions the tape at the beginning of the third tape record.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mt</font>
</td></tr>
<tr>
<td>
<pre>mt -f /dev/rmt/0n fsf 2
</pre>
</td></tr></table><br />
<p>The most common method to schedule backups is to perform cumulative incremental backups daily. This schedule is recommended for most situations.
</p><p>To set up a backup schedule, determine:
</p>
<ul><li> The file systems to back up</li>
<li> A backup device (for example, tape drive)</li>
<li> The number of tapes to use for the backup</li>
<li> The type of backup (for example, full or incremental)</li>
<li> The procedures for marking and storing tapes</li>
<li> The time it takes to perform a backup</li></ul>
<p>Determining File System Names to Back Up
</p><p>Display the contents of the /etc/vfstab file. Then view the mount point column to find the name of the file system that you want to back up.
Determining the Number of Tapes
</p><p>You determine the number of tapes for a backup according to the size of the file system you are backing up.
</p><p>To determine the size of the file system, use the ufsdump command with the S option. The following are the command formats:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsdump</font>
</td></tr>
<tr>
<td>
<pre># ufsdump 0S filesystem_name
&lt;number reported&gt;
</pre>
</td></tr></table><br />
<p>or
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsdump</font>
</td></tr>
<tr>
<td>
<pre># ufsdump 3S filesystem_name
&lt;number reported&gt;
</pre>
</td></tr></table><br />
<p>The numeric option determines the appropriate dump level. The output is the estimated number of bytes that the system requires for a complete backup.
</p><p>Divide the reported bytes by the capacity of the tape to determine how many tapes you need to backup the file system.
Determining Back Up Frequency and Levels
</p><p>You determine how often and at what level to backup each file system. The level of a backup refers to the amount of information that is backed up.
</p>
<h1><span class="mw-headline" id="Identifying_Incremental_and_Full_Backups"><span class="mw-headline-number">4</span> Identifying Incremental and Full Backups</span></h1>
<p>You can perform a full backup or an incremental backup of a file system. A full backup is a complete file system backup. An incremental backup copies only files in the file system that have been added or modified since a previous lower-level backup.
</p><p>You use dump level 0 to perform a full backup. You use dump levels 1 through 9 to schedule incremental backups. The level numbers have no meaning other than their relationship to each other as a higher or lower number.
</p><p>The Explore shows an example of a file system backup performed in incremental levels.
</p><p>The table defines the elements of the sample incremental backup strategy shown in The image.
</p>
<table border="1" width="100%">
<tr>
<th>Level
</th>
<th>Example
</th></tr>
<tr>
<td>0 (Full)
</td>
<td>Performed once each month.
</td></tr>
<tr>
<td>3
</td>
<td>Performed every Monday. The backup copies new or modified files since the last lower-level backup (for example, 0).
</td></tr>
<tr>
<td>4
</td>
<td>Performed every Tuesday. The backup copies new or modified files since the last lower-level backup (for example, 3).
</td></tr>
<tr>
<td>5
</td>
<td>Performed every Wednesday. The backup copies new or modified files since the last lower-level backup (for example, 4).
</td></tr>
<tr>
<td>6
</td>
<td>Performed every Thursday. The backup copies new or modified files since the last lower-level backup (for example, 5).
</td></tr>
<tr>
<td>2
</td>
<td>Performed every Friday. The backup copies new or modified files since the last lower-level backup, which is the Level 0 backup at the beginning of the month.
</td></tr></table>
<p><i>Note:</i> Many system administrators use the crontab utility to start a script that runs the ufsdump command.
</p><p>The /etc/dumpdates file records backups if the -u option is used with the ufsdump command. Each line in the /etc/dumpdates file shows the file system that was backed up and the level of the last backup. It also shows the day, the date, and the time of the backup.
</p><p>The following is an example /etc/dumpdates file:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># cat /etc/dumpdates
/dev/rdsk/c0t2d0s6  0 Fri Nov 5  19:12:27  2004
/dev/rdsk/c0t2d0s0  0 Fri Nov 5  20:44:02  2004
/dev/rdsk/c0t0d0s7  0 Tue Nov 9  09:58:26  2004
/dev/rdsk/c0t0d0s7  1 Tue Nov 9  16:25:28  2004</pre></div></div>
</td></tr></table><br />
<p>When an incremental backup is performed, the ufsdump command consults the /etc/dumpdates file. It looks for the date of the next lower-level backup. Then, the ufsdump command copies to the backup media all of the files that were modified or added since the date of that lower-level backup.
</p><p>When the backup is complete, the /etc/dumpdates file records a new entry that describes this backup. The new entry replaces the entry for the previous backup at that level.
</p><p>You can view the /etc/dumpdates file to determine if the system is completing backups. If a backup does not complete because of equipment failure, the /etc/dumpdates file does not record the backup.
</p><p>Note: When you are restoring an entire file system, check the /etc/dumpdates file for a list of the most recent dates and levels of backups. Use this list to determine which tapes are needed to restore the entire file system. The tapes should be physically marked with the dump level and date of the backup.
</p><p>Check that the file system is inactive, or unmounted, before you back the system up. If the file system is active, the output of the backup can be inconsistent, and you could find it impossible to restore some of the files correctly.
</p>
<h1><span class="mw-headline" id="Backing_Up_an_Unmounted_File_System"><span class="mw-headline-number">5</span> Backing Up an Unmounted File System</span></h1>
<p>The standard Solaris OS command for ufs file system backups is /usr/sbin/ufsdump.
</p><p>The format for the ufsdump command is:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsdump</font>
</td></tr>
<tr>
<td>
<pre>ufsdump option(s) argument(s) filesystem_name
</pre>
</td></tr></table><br />
<p>You can use this command to back up a complete or a partial file system. Backups are often referred to as dumps.
</p><p>The table defines several common options for the ufsdump command.
</p>
<table border="1" width="100%">
<tr>
<th>Option
</th>
<th>Description
</th></tr>
<tr>
<td>0-9
</td>
<td>Back up level. Level 0 is a full backup of the file system. Levels 1 through 9 are incremental backups of files that have changed since the last lower-level backup. When no backup level is given, the default is level 9.
</td></tr>
<tr>
<td>v
</td>
<td>Verify. After each tape is written, the system verifies the contents of the media against the source file system. If any discrepancies occur, the system prompts the operator to insert new media and repeat the process. Use this option only on an unmounted file system. Any activity in the file system causes the system to report discrepancies.
</td></tr>
<tr>
<td>S
</td>
<td>Size estimate. This option allows you to estimate the amount of space that will be needed on the tape to perform the level of backup you want.
</td></tr>
<tr>
<td>l
</td>
<td>Autoload. You use this option with an autoloading (stackloader) tape drive.
</td></tr>
<tr>
<td>o
</td>
<td>Offline. When the backup is complete, the system takes the drive offline, rewinds the tape (if you use a tape), and, if possible, ejects the media.
</td></tr>
<tr>
<td>u
</td>
<td>Update. The system creates an entry in the /etc/dumpdates file with the device name for the file system disk slice, the backup level (0-9), and the date. If an entry already exists for a backup at the same level, the system replaces the entry.
</td></tr>
<tr>
<td>n
</td>
<td>Notify. The system sends messages to the terminals of all logged-in users who are members of the sys group to indicate that the ufsdump command requires attention.
</td></tr>
<tr>
<td>f device
</td>
<td>Specify. The system specifies the device name of the file system backup. When you use the default tape device, /dev/rmt/0, you do not need the -f option. The system assumes the default.
</td></tr></table>
<p>You use the ufsdump command to create file system backups to tape. The dump level (0-9) specified in the ufsdump command determines which files to back up.
</p>
<h2><span class="mw-headline" id="Using_the_ufsdump_Command"><span class="mw-headline-number">5.1</span> Using the ufsdump Command</span></h2>
<p>Perform the following steps to use the ufsdump command to start a tape backup:
</p>
<ul><li> Become the root user to change the system to single-user mode, and unmount the file systems.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      # /usr/sbin/shutdown -y -g300 &quot;System is being shutdown for backup&quot;
&#160;
      Shutdown started.    Mon Oct 11 12:22:33 BST 2004
&#160;
      Broadcast Message from root (pts/1) on host1 Mon Oct 11 12:22:33...
      The system host1 will be shut down in 5 minutes
      System is being shutdown for backup
      (further output omitted)</pre></div></div>
</td></tr></table><br />
<ul><li> Verify that the /export/home file system was unmounted with the shutdown command. If not, unmount it manually.</li>
<li> Check the integrity of the file system data with the fsck command.</li></ul>
<pre># fsck /export/home
</pre>
<ul><li> Perform a full (Level 0) backup of the /export/home file system.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">      # ufsdump 0uf /dev/rmt/0 /export/home
      # ufsdump 0uf /dev/rmt/0 /export/home
        DUMP: Writing 32 Kilobyte records
        DUMP: Date of this level 0 dump: Mon Oct 11 12:30:44 2004
        DUMP: Date of last level 0 dump: the epoch
        DUMP: Dumping /dev/rdsk/c0t0d0s7 (host1:/export/home) to /dev/rmt/0.
        DUMP: Mapping (Pass I) [regular files]
        DUMP: Mapping (Pass II) [directories]
        DUMP: Estimated 1126 blocks (563KB).
        DUMP: Dumping (Pass III) [directories]
        DUMP: Dumping (Pass IV) [regular files]
        DUMP: Tape rewinding
        DUMP: 1086 blocks (543KB) on 1 volume at 1803 KB/sec
        DUMP: DUMP IS DONE
        DUMP: Level 0 dump on Mon Oct 11 12:42:12 2004</pre></div></div>
</td></tr></table><br />
<p>You can use the ufsdump command to perform a backup on a remote tape device.
</p><p>The format for the ufsdump command is:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsdump</font>
</td></tr>
<tr>
<td>
<pre>ufsdump options remotehost:tapedevice filesystem
</pre>
</td></tr></table><br />
<p>To perform remote backups across the network, the system with the tape drive must have an entry in its /.rhosts file for every system that uses the tape drive.
Using the ufsdump Command
</p><p>The following example shows how to perform a full (Level 0) backup of the /export/home file system on the host1 system, to the remote tape device on the host2 system.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsdump</font>
</td></tr>
<tr>
<td>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # ufsdump 0uf host2:/dev/rmt/0 /export/home
  DUMP: Writing 32 Kilobyte records
  DUMP: Date of this level 0 dump: Mon Oct 11 13:30:44 2004
  DUMP: Date of last level 0 dump: the epoch
  DUMP: Dumping /dev/rdsk/c0t0d0s7 (host1:/export/home) to   host2:/dev/rmt/0.
  DUMP: Mapping (Pass I) [regular files]
  DUMP: Mapping (Pass II) [directories]
  DUMP: Estimated 320 blocks (160KB).
  DUMP: Dumping (Pass III) [directories]
  DUMP: Dumping (Pass IV) [regular files]
  DUMP: Tape rewinding
  DUMP: 318 blocks (159KB) on 1 volume at 691 KB/sec
  DUMP: DUMP IS DONE
  DUMP: Level 0 dump on Mon Oct 11 13:44:12 2004</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Restoring"><span class="mw-headline-number">6</span> Restoring</span></h1>
<p>When you are restoring data to a system, consider the following questions&#160;:
</p>
<ul><li> Can the system boot on its own (regular file system restore)?</li>
<li> Do you need to boot the system from CD-ROM, DVD, or network (critical file system restore)?</li>
<li> Do you need to boot the system from CD-ROM, DVD, or network and repair the boot drive (special case recovery)?</li></ul>
<p>To restore files or file systems, determine the following&#160;:
</p>
<ul><li> The file system backup tapes that are needed</li>
<li> The device name to which you will restore the file system</li>
<li> The name of the temporary directory to which you will restore individual files</li>
<li> The type of backup device to be used (local or remote)</li>
<li> The backup device name (local or remote)</li></ul>
<p>To restore a regular file system, such as the /export/home or /opt file system, back up to the disk, you use the ufsrestore command. The ufsrestore command copies files to the disk, relative to the current working directory, from backup tapes that were created by the ufsdump command.
</p><p>You can use the ufsrestore command to reload an entire file system hierarchy from a Level 0 backup and related incremental backups. You can also restore one or more single files from any backup tape.
</p><p>The format for the ufsrestore command is:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsrestore</font>
</td></tr>
<tr>
<td>
<pre>ufsrestore option(s) argument(s) filesystem
</pre>
</td></tr></table><br />
<p>The table describes some options that you can use with the ufsrestore command.
</p>
<table border="1" width="100%">
<tr>
<th>Option
</th>
<th>Description
</th></tr>
<tr>
<td>t
</td>
<td>Lists the table of contents of the backup media.
</td></tr>
<tr>
<td>r
</td>
<td>Restores the entire file system from the backup media.
</td></tr>
<tr>
<td>x file1 file2
</td>
<td>Restores only the files named on the command line.
</td></tr>
<tr>
<td>i
</td>
<td>Invokes an interactive restore.
</td></tr>
<tr>
<td>v
</td>
<td>Specifies verbose mode. This mode displays the path names to the terminal screen as each file is restored.
</td></tr>
<tr>
<td>f device
</td>
<td>Specifies the tape device name. When not specified, the /dev/rmt/0 device file is used.
</td></tr></table>
<p>When you restore an entire file system from a backup tape, the system creates a restoresymtable file. The ufsrestore command uses the restoresymtable file for check-pointing or passing information between incremental restores. You can remove the restoresymtable file when the restore is complete.
</p>
<h2><span class="mw-headline" id="ufsrestore"><span class="mw-headline-number">6.1</span> ufsrestore</span></h2>
<p>The following procedure demonstrates how to use the ufsrestore command to restore the /opt file system on the c0t0d0s5 slice.
</p>
<ul><li> Create the new file system structure.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> newfs</font>
</td></tr>
<tr>
<td>
<pre>newfs /dev/rdsk/c0t0d0s5
</pre>
</td></tr></table><br />
<ul><li> Mount the file system to the /opt directory, and change to that directory.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>mount /dev/dsk/c0t0d0s5 /opt
cd /opt
</pre>
</td></tr></table><br />
<ul><li> Restore the entire /opt file system from the backup tape.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsrestore</font>
</td></tr>
<tr>
<td>
<pre>ufsrestore rf /dev/rmt/0
</pre>
</td></tr></table><br />
<p>Note: Always restore a file system by starting with the Level 0 backup tape, continuing with the next-lower-level tape, and continuing through the highest-level tape.
</p>
<ul><li> Remove the restoresymtable file.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>rm restoresymtable
</pre>
</td></tr></table><br />
<ul><li> Unmount the new file system.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>cd /
umount /opt
</pre>
</td></tr></table><br />
<ul><li> Use the fsck command to check the restored file system.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>fsck /dev/rdsk/c0t0d0s5
</pre>
</td></tr></table><br />
<ul><li> Perform a full backup of the file system.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>ufsdump 0uf /dev/rmt/0 /dev/rdsk/c0t0d0s5
</pre>
</td></tr></table><br />
<p>Note: The system administrator should always back up the newly created file system because the ufsrestore command repositions the files and changes the inode allocation.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> reboot</font>
</td></tr>
<tr>
<td>
<pre>init 6
</pre>
</td></tr></table><br />
<p>The ufsrestore i command invokes an interactive interface. Through the interface, you can browse the directory hierarchy of the backup tape and select individual files to extract. The term volume is used by ufsrestore and should be considered a single tape.
Using the ufsrestore i Command
</p><p><b>The following procedure demonstrates how to use the ufsrestore i command to extract individual files from a backup tape.</b>
</p>
<ul><li> Become the root user, and change to the temporary directory that you want to receive the extracted files.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>cd /export/home/tmp
</pre>
</td></tr></table><br />
<ul><li> Perform the ufsrestore i command.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> $ ufsrestore ivf /dev/rmt/0
 Verify volume and initialize maps
 Media block size is 64
 Dump   date: Mon Oct 11 12:30:44 2004
 Dumped from: the epoch
 Level 0 dump of /export/home on sys43:/dev/dsk/c0t0d0s7
 Label: none
 Extract directories from tape
 Initialize symbol table.</pre></div></div>
</td></tr></table><br />
<ul><li> Display the contents of the directory structure on the backup tape.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsrestore</font>
</td></tr>
<tr>
<td>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> $ ufsrestore &gt; ls
 .:
 2 *./            13  directory1    15  directory3     11  file2
 2 *../           14  directory2    10  file1          12  file3</pre></div></div>
</td></tr></table><br />
<ul><li> Change to the target directory on the backup tape.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> $ ufsrestore &gt; cd directory1
 $ ufsrestore &gt; ls
 ./directory1:
 3904  ./          2 *../      3905  file1    3906  file2    3907  file3</pre></div></div>
</td></tr></table><br />
<ul><li> Add the files you want to restore to the extraction list.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> $ ufsrestore &gt; add file1 file2
 $ Make node ./directory1</pre></div></div>
</td></tr></table><br />
<p>Files you want to restore are marked with an asterisk (*) for extraction. If you extract a directory, all of the directory contents are marked for extraction.
</p><p>In this example, two files are marked for extraction. The ls command displays an asterisk in front of the selected file names, file1 and file2.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> $ ufsrestore &gt; ls
 ./directory1:
 3904 *./          2 *../      3905 *file1    3906 *file2    3907  file3</pre></div></div>
</td></tr></table><br />
<ul><li> To delete a file from the extraction list, use the delete command.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsrestore</font>
</td></tr>
<tr>
<td>
<pre>ufsrestore &gt; delete file1
</pre>
</td></tr></table><br />
<p>The ls command displays the file1 file without an asterisk. 
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> $ ufsrestore &gt; ls
 ./directory1:
 3904 *./          2 *../      3905  file1    3906 *file2    3907  file3</pre></div></div>
</td></tr></table><br />
<ul><li> To view the files and directories marked for extraction, use the marked command.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> $ ufsrestore &gt; marked
 ./directory1:
 3904 *./          2 *../      3906 *file2</pre></div></div>
</td></tr></table><br />
<ul><li> To restore the selected files from the backup tape, perform the command:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> $ ufsrestore &lt;nowiki&gt;&gt;&lt;/nowiki&gt; extract
 Extract requested files
 You have not read any volumes yet.
 Unless you know which volume your file(s) are on you should start
 with the last volume and work towards the first.
 Specify next volume #: 1</pre></div></div>
</td></tr></table><br />
<p><i>Note:</i> The ufsrestore command has to find the selected files. If you used more than one tape for the backup, first insert the tape with the highest volume number and type the appropriate number at this point. Then repeat, working towards Volume #1 until all files have been restored.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> extract file ./directory1/file2
 Add links
 Set directory mode, owner, and times.
 set owner/mode for &amp;backquot;.'? [yn] n</pre></div></div>
</td></tr></table><br />
<p><i>Note:</i> Answering y sets ownership and permissions of the temporary directory to those of the mount point on the tape.
</p>
<ul><li> To exit the interactive restore after the files are extracted, perform the command:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>ufsrestore&gt; quit
</pre>
</td></tr></table><br />
<ul><li> Move the restored files to their original or permanent directory location, and delete the files from the temporary directory.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> mv /export/home/tmp/directory1/file2 /export/home
 rm -r /export/home/tmp/directory1</pre></div></div>
</td></tr></table><br />
<p><i>Note:</i> You can use the help command in an interactive restore to display a list of available commands.
</p>
<h1><span class="mw-headline" id="Restoring_a_ufs_File_System"><span class="mw-headline-number">7</span> Restoring a ufs File System</span></h1>
<p>When performing incremental restores, start with the last volume and work towards the first. The system uses information in the restoresymtable file to restore incremental backups on top of the latest full backup.
</p><p>The following procedure demonstrates how to restore the /export/home file system from incremental tapes.
</p><p>Note: This procedure makes use of the interactive restore to assist in showing the concept of incremental restores. You would typically use a command, such as ufsrestore rf, for restoring entire file systems.
</p>
<ul><li> View the contents of the /etc/dumpdates file for information about the /export/home file system.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> more</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # more /etc/dumpdates |grep c0t0d0s7
 /dev/rdsk/c0t0d0s7       0 Wed Apr 07 09:55:34 2004
 /dev/rdsk/c0t0d0s7       1 Web Apr 07 09:57:30 2004</pre></div></div>
</td></tr></table><br />
<ul><li> Create the new file system structure for the /export/home file system.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> newfs</font>
</td></tr>
<tr>
<td>
<pre>newfs /dev/rdsk/c0t0d0s7
</pre>
</td></tr></table><br />
<ul><li> Mount the file system and change to that directory.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> mount /dev/dsk/c0t0d0s7 /export/home
 cd /export/home</pre></div></div>
</td></tr></table><br />
<ul><li> Insert the Level 0 backup tape.</li>
<li> Restore the /export/home file system from the backup tapes.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsrestore</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # ufsrestore rvf /dev/rmt/0
 Verify volume and initialize maps
 Media block size is 64
 Dump   date: Wed Apr 07 09:55:34 2004
 Dumped from: the epoch
 Level 0 dump of /export/home on sys41:/dev/dsk/c0t0d0s7
 Label: none
 Begin level 0 restore
 Initialize symbol table.
 Extract directories from tape
 Calculate extraction list.
 Make node ./directory1
 Make node ./directory2
 Make node ./directory3
 Extract new leaves.
 Check pointing the restore
 extract file ./file1
 extract file ./file2
 extract file ./file3
 Add links
 Set directory mode, owner, and times.
 Check the symbol table.
 Check pointing the restore</pre></div></div>
</td></tr></table><br />
<ul><li> Load the next lower-level tape into the tape drive&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsrestore</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # ufsrestore rvf /dev/rmt/0
 Verify volume and initialize maps
 Media block size is 64
 Dump   date: Wed Apr 07 09:57:30 2004
 Dumped from: Wed Apr 07 09:55:34 2004
 Level 1 dump of /export/home on sys41:/dev/dsk/c0t0d0s7
 Label: none
 Begin incremental restore
 Initialize symbol table.
 Extract directories from tape
 Mark entries to be removed.
 Calculate node updates.
 Make node ./directory4
 Make node ./directory5
 Make node ./directory6
 Find unreferenced names.
 Remove old nodes (directories).
 Extract new leaves.
 Check pointing the restore
 extract file ./file4
 extract file ./file5
 extract file ./file6
 Add links
 Set directory mode, owner, and times.
 Check the symbol table.
 Check pointing the restore</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Alternative_Steps"><span class="mw-headline-number">7.1</span> Alternative Steps</span></h2>
<p>The following steps are an alternative to the previous Steps 5 and 6.
</p>
<ul><li> Restore the /export/home file system from the backup tapes. (This example uses an interactive, verbose restore to provide more detailed information.)</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # ufsrestore ivf /dev/rmt/0
 Verify volume and initialize maps
 Media block size is 64
 Dump   date: Mon Oct 11 13:10:12 2004
 Dumped from: the epoch
 Level 0 dump of /export/home on sys41:/dev/dsk/c0t0d0s7
 Label: none
 Extract directories from tape
 Initialize symbol table.</pre></div></div>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> $ ufsrestore &gt; ls
 .:
      2 *./            8  directory2     5  file2
      2 *../           9  directory3     6  file3
      7  directory1    4  file1          3  lost+found/
&#160;
 The system lists files from the last Level 0 backup.</pre></div></div>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> $ ufsrestore &gt; add *
 Warning: ./lost+found: File exists</pre></div></div>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsrestore</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> $ ufsrestore &gt; extract
 Extract requested files
 You have not read any volumes yet.
 Unless you know which volume your file(s) are on you should start
 with the last volume and work towards the first.
 Specify next volume #: 1
 extract file ./file1
 extract file ./file2
 extract file ./file3
 extract file ./directory1
 extract file ./directory2
 extract file ./directory3
 Add links
 Set directory mode, owner, and times.
 set owner/mode for '.'? [yn] n
 Directories already exist, set modes anyway? [yn] n
 ufsrestore &gt; q</pre></div></div>
</td></tr></table><br />
<ul><li> The information in the /etc/dumpdates file shows an incremental backup that was taken after the Level 0 backup. Load the next tape and perform the incremental restore.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsrestore</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> $ ufsrestore iv
 Verify volume and initialize maps
 Media block size is 64
 Dump   date: Wed Apr 07 09:57:30 2004
 Dumped from: Wed Apr 07 09:55:34 2004
 Level 1 dump of /export/home on sys41:/dev/dsk/c0t0d0s7
 Label: none
 Extract directories from tape
 Initialize symbol table.</pre></div></div>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsrestore</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> $ ufsrestore &gt; ls
 .:
      2 *./        13  directory4    15  directory6    11  file5
      2 *../       14  directory5    10  file4         12  file6
&#160;
 $ ufsrestore &gt; add *
&#160;
 $ ufsrestore &gt; extract
 Extract requested files
 You have not read any volumes yet.
 Unless you know which volume your file(s) are on you should start
 with the last volume and work towards the first.
 Specify next volume #: 1
 extract file ./file4
 extract file ./file5
 extract file ./file6
 extract file ./directory4
 extract file ./directory5
 extract file ./directory6
 Add links
 Set directory mode, owner, and times.
 set owner/mode for '.'? [yn] n
 $ ufsrestore &gt; q</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Creating_a_UFS_Snapshot"><span class="mw-headline-number">8</span> Creating a UFS Snapshot</span></h1>
<p>The UFS Copy on Write Snapshots feature provides administrators an online backup solution for ufs file systems. This utility enables you to use a point-in-time copy of a ufs file system, called a snapshot, to create an online backup. You can create the backup while the file system is mounted and the system is in multiuser mode.
</p><p><i>Note:</i> The UFS snapshots are similar to the Sun StorEdgeTM Instant Image product. Instant Image allocates space equal to the size of the entire file system that is being captured. However, the file system data saved by UFS snapshots occupies only as much disk space as needed.
</p><p>You use the fssnap command to create, query, or delete temporary read-only snapshots of ufs file systems.
</p><p>The format for the fssnap command is:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> fssnap</font>
</td></tr>
<tr>
<td>
<pre>/usr/sbin/fssnap -F FSType -V -o special_option(s) mount-point 
</pre>
</td></tr></table><br />
<p>The table shows some of the options for the fssnap command.
</p>
<table border="1" width="100%">
<tr>
<th>Option
</th>
<th>Description
</th></tr>
<tr>
<td>-d
</td>
<td>Deletes the snapshot associated with the given file system. If the -o unlink option was used when you built the snapshot, the backing-store file is deleted together with the snapshot. Otherwise, the backing-store file (which contains file system data) occupies disk space until you delete it manually.
</td></tr>
<tr>
<td>-F FSType
</td>
<td>Specifies the file system type to be used.
</td></tr>
<tr>
<td>-i
</td>
<td>Displays the state of an FSType snapshot.
</td></tr>
<tr>
<td>-V
</td>
<td>Echoes the complete command line but does not execute the command.
</td></tr>
<tr>
<td>-o
</td>
<td>Enables you to use special_options, such as the location and size of the backing-store (bs) file.
</td></tr></table>
<p>To create a UFS snapshot, specify a backing-store path and the actual file system to be captured. The following is the command format:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> fssnap</font>
</td></tr>
<tr>
<td>
<pre>fssnap -F ufs -o bs=backing_store_path /file-system
</pre>
</td></tr></table><br />
<p><i>Note:</i> The backing_store_path can be a raw device, the name of an existing directory, or the name of a file that does not already exist.
</p><p>The following example uses the fssnap command to create a snapshot of the /export/home file system.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> fssnap</font>
</td></tr>
<tr>
<td>
<pre># fssnap -F ufs -o bs=/var/tmp /export/home
/dev/fssnap/0
</pre>
</td></tr></table><br />
<p>The snapshot subsystem saves file system data in a file called a backing-store file before the data is overwritten. Some important aspects of a backing-store file are:
</p>
<ul><li> A backing-store file is a bit-mapped file that takes up disk space until you delete the UFS snapshot.</li>
<li> The size of the backing-store file varies with the amount of activity on the file system being captured.</li>
<li> The destination path that you specify on the fssnap command line must have enough free space to hold the backing-store file.</li>
<li> The location of the backing-store file must be different from that of the file system you want to capture in a UFS snapshot.</li>
<li> A backing-store file can reside on different types of file systems, including another ufs file system or a mounted nfs file system.</li></ul>
<p>The fssnap command creates the backing-store file and two read-only virtual devices. The block virtual device, /dev/fssnap/0, can be mounted as a read-only file system. The raw virtual device, /dev/rfssnap/0, can be used for raw read-only access to a file system.
</p><p>These virtual devices can be backed up with any of the existing Solaris OS backup commands. The backup created from a virtual device is a backup of the original file system when the UFS snapshot was taken.
</p><p>Note: When a UFS snapshot is first created, the file system locks temporarily. Users might notice a slight pause when writing to this file system. The length of the pause increases with the size of the file system. There is no performance impact when users are reading from the file system.
</p><p>Before creating a UFS snapshot, use the df -k command to check that the backing-store file has enough disk space to grow. The size of the backing-store file depends on how much data has changed since the previous snapshot was taken.
</p><p>You can limit the size of the backing-store file by using the -o maxsize=n option of the fssnap command, where n (k, m, or g) is the maximum size of the backing-store file specified in Kbytes, Mbytes, or Gbytes.
</p><p>Caution: If the backing-store file runs out of disk space, the system automatically deletes the UFS snapshot, which causes the backup to fail. The active ufs file system is not affected. Check the /var/adm/messages file for possible UFS snapshot errors.
</p><p>Note: You can force an unmount of an active ufs file system, for which a snapshot exists (for example, with the umount -f command). This action deletes the appropriate snapshot automatically.
</p><p>The following example creates a snapshot of the /export/home file system, and limits the backing-store file to 500 Mbytes.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> fssnap</font>
</td></tr>
<tr>
<td>
<pre># fssnap -F ufs -o bs=/var/tmp,maxsize=500m /export/home
/dev/fssnap/0
</pre>
</td></tr></table><br />
<p>You can use either fssnap command to display UFS snapshot information.
</p><p>The following example displays a list of all the current UFS snapshots on the system. The list also displays the corresponding virtual device for each snapshot.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> fssnap</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># fssnap -i
0    /export/home
1    /usr
2    /database</pre></div></div>
</td></tr></table><br />
<p>You use the -i option to the /usr/lib/fs/ufs/fssnap command to display detailed information for a specific UFS snapshot that was created by the fssnap command.
</p><p>The following example shows the details for the /export/home snapshot.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># /usr/lib/fs/ufs/fssnap -i /export/home
Snapshot number              &#160;: 0
Block Device                 &#160;: /dev/fssnap/0
Raw Device                   &#160;: /dev/rfssnap/0
Mount point                  &#160;: /export/home
Device state                 &#160;: idle
Backing store path           &#160;: /var/tmp/snapshot0
Backing store size           &#160;: 0 KB
Maximum backing store size   &#160;: 512000 KB
Snapshot create time         &#160;: Mon Oct 11 08:58:33 2004
Copy-on-write granularity    &#160;: 32 KB</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="tar"><span class="mw-headline-number">8.1</span> tar</span></h2>
<p>You can use the tar command or the ufsdump command to back up a UFS snapshot.
Using the tar Command to Back Up a Snapshot File
</p><p>If you use the tar command to back up the UFS snapshot, mount the snapshot before backing it up. The following procedure demonstrates how to do this type of mount.
</p>
<ul><li> Create the mount point for the block virtual device.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>mkdir -p /backups/home.bkup
</pre>
</td></tr></table><br />
<ul><li> Mount the block virtual device to the mount point.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>mount -F ufs -o ro /dev/fssnap/0 /backups/home.bkup
</pre>
</td></tr></table><br />
<ul><li> Change directory to the mount point.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>cd /backups/home.bkup
</pre>
</td></tr></table><br />
<ul><li> Use the tar command to write the data to tape.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>tar cvf /dev/rmt/0 .
</pre>
</td></tr></table><br />
<p>Using the ufsdump Command
</p><p>If you use the ufsdump command to back up a UFS snapshot, you can specify the raw virtual device during the backup.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsdump</font>
</td></tr>
<tr>
<td>
<pre>ufsdump 0uf /dev/rmt/0 /dev/rfssnap/0
</pre>
</td></tr></table><br />
<p>Verify that the UFS snapshot is backed up.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsrestore</font>
</td></tr>
<tr>
<td>
<pre>ufsrestore tf /dev/rmt/0
</pre>
</td></tr></table><br />
<h2><span class="mw-headline" id="Incrementals_restores"><span class="mw-headline-number">8.2</span> Incrementals restores</span></h2>
<p>Incremental backups of snapshots contain files that have been modified since the last UFS snapshot. You use the ufsdump command with the N option to create an incremental UFS snapshot, which writes the name of the device being backed up, rather than the name of the snapshot device to the /etc/dumpdates file.
</p><p>The following example shows how to use the ufsdump command to create an incremental backup of a file system.
</p><p>Note: It is important to note the use of the N argument when backing up a snapshot. This argument ensures proper updates to the /etc/dumpdates file.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsdump</font>
</td></tr>
<tr>
<td>
<pre>ufsdump 1ufN /dev/rmt/0 /dev/rdsk/c1t0d0s0 /dev/rfssnap/0
</pre>
</td></tr></table><br />
<p>Next you would verify that the UFS snapshot is backed up to tape.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ufsrestore</font>
</td></tr>
<tr>
<td>
<pre>ufsrestore tf /dev/rmt/0
</pre>
</td></tr></table><br />
<p>To understand incremental backups of snapshots, consider the following demonstration:
</p>
<ul><li> Create a snapshot of the /extra file system that is going to be backed up while the file system is mounted.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # fssnap -o bs=/var/tmp /extra
 /dev/fssnap/0</pre></div></div>
</td></tr></table><br />
<ul><li> Verify that the snapshot was successful, and view detailed information about the snapshot.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # fssnap -i
   0    /extra
 # /usr/lib/fs/ufs/fssnap -i /extra
 Snapshot number              &#160;: 0
 Block Device                 &#160;: /dev/fssnap/0
 Raw Device                   &#160;: /dev/rfssnap/0
 Mount point                  &#160;: /extra
 Device state                 &#160;: idle
 Backing store path           &#160;: /var/tmp/snapshot0
 Backing store size           &#160;: 0 KB
 Maximum backing store size   &#160;: Unlimited
 Snapshot create time         &#160;: Mon Oct 11 10:34:21 2004
 Copy-on-write granularity    &#160;: 32 KB</pre></div></div>
</td></tr></table><br />
<ul><li> Make a directory that will be used to mount and view the snapshot data.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> mkdir /extrasnap</pre></div></div>
</td></tr></table><br />
<ul><li> Mount the snapshot to the new mount point, and compare the size of the file system and the snapshot device.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # mount -o ro /dev/fssnap/0 /extrasnap
 # df -k |grep extra
 /dev/dsk/c1t0d0s0    1294023       9 1242254     1%    /extra
 /dev/fssnap/0        1294023       9 1242254     1%    /extrasnap</pre></div></div>
</td></tr></table><br />
<ul><li> Edit a file under the /extra directory and make it larger, and then compare the size of the file system and the snapshot device.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # vi file1
 (yank and put text, or read text in from another file)
 # df -k |grep extra
 /dev/dsk/c1t0d0s0    1294023      20 1242243     1%    /extra
 /dev/fssnap/0        1294023       9 1242254     1%    /extrasnap</pre></div></div>
</td></tr></table><br />
<p>Observe that the file system grew in size while the snapshot file did not.
</p>
<ul><li> Perform a full backup with the N option of the ufsdump command.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # ufsdump 0ufN /dev/rmt/0 /dev/rdsk/c1t0d0s0 /dev/rfssnap/0
 DUMP: Writing 32 Kilobyte records
 DUMP: Date of this level 0 dump: Mon Oct 11 10:49:38 2004
 DUMP: Date of last level 0 dump: the epoch
 DUMP: Dumping /dev/rfssnap/0 (sys41:/extrasnap) to /dev/rmt/0.
 DUMP: Mapping (Pass I) [regular files]
 DUMP: Mapping (Pass II) [directories]
 DUMP: Estimated 262 blocks (131KB).
 DUMP: Dumping (Pass III) [directories]
 DUMP: Dumping (Pass IV) [regular files]
 DUMP: Tape rewinding
 DUMP: 254 blocks (127KB) on 1 volume at 1814 KB/sec
 DUMP: DUMP IS DONE
 DUMP: Level 0 dump on Mon Oct 11 11:03:46 2004</pre></div></div>
</td></tr></table><br />
<ul><li> Verify the backup.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # ufsrestore tf /dev/rmt/0
         2      .
         3      ./file1
         4      ./file2
         5      ./file3
         6      ./file4</pre></div></div>
</td></tr></table><br />
<ul><li> Unmount the back up device and remove the snapshot.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> umount /extrasnap
 fssnap -d /extra
 rm /var/tmp/snapshot0</pre></div></div>
</td></tr></table><br />
<ul><li> Make some changes to the /extra file system, such as copying some files, and then re-create the snapshot.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # cp file1 file5
 # cp file1 file6
 # fssnap -o bs=/var/tmp /extra
 /dev/fssnap/0</pre></div></div>
</td></tr></table><br />
<ul><li> Re-mount the snapshot device, and compare the size of the file system and the snapshot device.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # mount -o ro /dev/fssnap/0 /extrasnap
 # df -k |grep extra
 /dev/dsk/c1t0d0s0    1294023      46 1242217     1%    /extra
 /dev/fssnap/0        1294023      46 1242217     1%    /extrasnap</pre></div></div>
</td></tr></table><br />
<ul><li> Perform an incremental backup with the N option of the ufsdump command.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # ufsdump 1ufN /dev/rmt/0 /dev/rdsk/c1t0d0s0 /dev/rfssnap/0
 DUMP: Writing 32 Kilobyte records
 DUMP: Date of this level 0 dump: Mon Oct 11 13:13:03 2004
 DUMP: Date of last level 0 dump: Mon Oct 11 12:30:44 2004
 DUMP: Dumping /dev/rfssnap/0 (sys41:/extrasnap) to /dev/rmt/0.
 DUMP: Mapping (Pass I) [regular files]
 DUMP: Mapping (Pass II) [directories]
 DUMP: Estimated 294 blocks (147KB).
 DUMP: Dumping (Pass III) [directories]
 DUMP: Dumping (Pass IV) [regular files]
 DUMP: Tape rewinding
 DUMP: 254 blocks (127KB) on 1 volume at 1693 KB/sec
 DUMP: DUMP IS DONE
 DUMP: Level 1 dump on Mon Oct 11 13:22:36 2004</pre></div></div>
</td></tr></table><br />
<ul><li> Verify the backup.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # ufsrestore tf /dev/rmt/0
         2      .
         7      ./file5
         8      ./file6</pre></div></div>
</td></tr></table><br />
<p>Notice that the backup of the snapshot contains only the files that were added since the previous Level 0 backup.
</p><p>The backup created from a virtual device is a backup of the original file system when the UFS snapshot was taken.
</p><p>You restore a UFS snapshot from a backup tape in the same manner as you would the backup of an original file system. Data written to a tape by ufsdump is simply data, whether it is a snapshot or a file system.
</p><p>To restore the demo directory from the snapshot backup of the /usr file system, complete the following steps:
</p>
<ul><li> Load the tape that contains the snapshot backup of the /usr file system into the tape drive.</li>
<li> Change to the /usr file system.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>cd /usr
</pre>
</td></tr></table><br />
<ul><li> Perform the a ufsrestore command.</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> # ufsrestore if /dev/rmt/0
 ufsrestore &gt; add demo
 ufsrestore &gt; extract
 Specify next volume #: 1
 set owner/mode for '.'? [yn] n
 ufsrestore &gt; quit</pre></div></div>
</td></tr></table><br />
<ul><li> Verify that the demo directory exists, and eject the tape.</li></ul>
<p>Deleting a UFS snapshot from the system is a multistep process and order-dependant. First, unmount the snapshot device, and then delete the snapshot. Finally, remove the backing-store file.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> umount /dev/fssnap/0
 fssnap -d /export/home
 rm /backing_store_file</pre></div></div>
</td></tr></table><br />

<!-- 
NewPP limit report
CPU time usage: 0.148 seconds
Real time usage: 0.149 seconds
Preprocessor visited node count: 1077/1000000
Preprocessor generated node count: 3492/1000000
Post‐expand include size: 14140/2097152 bytes
Template argument size: 3728/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   32.380      1 - -total
 71.92%   23.288     76 - Template:Command
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:1754-0!*!*!1!en!5!* and timestamp 20181111230614 and revision id 5803
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=Sauvegardes_et_Restaurations&amp;oldid=5803">https://wiki.deimos.fr/index.php?title=Sauvegardes_et_Restaurations&amp;oldid=5803</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=Sauvegardes+et+Restaurations" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="Sauvegardes_et_Restaurations.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="Sauvegardes_et_Restaurations.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="Sauvegardes_et_Restaurations.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=Sauvegardes_et_Restaurations&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=Sauvegardes_et_Restaurations&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="Sauvegardes_et_Restaurations.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/Sauvegardes_et_Restaurations.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/Sauvegardes_et_Restaurations" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=Sauvegardes_et_Restaurations&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=Sauvegardes_et_Restaurations&amp;oldid=5803" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=Sauvegardes_et_Restaurations&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 5 April 2008, at 17:33.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":31});
}</script>
	</body>
</html>
	
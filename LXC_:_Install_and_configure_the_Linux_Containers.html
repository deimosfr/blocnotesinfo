<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>LXC : Install and configure the Linux Containers - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="./LXC_:_Install_and_configure_the_Linux_Containers.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=ext.cite.styles|mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"LXC_:_Install_and_configure_the_Linux_Containers","wgTitle":"LXC : Install and configure the Linux Containers","wgCurRevisionId":13457,"wgRevisionId":13457,"wgArticleId":3630,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"LXC_:_Install_and_configure_the_Linux_Containers","wgRelevantArticleId":3630,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
.source-bash {line-height: normal;}
.source-bash li, .source-bash pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for bash
 * CSS class: source-bash, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.bash.source-bash .de1, .bash.source-bash .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.bash.source-bash  {font-family:monospace;}
.bash.source-bash .imp {font-weight: bold; color: red;}
.bash.source-bash li, .bash.source-bash .li1 {font-weight: normal; vertical-align:top;}
.bash.source-bash .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.bash.source-bash .li2 {font-weight: bold; vertical-align:top;}
.bash.source-bash .kw1 {color: #000000; font-weight: bold;}
.bash.source-bash .kw2 {color: #c20cb9; font-weight: bold;}
.bash.source-bash .kw3 {color: #7a0874; font-weight: bold;}
.bash.source-bash .co0 {color: #666666; font-style: italic;}
.bash.source-bash .co1 {color: #800000;}
.bash.source-bash .co2 {color: #cc0000; font-style: italic;}
.bash.source-bash .co3 {color: #000000; font-weight: bold;}
.bash.source-bash .co4 {color: #666666;}
.bash.source-bash .es1 {color: #000099; font-weight: bold;}
.bash.source-bash .es2 {color: #007800;}
.bash.source-bash .es3 {color: #007800;}
.bash.source-bash .es4 {color: #007800;}
.bash.source-bash .es5 {color: #780078;}
.bash.source-bash .es_h {color: #000099; font-weight: bold;}
.bash.source-bash .br0 {color: #7a0874; font-weight: bold;}
.bash.source-bash .sy0 {color: #000000; font-weight: bold;}
.bash.source-bash .st0 {color: #ff0000;}
.bash.source-bash .st_h {color: #ff0000;}
.bash.source-bash .nu0 {color: #000000;}
.bash.source-bash .re0 {color: #007800;}
.bash.source-bash .re1 {color: #007800;}
.bash.source-bash .re2 {color: #007800;}
.bash.source-bash .re4 {color: #007800;}
.bash.source-bash .re5 {color: #660033;}
.bash.source-bash .ln-xtra, .bash.source-bash li.ln-xtra, .bash.source-bash div.ln-xtra {background-color: #ffc;}
.bash.source-bash span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
.source-xml {line-height: normal;}
.source-xml li, .source-xml pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for xml
 * CSS class: source-xml, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.xml.source-xml .de1, .xml.source-xml .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.xml.source-xml  {font-family:monospace;}
.xml.source-xml .imp {font-weight: bold; color: red;}
.xml.source-xml li, .xml.source-xml .li1 {font-weight: normal; vertical-align:top;}
.xml.source-xml .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.xml.source-xml .li2 {font-weight: bold; vertical-align:top;}
.xml.source-xml .es0 {color: #000099; font-weight: bold;}
.xml.source-xml .br0 {color: #66cc66;}
.xml.source-xml .sy0 {color: #66cc66;}
.xml.source-xml .st0 {color: #ff0000;}
.xml.source-xml .nu0 {color: #cc66cc;}
.xml.source-xml .sc-1 {color: #808080; font-style: italic;}
.xml.source-xml .sc0 {color: #00bbdd;}
.xml.source-xml .sc1 {color: #ddbb00;}
.xml.source-xml .sc2 {color: #339933;}
.xml.source-xml .sc3 {color: #009900;}
.xml.source-xml .re0 {color: #000066;}
.xml.source-xml .re1 {color: #000000; font-weight: bold;}
.xml.source-xml .re2 {color: #000000; font-weight: bold;}
.xml.source-xml .ln-xtra, .xml.source-xml li.ln-xtra, .xml.source-xml div.ln-xtra {background-color: #ffc;}
.xml.source-xml span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
.source-c {line-height: normal;}
.source-c li, .source-c pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for c
 * CSS class: source-c, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.c.source-c .de1, .c.source-c .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.c.source-c  {font-family:monospace;}
.c.source-c .imp {font-weight: bold; color: red;}
.c.source-c li, .c.source-c .li1 {font-weight: normal; vertical-align:top;}
.c.source-c .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.c.source-c .li2 {font-weight: bold; vertical-align:top;}
.c.source-c .kw1 {color: #b1b100;}
.c.source-c .kw2 {color: #000000; font-weight: bold;}
.c.source-c .kw3 {color: #000066;}
.c.source-c .kw4 {color: #993333;}
.c.source-c .co1 {color: #666666; font-style: italic;}
.c.source-c .co2 {color: #339933;}
.c.source-c .coMULTI {color: #808080; font-style: italic;}
.c.source-c .es0 {color: #000099; font-weight: bold;}
.c.source-c .es1 {color: #000099; font-weight: bold;}
.c.source-c .es2 {color: #660099; font-weight: bold;}
.c.source-c .es3 {color: #660099; font-weight: bold;}
.c.source-c .es4 {color: #660099; font-weight: bold;}
.c.source-c .es5 {color: #006699; font-weight: bold;}
.c.source-c .br0 {color: #009900;}
.c.source-c .sy0 {color: #339933;}
.c.source-c .st0 {color: #ff0000;}
.c.source-c .nu0 {color: #0000dd;}
.c.source-c .nu6 {color: #208080;}
.c.source-c .nu8 {color: #208080;}
.c.source-c .nu12 {color: #208080;}
.c.source-c .nu16 {color:#800080;}
.c.source-c .nu17 {color:#800080;}
.c.source-c .nu18 {color:#800080;}
.c.source-c .nu19 {color:#800080;}
.c.source-c .me1 {color: #202020;}
.c.source-c .me2 {color: #202020;}
.c.source-c .ln-xtra, .c.source-c li.ln-xtra, .c.source-c div.ln-xtra {background-color: #ffc;}
.c.source-c span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-LXC_Install_and_configure_the_Linux_Containers skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">LXC : Install and configure the Linux Containers</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#mw-navigation">navigation</a>, 					<a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Kernel"><span class="tocnumber">2.1</span> <span class="toctext">Kernel</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Configuration"><span class="tocnumber">3</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Cgroups"><span class="tocnumber">3.1</span> <span class="toctext">Cgroups</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Check_LXC_configuration"><span class="tocnumber">3.2</span> <span class="toctext">Check LXC configuration</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Network"><span class="tocnumber">3.3</span> <span class="toctext">Network</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#No_specific_configuration_.28same_than_host.29"><span class="tocnumber">3.3.1</span> <span class="toctext">No specific configuration (same than host)</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Nat_configuration"><span class="tocnumber">3.3.2</span> <span class="toctext">Nat configuration</span></a>
<ul>
<li class="toclevel-4 tocsection-10"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#With_Libvirt"><span class="tocnumber">3.3.2.1</span> <span class="toctext">With Libvirt</span></a></li>
<li class="toclevel-4 tocsection-11"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#With_dnsmasq"><span class="tocnumber">3.3.2.2</span> <span class="toctext">With dnsmasq</span></a></li>
<li class="toclevel-4 tocsection-12"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Iptables"><span class="tocnumber">3.3.2.3</span> <span class="toctext">Iptables</span></a></li>
<li class="toclevel-4 tocsection-13"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Nat_on_containers"><span class="tocnumber">3.3.2.4</span> <span class="toctext">Nat on containers</span></a>
<ul>
<li class="toclevel-5 tocsection-14"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#DHCP"><span class="tocnumber">3.3.2.4.1</span> <span class="toctext">DHCP</span></a></li>
<li class="toclevel-5 tocsection-15"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Static_IP"><span class="tocnumber">3.3.2.4.2</span> <span class="toctext">Static IP</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-3 tocsection-16"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Private_container_interface"><span class="tocnumber">3.3.3</span> <span class="toctext">Private container interface</span></a></li>
<li class="toclevel-3 tocsection-17"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Bridged_configuration"><span class="tocnumber">3.3.4</span> <span class="toctext">Bridged configuration</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#VLAN_Bridged_configuration"><span class="tocnumber">3.3.5</span> <span class="toctext">VLAN Bridged configuration</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-19"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Security"><span class="tocnumber">3.4</span> <span class="toctext">Security</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-20"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Basic_Usage"><span class="tocnumber">4</span> <span class="toctext">Basic Usage</span></a>
<ul>
<li class="toclevel-2 tocsection-21"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Create_a_container"><span class="tocnumber">4.1</span> <span class="toctext">Create a container</span></a>
<ul>
<li class="toclevel-3 tocsection-22"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Classic_method"><span class="tocnumber">4.1.1</span> <span class="toctext">Classic method</span></a></li>
<li class="toclevel-3 tocsection-23"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#LVM_method"><span class="tocnumber">4.1.2</span> <span class="toctext">LVM method</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#BTRFS_method"><span class="tocnumber">4.1.3</span> <span class="toctext">BTRFS method</span></a></li>
<li class="toclevel-3 tocsection-25"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Templating_configuration"><span class="tocnumber">4.1.4</span> <span class="toctext">Templating configuration</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-26"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#List_containers"><span class="tocnumber">4.2</span> <span class="toctext">List containers</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Start_a_container"><span class="tocnumber">4.3</span> <span class="toctext">Start a container</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Plug_to_console"><span class="tocnumber">4.4</span> <span class="toctext">Plug to console</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Stop_a_container"><span class="tocnumber">4.5</span> <span class="toctext">Stop a container</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Force_shutdown"><span class="tocnumber">4.6</span> <span class="toctext">Force shutdown</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Autostart_on_boot"><span class="tocnumber">4.7</span> <span class="toctext">Autostart on boot</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Delete_a_container"><span class="tocnumber">4.8</span> <span class="toctext">Delete a container</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Monitoring"><span class="tocnumber">4.9</span> <span class="toctext">Monitoring</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Freeze"><span class="tocnumber">4.10</span> <span class="toctext">Freeze</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Unfreeze.2FRestore"><span class="tocnumber">4.11</span> <span class="toctext">Unfreeze/Restore</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Monitor_changes"><span class="tocnumber">4.12</span> <span class="toctext">Monitor changes</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Trigger_changes"><span class="tocnumber">4.13</span> <span class="toctext">Trigger changes</span></a></li>
<li class="toclevel-2 tocsection-38"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Launch_command_in_a_running_container"><span class="tocnumber">4.14</span> <span class="toctext">Launch command in a running container</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-39"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Convert.2FMigrate_a_VM.2FHost_to_a_LXC_container"><span class="tocnumber">5</span> <span class="toctext">Convert/Migrate a VM/Host to a LXC container</span></a></li>
<li class="toclevel-1 tocsection-40"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Container_configuration"><span class="tocnumber">6</span> <span class="toctext">Container configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-41"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Architectures"><span class="tocnumber">6.1</span> <span class="toctext">Architectures</span></a></li>
<li class="toclevel-2 tocsection-42"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Capabilities"><span class="tocnumber">6.2</span> <span class="toctext">Capabilities</span></a></li>
<li class="toclevel-2 tocsection-43"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Devices"><span class="tocnumber">6.3</span> <span class="toctext">Devices</span></a></li>
<li class="toclevel-2 tocsection-44"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Container_limits_.28cgroups.29"><span class="tocnumber">6.4</span> <span class="toctext">Container limits (cgroups)</span></a>
<ul>
<li class="toclevel-3 tocsection-45"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#CPU"><span class="tocnumber">6.4.1</span> <span class="toctext">CPU</span></a>
<ul>
<li class="toclevel-4 tocsection-46"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#CPU_Pining"><span class="tocnumber">6.4.1.1</span> <span class="toctext">CPU Pining</span></a>
<ul>
<li class="toclevel-5 tocsection-47"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Check_CPU_assignments"><span class="tocnumber">6.4.1.1.1</span> <span class="toctext">Check CPU assignments</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-48"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Scheduler"><span class="tocnumber">6.4.1.2</span> <span class="toctext">Scheduler</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-49"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Memory"><span class="tocnumber">6.4.2</span> <span class="toctext">Memory</span></a>
<ul>
<li class="toclevel-4 tocsection-50"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Check_memory_from_the_host"><span class="tocnumber">6.4.2.1</span> <span class="toctext">Check memory from the host</span></a></li>
<li class="toclevel-4 tocsection-51"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Check_memory_in_the_container"><span class="tocnumber">6.4.2.2</span> <span class="toctext">Check memory in the container</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-52"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#SWAP"><span class="tocnumber">6.4.3</span> <span class="toctext">SWAP</span></a></li>
<li class="toclevel-3 tocsection-53"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Disks"><span class="tocnumber">6.4.4</span> <span class="toctext">Disks</span></a>
<ul>
<li class="toclevel-4 tocsection-54"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Mount"><span class="tocnumber">6.4.4.1</span> <span class="toctext">Mount</span></a>
<ul>
<li class="toclevel-5 tocsection-55"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Block_Device"><span class="tocnumber">6.4.4.1.1</span> <span class="toctext">Block Device</span></a></li>
<li class="toclevel-5 tocsection-56"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Bind_mount"><span class="tocnumber">6.4.4.1.2</span> <span class="toctext">Bind mount</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-57"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Disk_priority"><span class="tocnumber">6.4.4.2</span> <span class="toctext">Disk priority</span></a></li>
<li class="toclevel-4 tocsection-58"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Disk_bandwidth"><span class="tocnumber">6.4.4.3</span> <span class="toctext">Disk bandwidth</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-59"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Network_2"><span class="tocnumber">6.4.5</span> <span class="toctext">Network</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-60"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Resources_statistics"><span class="tocnumber">6.5</span> <span class="toctext">Resources statistics</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-61"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#FAQ"><span class="tocnumber">7</span> <span class="toctext">FAQ</span></a>
<ul>
<li class="toclevel-2 tocsection-62"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#How_could_I_know_if_I.27m_in_a_container_or_not_.3F"><span class="tocnumber">7.1</span> <span class="toctext">How could I know if I'm in a container or not&#160;?</span></a></li>
<li class="toclevel-2 tocsection-63"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Can.27t_connect_to_console"><span class="tocnumber">7.2</span> <span class="toctext">Can't connect to console</span></a></li>
<li class="toclevel-2 tocsection-64"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Can.27t_create_a_LXC_LVM_container"><span class="tocnumber">7.3</span> <span class="toctext">Can't create a LXC LVM container</span></a></li>
<li class="toclevel-2 tocsection-65"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Can.27t_limit_container_memory_or_swap"><span class="tocnumber">7.4</span> <span class="toctext">Can't limit container memory or swap</span></a></li>
<li class="toclevel-2 tocsection-66"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#I_can.27t_start_my_container.2C_how_could_I_debug_.3F"><span class="tocnumber">7.5</span> <span class="toctext">I can't start my container, how could I debug&#160;?</span></a></li>
<li class="toclevel-2 tocsection-67"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#.2Fusr.2Fsbin.2Fgrub-probe:_error:_cannot_find_a_device_for_.2F_.28is_.2Fdev_mounted.3F.29"><span class="tocnumber">7.6</span> <span class="toctext">/usr/sbin/grub-probe: error: cannot find a device for / (is /dev mounted?)</span></a></li>
<li class="toclevel-2 tocsection-68"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#telinit:_.2Frun.2Finitctl:_No_such_file_or_directory"><span class="tocnumber">7.7</span> <span class="toctext">telinit: /run/initctl: No such file or directory</span></a></li>
<li class="toclevel-2 tocsection-69"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Some_containers_are_loosing_their_IP_addresse_at_boot"><span class="tocnumber">7.8</span> <span class="toctext">Some containers are loosing their IP addresse at boot</span></a></li>
<li class="toclevel-2 tocsection-70"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#OpenVPN"><span class="tocnumber">7.9</span> <span class="toctext">OpenVPN</span></a></li>
<li class="toclevel-2 tocsection-71"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#LXC_inception_or_Docker_in_LXC"><span class="tocnumber">7.10</span> <span class="toctext">LXC inception or Docker in LXC</span></a></li>
<li class="toclevel-2 tocsection-72"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#LXC_control_device_mapper"><span class="tocnumber">7.11</span> <span class="toctext">LXC control device mapper</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-73"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#References"><span class="tocnumber">8</span> <span class="toctext">References</span></a></li>
</ul>
</div>

<table class="config_array" align="right" style="width:20em; font-size:90%; text-align:left; border: 1px #d0e7ff solid; margin-left:10px;">
   <tr>
      <td class="config_subarray" colspan="2" style="text-align:center;"><a href="./File:Poweredbylinux.jpg.html" class="image" title="LXC"><img alt="LXC" src="images/2/2f/Poweredbylinux.jpg" width="100" height="150" /></a></td>
   </tr><tr><td colspan="2" style="text-align:center;"><hr class="gradient" /></td></tr><tr>
      <th>Software version</th>
      <td>0.8</td>
   </tr><tr>
      <th>Operating System</th>
      <td>Debian 7</td>
   </tr><tr>
      <th>Website</th>
      <td><a rel="nofollow" class="external text" href="http://lxc.sourceforge.net/">LXC Website</a></td>
   </tr><tr>
      <th>Last Update</th>
      <td>22/02/2015</td>
   </tr><tr>
      <th>Others</th>
      <td></td>
   </tr>
</table>
<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p>LXC is the userspace control package for Linux Containers, a lightweight virtual system mechanism sometimes described as “chroot on steroids”.
</p><p>LXC builds up from chroot to implement complete virtual systems, adding resource management and isolation mechanisms to Linux’s existing process management infrastructure.
</p><p>Linux Containers (lxc) implement:
</p>
<ul><li> Resource management via “process control groups” (implemented via the cgroup filesystem)</li>
<li> Resource isolation via new flags to the clone(2) system call (capable of create several types of new namespaces for things like PIDs and network routing)</li>
<li> Several additional isolation mechanisms (such as the “-o newinstance” flag to the devpts filesystem).</li></ul>
<p>The LXC package combines these Linux kernel mechanisms to provide a userspace container object, a lightweight virtual system with full resource isolation and resource control for an application or a system.
</p><p>Linux Containers take a completely different approach than system virtualization technologies such as KVM and Xen, which started by booting separate virtual systems on emulated hardware and then attempted to lower their overhead via paravirtualization and related mechanisms. Instead of retrofitting efficiency onto full isolation, LXC started out with an efficient mechanism (existing Linux process management) and added isolation, resulting in a system virtualization mechanism as scalable and portable as chroot, capable of simultaneously supporting thousands of emulated systems on a single server while also providing lightweight virtualization options to routers and smart phones.
</p><p>The  first  objective  of this project is to make the life easier for the kernel developers involved in the containers project and especially to continue working on the Checkpoint/Restart new features. The lxc is small enough to easily manage a  container  with simple command lines and complete enough to be used for other purposes.<sup id="cite_ref-1" class="reference"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_note-1">[1]</a></sup>
</p>
<h1><span class="mw-headline" id="Installation"><span class="mw-headline-number">2</span> Installation</span></h1>
<p>To install LXC, we do not need too much packages. As I will want to manage my LXC containers with libvirt, I need to install it as well&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude install lxc bridge-utils debootstrap git git-core</pre></div></div>
</td></tr></table><br />
<p>At the time where I write this sentence, there is an issue with LVM container creation (here is <a rel="nofollow" class="external text" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=680469">a first Debian bug</a> and <a rel="nofollow" class="external text" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=716839">a second one</a>) on Debian Wheezy and it doesn't seams to be resolve soon.
</p><p>Here is a workaround to avoid errors during LVM containers initialization&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cd /tmp
git clone https://github.com/simonvanderveldt/lxc-debian-wheezy-template.git
cp lxc-debian-wheezy-template/lxc-debian-0.9.0-upstream /usr/share/lxc/templates/lxc-debian-squeeze
cp lxc-debian-wheezy-template/lxc-debian-0.9.0-upstream /usr/share/lxc/templates/lxc-debian-wheezy
sed -i 's/-squeeze/-wheezy/' /usr/share/lxc/templates/lxc-debian-wheezy
chmod 755 /usr/share/lxc/templates/lxc-debian-*</pre></div></div>
</td></tr></table><br />
<p>On Jessie, you'll also have to install this:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude install cgroupfs-mount</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Kernel"><span class="mw-headline-number">2.1</span> Kernel</span></h2>
<p>It's recommended to get a recent kernel as LXC grow very fast, get better performances, stabilities and new features. To get a newer kernel, we're going to use a kernel from the testing repo&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/apt/preferences.d/kernel</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">Package: *
Pin: release a=stable
Pin-priority: 900
&#160;
Package: *
Pin: release a=testing
Pin-priority: 100
&#160;
Package: linux-image-*
Pin: release a=testing
Pin-priority: 1001
&#160;
Package: linux-headers-*
Pin: release a=testing
Pin-priority: 1001
&#160;
Package: linux-kbuild-*
Pin: release a=testing
Pin-priority: 1001</pre></div></div>
</td></tr></table><br />
<p>Add then this testing content&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/apt/sources.list.d/testing.list</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># Testing
deb http://ftp.fr.debian.org/debian/ testing main non-free contrib
deb-src http://ftp.fr.debian.org/debian/ testing main non-free contrib</pre></div></div>
</td></tr></table><br />
<p>Then you can install the latest kernel image&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude update
aptitude install linux-image-amd64</pre></div></div>
</td></tr></table><br />
<p>If it's not enough, you'll need to install the package with specific kernel version number corresponding to latest (ex. linux-image-3.11-2-amd64) and reboot on this new kernel.
</p>
<h1><span class="mw-headline" id="Configuration"><span class="mw-headline-number">3</span> Configuration</span></h1>
<h2><span class="mw-headline" id="Cgroups"><span class="mw-headline-number">3.1</span> Cgroups</span></h2>
<p>LXC is based on cgroups. Those are used to limit CPU, RAM etc...<a href="Latence_des_process_et_kernel_timing.html#cpuset" title="Latence des process et kernel timing">You can check here for more informations</a>.
</p><p>We need to enable Cgroups. Add this line in fstab&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/fstab</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">[...]
cgroup  /sys/fs/cgroup  cgroup  defaults                        0       0</pre></div></div>
</td></tr></table><br />
<p>As we want to manage memory and swap on containers, as it's not available by default, add cgroup argument to grub to activate those functionality&#160;:
</p>
<ul><li> cgroup RAM feature&#160;: "cgroup_enable=memory"</li>
<li> cgroup SWAP feature&#160;: "swapaccount=1"</li></ul>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/default/grub</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># If you change this file, run 'update-grub' afterwards to update
# /boot/grub/grub.cfg.
# For full documentation of the options in this file, see:
#   info -f grub -n 'Simple configuration'
&#160;
GRUB_DEFAULT=0
GRUB_TIMEOUT=5
GRUB_DISTRIBUTOR=`lsb_release -i -s 2&gt; /dev/null || echo Debian`
<span class="xtra ln-xtra">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet cgroup_enable=memory swapaccount=1&quot;</span>GRUB_CMDLINE_LINUX=&quot;&quot;
[...]</pre></div></div>
</td></tr></table><br />
<p>Then regenerate grub config&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> update-grub</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">update-grub</pre></div></div>
</td></tr></table><br />
<table width="100%" class="notes_array">
<tr>
<td class="notes_subarray"> <font size="-1"><a href="./File:Notes_file.png.html" class="image" title="Notes"><img alt="Notes" src="images/2/20/Notes_file.png" width="31" height="32" /></a> Notes</font>
</td></tr>
<tr>
<td>You'll need to reboot to make the cgroup memory feature active
</td></tr></table><br />
<p>Then mount it&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mount</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">mount /sys/fs/cgroup</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Check_LXC_configuration"><span class="mw-headline-number">3.2</span> Check LXC configuration</span></h2>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-checkconfig</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; lxc-checkconfig
Kernel config /proc/config.gz not found, looking in other places...
Found kernel config file /boot/config-3.2.0-4-amd64
--- Namespaces ---
Namespaces: enabled
Utsname namespace: enabled
Ipc namespace: enabled
Pid namespace: enabled
User namespace: enabled
Network namespace: enabled
Multiple /dev/pts instances: enabled
&#160;
--- Control groups ---
Cgroup: enabled
Cgroup clone_children flag: enabled
Cgroup device: enabled
Cgroup sched: enabled
Cgroup cpu account: enabled
Cgroup memory controller: enabled
Cgroup cpuset: enabled
&#160;
--- Misc ---
Veth pair device: enabled
Macvlan: enabled
Vlan: enabled
File capabilities: enabled
&#160;
Note&#160;: Before booting a new kernel, you can check its configuration
usage&#160;: CONFIG=/path/to/config /usr/bin/lxc-checkconfig</pre></div></div>
</td></tr></table><br />
<table width="100%" class="warning_array">
<tr>
<td class="warning_subarray"> <font size="-1"><a href="./File:Warning_file.png.html" class="image" title="Warning"><img alt="Warning" src="images/0/09/Warning_file.png" width="39" height="32" /></a> <b>WARNING</b></font>
</td></tr>
<tr>
<td>All should be enabled to ensure it will work as expected&#160;!
</td></tr></table><br />
<h2><span class="mw-headline" id="Network"><span class="mw-headline-number">3.3</span> Network</span></h2>
<h3><span class="mw-headline" id="No_specific_configuration_.28same_than_host.29"><span class="mw-headline-number">3.3.1</span> No specific configuration (same than host)</span></h3>
<p>If you don't configure your network configuration after container initialization, you'll have the exact same configuration on your guests (containers) than your host. That mean all network interfaces are available on the guests and they will have full access to the host.
</p>
<table width="100%" class="warning_array">
<tr>
<td class="warning_subarray"> <font size="-1"><a href="./File:Warning_file.png.html" class="image" title="Warning"><img alt="Warning" src="images/0/09/Warning_file.png" width="39" height="32" /></a> <b>WARNING</b></font>
</td></tr>
<tr>
<td>This is not the recommended solution for production usages
</td></tr></table><br />
<ul><li> The pro of that "no" configuration, is to have network working out of the box for the guests (perfect for quick tests)</li>
<li> Another con, is to have the access to process on host. <b>I mean that a SSH server running on host will have it's port available on the guest too</b>. So you cannot have a SSH server running on guests without changing port (or you'll have a network binding conflict).</li></ul>
<p>You can easily check this configuration in opening a port on the host (here 80)&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> nc</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1">nc <span class="re5">-lp</span> <span class="nu0">80</span></pre></div></div>
</td></tr></table><br />
<p>now on a guest, you can see it listening&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> netstat</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1"><span class="sy0">&gt;</span> <span class="kw2">netstat</span> <span class="re5">-aunt</span> <span class="sy0">|</span> <span class="kw2">grep</span> <span class="nu0">80</span>
tcp        <span class="nu0">0</span>      <span class="nu0">0</span> 0.0.0.0:<span class="nu0">80</span>              0.0.0.0:<span class="sy0">*</span>               LISTEN</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="Nat_configuration"><span class="mw-headline-number">3.3.2</span> Nat configuration</span></h3>
<p>How does it works for NAT configuration&#160;?
</p>
<ol><li> You need to <b>choose</b> which kind of configuration you want to use&#160;: <b>libvirt or dnsmaq</b></li>
<li> Iptables&#160;: to help to access nated containers from outside and help containers to get internet</li>
<li> Configure the network container</li></ol>
<h4><span class="mw-headline" id="With_Libvirt"><span class="mw-headline-number">3.3.2.1</span> With Libvirt</span></h4>
<p>You'll need to install libvirt first&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude install libvirt-bin</pre></div></div>
</td></tr></table><br />
<p><br />
Nat is the default configuration. But you may need to do some adjustements. Add the forwarding to sysctl&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/sysctl.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">net.ipv4.ip_forward = 1</pre></div></div>
</td></tr></table><br />
<p>Check that the connecting is active&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; virsh net-list --all
Name                 State      Autostart 
-----------------------------------------
default              inactive   no</pre></div></div>
</td></tr></table><br />
<p>If it's not the case, then set the default network configuration&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">virsh net-define /etc/libvirt/qemu/networks/default.xml
virsh net-autostart default
virsh net-start default</pre></div></div>
</td></tr></table><br />
<p>Then you should see it enable&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; virsh net-list --all
Name                 State      Autostart 
-----------------------------------------
default              active     yes</pre></div></div>
</td></tr></table><br />
<p>Edit the configuration to add your range of IP&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/libvirt/qemu/networks/default.xml</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="xml source-xml"><pre class="de1"><span class="sc3"><span class="re1">&lt;network<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;name<span class="re2">&gt;</span></span></span>default<span class="sc3"><span class="re1">&lt;/name<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;bridge</span> <span class="re0">name</span>=<span class="st0">&quot;virbr0&quot;</span> <span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;forward</span><span class="re2">/&gt;</span></span>
<span class="xtra ln-xtra">  <span class="sc3"><span class="re1">&lt;ip</span> <span class="re0">address</span>=<span class="st0">&quot;192.168.122.1&quot;</span> <span class="re0">netmask</span>=<span class="st0">&quot;255.255.255.0&quot;</span><span class="re2">&gt;</span></span></span>    <span class="sc3"><span class="re1">&lt;dhcp<span class="re2">&gt;</span></span></span>
<span class="xtra ln-xtra">      <span class="sc3"><span class="re1">&lt;range</span> <span class="re0">start</span>=<span class="st0">&quot;192.168.122.100&quot;</span> <span class="re0">end</span>=<span class="st0">&quot;192.168.122.200&quot;</span> <span class="re2">/&gt;</span></span></span>    <span class="sc3"><span class="re1">&lt;/dhcp<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;/ip<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/network<span class="re2">&gt;</span></span></span></pre></div></div>
</td></tr></table><br />
<p>Now it's done, restart libvirt.
</p>
<h4><span class="mw-headline" id="With_dnsmasq"><span class="mw-headline-number">3.3.2.2</span> With dnsmasq</span></h4>
<p>Libvirt is not necessary as for the moment it doesn't manage LXC containers very well. So you can manage your own dnsmasq server to give DNS and DHCP to your containers. First of all, install it&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude install dnsmasq dnsmasq-utils</pre></div></div>
</td></tr></table><br />
<p>Then configure it&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/dnsmasq.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># Bind it to the LXC interface
interface=lxcbr0
bind-interfaces
# Want DHCP client FQDN 
dhcp-fqdn
# Domain name and ip range with lease time
domain=deimos.fr,192.168.122.0/24
dhcp-range=192.168.122.100,192.168.122.200,1h
# DHCP options
dhcp-option=40,deimos.fr
log-dhcp</pre></div></div>
</td></tr></table><br />
<p>Then restart the dnsmasq service. And now configure the lxcbr0 interface&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/network/interfaces</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># This bridge will is used to NAT LXC containers' traffic
auto lxcbr0
iface lxcbr0 inet static
    pre-up brctl addbr lxcbr0
    bridge_fd 0
    bridge_maxwait 0
    address 192.168.122.1
    netmask 255.255.255.0
    post-up iptables -A FORWARD -i lxcbr0 -s 192.168.122.1/24 -j ACCEPT
    post-up iptables -A POSTROUTING -t nat -s 192.168.122.1/24 -j MASQUERADE
    # add checksum so that dhclient does not complain.
    # udp packets staying on the same host never have a checksum filled else
    post-up iptables -A POSTROUTING -t mangle -p udp --dport bootpc -s 192.168.122.1/24 -j CHECKSUM --checksum-fill</pre></div></div>
</td></tr></table><br />
<h4><span class="mw-headline" id="Iptables"><span class="mw-headline-number">3.3.2.3</span> Iptables</span></h4>
<p>You may need to configure iptables for example if you're on a dedicated box where the provider doesn't allow bridge configuration. Here is a working iptables configuration to permit incoming connexions to Nated guests&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> iptables.sh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1"><span class="co0">#!/bin/bash</span>
<span class="co0"># Made by Pierre Mavro / Deimosfr</span>
<span class="co0"># This script will Nat you KVM/containers hosts</span>
<span class="co0"># and help you to get access from outside</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Essentials</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="re2">IPTABLES</span>=<span class="st_h">'/sbin/iptables'</span>
modprobe nf_conntrack_ftp
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Physical and virtual interfaces definitions</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Interfaces</span>
<span class="re2">wan1_if</span>=<span class="st0">&quot;eth0&quot;</span>
<span class="re2">wan2_if</span>=<span class="st0">&quot;eth0:0&quot;</span>
<span class="re2">kvm_if</span>=<span class="st0">&quot;virbr0&quot;</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Networks definitions</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Networks</span>
<span class="re2">wan1_ip</span>=<span class="st0">&quot;x.x.x.x&quot;</span>
<span class="re2">wan2_ip</span>=<span class="st0">&quot;x.x.x.x&quot;</span>
<span class="re2">vms_net</span>=<span class="st0">&quot;192.168.122.0/24&quot;</span>
&#160;
<span class="co0"># Dedibox internals IPs</span>
<span class="re2">web_ip</span>=<span class="st0">&quot;192.168.122.10&quot;</span>
<span class="re2">mail_ip</span>=<span class="st0">&quot;192.168.122.20&quot;</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Global Rules input / output / forward</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Flushing tables</span>
<span class="re1">$IPTABLES</span> <span class="re5">-F</span>
<span class="re1">$IPTABLES</span> <span class="re5">-X</span>
<span class="re1">$IPTABLES</span> <span class="re5">-t</span> nat <span class="re5">-F</span>
&#160;
<span class="co0"># Define default policy</span>
<span class="re1">$IPTABLES</span> <span class="re5">-P</span> INPUT DROP
<span class="re1">$IPTABLES</span> <span class="re5">-P</span> OUTPUT ACCEPT
<span class="re1">$IPTABLES</span> <span class="re5">-P</span> FORWARD ACCEPT
&#160;
<span class="co0">## Loopback accepte</span>
<span class="co1">${IPTABLES}</span> <span class="re5">-A</span> FORWARD <span class="re5">-i</span> lo <span class="re5">-o</span> lo <span class="re5">-j</span> ACCEPT
<span class="co1">${IPTABLES}</span> <span class="re5">-A</span> INPUT <span class="re5">-i</span> lo <span class="re5">-j</span> ACCEPT
<span class="co1">${IPTABLES}</span> <span class="re5">-A</span> OUTPUT <span class="re5">-o</span> lo <span class="re5">-j</span> ACCEPT
&#160;
<span class="co0"># Allow KVM DHCP/dnsmasq</span>
<span class="co1">${IPTABLES}</span> <span class="re5">-A</span> INPUT <span class="re5">-i</span> <span class="re1">$kvm_if</span> <span class="re5">-p</span> udp <span class="re5">--dport</span> <span class="nu0">67</span> <span class="re5">-j</span> ACCEPT
<span class="co1">${IPTABLES}</span> <span class="re5">-A</span> INPUT <span class="re5">-i</span> <span class="re1">$kvm_if</span> <span class="re5">-p</span> udp <span class="re5">--dport</span> <span class="nu0">69</span> <span class="re5">-j</span> ACCEPT
&#160;
<span class="re1">$IPTABLES</span> <span class="re5">-A</span> INPUT <span class="re5">-j</span> ACCEPT <span class="re5">-d</span> <span class="re1">$vms_net</span>
<span class="re1">$IPTABLES</span> <span class="re5">-A</span> INPUT <span class="re5">-j</span> ACCEPT <span class="re5">-m</span> state <span class="re5">--state</span> ESTABLISHED,RELATED
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Allow masquerading for KVM VMs</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Activating masquerade to get Internet from KVM VMs</span>
<span class="re1">$IPTABLES</span> <span class="re5">-t</span> nat <span class="re5">-A</span> POSTROUTING <span class="re5">-o</span> <span class="re1">$wan1_if</span> <span class="re5">-s</span> <span class="re1">$vms_net</span> <span class="re5">-j</span> MASQUERADE
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Allow ports on KVM host</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Allow ICMP</span>
<span class="re1">$IPTABLES</span> <span class="re5">-A</span> INPUT <span class="re5">-j</span> ACCEPT <span class="re5">-p</span> icmp
&#160;
<span class="co0"># SSH access</span>
<span class="re1">$IPTABLES</span> <span class="re5">-A</span> INPUT <span class="re5">-j</span> ACCEPT <span class="re5">-p</span> tcp <span class="re5">--dport</span> <span class="nu0">22</span>
&#160;
<span class="co0"># HTTPS access</span>
<span class="re1">$IPTABLES</span> <span class="re5">-A</span> INPUT <span class="re5">-j</span> ACCEPT <span class="re5">-p</span> tcp <span class="re5">--dport</span> <span class="nu0">443</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Redirections for incoming connections (wan1)</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># HTTP access</span>
<span class="re1">$IPTABLES</span> <span class="re5">-t</span> nat <span class="re5">-A</span> PREROUTING <span class="re5">-p</span> tcp <span class="re5">--dport</span> <span class="nu0">80</span> <span class="re5">-d</span> <span class="re1">$wan1_ip</span> <span class="re5">-j</span> DNAT <span class="re5">--to-destination</span> <span class="re1">$web_ip</span>:<span class="nu0">80</span>
&#160;
<span class="co0"># HTTP access</span>
<span class="re1">$IPTABLES</span> <span class="re5">-t</span> nat <span class="re5">-A</span> PREROUTING <span class="re5">-p</span> tcp <span class="re5">--dport</span> <span class="nu0">443</span> <span class="re5">-d</span> <span class="re1">$wan1_ip</span> <span class="re5">-j</span> DNAT <span class="re5">--to-destination</span> <span class="re1">$web_ip</span>:<span class="nu0">443</span>
&#160;
<span class="co0"># Mail for mailsrv</span>
<span class="re1">$IPTABLES</span> <span class="re5">-t</span> nat <span class="re5">-A</span> PREROUTING <span class="re5">-p</span> tcp <span class="re5">--dport</span> <span class="nu0">25</span> <span class="re5">-d</span> <span class="re1">$wan1_ip</span> <span class="re5">-j</span> DNAT <span class="re5">--to-destination</span> <span class="re1">$mail_ip</span>:<span class="nu0">25</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Reload fail2ban</span>
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>fail2ban reload</pre></div></div>
</td></tr></table><br />
<h4><span class="mw-headline" id="Nat_on_containers"><span class="mw-headline-number">3.3.2.4</span> Nat on containers</span></h4>
<h5><span class="mw-headline" id="DHCP"><span class="mw-headline-number">3.3.2.4.1</span> DHCP</span></h5>
<p>On each containers you want to use NAT configuration, you need to add those lines for DHCP configuration<sup id="cite_ref-2" class="reference"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_note-2">[2]</a></sup>&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">## Network
lxc.network.type = veth
lxc.network.flags = up
&#160;
# Network host side
lxc.network.link = virbr0
lxc.network.veth.pair = veth0
# lxc.network.hwaddr = 00:FF:AA:00:00:01
&#160;
# Network container side
lxc.network.name = eth0
lxc.network.ipv4 = 0.0.0.0/24</pre></div></div>
</td></tr></table><br />
<p>Then in the LXC container (mount the LV if you did LVM) configure the network like this&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/rootfs/etc/network/interfaces</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">auto eth0
iface eth0 inet dhcp</pre></div></div>
</td></tr></table><br />
<h5><span class="mw-headline" id="Static_IP"><span class="mw-headline-number">3.3.2.4.2</span> Static IP</span></h5>
<table width="100%" class="notes_array">
<tr>
<td class="notes_subarray"> <font size="-1"><a href="./File:Notes_file.png.html" class="image" title="Notes"><img alt="Notes" src="images/2/20/Notes_file.png" width="31" height="32" /></a> Notes</font>
</td></tr>
<tr>
<td>This is only applicable for Libvirt
</td></tr></table><br />
<p>You can also configure manual static IP if you want by changing 'lxc.network.ipv4'. Another elegant method is to ask DHCP to fix it&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/libvirt/qemu/networks/default.xml</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="xml source-xml"><pre class="de1"><span class="sc3"><span class="re1">&lt;network<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;name<span class="re2">&gt;</span></span></span>default<span class="sc3"><span class="re1">&lt;/name<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;bridge</span> <span class="re0">name</span>=<span class="st0">&quot;virbr0&quot;</span> <span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;forward</span><span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;ip</span> <span class="re0">address</span>=<span class="st0">&quot;192.168.122.1&quot;</span> <span class="re0">netmask</span>=<span class="st0">&quot;255.255.255.0&quot;</span><span class="re2">&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;dhcp<span class="re2">&gt;</span></span></span>
      <span class="sc3"><span class="re1">&lt;range</span> <span class="re0">start</span>=<span class="st0">&quot;192.168.122.2&quot;</span> <span class="re0">end</span>=<span class="st0">&quot;192.168.122.254&quot;</span> <span class="re2">/&gt;</span></span>
<span class="xtra ln-xtra">      <span class="sc3"><span class="re1">&lt;host</span> <span class="re0">mac</span>=<span class="st0">&quot;00:FF:AA:00:00:01&quot;</span> <span class="re0">name</span>=<span class="st0">&quot;fixed.deimos.fr&quot;</span> <span class="re0">ip</span>=<span class="st0">&quot;192.168.122.101&quot;</span> <span class="re2">/&gt;</span></span></span>    <span class="sc3"><span class="re1">&lt;/dhcp<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;/ip<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/network<span class="re2">&gt;</span></span></span></pre></div></div>
</td></tr></table><br />
<table width="100%" class="notes_array">
<tr>
<td class="notes_subarray"> <font size="-1"><a href="./File:Notes_file.png.html" class="image" title="Notes"><img alt="Notes" src="images/2/20/Notes_file.png" width="31" height="32" /></a> Notes</font>
</td></tr>
<tr>
<td>Do not forget to fix lxc.network.hwaddr parameter. Here is a way to generate mac address&#160;:
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> openssl</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">openssl rand -hex 6 | sed 's/\(..\)/\1:/g; s/.$//'</pre></div></div>
</td></tr></table><br />
</td></tr></table><br />
<h3><span class="mw-headline" id="Private_container_interface"><span class="mw-headline-number">3.3.3</span> Private container interface</span></h3>
<p>You can create a private interface for your containers. Containers will be able to communicate together though this dedicated interface. Here are the steps to create one between 2 hosts.
</p><p>On the host server, install UML utilities&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude install uml-utilities</pre></div></div>
</td></tr></table><br />
<p>Then edit the network configuration file and add a bridge&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/network/interfaces</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">auto privbr0
iface privbr0 inet static
    pre-up /usr/sbin/tunctl -t tap0
    pre-up /sbin/ifup tap0
    post-down /sbin/ifdown tap0
    bridge_ports tap0
    bridge_fd 0</pre></div></div>
</td></tr></table><br />
<p>You can restart your network or launch it manually if you can't restart now&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1">tunctl <span class="re5">-t</span> tap0
brctl addbr privbr0
brctl addif privbr0 tap0</pre></div></div>
</td></tr></table><br />
<p>Then edit both containers that will have this dedicated interface and replace or add those lines&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a>  /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># Private interface
lxc.network.type = veth
lxc.network.flags = up
lxc.network.link = privbr0
lxc.network.ipv4 = 10.0.0.1</pre></div></div>
</td></tr></table><br />
<p>Now start the container and you'll have the 10.0.0.X dedicated network.
</p>
<h3><span class="mw-headline" id="Bridged_configuration"><span class="mw-headline-number">3.3.4</span> Bridged configuration</span></h3>
<p>Now modify your /etc/network/interfaces file to add bridged configuration&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/network/interfaces</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">auto lo br0
iface lo inet loopback
&#160;
# The primary network interface
iface br0 inet static
        address 192.168.0.80
        netmask 255.255.255.0
        gateway 192.168.0.252
        broadcast 192.168.0.255
        network 192.168.0.0
        bridge_ports eth0
        bridge_fd 9
        bridge_hello 2
        bridge_maxage 12
        bridge_stp off</pre></div></div>
</td></tr></table><br />
<p>br0 is replacing eth0 for bridging.
</p><p>Here is another configuration with 2 network cards and 2 bridges&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/network/interfaces</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).
&#160;
# The loopback network interface
auto lo br0 br1
iface lo inet loopback
&#160;
# DMZ
iface br0 inet static
	address 192.168.10.1
	netmask 255.255.255.0
	gateway 192.168.10.254
	network 192.168.10.0
	broadcast 192.168.10.255
        bridge_ports eth0
        bridge_fd 9
        bridge_hello 2
        bridge_maxage 12
        bridge_stp off
&#160;
# Internal
iface br1 inet static
	address 192.168.0.1
	netmask 255.255.255.0
	gateway 192.168.0.254
	network 192.168.0.0
	broadcast 192.168.0.255
        bridge_ports eth1
        bridge_fd 9
        bridge_hello 2
        bridge_maxage 12
        bridge_stp off</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="VLAN_Bridged_configuration"><span class="mw-headline-number">3.3.5</span> VLAN Bridged configuration</span></h3>
<p>And a last one with Vlans bridged (<a href="Mise_en_place_de_VLAN.html" title="Mise en place de VLAN">look at this documentation to enable it before</a>)&#160;:
</p><p>We will need to use etables (iptables for bridged interfaces). Install this&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude install ebtables</pre></div></div>
</td></tr></table><br />
<p>Check you etables configuration&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/default/ebtables</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">EBTABLES_LOAD_ON_START=&quot;yes&quot;
EBTABLES_SAVE_ON_STOP=&quot;yes&quot;
EBTABLES_SAVE_ON_RESTART=&quot;yes&quot;</pre></div></div>
</td></tr></table><br />
<p>And enable VLAN tagging on bridged interfaces&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ebtables</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">ebtables -t broute -A BROUTING -i eth0 -p 802_1Q -j DROP</pre></div></div>
</td></tr></table><br />
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/network/interfaces</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).
&#160;
# The loopback network interface
auto lo
iface lo inet loopback
&#160;
<span class="xtra ln-xtra"># The primary network interface</span><span class="xtra ln-xtra">allow-hotplug eth0</span><span class="xtra ln-xtra">auto eth0</span><span class="xtra ln-xtra">iface eth0 inet manual</span><span class="xtra ln-xtra">&#160;</span><span class="xtra ln-xtra">auto eth0.110</span><span class="xtra ln-xtra">iface eth0.110 inet manual</span><span class="xtra ln-xtra">        vlan_raw_device eth0</span>&#160;
# The bridged interface
auto vmbr0
iface vmbr0 inet static
        address 192.168.100.1
        netmask 255.255.255.0
        network 192.168.100.0
        broadcast 192.168.100.255
        gateway 192.168.100.254
        # dns-* options are implemented by the resolvconf package, if installed
        dns-nameservers 192.168.100.254
        dns-search deimos.fr
        bridge_ports eth0
        bridge_fd 9
        bridge_hello 2
        bridge_maxage 12
        bridge_stp off
&#160;
<span class="xtra ln-xtra">auto vmbr0.110</span><span class="xtra ln-xtra">iface vmbr0.110 inet static</span><span class="xtra ln-xtra">        address 192.168.110.1</span><span class="xtra ln-xtra">        netmask 255.255.255.0</span><span class="xtra ln-xtra">        bridge_ports eth0.190</span><span class="xtra ln-xtra">        bridge_stp off</span><span class="xtra ln-xtra">        bridge_maxwait 0</span><span class="xtra ln-xtra">        bridge_fd 0</span></pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Security"><span class="mw-headline-number">3.4</span> Security</span></h2>
<p>It's recommended to use Grsecurity kernel (may be not compatible with the <a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Kernel">testing kernel</a>)or Apparmor.
</p><p>With Grsecurity, here are the parameters<sup id="cite_ref-3" class="reference"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_note-3">[3]</a></sup>&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/sysctl.d/grsecurity.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">kernel.grsecurity.chroot_deny_mount = 0
kernel.grsecurity.chroot_deny_chroot = 0
kernel.grsecurity.chroot_deny_chmod = 0
kernel.grsecurity.chroot_deny_mknod = 0
kernel.grsecurity.chroot_caps = 0
kernel.grsecurity.chroot_findtask = 0</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Basic_Usage"><span class="mw-headline-number">4</span> Basic Usage</span></h1>
<h2><span class="mw-headline" id="Create_a_container"><span class="mw-headline-number">4.1</span> Create a container</span></h2>
<h3><span class="mw-headline" id="Classic_method"><span class="mw-headline-number">4.1.1</span> Classic method</span></h3>
<p>To create a container with a wizard&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-create</font>
</td></tr>
<tr>
<td>
<pre>lxc-create -n mycontainer -t debian
</pre>
<p>or
</p>
<pre>lxc-create -n mycontainer -t debian-wheezy
</pre>
<p>or
</p>
<pre>lxc-create -n mycontainer -t debian-wheezy -f /etc/lxc/lxc-nat.conf
</pre>
</td></tr></table><br />
<ul><li> n&#160;: the name of the container</li>
<li> t&#160;: the template of the container. You can find the list in this folder&#160;: /usr/share/lxc/templates</li>
<li> f&#160;: the configuration template</li></ul>
<p>It will deploy through debootstrap a new container.
</p><p>If you want to plug yourself to a container through the console, your first need to create devices&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> chroot</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">chroot /var/lib/lxc/mycontainer/rootfs
mknod -m 666 /dev/tty1 c 4 1
mknod -m 666 /dev/tty2 c 4 2
mknod -m 666 /dev/tty3 c 4 3
mknod -m 666 /dev/tty4 c 4 4
mknod -m 666 /dev/tty5 c 4 5
mknod -m 666 /dev/tty6 c 4 6</pre></div></div>
</td></tr></table><br />
<p>Then you'll be able to connect&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc-console -n mycontainer</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="LVM_method"><span class="mw-headline-number">4.1.2</span> LVM method</span></h3>
<p>If you're using LVM to store your containers (strongly recommended), you can ask to LXC to auto create the logical volume and mkfs it for you&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxcname=mycontainerlvm
lxc-create -t debian-wheezy -n $lxcname -B lvm --vgname lxc --lvname $lxcname --fssize 4G --fstype ext3</pre></div></div>
</td></tr></table><br />
<ul><li> t&#160;: specify the wished template</li>
<li> B&#160;: we want to use LVM as backend (BTRFS is also supported)</li>
<li> vgname&#160;: set the volume group (VG) name where logical volume (LV) should be created</li>
<li> lvname&#160;: set the wished LV name for that container</li>
<li> fssize&#160;: set the size of the LV</li>
<li> fstype&#160;: set the filesystem for this container (full list is available in /proc/filesystems)</li></ul>
<h3><span class="mw-headline" id="BTRFS_method"><span class="mw-headline-number">4.1.3</span> BTRFS method</span></h3>
<p>If your host has a btrfs /var, the LXC administration tools will detect this and automatically exploit it by cloning containers using btrfs snapshots.<sup id="cite_ref-4" class="reference"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_note-4">[4]</a></sup>
</p>
<h3><span class="mw-headline" id="Templating_configuration"><span class="mw-headline-number">4.1.4</span> Templating configuration</span></h3>
<p>You can template configuration if you want to simplify your deployments. It could be useful if you need to do specific lxc configuration. To do it, simply create a file (name it as you want) and add your lxc configuration (here the network configuration)&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/lxc/lxc-nat.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">## Network
lxc.network.type = veth
lxc.network.flags = up
&#160;
# Network host side
lxc.network.link = virbr0
lxc.network.veth.pair = veth-$name
&#160;
# Network container side
lxc.network.name = eth0
lxc.network.ipv4 = 0.0.0.0/24</pre></div></div>
</td></tr></table><br />
<p>Then you could call it when you'll create a container with -f argument. You can create as many configuration as you want and place them were you want. I did it in /etc/lxc as I felt it well.
</p>
<h2><span class="mw-headline" id="List_containers"><span class="mw-headline-number">4.2</span> List containers</span></h2>
<p>You can list containers&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-list</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; lxc-list
RUNNING
  mycontainer
&#160;
FROZEN
&#160;
STOPPED
  mycontainer2</pre></div></div>
</td></tr></table><br />
<p>If you want to list running containers&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-ls</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc-ls --active</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Start_a_container"><span class="mw-headline-number">4.3</span> Start a container</span></h2>
<p>To start a container as a deamon&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-start</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc-start -n mycontainer -d</pre></div></div>
</td></tr></table><br />
<ul><li> d&#160;: Run the container as a daemon. As the container has no more tty, if an error occurs nothing will be displayed, the log file can be used to check the error.</li></ul>
<h2><span class="mw-headline" id="Plug_to_console"><span class="mw-headline-number">4.4</span> Plug to console</span></h2>
<p>You can connect to the console&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc-console -n mycontainer</pre></div></div>
</td></tr></table><br />
<p>If you've problems to connect to the container, <a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Can.27t_connect_to_console">do this</a>.
</p>
<h2><span class="mw-headline" id="Stop_a_container"><span class="mw-headline-number">4.5</span> Stop a container</span></h2>
<p>To stop a container&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-halt</font>
</td></tr>
<tr>
<td>
<pre>lxc-shutdown -n mycontainer
</pre>
<p>or
</p>
<pre>lxc-halt -n mycontainer
</pre>
</td></tr></table><br />
<table width="100%" class="notes_array">
<tr>
<td class="notes_subarray"> <font size="-1"><a href="./File:Notes_file.png.html" class="image" title="Notes"><img alt="Notes" src="images/2/20/Notes_file.png" width="31" height="32" /></a> Notes</font>
</td></tr>
<tr>
<td>You can't lxc-halt/lxc-shutdown on a container based on LVM in the current Debian version(Wheezy)
</td></tr></table><br />
<h2><span class="mw-headline" id="Force_shutdown"><span class="mw-headline-number">4.6</span> Force shutdown</span></h2>
<p>If you need to force a container to halt&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-halt</font>
</td></tr>
<tr>
<td>
<pre>lxc-stop -n mycontainer
</pre>
</td></tr></table><br />
<h2><span class="mw-headline" id="Autostart_on_boot"><span class="mw-headline-number">4.7</span> Autostart on boot</span></h2>
<p>If you need to get LXC containers to autostart on boot, you'll need to create symlink&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ln</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">ln -s /var/lib/lxc/mycontainer/config /etc/lxc/auto/mycontainer</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Delete_a_container"><span class="mw-headline-number">4.8</span> Delete a container</span></h2>
<p>You can delete a container like this&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-destroy</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc-destroy -n mycontainer</pre></div></div>
</td></tr></table><br />
<table width="100%" class="warning_array">
<tr>
<td class="warning_subarray"> <font size="-1"><a href="./File:Warning_file.png.html" class="image" title="Warning"><img alt="Warning" src="images/0/09/Warning_file.png" width="39" height="32" /></a> <b>WARNING</b></font>
</td></tr>
<tr>
<td>This will remove all your data as well. Do a backup before doing destroy&#160;!
</td></tr></table><br />
<h2><span class="mw-headline" id="Monitoring"><span class="mw-headline-number">4.9</span> Monitoring</span></h2>
<p>If you want to know the state of a container&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-info</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc-info -n mycontainer
state:   RUNNING
pid:      3034</pre></div></div>
</td></tr></table><br />
<p>Available state are&#160;:
</p>
<ul><li> ABORTING</li>
<li> RUNNING</li>
<li> STARTING</li>
<li> STOPPED</li>
<li> STOPPING</li></ul>
<h2><span class="mw-headline" id="Freeze"><span class="mw-headline-number">4.10</span> Freeze</span></h2>
<p>If you want to freeze (suspend like) a container&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-freeze</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc-freeze -n mycontainer</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Unfreeze.2FRestore"><span class="mw-headline-number">4.11</span> Unfreeze/Restore</span></h2>
<p>If you want to unfreeze (resume/restore like) a container&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-unfreeze</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc-unfreeze -n mycontainer</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Monitor_changes"><span class="mw-headline-number">4.12</span> Monitor changes</span></h2>
<p>You can monitor changes of a container with lxc-monitor&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-monitor</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; lxc-monitor -n mycontainer
'mycontainer' changed state to [STOPPING]
'mycontainer' changed state to [STOPPED]
'mycontainer' changed state to [STARTING]
'mycontainer' changed state to [RUNNING]</pre></div></div>
</td></tr></table><br />
<p>You can see all container changing states.
</p>
<h2><span class="mw-headline" id="Trigger_changes"><span class="mw-headline-number">4.13</span> Trigger changes</span></h2>
<p>You can also use 'lxc-wait command with '-s' parameter to wait a specific state and execute something afterward&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-wait</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc-wait -n mycontainer -s STOPPED &amp;&amp; echo &quot;Container stopped&quot; | mail -s 'You need to restart it' deimos@deimos.fr</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Launch_command_in_a_running_container"><span class="mw-headline-number">4.14</span> Launch command in a running container</span></h2>
<p>You can launch a command in a running container without being inside it&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-attach</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc-attach -n mycontainer -- /etc/init.d/cron restart</pre></div></div>
</td></tr></table><br />
<p>This restart the cron service in "mycontianer" container.
</p>
<h1><span class="mw-headline" id="Convert.2FMigrate_a_VM.2FHost_to_a_LXC_container"><span class="mw-headline-number">5</span> Convert/Migrate a VM/Host to a LXC container</span></h1>
<p>If you already have a running machine on KVM/VirtualBox or anything else and want to convert to an LXC container, it's easy. I've wrote a script (strongly inspired from the lxc-create) that helps me to initiate the missing elements. You can copy it in /usr/bin folder&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> lxc-convert</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1"><span class="co0">#!/bin/bash</span>
&#160;
<span class="co0">#</span>
<span class="co0"># lxc: linux Container library</span>
&#160;
<span class="co0"># Authors:</span>
<span class="co0"># Pierre MAVRO &lt;pierre@mavro.fr&gt;</span>
&#160;
<span class="co0"># This library is free software; you can redistribute it and/or</span>
<span class="co0"># modify it under the terms of the GNU Lesser General Public</span>
<span class="co0"># License as published by the Free Software Foundation; either</span>
<span class="co0"># version 2.1 of the License, or (at your option) any later version.</span>
&#160;
<span class="co0"># This library is distributed in the hope that it will be useful,</span>
<span class="co0"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
 <span class="co0"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="co0"># Lesser General Public License for more details.</span>
&#160;
<span class="co0"># You should have received a copy of the GNU Lesser General Public</span>
<span class="co0"># License along with this library; if not, write to the Free Software</span>
<span class="co0"># Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
&#160;
configure_debian<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="re2">rootfs</span>=<span class="re4">$1</span>
    <span class="re2">hostname</span>=<span class="re4">$2</span>
&#160;
    <span class="co0"># Remove unneeded folders</span>
    <span class="kw2">rm</span> <span class="re5">-Rf</span> <span class="re1">$rootfs</span><span class="sy0">/</span><span class="br0">&#123;</span>dev,proc,sys,run<span class="br0">&#125;</span>
&#160;
    <span class="co0"># Decompress dev devices</span>
    <span class="kw2">tar</span> <span class="re5">-xzf</span> <span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>debootstrap<span class="sy0">/</span>devices.tar.gz <span class="re5">-C</span> <span class="re1">$rootfs</span>
    <span class="re2">rootfs_dev</span>=<span class="re1">$rootfs</span><span class="sy0">/</span>dev
&#160;
    <span class="co0"># Create missing dev devices</span>
    <span class="kw2">mkdir</span> <span class="re5">-m</span> <span class="nu0">755</span> <span class="re1">$rootfs_dev</span><span class="sy0">/</span>pts
    <span class="kw2">mkdir</span> <span class="re5">-m</span> <span class="nu0">1777</span> <span class="re1">$rootfs_dev</span><span class="sy0">/</span>shm
    <span class="kw2">mknod</span> <span class="re5">-m</span> <span class="nu0">666</span> <span class="re1">$rootfs_dev</span><span class="sy0">/</span>tty0 c <span class="nu0">4</span> <span class="nu0">0</span>
    <span class="kw2">mknod</span> <span class="re5">-m</span> <span class="nu0">600</span> <span class="re1">$rootfs_dev</span><span class="sy0">/</span>initctl p
&#160;
    <span class="co0"># Create folders</span>
    <span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="re1">$rootfs</span><span class="sy0">/</span><span class="br0">&#123;</span>proc,sys,run<span class="br0">&#125;</span>
&#160;
    <span class="co0"># Do not use fstab</span>
    <span class="kw2">mv</span> <span class="re1">$rootfs</span><span class="sy0">/</span>etc<span class="sy0">/</span>fstab<span class="br0">&#123;</span>,.old<span class="br0">&#125;</span>
    <span class="kw2">touch</span> <span class="re1">$rootfs</span><span class="sy0">/</span>etc<span class="sy0">/</span>fstab
&#160;
    <span class="co0"># squeeze only has /dev/tty and /dev/tty0 by default,</span>
    <span class="co0"># therefore creating missing device nodes for tty1-4.</span>
    <span class="kw1">for</span> tty <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">1</span> <span class="nu0">4</span><span class="br0">&#41;</span>; <span class="kw1">do</span>
    <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="sy0">!</span> <span class="re5">-e</span> <span class="re1">$rootfs</span><span class="sy0">/</span>dev<span class="sy0">/</span>tty<span class="re1">$tty</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
        <span class="kw2">mknod</span> <span class="re1">$rootfs</span><span class="sy0">/</span>dev<span class="sy0">/</span>tty<span class="re1">$tty</span> c <span class="nu0">4</span> <span class="re1">$tty</span>
    <span class="kw1">fi</span>
    <span class="kw1">done</span>
&#160;
    <span class="co0"># configure the inittab</span>
    <span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span>EOF <span class="sy0">&gt;</span> <span class="re1">$rootfs</span><span class="sy0">/</span>etc<span class="sy0">/</span>inittab
id:<span class="nu0">2</span>:initdefault:
si::sysinit:<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>rcS
l0:<span class="nu0">0</span>:wait:<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>rc <span class="nu0">0</span>
l1:<span class="nu0">1</span>:wait:<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>rc <span class="nu0">1</span>
l2:<span class="nu0">2</span>:wait:<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>rc <span class="nu0">2</span>
l3:<span class="nu0">3</span>:wait:<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>rc <span class="nu0">3</span>
l4:<span class="nu0">4</span>:wait:<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>rc <span class="nu0">4</span>
l5:<span class="nu0">5</span>:wait:<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>rc <span class="nu0">5</span>
l6:<span class="nu0">6</span>:wait:<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>rc <span class="nu0">6</span>
<span class="co0"># Normally not reached, but fallthrough in case of emergency.</span>
z6:<span class="nu0">6</span>:respawn:<span class="sy0">/</span>sbin<span class="sy0">/</span>sulogin
<span class="nu0">1</span>:<span class="nu0">2345</span>:respawn:<span class="sy0">/</span>sbin<span class="sy0">/</span>getty <span class="nu0">38400</span> console
c1:<span class="nu0">12345</span>:respawn:<span class="sy0">/</span>sbin<span class="sy0">/</span>getty <span class="nu0">38400</span> tty1 linux
c2:<span class="nu0">12345</span>:respawn:<span class="sy0">/</span>sbin<span class="sy0">/</span>getty <span class="nu0">38400</span> tty2 linux
c3:<span class="nu0">12345</span>:respawn:<span class="sy0">/</span>sbin<span class="sy0">/</span>getty <span class="nu0">38400</span> tty3 linux
c4:<span class="nu0">12345</span>:respawn:<span class="sy0">/</span>sbin<span class="sy0">/</span>getty <span class="nu0">38400</span> tty4 linux
EOF
&#160;
    <span class="co0"># add daemontools-run entry</span>
    <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-e</span> <span class="re1">$rootfs</span><span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>dpkg<span class="sy0">/</span>info<span class="sy0">/</span>daemontools.list <span class="br0">&#93;</span>; <span class="kw1">then</span>
        <span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span>EOF <span class="sy0">&gt;&gt;</span> <span class="re1">$rootfs</span><span class="sy0">/</span>etc<span class="sy0">/</span>inittab
<span class="co0">#-- daemontools-run begin</span>
SV:<span class="nu0">123456</span>:respawn:<span class="sy0">/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span>svscanboot
<span class="co0">#-- daemontools-run end</span>
EOF
    <span class="kw1">fi</span>
&#160;
    <span class="co0"># Remove grub and kernel</span>
    <span class="kw2">chroot</span> <span class="re1">$rootfs</span> <span class="kw2">apt-get</span> <span class="re5">--yes</span> <span class="re5">-o</span>  Dpkg::Options::=<span class="st0">&quot;--force-confdef&quot;</span> <span class="re5">-o</span> Dpkg::Options::=<span class="st0">&quot;--force-confold&quot;</span> remove grub grub2 grub-pc grub-common linux-image-amd64
&#160;
    <span class="co0"># remove pointless services in a container</span>
    <span class="kw2">chroot</span> <span class="re1">$rootfs</span> <span class="st0">&quot;LANG=C /usr/sbin/update-rc.d -f checkroot.sh remove&quot;</span> <span class="co0"># S</span>
    <span class="kw2">chroot</span> <span class="re1">$rootfs</span> <span class="st0">&quot;LANG=C /usr/sbin/update-rc.d checkroot.sh stop 09 S .&quot;</span>
&#160;
    <span class="kw2">chroot</span> <span class="re1">$rootfs</span> <span class="st0">&quot;LANG=C /usr/sbin/update-rc.d -f umountfs remove&quot;</span> <span class="co0"># 0 6</span>
    <span class="kw2">chroot</span> <span class="re1">$rootfs</span> <span class="st0">&quot;LANG=C /usr/sbin/update-rc.d umountfs start 09 0 6 .&quot;</span>
&#160;
    <span class="kw2">chroot</span> <span class="re1">$rootfs</span> <span class="st0">&quot;LANG=C /usr/sbin/update-rc.d -f umountroot remove&quot;</span> <span class="co0"># 0 6</span>
    <span class="kw2">chroot</span> <span class="re1">$rootfs</span> <span class="st0">&quot;LANG=C /usr/sbin/update-rc.d umountroot start 10 0 6 .&quot;</span>
&#160;
    <span class="co0"># The following initscripts don't provide an empty start or stop block.</span>
    <span class="co0"># To prevent them being enabled on upgrades, we leave a start link on</span>
    <span class="co0"># runlevel 3.</span>
    <span class="kw2">chroot</span> <span class="re1">$rootfs</span> <span class="st0">&quot;LANG=C /usr/sbin/update-rc.d -f hwclock.sh remove&quot;</span> <span class="co0"># S 0 6</span>
    <span class="kw2">chroot</span> <span class="re1">$rootfs</span> <span class="st0">&quot;LANG=C /usr/sbin/update-rc.d hwclock.sh start 10 3 .&quot;</span>
&#160;
    <span class="kw2">chroot</span> <span class="re1">$rootfs</span> <span class="st0">&quot;LANG=C /usr/sbin/update-rc.d -f hwclockfirst.sh remove&quot;</span> <span class="co0"># S</span>
    <span class="kw2">chroot</span> <span class="re1">$rootfs</span> <span class="st0">&quot;LANG=C /usr/sbin/update-rc.d hwclockfirst start 08 3 .&quot;</span>
&#160;
    <span class="kw2">chroot</span> <span class="re1">$rootfs</span> <span class="st0">&quot;LANG=C /usr/sbin/update-rc.d -f module-init-tools remove&quot;</span> <span class="co0"># S</span>
    <span class="kw2">chroot</span> <span class="re1">$rootfs</span> <span class="st0">&quot;LANG=C /usr/sbin/update-rc.d module-init-tools start 10 3 .&quot;</span>
&#160;
    <span class="kw3">return</span> <span class="nu0">0</span>
<span class="br0">&#125;</span>
&#160;
copy_configuration<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="re2">path</span>=<span class="re4">$1</span>
    <span class="re2">rootfs</span>=<span class="re4">$2</span>
    <span class="re2">name</span>=<span class="re4">$3</span>
&#160;
    <span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span>EOF <span class="sy0">&gt;</span> <span class="re1">$path</span><span class="sy0">/</span>config
<span class="co0"># $path/config</span>
&#160;
<span class="co0">## Container</span>
lxc.utsname                             = <span class="re1">$hostname</span>
lxc.tty                                 = <span class="nu0">4</span>
lxc.pts                                 = <span class="nu0">1024</span>
<span class="co0">#lxc.console                            = /var/log/lxc/$name.console</span>
&#160;
<span class="co0">## Capabilities</span>
<span class="co0">#lxc.cap.drop                           = mac_admin</span>
<span class="co0">#lxc.cap.drop                           = mac_override</span>
lxc.cap.drop                            = sys_admin
<span class="co0">#lxc.cap.drop                           = sys_module</span>
&#160;
<span class="co0">## Devices</span>
<span class="co0"># Allow all devices</span>
<span class="co0">#lxc.cgroup.devices.allow = a</span>
<span class="co0"># Deny all devices</span>
lxc.cgroup.devices.deny = a
<span class="co0"># /dev/null and zero</span>
lxc.cgroup.devices.allow = c <span class="nu0">1</span>:<span class="nu0">3</span> rwm
lxc.cgroup.devices.allow = c <span class="nu0">1</span>:<span class="nu0">5</span> rwm
<span class="co0"># /dev/consoles</span>
lxc.cgroup.devices.allow = c <span class="nu0">5</span>:<span class="nu0">1</span> rwm
<span class="co0"># /dev/tty</span>
lxc.cgroup.devices.allow = c <span class="nu0">5</span>:<span class="nu0">0</span> rwm
lxc.cgroup.devices.allow = c <span class="nu0">4</span>:<span class="nu0">0</span> rwm
lxc.cgroup.devices.allow = c <span class="nu0">4</span>:<span class="nu0">1</span> rwm
<span class="co0"># /dev/{,u}random</span>
lxc.cgroup.devices.allow = c <span class="nu0">1</span>:<span class="nu0">9</span> rwm
<span class="co0"># /dev/random</span>
lxc.cgroup.devices.allow = c <span class="nu0">1</span>:<span class="nu0">8</span> rwm
<span class="co0"># /dev/pts/*</span>
lxc.cgroup.devices.allow = c <span class="nu0">136</span>:<span class="sy0">*</span> rwm
<span class="co0"># /dev/ptmx</span>
lxc.cgroup.devices.allow = c <span class="nu0">5</span>:<span class="nu0">2</span> rwm
<span class="co0"># /dev/rtc</span>
lxc.cgroup.devices.allow = c <span class="nu0">254</span>:<span class="nu0">0</span> rwm
<span class="co0"># /dev/fuse</span>
lxc.cgroup.devices.allow = c <span class="nu0">10</span>:<span class="nu0">229</span> rwm
&#160;
<span class="co0">## Limits</span>
<span class="co0">#lxc.cgroup.cpu.shares                  = 1024</span>
<span class="co0">#lxc.cgroup.cpuset.cpus                 = 0</span>
<span class="co0">#lxc.cgroup.memory.limit_in_bytes       = 256M</span>
<span class="co0">#lxc.cgroup.memory.memsw.limit_in_bytes = 1G</span>
<span class="co0">#lxc.cgroup.blkio.weight                = 500</span>
&#160;
&#160;
<span class="co0">## Filesystem</span>
lxc.mount.entry                         = proc <span class="re1">$rootfs</span><span class="sy0">/</span>proc proc nodev,noexec,nosuid <span class="nu0">0</span> <span class="nu0">0</span>
lxc.mount.entry                         = sysfs <span class="re1">$rootfs</span><span class="sy0">/</span>sys sysfs defaults,ro <span class="nu0">0</span> <span class="nu0">0</span>
lxc.rootfs                              = <span class="re1">$rootfs</span>
<span class="co0"># LVM</span>
<span class="co0">#lxc.rootfs                             = /dev/vg/lvname</span>
EOF
&#160;
    <span class="co0"># Adding shared data directory if existing</span>
    <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-d</span> <span class="sy0">/</span>srv<span class="sy0">/</span>share<span class="sy0">/</span><span class="re1">$hostname</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
    <span class="kw3">echo</span> <span class="st0">&quot;lxc.mount.entry                         = /srv/share/<span class="es2">$hostname</span> <span class="es2">$rootfs</span>/srv/<span class="es2">$hostname</span> none defaults,bind 0 0&quot;</span> <span class="sy0">&gt;&gt;</span> <span class="re1">$path</span><span class="sy0">/</span>config
    <span class="kw1">else</span>
    <span class="kw3">echo</span> <span class="st0">&quot;#lxc.mount.entry                        = /srv/share/<span class="es2">$hostname</span> <span class="es2">$rootfs</span>/srv/<span class="es2">$hostname</span> none defaults,bind 0 0&quot;</span> <span class="sy0">&gt;&gt;</span> <span class="re1">$path</span><span class="sy0">/</span>config
    <span class="kw1">fi</span>
&#160;
    <span class="re2">gen_mac</span>=<span class="sy0">`</span>openssl rand <span class="re5">-hex</span> <span class="nu0">6</span> <span class="sy0">|</span> <span class="kw2">sed</span> <span class="st_h">'s/\(..\)/\1:/g; s/.$//'</span><span class="sy0">`</span>
    <span class="kw2">cat</span> <span class="sy0">&gt;&gt;</span> <span class="re1">$path</span><span class="sy0">/</span>config <span class="co2">&lt;&lt; EOF
&#160;
#lxc.mount.entry                        = /srv/$hostname $rootfs/srv/$hostname none defaults,bind 0 0
&#160;
## Network
lxc.network.type                        = veth
lxc.network.flags                       = up
#lxc.network.hwaddr                      = $gen_mac
lxc.network.link                        = lxcbr0
lxc.network.name                        = eth0
lxc.network.veth.pair                   = veth-$hostname
EOF</span>
&#160;
    <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re4">$?</span> <span class="re5">-ne</span> <span class="nu0">0</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
    <span class="kw3">echo</span> <span class="st0">&quot;Failed to add configuration&quot;</span>
    <span class="kw3">return</span> <span class="nu0">1</span>
    <span class="kw1">fi</span>
&#160;
    <span class="kw3">return</span> <span class="nu0">0</span>
<span class="br0">&#125;</span>
&#160;
&#160;
usage<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="kw2">cat</span> <span class="co2">&lt;&lt;EOF
$1 -h|--help -p|--path=&lt;path&gt; -n|--name=name
EOF</span>
    <span class="kw3">return</span> <span class="nu0">0</span>
<span class="br0">&#125;</span>
&#160;
<span class="re2">options</span>=$<span class="br0">&#40;</span><span class="kw2">getopt</span> <span class="re5">-o</span> hp:n:c <span class="re5">-l</span> <span class="kw3">help</span>,path:,name:,clean <span class="re5">--</span> <span class="st0">&quot;$@&quot;</span><span class="br0">&#41;</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re4">$?</span> <span class="re5">-ne</span> <span class="nu0">0</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
        usage $<span class="br0">&#40;</span><span class="kw2">basename</span> <span class="re4">$0</span><span class="br0">&#41;</span>
    <span class="kw3">exit</span> <span class="nu0">1</span>
<span class="kw1">fi</span>
<span class="kw3">eval</span> <span class="kw1">set</span> <span class="re5">--</span> <span class="st0">&quot;<span class="es2">$options</span>&quot;</span>
&#160;
<span class="kw1">while</span> <span class="kw2">true</span>
<span class="kw1">do</span>
    <span class="kw1">case</span> <span class="st0">&quot;$1&quot;</span> <span class="kw1">in</span>
        <span class="re5">-h</span><span class="sy0">|</span>--help<span class="br0">&#41;</span>      usage <span class="re4">$0</span> <span class="sy0">&amp;&amp;</span> <span class="kw3">exit</span> <span class="nu0">0</span><span class="sy0">;;</span>
        <span class="re5">-p</span><span class="sy0">|</span>--path<span class="br0">&#41;</span>      <span class="re2">path</span>=<span class="re4">$2</span>; <span class="kw3">shift</span> <span class="nu0">2</span><span class="sy0">;;</span>
        <span class="re5">-n</span><span class="sy0">|</span>--name<span class="br0">&#41;</span>      <span class="re2">name</span>=<span class="re4">$2</span>; <span class="kw3">shift</span> <span class="nu0">2</span><span class="sy0">;;</span>
        --<span class="br0">&#41;</span>             <span class="kw3">shift</span> <span class="nu0">1</span>; <span class="kw3">break</span> <span class="sy0">;;</span>
        <span class="sy0">*</span><span class="br0">&#41;</span>              <span class="kw3">break</span> <span class="sy0">;;</span>
    <span class="kw1">esac</span>
<span class="kw1">done</span>
&#160;
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="sy0">!</span> <span class="re5">-z</span> <span class="st0">&quot;<span class="es2">$clean</span>&quot;</span> <span class="re5">-a</span> <span class="re5">-z</span> <span class="st0">&quot;<span class="es2">$path</span>&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
    clean <span class="sy0">||</span> <span class="kw3">exit</span> <span class="nu0">1</span>
    <span class="kw3">exit</span> <span class="nu0">0</span>
<span class="kw1">fi</span>
&#160;
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-z</span> <span class="st0">&quot;<span class="es2">$path</span>&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
    <span class="kw3">echo</span> <span class="st0">&quot;'path' parameter is required&quot;</span>
    <span class="kw3">exit</span> <span class="nu0">1</span>
<span class="kw1">fi</span>
&#160;
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es4">$(id -u)</span>&quot;</span> <span class="sy0">!</span>= <span class="st0">&quot;0&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
    <span class="kw3">echo</span> <span class="st0">&quot;This script should be run as 'root'&quot;</span>
    <span class="kw3">exit</span> <span class="nu0">1</span>
<span class="kw1">fi</span>
&#160;
<span class="re2">rootfs</span>=<span class="re1">$path</span><span class="sy0">/</span>rootfs
&#160;
configure_debian <span class="re1">$rootfs</span> <span class="re1">$name</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re4">$?</span> <span class="re5">-ne</span> <span class="nu0">0</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
    <span class="kw3">echo</span> <span class="st0">&quot;failed to configure debian for a container&quot;</span>
    <span class="kw3">exit</span> <span class="nu0">1</span>
<span class="kw1">fi</span>
&#160;
copy_configuration <span class="re1">$path</span> <span class="re1">$rootfs</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re4">$?</span> <span class="re5">-ne</span> <span class="nu0">0</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
    <span class="kw3">echo</span> <span class="st0">&quot;failed write configuration file&quot;</span>
    <span class="kw3">exit</span> <span class="nu0">1</span>
<span class="kw1">fi</span></pre></div></div>
</td></tr></table><br />
<p>To use it, it's easy. First of all mount or copy all your datas in the rootfs folder, <b>be sure to have enough space</b>, then launch the lxc-convert script like in this example&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">migrated_container=migrated_container
mkdir -p /var/lib/lxc/$migrated_container/rootfs
rsync -e ssh -a --exclude '/dev' --exclude '/proc' --exclude '/sys' &lt;old_vm&gt;:/ /var/lib/lxc/$migrated_container/rootfs
lxc-convert -p /var/lib/lxc/$migrated_container -n $migrated_container</pre></div></div>
</td></tr></table><br />
<p>Adapt the remote host to your distant SSH host or rsync without SSH if it's possible. During the transfer, you need to exclude some folders to avoid errors (/proc, /sys, /dev). They will be recreated during the lxc-convert.
</p><p>Then you'll be able to start it&#160;:-)
</p>
<h1><span class="mw-headline" id="Container_configuration"><span class="mw-headline-number">6</span> Container configuration</span></h1>
<p>Once you've initialized your container, there are a lot of interesting options. Here are some for a classical configuration&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">## Container
# Container name
lxc.utsname                             = mycontainer
# Path where default container is based
lxc.rootfs                              = /var/lib/lxc/mycontainer/rootfs
# Set architecture type
lxc.arch                                = x86_64
#lxc.console                            = /var/log/lxc/mycontainer.console
# Number of tty/pts available for that container
lxc.tty                                 = 6
lxc.pts                                 = 1024
&#160;
## Capabilities
lxc.cap.drop                            = mac_admin
lxc.cap.drop                            = mac_override
lxc.cap.drop                            = sys_admin
lxc.cap.drop                            = sys_module
## Devices
# Allow all devices
#lxc.cgroup.devices.allow               = a
# Deny all devices
lxc.cgroup.devices.deny                 = a
# Allow to mknod all devices (but not using them)
lxc.cgroup.devices.allow                = c *:* m
lxc.cgroup.devices.allow                = b *:* m
&#160;
# /dev/console
lxc.cgroup.devices.allow                = c 5:1 rwm
# /dev/fuse
lxc.cgroup.devices.allow                = c 10:229 rwm
# /dev/null
lxc.cgroup.devices.allow                = c 1:3 rwm
# /dev/ptmx
lxc.cgroup.devices.allow                = c 5:2 rwm
# /dev/pts/*
lxc.cgroup.devices.allow                = c 136:* rwm
# /dev/random
lxc.cgroup.devices.allow                = c 1:8 rwm
# /dev/rtc
lxc.cgroup.devices.allow                = c 254:0 rwm
# /dev/tty
lxc.cgroup.devices.allow                = c 5:0 rwm
# /dev/urandom
lxc.cgroup.devices.allow                = c 1:9 rwm
# /dev/zero
lxc.cgroup.devices.allow                = c 1:5 rwm
&#160;
## Limits
#lxc.cgroup.cpu.shares                  = 1024
#lxc.cgroup.cpuset.cpus                 = 0
#lxc.cgroup.memory.limit_in_bytes       = 256M
#lxc.cgroup.memory.memsw.limit_in_bytes = 1G
&#160;
## Filesystem
# fstab for the containers with advanced features like bindind mount.
# Mount bind between host and containers (mount --bind equivalent)
lxc.mount.entry                         = proc /var/lib/lxc/mycontainer/rootfs/proc proc nodev,noexec,nosuid 0 0
lxc.mount.entry                         = sysfs /var/lib/lxc/mycontainer/rootfs/sys sysfs defaults,ro 0 0
#lxc.mount.entry                        = /srv/mycontainer /var/lib/lxc/mycontainer/rootfs/srv/mycontainer none defaults,bind 0 0
&#160;
## Network
lxc.network.type                        = veth
lxc.network.flags                       = up
lxc.network.hwaddr                      = 11:22:33:44:55:66
lxc.network.link                        = br0
lxc.network.mtu                         = 1500
lxc.network.name                        = eth0
lxc.network.veth.pair                   = veth-$name</pre></div></div>
</td></tr></table><br />
<p>For an LVM configuration&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.tty = 4
lxc.pts = 1024
lxc.utsname = mycontainer
&#160;
## Capabilities
lxc.cap.drop                            = sys_admin
&#160;
# When using LXC with apparmor, uncomment the next line to run unconfined:
#lxc.aa_profile = unconfined
&#160;
lxc.cgroup.devices.deny = a
# /dev/null and zero
lxc.cgroup.devices.allow = c 1:3 rwm
lxc.cgroup.devices.allow = c 1:5 rwm
# consoles
lxc.cgroup.devices.allow = c 5:1 rwm
lxc.cgroup.devices.allow = c 5:0 rwm
lxc.cgroup.devices.allow = c 4:0 rwm
lxc.cgroup.devices.allow = c 4:1 rwm
# /dev/{,u}random
lxc.cgroup.devices.allow = c 1:9 rwm
lxc.cgroup.devices.allow = c 1:8 rwm
lxc.cgroup.devices.allow = c 136:* rwm
lxc.cgroup.devices.allow = c 5:2 rwm
# rtc
lxc.cgroup.devices.allow = c 254:0 rwm
&#160;
# mounts point
lxc.mount.entry = proc proc proc nodev,noexec,nosuid 0 0
lxc.mount.entry = sysfs sys sysfs defaults  0 0
lxc.rootfs = /dev/vg/mycontainer</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Architectures"><span class="mw-headline-number">6.1</span> Architectures</span></h2>
<p>You can set the container architecture on a container. For example, you can use an x86 container on a x64 kernel&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.arch=x86</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Capabilities"><span class="mw-headline-number">6.2</span> Capabilities</span></h2>
<p>You can specify the capability to be dropped in the container. A single line defining several capabilities with a space separation is allowed. The format is the lower case of the capability definition without the "CAP_" prefix, eg. CAP_SYS_MODULE should be specified as sys_module. You can see the complete list of linux capabilities with explanations by reading the man page&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> man</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">man 7 capabilities</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Devices"><span class="mw-headline-number">6.3</span> Devices</span></h2>
<p>You can manage (allow/deny) accessible devices directly from your containers. By default, everything is disabled&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">## Devices
# Allow all devices
#lxc.cgroup.devices.allow               = a
# Deny all devices
lxc.cgroup.devices.deny                 = a</pre></div></div>
</td></tr></table><br />
<ul><li> a&#160;: means all devices</li></ul>
<p>You can then allow some of them easily<sup id="cite_ref-5" class="reference"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_note-5">[5]</a></sup>&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.cgroup.devices.allow = c 5:1 rwm # dev/console
lxc.cgroup.devices.allow = c 5:0 rwm # dev/tty
lxc.cgroup.devices.allow = c 4:0 rwm # dev/tty0</pre></div></div>
</td></tr></table><br />
<p>To get the complete list of allowed devices&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-cgroup</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc-cgroup -n mycontainer devices.list</pre></div></div>
</td></tr></table><br />
<p>To get a better understanding of this, here are explanations<sup id="cite_ref-6" class="reference"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_note-6">[6]</a></sup>&#160;:
</p>
<pre>lxc.cgroup.devices.allow = &lt;type&gt; &lt;major&gt;:&lt;minor&gt; &lt;perm&gt;
</pre>
<ul><li> &lt;type&gt;&#160;: b (block), c (char), etc ...</li>
<li> &lt;major&gt;&#160;: major number</li>
<li> &lt;minor&gt;&#160;: minor number (wildcard is accepted)</li>
<li> &lt;perms&gt;&#160;: r (read), w (write), m (mapping)</li></ul>
<h2><span class="mw-headline" id="Container_limits_.28cgroups.29"><span class="mw-headline-number">6.4</span> Container limits (cgroups)</span></h2>
<p>If you've never played with Cgroups, <a href="Latence_des_process_et_kernel_timing.html" title="Latence des process et kernel timing">look at my documentation</a>. With LXC, here are the available ways to setup cgroups to your containers&#160;:
</p>
<ul><li> You can change cgroups values with lxc-cgroup command (on the fly):</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-cgroup</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1">lxc-cgroup <span class="re5">-n</span> <span class="sy0">&lt;</span>container_name<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>cgroup-name<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>value<span class="sy0">&gt;</span></pre></div></div>
</td></tr></table><br />
<ul><li> You can directly play with /proc (on the fly):</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> echo</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1"><span class="kw3">echo</span> <span class="sy0">&lt;</span>value<span class="sy0">&gt;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>sys<span class="sy0">/</span>fs<span class="sy0">/</span>cgroup<span class="sy0">/</span>lxc<span class="sy0">/&lt;</span>container_name<span class="sy0">&gt;/&lt;</span>cgroup-name<span class="sy0">&gt;</span></pre></div></div>
</td></tr></table><br />
<ul><li> And set it directly in the config file (persistent way)&#160;:</li></ul>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.cgroup.&lt;cgroup-name&gt; = &lt;value&gt;</pre></div></div>
</td></tr></table><br />
<p>Cgroups can be changed on the fly.
</p>
<table width="100%" class="warning_array">
<tr>
<td class="warning_subarray"> <font size="-1"><a href="./File:Warning_file.png.html" class="image" title="Warning"><img alt="Warning" src="images/0/09/Warning_file.png" width="39" height="32" /></a> <b>WARNING</b></font>
</td></tr>
<tr>
<td>
<p>You should warn when you reduce some of them, especially the memory (be sure that you do not reduce more than used).
</p>
</td></tr></table><br />
<p>If you want to see available cgroups for a container&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ls</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; ls -1 /sys/fs/cgroup/lxc/&lt;container_name&gt;
blkio.io_merged
blkio.io_queued
blkio.io_service_bytes
blkio.io_serviced
blkio.io_service_time
blkio.io_wait_time
blkio.reset_stats
blkio.sectors
blkio.time
blkio.weight
blkio.weight_device
cgroup.clone_children
cgroup.event_control
cgroup.procs
cpuacct.stat
cpuacct.usage
cpuacct.usage_percpu
cpuset.cpu_exclusive
cpuset.cpus
cpuset.mem_exclusive
cpuset.mem_hardwall
cpuset.memory_migrate
cpuset.memory_pressure
cpuset.memory_spread_page
cpuset.memory_spread_slab
cpuset.mems
cpuset.sched_load_balance
cpuset.sched_relax_domain_level
cpu.shares
devices.allow
devices.deny
devices.list
freezer.state
memory.failcnt
memory.force_empty
memory.limit_in_bytes
memory.max_usage_in_bytes
memory.memsw.failcnt
memory.memsw.limit_in_bytes
memory.memsw.max_usage_in_bytes
memory.memsw.usage_in_bytes
memory.move_charge_at_immigrate
memory.numa_stat
memory.oom_control
memory.soft_limit_in_bytes
memory.stat
memory.swappiness
memory.usage_in_bytes
memory.use_hierarchy
net_cls.classid
notify_on_release
tasks</pre></div></div>
</td></tr></table><br />
<p><br />
</p>
<h3><span class="mw-headline" id="CPU"><span class="mw-headline-number">6.4.1</span> CPU</span></h3>
<h4><span class="mw-headline" id="CPU_Pining"><span class="mw-headline-number">6.4.1.1</span> CPU Pining</span></h4>
<p>If you want to bind some CPU/Cores to a VM/Container, there is a solution called CPU Pining&#160;:-). First, look at the available cores on your server&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> grep</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; grep -e processor -e core /proc/cpuinfo | sed 's/processor/\nprocessor/'
&#160;
processor	: 0
core id		: 0
cpu cores	: 4
&#160;
processor	: 1
core id		: 1
cpu cores	: 4
&#160;
processor	: 2
core id		: 2
cpu cores	: 4
&#160;
processor	: 3
core id		: 3
cpu cores	: 4
&#160;
processor	: 4
core id		: 0
cpu cores	: 4
&#160;
processor	: 5
core id		: 1
cpu cores	: 4
&#160;
processor	: 6
core id		: 2
cpu cores	: 4
&#160;
processor	: 7
core id		: 3
cpu cores	: 4</pre></div></div>
</td></tr></table><br />
<p>You can see there are 7 cores (called processor). In fact there are 4 cores with 2 thread each on this CPU. That's why there are 4 cores id and 8 detected cores.
</p><p>So here is the list of the cores with their attached core&#160;:
</p>
<pre>core id 0&#160;: processors 0 and 4
core id 1&#160;: processors 1 and 5
core id 2&#160;: processors 2 and 6
core id 3&#160;: processors 3 and 7
</pre>
<p>Now if I want to dedicate a set of cores to a container&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.cgroup.cpuset.cpus = 0-3</pre></div></div>
</td></tr></table><br />
<p>This will add the 4 firsts cores to the container. Then if I only want CPU 1 and 3&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.cgroup.cpuset.cpus = 1,3</pre></div></div>
</td></tr></table><br />
<h5><span class="mw-headline" id="Check_CPU_assignments"><span class="mw-headline-number">6.4.1.1.1</span> Check CPU assignments</span></h5>
<p>You can check how many CPU Pining are working for a container. On the host file, launch "htop" for example and in the container launch stress&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> stress</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude install stress
stress --cpu 2 --timeout 10s</pre></div></div>
</td></tr></table><br />
<p>This will stress 2 CPU at 100% for 10 seconds. You'll see your htop CPU bars at 100%. If I change 2 by 3 and only binded 2 CPUs, only 2 will be at 100%&#160;:-)
</p>
<h4><span class="mw-headline" id="Scheduler"><span class="mw-headline-number">6.4.1.2</span> Scheduler</span></h4>
<p>This is the other method to assign CPU to a container. You need to add weight to VMs so that the scheduler can decide which container should use CPU time form the CPU clock. For instance, if a container is set to 512 and another to 1024, the last one will have twice more CPU time than the first container. To edit this property&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.cgroup.cpu.shares = 512</pre></div></div>
</td></tr></table><br />
<p>If you need more documentation, look at <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/Documentation/scheduler/sched-design-CFS.txt">the kernel page</a><sup id="cite_ref-7" class="reference"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_note-7">[7]</a></sup>.
</p><p><br />
</p>
<h3><span class="mw-headline" id="Memory"><span class="mw-headline-number">6.4.2</span> Memory</span></h3>
<p>You can limit the memory in a container like this&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.cgroup.memory.limit_in_bytes = 128M</pre></div></div>
</td></tr></table><br />
<p>If you've got error when trying to limit memory, <a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Can.27t_limit_container_memory">check the FAQ</a>.
</p>
<h4><span class="mw-headline" id="Check_memory_from_the_host"><span class="mw-headline-number">6.4.2.1</span> Check memory from the host</span></h4>
<p>You can check memory from the host like that<sup id="cite_ref-8" class="reference"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_note-8">[8]</a></sup>&#160;:
</p>
<ul><li> Current memory usage:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cat</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cat /sys/fs/cgroup/lxc/mycontainer/memory.usage_in_bytes</pre></div></div>
</td></tr></table><br />
<ul><li> Current memory + swap usage:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cat</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cat /sys/fs/cgroup/lxc/mycontainer/memory.memsw.usage_in_bytes</pre></div></div>
</td></tr></table><br />
<ul><li> Maximum memory usage:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cat</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cat /sys/fs/cgroup/lxc/mycontainer/memory.max_usage_in_bytes</pre></div></div>
</td></tr></table><br />
<ul><li> Maximum memory + swap usage&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cat</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">cat /sys/fs/cgroup/lxc/mycontainer/memory.memsw.max_usage_in_bytes</pre></div></div>
</td></tr></table><br />
<p>Here is an easier solution to read informations&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> awk</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1"><span class="kw2">awk</span> <span class="st_h">'{ printf &quot;%sK\n&quot;, $1/ 1024 }'</span> <span class="sy0">/</span>sys<span class="sy0">/</span>fs<span class="sy0">/</span>cgroup<span class="sy0">/</span>lxc<span class="sy0">/</span>mycontainer<span class="sy0">/</span>memory.usage_in_bytes
<span class="kw2">awk</span> <span class="st_h">'{ printf &quot;%sM\n&quot;, $1/ 1024 / 1024 }'</span> <span class="sy0">/</span>sys<span class="sy0">/</span>fs<span class="sy0">/</span>cgroup<span class="sy0">/</span>lxc<span class="sy0">/</span>mycontainer<span class="sy0">/</span>memory.usage_in_bytes</pre></div></div>
</td></tr></table><br />
<h4><span class="mw-headline" id="Check_memory_in_the_container"><span class="mw-headline-number">6.4.2.2</span> Check memory in the container</span></h4>
<p>The actual problem is you can't check how many memory you've set and is available for your container. For the moment /proc/meminfo is not correctly updated<sup id="cite_ref-9" class="reference"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_note-9">[9]</a></sup>. If you need to validate the available memory on a container, you have to write fake data into the allocated memory area to trigger the memory checks of the kernel/visualization tool.
</p><p><a href="Les_caches_mémoire.html#Gestion_de_l.27overcommit" title="Les caches mémoire">Memory overcommit</a> is a Linux kernel feature that lets applications allocate more memory than is actually available. The idea behind this feature is that some applications allocate large amounts of memory just in case, but never actually use it. Thus, memory overcommit allows you to run more applications than actually fit in your memory, provided the applications don’t actually use the memory they have allocated. If they do, then the kernel (via OOM killer) terminates the application.
</p><p>Here is the code<sup id="cite_ref-10" class="reference"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_note-10">[10]</a></sup>&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> memory_allocation.c</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="c source-c"><pre class="de1"><span class="co2">#include &lt;stdio.h&gt;</span>
<span class="co2">#include &lt;stdlib.h&gt;</span>
<span class="co2">#include &lt;string.h&gt;</span>
<span class="co2">#include &lt;unistd.h&gt;</span>
&#160;
main<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&#160;
   <span class="kw4">int</span> i<span class="sy0">;</span>
   <span class="kw1">for</span><span class="br0">&#40;</span>i<span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span>i<span class="sy0">&lt;</span><span class="nu0">9000</span><span class="sy0">;</span>i<span class="sy0">++</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw4">int</span> <span class="sy0">*</span>ptr <span class="sy0">=</span> <span class="kw3">malloc</span><span class="br0">&#40;</span>i<span class="sy0">*</span><span class="nu0">1024</span><span class="sy0">*</span><span class="nu0">1024</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span>ptr <span class="sy0">==</span> NULL<span class="br0">&#41;</span> <span class="br0">&#123;</span>
          <span class="kw3">printf</span> <span class="br0">&#40;</span><span class="st0">&quot;Soft memory allocation failed for&#160;%i MB<span class="es1">\n</span>&quot;</span><span class="sy0">,</span>i <span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="kw2">break</span><span class="sy0">;</span>
        <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
            <span class="kw3">free</span><span class="br0">&#40;</span>ptr<span class="br0">&#41;</span><span class="sy0">;</span>
            ptr <span class="sy0">=</span> NULL<span class="sy0">;</span>
        <span class="br0">&#125;</span>
   <span class="br0">&#125;</span>
&#160;
&#160;
   <span class="kw1">for</span><span class="br0">&#40;</span>i<span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span>i<span class="sy0">&lt;</span><span class="nu0">9000</span><span class="sy0">;</span>i<span class="sy0">++</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> 
&#160;
        <span class="kw4">int</span> <span class="sy0">*</span>ptr <span class="sy0">=</span> <span class="kw3">malloc</span><span class="br0">&#40;</span>i<span class="sy0">*</span><span class="nu0">1024</span><span class="sy0">*</span><span class="nu0">1024</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span>ptr <span class="sy0">==</span> NULL<span class="br0">&#41;</span> <span class="br0">&#123;</span>
          <span class="kw3">printf</span> <span class="br0">&#40;</span><span class="st0">&quot;Memory allocation failed for&#160;%i MB<span class="es1">\n</span>&quot;</span><span class="sy0">,</span>i <span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="kw2">break</span><span class="sy0">;</span>
        <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
            <span class="kw3">memset</span><span class="br0">&#40;</span>ptr<span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> i<span class="sy0">*</span><span class="nu0">1024</span><span class="sy0">*</span><span class="nu0">1024</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="kw3">printf</span><span class="br0">&#40;</span><span class="st0">&quot;Wrote&#160;%i MB to memory<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> i<span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="co1">//usleep(1000);</span>
            <span class="kw3">free</span><span class="br0">&#40;</span>ptr<span class="br0">&#41;</span><span class="sy0">;</span>  
            ptr <span class="sy0">=</span> NULL<span class="sy0">;</span>
        <span class="br0">&#125;</span>
&#160;
   <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></div></div>
</td></tr></table><br />
<p>Then compil it (with gcc)&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> gcc</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude install gcc
gcc memory_allocation.c -o memory_allocation</pre></div></div>
</td></tr></table><br />
<p>You can now run the test&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> memory_allocation</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; ./memory_allocation
Soft memory allocation failed for 654 MB
Wrote 0 MB to memory
Wrote 1 MB to memory
Wrote 2 MB to memory
Wrote 3 MB to memory
[...]
Wrote 185 MB to memory
Wrote 186 MB to memory
Wrote 187 MB to memory
Wrote 188 MB to memory
Killed</pre></div></div>
</td></tr></table><br />
<p><br />
</p>
<h3><span class="mw-headline" id="SWAP"><span class="mw-headline-number">6.4.3</span> SWAP</span></h3>
<p>You can limit the swap in a container like this&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.cgroup.memory.memsw.limit_in_bytes = 192M</pre></div></div>
</td></tr></table><br />
<table width="100%" class="warning_array">
<tr>
<td class="warning_subarray"> <font size="-1"><a href="./File:Warning_file.png.html" class="image" title="Warning"><img alt="Warning" src="images/0/09/Warning_file.png" width="39" height="32" /></a> <b>WARNING</b></font>
</td></tr>
<tr>
<td>This limit is not only SWAP but Memory + SWAP
</td></tr></table><br />
<p>That mean that <b>"lxc.cgroup.memory.memsw.limit_in_bytes" should be at least equal to "lxc.cgroup.memory.limit_in_bytes".</b>
</p><p>If you've got error when trying to limit swap, <a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Can.27t_limit_container_memory">check the FAQ</a>.
</p>
<h3><span class="mw-headline" id="Disks"><span class="mw-headline-number">6.4.4</span> Disks</span></h3>
<p>By default, LXC doesn't provide any disks limitation. Anyway, there are enough solution today to make that kind of limitations&#160;:
</p>
<ul><li> <a href="./LVM_:_Utilisation_poussée_des_LVM.html" title="LVM : Utilisation poussée des LVM">LVM</a>&#160;: create one LV per container</li>
<li> <a href="./BTRFS_:_Utilisation_du_remplaçant_de_l'Ext4.html" title="BTRFS : Utilisation du remplaçant de l'Ext4">BTRFS</a>&#160;: using integrated BTRFS quotas</li>
<li> <a href="./ZFS_:_Le_FileSystem_par_excellence.html" title="ZFS : Le FileSystem par excellence">ZFS</a>&#160;: if you're using <a href="./ZFS_On_Linux_:_Mise_en_place_de_ZFS_sous_Linux.html" title="ZFS On Linux : Mise en place de ZFS sous Linux">ZFS on Linux</a>, you can use integrated zfs/zpool quotas</li>
<li> <a href="Mise_en_place_des_quotas_sous_Linux.html" title="Mise en place des quotas sous Linux">Quotas</a>&#160;: using classical Linux quotas (not the recommended solution)</li>
<li> Disk image&#160;: you can use QCOW/QCOW2/RAW/QED images</li></ul>
<h4><span class="mw-headline" id="Mount"><span class="mw-headline-number">6.4.4.1</span> Mount</span></h4>
<table width="100%" class="notes_array">
<tr>
<td class="notes_subarray"> <font size="-1"><a href="./File:Notes_file.png.html" class="image" title="Notes"><img alt="Notes" src="images/2/20/Notes_file.png" width="31" height="32" /></a> Notes</font>
</td></tr>
<tr>
<td>You should take care if you want to create a mount entry in a subdirectory of /mnt.
</td></tr></table><br />
<p>It won't work so easily. The reason this happens is that by default 'mnt' is the directory used as pivotdir, where the old_root is placed during pivot_root(). After that, everything under pivotdir is unmounted.
</p><p>A workaround is to specify an alternate 'lxc.pivotdir' in the container configuration file.<sup id="cite_ref-11" class="reference"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_note-11">[11]</a></sup>
</p>
<h5><span class="mw-headline" id="Block_Device"><span class="mw-headline-number">6.4.4.1.1</span> Block Device</span></h5>
<p>You can mount block devices in adding in your container configuration lines like this (adapt with your needs) &#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.mount.entry = /dev/sdb1 /var/lib/lxc/mycontainer/rootfs/mnt ext4 rw 0 2</pre></div></div>
</td></tr></table><br />
<h5><span class="mw-headline" id="Bind_mount"><span class="mw-headline-number">6.4.4.1.2</span> Bind mount</span></h5>
<p>You also can mount bind mountpoints like that (adapt with your needs)&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.mount.entry = /path/in/host/mount_point /var/lib/lxc/mycontainer/rootfs/mount_moint none bind 0 0</pre></div></div>
</td></tr></table><br />
<h4><span class="mw-headline" id="Disk_priority"><span class="mw-headline-number">6.4.4.2</span> Disk priority</span></h4>
<p>You can set disk priority like that (default is 500):
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.cgroup.blkio.weight = 500</pre></div></div>
</td></tr></table><br />
<p>Higher the value is, more the priority will be important. You can get <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/Documentation/cgroups/blkio-controller.txt">more informations here</a>. Maximum value is 1000 and lowest is 10.
</p>
<table width="100%" class="notes_array">
<tr>
<td class="notes_subarray"> <font size="-1"><a href="./File:Notes_file.png.html" class="image" title="Notes"><img alt="Notes" src="images/2/20/Notes_file.png" width="31" height="32" /></a> Notes</font>
</td></tr>
<tr>
<td>You need to have CFQ scheduler to make it work properly
</td></tr></table><br />
<h4><span class="mw-headline" id="Disk_bandwidth"><span class="mw-headline-number">6.4.4.3</span> Disk bandwidth</span></h4>
<p>Another solution is to limit bandwidth usage, but the Wheezy kernel doesn't have the "CONFIG_BLK_DEV_THROTTLING" activated. You need to take a testing/unstable kernel instead or recompile a new one with this option activated. To do this follow the <a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Kernel">kernel procedure</a>.
</p><p>Then, you'll be able to limit bandwidth like that&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/mycontainer/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># Limit to 1Mb/s
lxc.cgroup.blkio.throttle.read_bps_device = 100</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="Network_2"><span class="mw-headline-number">6.4.5</span> Network</span></h3>
<p>You can limit network bandwidth using native kernel QOS directly on cgroups. For example, we have 2 containers&#160;: A and B. To get a good understanding, look at this schema&#160;:
</p><p><a href="./File:Cgroup_network.png.html" class="image"><img alt="Cgroup network.png" src="images/3/3e/Cgroup_network.png" width="225" height="346" /></a><sup id="cite_ref-12" class="reference"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_note-12">[12]</a></sup>
</p><p>Now you've understand how it could looks like. Now if I want to limit a container to 30Mb and the other one to 40Mb, here is how I should achieve it. Assign IDs on containers that should have quality of service&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> echo</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">echo 0x1001 &gt; /sys/fs/cgroup/lxc/&lt;containerA&gt;/net_cls.classid
echo 0x1002 &gt; /sys/fs/cgroup/lxc/&lt;containerB&gt;/net_cls.classid</pre></div></div>
</td></tr></table><br />
<ul><li> 0x1001&#160;: corresponding to 10:1</li>
<li> 0x1002&#160;: corresponding to 10:2</li></ul>
<p>Then select the desired QOS algorithm (HTB)&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> tc</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">tc qdisc add dev eth0 root handle 10: htb</pre></div></div>
</td></tr></table><br />
<p>Choose the desired bandwidth on containers IDs&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> tc</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">tc class add dev eth0 parent 10: classid 10:1 htb rate 40mbit
tc class add dev eth0 parent 10: classid 10:2 htb rate 30mbit</pre></div></div>
</td></tr></table><br />
<p>Enable filtering&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> tc</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">tc filter add dev eth0 parent 10: protocol ip prio 10 handle 1: cgroup</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Resources_statistics"><span class="mw-headline-number">6.5</span> Resources statistics</span></h2>
<p>Unfortunately, you can't have informations directly on the containers, however you can have informations from the host. Here is a little script to do it:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /usr/bin/lxc-resources-stats</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1"><span class="co0">#!/bin/bash</span>
&#160;
<span class="kw3">cd</span> <span class="sy0">/</span>sys<span class="sy0">/</span>fs<span class="sy0">/</span>cgroup<span class="sy0">/</span>lxc<span class="sy0">/</span>
<span class="kw1">for</span> i <span class="kw1">in</span> <span class="sy0">*</span>&#160;; <span class="kw1">do</span>
    <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-d</span> <span class="re1">$i</span> <span class="br0">&#93;</span>&#160;; <span class="kw1">then</span>
        <span class="kw3">echo</span> <span class="st0">&quot;===== <span class="es2">$i</span> =====&quot;</span>
        <span class="kw3">echo</span> <span class="st0">&quot;CPU, cap:               &quot;</span> $<span class="br0">&#40;</span><span class="kw2">cat</span> <span class="sy0">/</span>sys<span class="sy0">/</span>fs<span class="sy0">/</span>cgroup<span class="sy0">/</span>lxc<span class="sy0">/</span><span class="re1">$i</span><span class="sy0">/</span>cpuset.cpus<span class="br0">&#41;</span>
        <span class="kw3">echo</span> <span class="st0">&quot;CPU, shares:            &quot;</span> $<span class="br0">&#40;</span><span class="kw2">cat</span> <span class="sy0">/</span>sys<span class="sy0">/</span>fs<span class="sy0">/</span>cgroup<span class="sy0">/</span>lxc<span class="sy0">/</span><span class="re1">$i</span><span class="sy0">/</span>cpu.shares<span class="br0">&#41;</span>
        <span class="kw2">awk</span> <span class="st_h">'{ printf &quot;RAM, limit usage:       &#160;%sM\n&quot;, $1/ 1024/1024 }'</span> <span class="sy0">/</span>sys<span class="sy0">/</span>fs<span class="sy0">/</span>cgroup<span class="sy0">/</span>lxc<span class="sy0">/</span><span class="re1">$i</span><span class="sy0">/</span>memory.limit_in_bytes
        <span class="kw2">awk</span> <span class="st_h">'{ printf &quot;RAM+SWAP, limit usage:  &#160;%sM\n&quot;, $1/ 1024/1024 }'</span> <span class="sy0">/</span>sys<span class="sy0">/</span>fs<span class="sy0">/</span>cgroup<span class="sy0">/</span>lxc<span class="sy0">/</span><span class="re1">$i</span><span class="sy0">/</span>memory.memsw.limit_in_bytes
        <span class="kw2">awk</span> <span class="st_h">'{ printf &quot;RAM, current usage:     &#160;%sM\n&quot;, $1/ 1024/1024 }'</span> <span class="sy0">/</span>sys<span class="sy0">/</span>fs<span class="sy0">/</span>cgroup<span class="sy0">/</span>lxc<span class="sy0">/</span><span class="re1">$i</span><span class="sy0">/</span>memory.usage_in_bytes
        <span class="kw2">awk</span> <span class="st_h">'{ printf &quot;RAM+SWAP, current usage:&#160;%sM\n&quot;, $1/ 1024/1024 }'</span> <span class="sy0">/</span>sys<span class="sy0">/</span>fs<span class="sy0">/</span>cgroup<span class="sy0">/</span>lxc<span class="sy0">/</span><span class="re1">$i</span><span class="sy0">/</span>memory.memsw.usage_in_bytes
        <span class="kw2">awk</span> <span class="st_h">'{ printf &quot;RAM, max usage:         &#160;%sM\n&quot;, $1/ 1024/1024 }'</span> <span class="sy0">/</span>sys<span class="sy0">/</span>fs<span class="sy0">/</span>cgroup<span class="sy0">/</span>lxc<span class="sy0">/</span><span class="re1">$i</span><span class="sy0">/</span>memory.max_usage_in_bytes
        <span class="kw2">awk</span> <span class="st_h">'{ printf &quot;RAM+SWAP, max usage:    &#160;%sM\n&quot;, $1/ 1024/1024 }'</span> <span class="sy0">/</span>sys<span class="sy0">/</span>fs<span class="sy0">/</span>cgroup<span class="sy0">/</span>lxc<span class="sy0">/</span><span class="re1">$i</span><span class="sy0">/</span>memory.memsw.max_usage_in_bytes
        <span class="kw3">echo</span> <span class="st0">&quot;DISK I/O weight:        &quot;</span> $<span class="br0">&#40;</span><span class="kw2">cat</span> <span class="sy0">/</span>sys<span class="sy0">/</span>fs<span class="sy0">/</span>cgroup<span class="sy0">/</span>lxc<span class="sy0">/</span><span class="re1">$i</span><span class="sy0">/</span>blkio.weight<span class="br0">&#41;</span>
        <span class="kw3">echo</span> <span class="st0">&quot;&quot;</span>
    <span class="kw1">fi</span> 
<span class="kw1">done</span></pre></div></div>
</td></tr></table><br />
<p>Here is the result:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-resources-stats</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; lxc-resources-stats
===== mycontainer =====
CPU, cap:                3-4,6-7
CPU, shares:             1024
RAM, limit usage:        2048M
RAM+SWAP, limit usage:   3072M
RAM, current usage:      1577.33M
RAM+SWAP, current usage: 1582.79M
RAM, max usage:          2048M
RAM+SWAP, max usage:     2060.5M
DISK I/O weight:         500</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="FAQ"><span class="mw-headline-number">7</span> FAQ</span></h1>
<h2><span class="mw-headline" id="How_could_I_know_if_I.27m_in_a_container_or_not_.3F"><span class="mw-headline-number">7.1</span> How could I know if I'm in a container or not&#160;?</span></h2>
<p>There's an easy way to know that&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cat</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; cat /proc/$$/cgroup
1:perf_event,blkio,net_cls,freezer,devices,memory,cpuacct,cpu,cpuset:/lxc/mycontainer</pre></div></div>
</td></tr></table><br />
<p>You can see in the cpuset, the container name where I am ("mycontainer" here).
</p><p><br />
</p>
<h2><span class="mw-headline" id="Can.27t_connect_to_console"><span class="mw-headline-number">7.2</span> Can't connect to console</span></h2>
<p>If you want to plug yourself to a container through the console, your first need to create devices&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> chroot</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">chroot /var/lib/lxc/mycontainer/rootfs
mknod -m 666 /dev/tty1 c 4 1
mknod -m 666 /dev/tty2 c 4 2
mknod -m 666 /dev/tty3 c 4 3
mknod -m 666 /dev/tty4 c 4 4
mknod -m 666 /dev/tty5 c 4 5
mknod -m 666 /dev/tty6 c 4 6</pre></div></div>
</td></tr></table><br />
<p>Then you'll be able to connect&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc-console -n mycontainer</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Can.27t_create_a_LXC_LVM_container"><span class="mw-headline-number">7.3</span> Can't create a LXC LVM container</span></h2>
<p>If you get this kind of error during LVM&#160;:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">Copying local cache to /var/lib/lxc/mycontainerlvm/rootfs.../usr/share/lxc/templates/lxc-debian: line 101: /var/lib/lxc/mycontainerlvm/rootfs/etc/apt/sources.list.d/debian.list: No such file or directory
/usr/share/lxc/templates/lxc-debian: line 107: /var/lib/lxc/mycontainerlvm/rootfs/etc/apt/sources.list.d/debian.list: No such file or directory
/usr/share/lxc/templates/lxc-debian: line 111: /var/lib/lxc/mycontainerlvm/rootfs/etc/apt/sources.list.d/debian.list: No such file or directory
/usr/share/lxc/templates/lxc-debian: line 115: /var/lib/lxc/mycontainerlvm/rootfs/etc/apt/sources.list.d/debian.list: No such file or directory
/usr/share/lxc/templates/lxc-debian: line 183: /var/lib/lxc/mycontainerlvm/rootfs/etc/fstab: No such file or directory
mount: mount point /var/lib/lxc/mycontainerlvm/rootfs/dev/pts does not exist
mount: mount point /var/lib/lxc/mycontainerlvm/rootfs/proc does not exist
mount: mount point /var/lib/lxc/mycontainerlvm/rootfs/sys does not exist
mount: mount point /var/lib/lxc/mycontainerlvm/rootfs/var/cache/apt/archives does not exist
/usr/share/lxc/templates/lxc-debian: line 49: /var/lib/lxc/mycontainerlvm/rootfs/etc/dpkg/dpkg.cfg.d/lxc-debconf: No such file or directory
/usr/share/lxc/templates/lxc-debian: line 55: /var/lib/lxc/mycontainerlvm/rootfs/usr/sbin/policy-rc.d: No such file or directory
chmod: cannot access `/var/lib/lxc/mycontainerlvm/rootfs/usr/sbin/policy-rc.d': No such file or directory
chroot: failed to run command `/usr/bin/env': No such file or directory
chroot: failed to run command `/usr/bin/env': No such file or directory
chroot: failed to run command `/usr/bin/env': No such file or directory
umount: /var/lib/lxc/mycontainerlvm/rootfs/var/cache/apt/archives: not found
chroot: failed to run command `/usr/bin/env': No such file or directory
chroot: failed to run command `/usr/bin/env': No such file or directory
chroot: failed to run command `/usr/bin/env': No such file or directory
chroot: failed to run command `/usr/bin/env': No such file or directory
chroot: failed to run command `/usr/bin/env': No such file or directory
chroot: failed to run command `/usr/bin/env': No such file or directory
chroot: failed to run command `/usr/bin/env': No such file or directory
chroot: failed to run command `/usr/bin/env': No such file or directory
umount: /var/lib/lxc/mycontainerlvm/rootfs/dev/pts: not found
umount: /var/lib/lxc/mycontainerlvm/rootfs/proc: not found
umount: /var/lib/lxc/mycontainerlvm/rootfs/sys: not found
'debian' template installed
Unmounting LVM
'mycontainerlvm' created</pre></div></div>
<p>this is because of a Debian bug that the maintainer doesn't want to fix&#160;:-(. <a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#Installation">Here is a workaround</a>.
</p>
<h2><span class="mw-headline" id="Can.27t_limit_container_memory_or_swap"><span class="mw-headline-number">7.4</span> Can't limit container memory or swap</span></h2>
<p>If you can't limit container memory and have this kind of issue&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-cgroup</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; lxc-cgroup -n mycontainer memory.limit_in_bytes &quot;128M&quot;
lxc-cgroup: cgroup is not mounted
lxc-cgroup: failed to assign '128M' value to 'memory.limit_in_bytes' for 'mycontainer'</pre></div></div>
</td></tr></table><br />
<p>This is because cgroup memory capability is not loaded from your kernel. You can check it like that&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cat</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; cat /proc/cgroups 
#subsys_name	hierarchy	num_cgroups	enabled
cpuset	1	4	1
cpu	1	4	1
cpuacct	1	4	1
<span class="xtra ln-xtra">memory	0	1	0</span>devices	1	4	1
freezer	1	4	1
net_cls	1	4	1
blkio	1	4	1
perf_event	1	4	1</pre></div></div>
</td></tr></table><br />
<p>As we want to manage memory and swap on containers, as it's not available by default, add cgroup argument to grub to activate those functionality&#160;:
</p>
<ul><li> cgroup RAM feature&#160;: "cgroup_enable=memory"</li>
<li> cgroup SWAP feature&#160;: "swapaccount=1"</li></ul>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/default/grub</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># If you change this file, run 'update-grub' afterwards to update
# /boot/grub/grub.cfg.
# For full documentation of the options in this file, see:
#   info -f grub -n 'Simple configuration'
&#160;
GRUB_DEFAULT=0
GRUB_TIMEOUT=5
GRUB_DISTRIBUTOR=`lsb_release -i -s 2&gt; /dev/null || echo Debian`
<span class="xtra ln-xtra">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet cgroup_enable=memory swapaccount=1&quot;</span>GRUB_CMDLINE_LINUX=&quot;&quot;
[...]</pre></div></div>
</td></tr></table><br />
<p>Then regenerate grub config&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> update-grub</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">update-grub</pre></div></div>
</td></tr></table><br />
<p><b>Now reboot to make changes available.</b>
</p><p>After reboot you can check that memory is activated&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cat</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; cat /proc/cgroups
#subsys_name	hierarchy	num_cgroups	enabled
cpuset	1	6	1
cpu	1	6	1
cpuacct	1	6	1
<span class="xtra ln-xtra">memory	1	6	1</span>devices	1	6	1
freezer	1	6	1
net_cls	1	6	1
blkio	1	6	1
perf_event	1	6	1</pre></div></div>
</td></tr></table><br />
<p>Another way to check is the mount command&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mount</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; mount | grep cgroup
cgroup on /sys/fs/cgroup type cgroup (rw,relatime,perf_event,blkio,net_cls,freezer,devices,memory,cpuacct,cpu,cpuset,clone_children)</pre></div></div>
</td></tr></table><br />
<p>You can see that memory is available here.<sup id="cite_ref-13" class="reference"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_note-13">[13]</a></sup>
</p>
<h2><span class="mw-headline" id="I_can.27t_start_my_container.2C_how_could_I_debug_.3F"><span class="mw-headline-number">7.5</span> I can't start my container, how could I debug&#160;?</span></h2>
<p>You can debug a container on boot by this way&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lxc-start</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1">lxc-start <span class="re5">-n</span> mycontainer <span class="re5">-l</span> debug <span class="re5">-o</span> debug.out</pre></div></div>
</td></tr></table><br />
<p>Now you can look at debug.out and see what's wrong.
</p>
<h2><span class="mw-headline" id=".2Fusr.2Fsbin.2Fgrub-probe:_error:_cannot_find_a_device_for_.2F_.28is_.2Fdev_mounted.3F.29"><span class="mw-headline-number">7.6</span> /usr/sbin/grub-probe: error: cannot find a device for / (is /dev mounted?)</span></h2>
<p>I got dpkg error issue while I wanted to upgrade an LXC containers running on Debian because grub couldn't find /.
</p><p>To resolve that issue, I needed to remove definitively grub and grub-pc. Then the system accepted to remove the kernel.
</p>
<h2><span class="mw-headline" id="telinit:_.2Frun.2Finitctl:_No_such_file_or_directory"><span class="mw-headline-number">7.7</span> telinit: /run/initctl: No such file or directory</span></h2>
<p>If you got his kind of error when you want to properly shutdown your LXC container, you need to create a device in your container:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> mknod</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">mknod -m 600 /var/lib/lxc/&lt;container_name&gt;/rootfs/run/initctl p</pre></div></div>
</td></tr></table><br />
<p>And then add this in the container configuration file:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/&lt;container_name&gt;/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.cap.drop = sys_admin</pre></div></div>
</td></tr></table><br />
<p>You can now shutdown it properly without any issue&#160;:-)
</p>
<h2><span class="mw-headline" id="Some_containers_are_loosing_their_IP_addresse_at_boot"><span class="mw-headline-number">7.8</span> Some containers are loosing their IP addresse at boot</span></h2>
<p>If you're experiencing issues with booting containers which are loosing their static IP at boot<sup id="cite_ref-14" class="reference"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_note-14">[14]</a></sup> there is a solution. The first thing to do to recover is:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">ifdown eth0 &amp;&amp; ifup eth0</pre></div></div>
</td></tr></table><br />
<p>But is is a temporary solution. You in fact need to add in your LXC configuration file, the IP address with CIDR of your container:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /var/lib/lxc/&lt;container&gt;/config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.network.ipv4 = 192.168.0.50/24
lxc.network.ipv4.gateway = auto</pre></div></div>
</td></tr></table><br />
<p>The automatic gateway setting is will in fact address to the container, the IP of the interface on which the container is attached. Then you have to modify your container network configuration and change static configuration to manual of eth0 interface. You should have something like this:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">allow-hotplug eth0
iface eth0 inet manual</pre></div></div>
</td></tr></table><br />
<p>You're now ok, on next reboot the IP will be properly configured automatically by LXC and it will work anytime.
</p>
<h2><span class="mw-headline" id="OpenVPN"><span class="mw-headline-number">7.9</span> OpenVPN</span></h2>
<p>To make openvpn working, you need to allow tun devices. In the LXC configuration, simply add this:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> container.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.cgroup.devices.allow = c 10:200 rwm</pre></div></div>
</td></tr></table><br />
<p>And in the container, create it:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1"><span class="kw2">mkdir</span> <span class="sy0">/</span>dev<span class="sy0">/</span>net
<span class="kw2">mknod</span> <span class="sy0">/</span>dev<span class="sy0">/</span>net<span class="sy0">/</span>tun c <span class="nu0">10</span> <span class="nu0">200</span>
<span class="kw2">chmod</span> 0666 <span class="sy0">/</span>dev<span class="sy0">/</span>net<span class="sy0">/</span>tun</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="LXC_inception_or_Docker_in_LXC"><span class="mw-headline-number">7.10</span> LXC inception or Docker in LXC</span></h2>
<p>To get Docker in LXC or LXC in LXC working, you need to have some packages installed inside the LXC container:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">apt-get install cgroup-bin libcgroup1 cgroupfs-mount</pre></div></div>
</td></tr></table><br />
<p>In the container configuration, you also need to have that line:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.mount.auto = cgroup</pre></div></div>
</td></tr></table><br />
<p>Then it's ok&#160;:-)
</p>
<h2><span class="mw-headline" id="LXC_control_device_mapper"><span class="mw-headline-number">7.11</span> LXC control device mapper</span></h2>
<p>In Docker, you may want to use devicemapper driver. To get it working, you need to let your LXC container to control devicemappers. To do so, just add those 1 lines in your container configuration:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> config</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">lxc.cgroup.devices.allow = c 10:236 rwm
lxc.cgroup.devices.allow = b 252:* rwm</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="References"><span class="mw-headline-number">8</span> References</span></h1>
<ol class="references">
<li id="cite_note-1"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_ref-1">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://lxc.sourceforge.net/">http://lxc.sourceforge.net/</a></span>
</li>
<li id="cite_note-2"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_ref-2">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://pi.lastr.us/doku.php/virtualizacion:lxc:digitalocean-wheezy">http://pi.lastr.us/doku.php/virtualizacion:lxc:digitalocean-wheezy</a></span>
</li>
<li id="cite_note-3"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_ref-3">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://philpep.org/blog/lxc-sur-debian-squeeze">http://philpep.org/blog/lxc-sur-debian-squeeze</a></span>
</li>
<li id="cite_note-4"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_ref-4">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="https://help.ubuntu.com/lts/serverguide/lxc.html">https://help.ubuntu.com/lts/serverguide/lxc.html</a></span>
</li>
<li id="cite_note-5"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_ref-5">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://lwn.net/Articles/273208/">http://lwn.net/Articles/273208/</a></span>
</li>
<li id="cite_note-6"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_ref-6">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://wiki.rot13.org/rot13/index.cgi?action=display_html;page_name=lxc">http://wiki.rot13.org/rot13/index.cgi?action=display_html;page_name=lxc</a></span>
</li>
<li id="cite_note-7"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_ref-7">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="https://www.kernel.org/doc/Documentation/scheduler/sched-design-CFS.txt">https://www.kernel.org/doc/Documentation/scheduler/sched-design-CFS.txt</a></span>
</li>
<li id="cite_note-8"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_ref-8">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://www.mattfischer.com/blog/?p=399">http://www.mattfischer.com/blog/?p=399</a></span>
</li>
<li id="cite_note-9"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_ref-9">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://webcache.googleusercontent.com/search?q=cache:vWmLMNBRKIYJ:comments.gmane.org/gmane.linux.kernel.containers/23094+&amp;cd=6&amp;hl=fr&amp;ct=clnk&amp;gl=fr&amp;client=firefox-a">http://webcache.googleusercontent.com/search?q=cache:vWmLMNBRKIYJ:comments.gmane.org/gmane.linux.kernel.containers/23094+&amp;cd=6&amp;hl=fr&amp;ct=clnk&amp;gl=fr&amp;client=firefox-a</a></span>
</li>
<li id="cite_note-10"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_ref-10">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://www.jotschi.de/Uncategorized/2010/11/11/memory-allocation-test.html">http://www.jotschi.de/Uncategorized/2010/11/11/memory-allocation-test.html</a></span>
</li>
<li id="cite_note-11"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_ref-11">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/986385">https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/986385</a></span>
</li>
<li id="cite_note-12"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_ref-12">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://vger.kernel.org/netconf2009_slides/Network%20Control%20Group%20Whitepaper.odt">http://vger.kernel.org/netconf2009_slides/Network%20Control%20Group%20Whitepaper.odt</a></span>
</li>
<li id="cite_note-13"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_ref-13">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://vin0x64.fr/2012/01/debian-limite-de-memoire-sur-conteneur-lxc/">http://vin0x64.fr/2012/01/debian-limite-de-memoire-sur-conteneur-lxc/</a></span>
</li>
<li id="cite_note-14"><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#cite_ref-14">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://serverfault.com/questions/571714/setting-up-bridged-lxc-containers-with-static-ips/586577#586577">http://serverfault.com/questions/571714/setting-up-bridged-lxc-containers-with-static-ips/586577#586577</a></span>
</li>
</ol>
<p><a rel="nofollow" class="external free" href="http://www.pointroot.org/index.php/2013/05/12/installation-du-systeme-de-virtualisation-lxc-linux-containers-sur-debian-wheezy/">http://www.pointroot.org/index.php/2013/05/12/installation-du-systeme-de-virtualisation-lxc-linux-containers-sur-debian-wheezy/</a><br />
<a rel="nofollow" class="external free" href="http://box.matto.nl/lxconlaptop.html">http://box.matto.nl/lxconlaptop.html</a><br />
<a rel="nofollow" class="external free" href="https://help.ubuntu.com/lts/serverguide/lxc.html">https://help.ubuntu.com/lts/serverguide/lxc.html</a><br />
<a rel="nofollow" class="external free" href="http://debian-handbook.info/browse/stable/sect.virtualization.html">http://debian-handbook.info/browse/stable/sect.virtualization.html</a><br />
<a rel="nofollow" class="external free" href="http://www.fitzdsl.net/2012/12/installation-dun-conteneur-lxc-sur-dedibox/">http://www.fitzdsl.net/2012/12/installation-dun-conteneur-lxc-sur-dedibox/</a><br />
<a rel="nofollow" class="external free" href="http://freedomboxblog.nl/installing-lxc-dhcp-and-dns-on-my-freedombox/">http://freedomboxblog.nl/installing-lxc-dhcp-and-dns-on-my-freedombox/</a><br />
<a rel="nofollow" class="external free" href="http://containerops.org/2013/11/19/lxc-networking/">http://containerops.org/2013/11/19/lxc-networking/</a>
</p>
<!-- 
NewPP limit report
CPU time usage: 0.384 seconds
Real time usage: 0.389 seconds
Preprocessor visited node count: 2494/1000000
Preprocessor generated node count: 7082/1000000
Post‐expand include size: 33668/2097152 bytes
Template argument size: 8439/2097152 bytes
Highest expansion depth: 5/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%  178.087      1 - -total
 39.66%   70.630     68 - Template:Command
 33.38%   59.453     43 - Template:Config
  6.64%   11.824      1 - Template:KVM_network_nat_iptables
  2.40%    4.282      1 - Template:KVM_network_nat
  1.80%    3.206      2 - Template:LXC_console_bugfix
  1.65%    2.946      1 - Template:KVM_bridged_vlans_config
  1.45%    2.591      1 - Template:KVM_network_bridged
  1.31%    2.341      2 - Template:LXC_cgroups_memory
  1.18%    2.105      1 - Template:Infobox
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:3630-0!*!0!1!en!5!* and timestamp 20181111230815 and revision id 13457
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=LXC_:_Install_and_configure_the_Linux_Containers&amp;oldid=13457">https://wiki.deimos.fr/index.php?title=LXC_:_Install_and_configure_the_Linux_Containers&amp;oldid=13457</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=LXC+%3A+Install+and+configure+the+Linux+Containers" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=LXC_:_Install_and_configure_the_Linux_Containers&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=LXC_:_Install_and_configure_the_Linux_Containers&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="./LXC_:_Install_and_configure_the_Linux_Containers.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/LXC_:_Install_and_configure_the_Linux_Containers.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/LXC_:_Install_and_configure_the_Linux_Containers" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=LXC_:_Install_and_configure_the_Linux_Containers&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=LXC_:_Install_and_configure_the_Linux_Containers&amp;oldid=13457" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=LXC_:_Install_and_configure_the_Linux_Containers&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 22 February 2015, at 00:26.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["ext.cite.a11y","mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":427});
}</script>
	</body>
</html>
	
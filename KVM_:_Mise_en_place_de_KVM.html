<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>KVM : Mise en place de KVM - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="./KVM_:_Mise_en_place_de_KVM.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"KVM_:_Mise_en_place_de_KVM","wgTitle":"KVM : Mise en place de KVM","wgCurRevisionId":13465,"wgRevisionId":13465,"wgArticleId":1917,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"KVM_:_Mise_en_place_de_KVM","wgRelevantArticleId":1917,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
.source-xml {line-height: normal;}
.source-xml li, .source-xml pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for xml
 * CSS class: source-xml, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.xml.source-xml .de1, .xml.source-xml .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.xml.source-xml  {font-family:monospace;}
.xml.source-xml .imp {font-weight: bold; color: red;}
.xml.source-xml li, .xml.source-xml .li1 {font-weight: normal; vertical-align:top;}
.xml.source-xml .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.xml.source-xml .li2 {font-weight: bold; vertical-align:top;}
.xml.source-xml .es0 {color: #000099; font-weight: bold;}
.xml.source-xml .br0 {color: #66cc66;}
.xml.source-xml .sy0 {color: #66cc66;}
.xml.source-xml .st0 {color: #ff0000;}
.xml.source-xml .nu0 {color: #cc66cc;}
.xml.source-xml .sc-1 {color: #808080; font-style: italic;}
.xml.source-xml .sc0 {color: #00bbdd;}
.xml.source-xml .sc1 {color: #ddbb00;}
.xml.source-xml .sc2 {color: #339933;}
.xml.source-xml .sc3 {color: #009900;}
.xml.source-xml .re0 {color: #000066;}
.xml.source-xml .re1 {color: #000000; font-weight: bold;}
.xml.source-xml .re2 {color: #000000; font-weight: bold;}
.xml.source-xml .ln-xtra, .xml.source-xml li.ln-xtra, .xml.source-xml div.ln-xtra {background-color: #ffc;}
.xml.source-xml span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
.source-bash {line-height: normal;}
.source-bash li, .source-bash pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for bash
 * CSS class: source-bash, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.bash.source-bash .de1, .bash.source-bash .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.bash.source-bash  {font-family:monospace;}
.bash.source-bash .imp {font-weight: bold; color: red;}
.bash.source-bash li, .bash.source-bash .li1 {font-weight: normal; vertical-align:top;}
.bash.source-bash .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.bash.source-bash .li2 {font-weight: bold; vertical-align:top;}
.bash.source-bash .kw1 {color: #000000; font-weight: bold;}
.bash.source-bash .kw2 {color: #c20cb9; font-weight: bold;}
.bash.source-bash .kw3 {color: #7a0874; font-weight: bold;}
.bash.source-bash .co0 {color: #666666; font-style: italic;}
.bash.source-bash .co1 {color: #800000;}
.bash.source-bash .co2 {color: #cc0000; font-style: italic;}
.bash.source-bash .co3 {color: #000000; font-weight: bold;}
.bash.source-bash .co4 {color: #666666;}
.bash.source-bash .es1 {color: #000099; font-weight: bold;}
.bash.source-bash .es2 {color: #007800;}
.bash.source-bash .es3 {color: #007800;}
.bash.source-bash .es4 {color: #007800;}
.bash.source-bash .es5 {color: #780078;}
.bash.source-bash .es_h {color: #000099; font-weight: bold;}
.bash.source-bash .br0 {color: #7a0874; font-weight: bold;}
.bash.source-bash .sy0 {color: #000000; font-weight: bold;}
.bash.source-bash .st0 {color: #ff0000;}
.bash.source-bash .st_h {color: #ff0000;}
.bash.source-bash .nu0 {color: #000000;}
.bash.source-bash .re0 {color: #007800;}
.bash.source-bash .re1 {color: #007800;}
.bash.source-bash .re2 {color: #007800;}
.bash.source-bash .re4 {color: #007800;}
.bash.source-bash .re5 {color: #660033;}
.bash.source-bash .ln-xtra, .bash.source-bash li.ln-xtra, .bash.source-bash div.ln-xtra {background-color: #ffc;}
.bash.source-bash span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-KVM_Mise_en_place_de_KVM skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">KVM : Mise en place de KVM</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="./KVM_:_Mise_en_place_de_KVM.html#mw-navigation">navigation</a>, 					<a href="./KVM_:_Mise_en_place_de_KVM.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="./KVM_:_Mise_en_place_de_KVM.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="./KVM_:_Mise_en_place_de_KVM.html#Install"><span class="tocnumber">2</span> <span class="toctext">Install</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="./KVM_:_Mise_en_place_de_KVM.html#Configuration"><span class="tocnumber">3</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="./KVM_:_Mise_en_place_de_KVM.html#System_performances"><span class="tocnumber">3.1</span> <span class="toctext">System performances</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="./KVM_:_Mise_en_place_de_KVM.html#Disks"><span class="tocnumber">3.1.1</span> <span class="toctext">Disks</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="./KVM_:_Mise_en_place_de_KVM.html#Memory"><span class="tocnumber">3.1.2</span> <span class="toctext">Memory</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="./KVM_:_Mise_en_place_de_KVM.html#Network"><span class="tocnumber">3.1.3</span> <span class="toctext">Network</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="./KVM_:_Mise_en_place_de_KVM.html#Virtio"><span class="tocnumber">3.1.4</span> <span class="toctext">Virtio</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-9"><a href="./KVM_:_Mise_en_place_de_KVM.html#Add_user_to_group"><span class="tocnumber">3.2</span> <span class="toctext">Add user to group</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="./KVM_:_Mise_en_place_de_KVM.html#Storage"><span class="tocnumber">3.3</span> <span class="toctext">Storage</span></a>
<ul>
<li class="toclevel-3 tocsection-11"><a href="./KVM_:_Mise_en_place_de_KVM.html#Create_Disks_image"><span class="tocnumber">3.3.1</span> <span class="toctext">Create Disks image</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="./KVM_:_Mise_en_place_de_KVM.html#Create_LVM_LV"><span class="tocnumber">3.3.2</span> <span class="toctext">Create LVM LV</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-13"><a href="./KVM_:_Mise_en_place_de_KVM.html#Network_Interfaces"><span class="tocnumber">3.4</span> <span class="toctext">Network Interfaces</span></a>
<ul>
<li class="toclevel-3 tocsection-14"><a href="./KVM_:_Mise_en_place_de_KVM.html#Bridged_configuration"><span class="tocnumber">3.4.1</span> <span class="toctext">Bridged configuration</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="./KVM_:_Mise_en_place_de_KVM.html#VLAN_Bridged_configuration"><span class="tocnumber">3.4.2</span> <span class="toctext">VLAN Bridged configuration</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="./KVM_:_Mise_en_place_de_KVM.html#Nat_configuration"><span class="tocnumber">3.4.3</span> <span class="toctext">Nat configuration</span></a>
<ul>
<li class="toclevel-4 tocsection-17"><a href="./KVM_:_Mise_en_place_de_KVM.html#Iptables"><span class="tocnumber">3.4.3.1</span> <span class="toctext">Iptables</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-18"><a href="./KVM_:_Mise_en_place_de_KVM.html#Create_a_VM"><span class="tocnumber">4</span> <span class="toctext">Create a VM</span></a>
<ul>
<li class="toclevel-2 tocsection-19"><a href="./KVM_:_Mise_en_place_de_KVM.html#New_method_.28with_libvirt.29"><span class="tocnumber">4.1</span> <span class="toctext">New method (with libvirt)</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="./KVM_:_Mise_en_place_de_KVM.html#Old_method_.28without_libvirt.29"><span class="tocnumber">4.2</span> <span class="toctext">Old method (without libvirt)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-21"><a href="./KVM_:_Mise_en_place_de_KVM.html#Manage_VM"><span class="tocnumber">5</span> <span class="toctext">Manage VM</span></a>
<ul>
<li class="toclevel-2 tocsection-22"><a href="./KVM_:_Mise_en_place_de_KVM.html#Manual_method"><span class="tocnumber">5.1</span> <span class="toctext">Manual method</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="./KVM_:_Mise_en_place_de_KVM.html#Virt_Manager_.28GUI.29"><span class="tocnumber">5.2</span> <span class="toctext">Virt Manager (GUI)</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="./KVM_:_Mise_en_place_de_KVM.html#Virt_Manager_.28Command_line.29"><span class="tocnumber">5.3</span> <span class="toctext">Virt Manager (Command line)</span></a>
<ul>
<li class="toclevel-3 tocsection-25"><a href="./KVM_:_Mise_en_place_de_KVM.html#Start.2C_stop.2C_list"><span class="tocnumber">5.3.1</span> <span class="toctext">Start, stop, list</span></a></li>
<li class="toclevel-3 tocsection-26"><a href="./KVM_:_Mise_en_place_de_KVM.html#Suspend.2C_restore"><span class="tocnumber">5.3.2</span> <span class="toctext">Suspend, restore</span></a></li>
<li class="toclevel-3 tocsection-27"><a href="./KVM_:_Mise_en_place_de_KVM.html#Delete"><span class="tocnumber">5.3.3</span> <span class="toctext">Delete</span></a></li>
<li class="toclevel-3 tocsection-28"><a href="./KVM_:_Mise_en_place_de_KVM.html#Backups.2C_restore"><span class="tocnumber">5.3.4</span> <span class="toctext">Backups, restore</span></a></li>
<li class="toclevel-3 tocsection-29"><a href="./KVM_:_Mise_en_place_de_KVM.html#Autostart"><span class="tocnumber">5.3.5</span> <span class="toctext">Autostart</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-30"><a href="./KVM_:_Mise_en_place_de_KVM.html#Snapshots"><span class="tocnumber">6</span> <span class="toctext">Snapshots</span></a>
<ul>
<li class="toclevel-2 tocsection-31"><a href="./KVM_:_Mise_en_place_de_KVM.html#Create_a_snapshot"><span class="tocnumber">6.1</span> <span class="toctext">Create a snapshot</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="./KVM_:_Mise_en_place_de_KVM.html#External_snapshot"><span class="tocnumber">6.2</span> <span class="toctext">External snapshot</span></a>
<ul>
<li class="toclevel-3 tocsection-33"><a href="./KVM_:_Mise_en_place_de_KVM.html#blockpull"><span class="tocnumber">6.2.1</span> <span class="toctext">blockpull</span></a></li>
<li class="toclevel-3 tocsection-34"><a href="./KVM_:_Mise_en_place_de_KVM.html#blockcommit"><span class="tocnumber">6.2.2</span> <span class="toctext">blockcommit</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-35"><a href="./KVM_:_Mise_en_place_de_KVM.html#Others"><span class="tocnumber">7</span> <span class="toctext">Others</span></a>
<ul>
<li class="toclevel-2 tocsection-36"><a href="./KVM_:_Mise_en_place_de_KVM.html#Reload_configuration"><span class="tocnumber">7.1</span> <span class="toctext">Reload configuration</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="./KVM_:_Mise_en_place_de_KVM.html#Serial_Port_Connection"><span class="tocnumber">7.2</span> <span class="toctext">Serial Port Connection</span></a></li>
<li class="toclevel-2 tocsection-38"><a href="./KVM_:_Mise_en_place_de_KVM.html#Add_a_disk_to_an_existing_VM"><span class="tocnumber">7.3</span> <span class="toctext">Add a disk to an existing VM</span></a></li>
<li class="toclevel-2 tocsection-39"><a href="./KVM_:_Mise_en_place_de_KVM.html#Bind_CPU.2FCores_to_a_VM"><span class="tocnumber">7.4</span> <span class="toctext">Bind CPU/Cores to a VM</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-40"><a href="./KVM_:_Mise_en_place_de_KVM.html#Others_2"><span class="tocnumber">8</span> <span class="toctext">Others</span></a>
<ul>
<li class="toclevel-2 tocsection-41"><a href="./KVM_:_Mise_en_place_de_KVM.html#Convert_a_disk_based_VM_on_a_LVM_parition"><span class="tocnumber">8.1</span> <span class="toctext">Convert a disk based VM on a LVM parition</span></a></li>
<li class="toclevel-2 tocsection-42"><a href="./KVM_:_Mise_en_place_de_KVM.html#Convert_an_LVM_parition_to_a_disk_image"><span class="tocnumber">8.2</span> <span class="toctext">Convert an LVM parition to a disk image</span></a></li>
<li class="toclevel-2 tocsection-43"><a href="./KVM_:_Mise_en_place_de_KVM.html#Transfert_a_LVM_disk_based_VM"><span class="tocnumber">8.3</span> <span class="toctext">Transfert a LVM disk based VM</span></a></li>
<li class="toclevel-2 tocsection-44"><a href="./KVM_:_Mise_en_place_de_KVM.html#Graphically_access_to_VMs_without_Virt_Manager"><span class="tocnumber">8.4</span> <span class="toctext">Graphically access to VMs without Virt Manager</span></a></li>
<li class="toclevel-2 tocsection-45"><a href="./KVM_:_Mise_en_place_de_KVM.html#Suspend_guests_VMs_on_host_shutdown"><span class="tocnumber">8.5</span> <span class="toctext">Suspend guests VMs on host shutdown</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-46"><a href="./KVM_:_Mise_en_place_de_KVM.html#FAQ"><span class="tocnumber">9</span> <span class="toctext">FAQ</span></a>
<ul>
<li class="toclevel-2 tocsection-47"><a href="./KVM_:_Mise_en_place_de_KVM.html#warning:_could_not_open_.2Fdev.2Fnet.2Ftun:_no_virtual_network_emulation"><span class="tocnumber">9.1</span> <span class="toctext">warning: could not open /dev/net/tun: no virtual network emulation</span></a></li>
<li class="toclevel-2 tocsection-48"><a href="./KVM_:_Mise_en_place_de_KVM.html#Solaris_reboot_all_the_time_on_grub_menu"><span class="tocnumber">9.2</span> <span class="toctext">Solaris reboot all the time on grub menu</span></a></li>
<li class="toclevel-2 tocsection-49"><a href="./KVM_:_Mise_en_place_de_KVM.html#error:_Timed_out_during_operation:_cannot_acquire_state_change_lock"><span class="tocnumber">9.3</span> <span class="toctext">error: Timed out during operation: cannot acquire state change lock</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-50"><a href="./KVM_:_Mise_en_place_de_KVM.html#Ressources"><span class="tocnumber">10</span> <span class="toctext">Ressources</span></a></li>
</ul>
</div>

<table class="config_array" align="right" style="width:20em; font-size:90%; text-align:left; border: 1px #d0e7ff solid; margin-left:10px;">
   <tr>
      <td class="config_subarray" colspan="2" style="text-align:center;"><a href="./File:Kvm-logo.png.html" class="image" title="KVM"><img alt="KVM" src="images/2/23/Kvm-logo.png" width="220" height="68" /></a></td>
   </tr><tr><td colspan="2" style="text-align:center;"><hr class="gradient" /></td></tr><tr>
      <th>Software version</th>
      <td>0.12.5</td>
   </tr><tr>
      <th>Operating System</th>
      <td>Debian 6</td>
   </tr><tr>
      <th>Website</th>
      <td><a rel="nofollow" class="external text" href="http://www.linux-kvm.org/">KVM Website</a></td>
   </tr><tr>
      <th>Last Update</th>
      <td>03/03/2015</td>
   </tr><tr>
      <th>Others</th>
      <td></td>
   </tr>
</table>
<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p>KVM (for Kernel-based Virtual Machine) is a full virtualization solution for Linux on x86 hardware containing virtualization extensions (Intel VT or AMD-V). It consists of a loadable kernel module, kvm.ko, that provides the core virtualization infrastructure and a processor specific module, kvm-intel.ko or kvm-amd.ko. KVM also requires a modified QEMU although work is underway to get the required changes upstream.
</p><p>Using KVM, one can run multiple virtual machines running unmodified Linux or Windows images. Each virtual machine has private virtualized hardware: a network card, disk, graphics adapter, etc.
</p><p>The kernel component of KVM is included in mainline Linux, as of 2.6.20.
</p><p>KVM is open source software.
</p>
<h1><span class="mw-headline" id="Install"><span class="mw-headline-number">2</span> Install</span></h1>
<p>To install and run KVM on Debian, follow these steps:
</p><p>Run these commands as root:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> apt-get</font>
</td></tr>
<tr>
<td>
<pre>aptitude update
aptitude install kvm qemu bridge-utils libvirt-bin virtinst
</pre>
</td></tr></table><br />
<ul><li> qemu is necessary, this is the base</li>
<li> kvm is for full acceleration (need processor with vmx or svm technology)</li>
<li> bridge-utils are tools for bridging VMs network</li>
<li> libvirt is a managing solution for your VMs</li></ul>
<p>Depending on if you are using an AMD or Intel processor, run one of these commands:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> modprobe</font>
</td></tr>
<tr>
<td>
<pre>modprobe kvm-amd
</pre>
</td></tr></table><br />
<p>or
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> modprobe</font>
</td></tr>
<tr>
<td>
<pre>modprobe kvm-intel
</pre>
</td></tr></table><br />
<p>Then add it to /etc/modules&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/modules</font>
</td></tr>
<tr>
<td>
<pre>kvm-intel
</pre>
</td></tr></table><br />
<h1><span class="mw-headline" id="Configuration"><span class="mw-headline-number">3</span> Configuration</span></h1>
<h2><span class="mw-headline" id="System_performances"><span class="mw-headline-number">3.1</span> System performances</span></h2>
<p>To get as performances as possible, we'll need to set some specific options.
</p>
<h3><span class="mw-headline" id="Disks"><span class="mw-headline-number">3.1.1</span> Disks</span></h3>
<p>First, we'll set the disks algorithm to deadline in grub&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/default/grub</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># If you change this file, run 'update-grub' afterwards to update
# /boot/grub/grub.cfg.
&#160;
GRUB_DEFAULT=0
GRUB_TIMEOUT=5
GRUB_DISTRIBUTOR=`lsb_release -i -s 2&gt; /dev/null || echo Debian`
<span class="xtra ln-xtra">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet elevator=deadline&quot;</span>GRUB_CMDLINE_LINUX=&quot;&quot;
&#160;
# Uncomment to enable BadRAM filtering, modify to suit your needs
# This works with Linux (no patch required) and with any kernel that obtains
# the memory map information from GRUB (GNU Mach, kernel of FreeBSD ...)
#GRUB_BADRAM=&quot;0x01234567,0xfefefefe,0x89abcdef,0xefefefef&quot;
&#160;
# Uncomment to disable graphical terminal (grub-pc only)
#GRUB_TERMINAL=console
&#160;
# The resolution used on graphical terminal
# note that you can use only modes which your graphic card supports via VBE
# you can see them in real GRUB with the command `vbeinfo'
#GRUB_GFXMODE=640x480
&#160;
# Uncomment if you don't want GRUB to pass &quot;root=UUID=xxx&quot; parameter to Linux
#GRUB_DISABLE_LINUX_UUID=true
&#160;
# Uncomment to disable generation of recovery mode menu entries
#GRUB_DISABLE_LINUX_RECOVERY=&quot;true&quot;
&#160;
# Uncomment to get a beep at grub start
#GRUB_INIT_TUNE=&quot;480 440 1&quot;</pre></div></div>
</td></tr></table><br />
<p>And update grub&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> update-grub</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">update-grub</pre></div></div>
</td></tr></table><br />
<p>Now, to reduces data copies and bus traffic, when you're using LVM partitions, disable the cache and use virtio drivers which are the fastest&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virt-install</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">virt-install ... --file=/dev/vg-name/lv-name,cache=none,if=virtio ...</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="Memory"><span class="mw-headline-number">3.1.2</span> Memory</span></h3>
<p>Then, we will enable KSM. Kernel Samepage Merging (KSM) is a feature of the Linux kernel introduced in the 2.6.32 kernel. KSM allows for an application to register with the kernel to have its pages merged with other processes that also register to have their pages merged. For KVM, the KSM mechanism allows for guest virtual machines to share pages with each other. In an environment where many of the guest operating systems are similar, this can result in significant memory savings.
</p><p>To enable it, add this line&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/rc.local</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">#!/bin/sh -e
#
# rc.local
#
# This script is executed at the end of each multiuser runlevel.
# Make sure that the script will &quot;exit 0&quot; on success or any other
# value on error.
#
# In order to enable or disable this script just change the execution
# bits.
#
# By default this script does nothing.
&#160;
# KSM
<span class="xtra ln-xtra">echo 1 &gt; /sys/kernel/mm/ksm/run</span>exit 0</pre></div></div>
</td></tr></table><br />
<p>You can see at anytime the status of KSM by&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> echo</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">for i in /sys/kernel/mm/ksm/*&#160;; do echo -n &quot;$i: &quot;&#160;; cat $i&#160;; done</pre></div></div>
</td></tr></table><br />
<p>And in addition, we will disable swapiness to avoid having too much memory consumption. Add those lines in sysctl&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/sysctl.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># Swapiness
vm.swappiness = 1</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="Network"><span class="mw-headline-number">3.1.3</span> Network</span></h3>
<p>For security and performances issues, you should disable ipv6 on bridged interfaces by adding those 3 lines&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/sysctl.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">net.bridge.bridge-nf-call-ip6tables = 0
net.bridge.bridge-nf-call-iptables = 0
net.bridge.bridge-nf-call-arptables = 0</pre></div></div>
</td></tr></table><br />
<p>When you will create network interfaces, uses tap with virtio drivers&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virt-install</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">virt-install ... --network tap,bridge=br0,model=virtio ...</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="Virtio"><span class="mw-headline-number">3.1.4</span> Virtio</span></h3>
<p>If you want to always enable VirtIO, to get maximum performances, load those modules&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/modules</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">virtio_blk
virtio_pci
virtio_net</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Add_user_to_group"><span class="mw-headline-number">3.2</span> Add user to group</span></h2>
<ul><li> The installation of kvm created a new system group named kvm in /etc/group. You need to add the user accounts that will run kvm to this group (replace username with the user account name to add):</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> adduser</font>
</td></tr>
<tr>
<td>
<pre>adduser <b>username</b> kvm
</pre>
</td></tr></table><br />
<ul><li> For those who would like to use libvirt (recommanded), add your user to this group too&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> adduser</font>
</td></tr>
<tr>
<td>
<pre>adduser <b>username</b> libvirt
</pre>
</td></tr></table><br />
<h2><span class="mw-headline" id="Storage"><span class="mw-headline-number">3.3</span> Storage</span></h2>
<p>There are 2 types of solutions&#160;:
</p>
<ul><li> Disk Image&#160;: Easier but slower</li>
<li> Need LVM acknoledges but is faster and simpler to backup (LVM Snapshot)</li></ul>
<h3><span class="mw-headline" id="Create_Disks_image"><span class="mw-headline-number">3.3.1</span> Create Disks image</span></h3>
<p>Create a virtual disk image (10 gigabytes in the example, but it is a sparse file and will only take as much space as is actually used, which is 0 at first, as can be seen with the du command: du vdisk.qcow, while ls -l vdisk.qcow shows the sparse file size):
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> qemu-img</font>
</td></tr>
<tr>
<td>
<pre>qemu-img create -f qcow2 disk0.qcow2 10G
</pre>
</td></tr></table><br />
<p>You can also use QED, which is faster than qcow2&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">qemu-img create -f qed disk0.qed 10G</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="Create_LVM_LV"><span class="mw-headline-number">3.3.2</span> Create LVM LV</span></h3>
<p>To create a Logical Volume, simply&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> lvcreate</font>
</td></tr>
<tr>
<td>
<pre>lvcreate -L <b>4G</b> -n <b>vm-name</b> <b>vg-name</b>
</pre>
</td></tr></table><br />
<ul><li> -L&#160;: size of the logical volume</li>
<li> -n&#160;: Name of the VM</li>
<li> vg-name&#160;: replace by your Volume Group Name</li></ul>
<h2><span class="mw-headline" id="Network_Interfaces"><span class="mw-headline-number">3.4</span> Network Interfaces</span></h2>
<h3><span class="mw-headline" id="Bridged_configuration"><span class="mw-headline-number">3.4.1</span> Bridged configuration</span></h3>
<p>Now modify your /etc/network/interfaces file to add bridged configuration&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/network/interfaces</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">auto lo br0
iface lo inet loopback
&#160;
# The primary network interface
iface br0 inet static
        address 192.168.0.80
        netmask 255.255.255.0
        gateway 192.168.0.252
        broadcast 192.168.0.255
        network 192.168.0.0
        bridge_ports eth0
        bridge_fd 9
        bridge_hello 2
        bridge_maxage 12
        bridge_stp off</pre></div></div>
</td></tr></table><br />
<p>br0 is replacing eth0 for bridging.
</p><p>Here is another configuration with 2 network cards and 2 bridges&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/network/interfaces</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).
&#160;
# The loopback network interface
auto lo br0 br1
iface lo inet loopback
&#160;
# DMZ
iface br0 inet static
	address 192.168.10.1
	netmask 255.255.255.0
	gateway 192.168.10.254
	network 192.168.10.0
	broadcast 192.168.10.255
        bridge_ports eth0
        bridge_fd 9
        bridge_hello 2
        bridge_maxage 12
        bridge_stp off
&#160;
# Internal
iface br1 inet static
	address 192.168.0.1
	netmask 255.255.255.0
	gateway 192.168.0.254
	network 192.168.0.0
	broadcast 192.168.0.255
        bridge_ports eth1
        bridge_fd 9
        bridge_hello 2
        bridge_maxage 12
        bridge_stp off</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="VLAN_Bridged_configuration"><span class="mw-headline-number">3.4.2</span> VLAN Bridged configuration</span></h3>
<p>And a last one with Vlans bridged (<a href="Mise_en_place_de_VLAN.html" title="Mise en place de VLAN">look at this documentation to enable it before</a>)&#160;:
</p><p>We will need to use etables (iptables for bridged interfaces). Install this&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude install ebtables</pre></div></div>
</td></tr></table><br />
<p>Check you etables configuration&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/default/ebtables</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">EBTABLES_LOAD_ON_START=&quot;yes&quot;
EBTABLES_SAVE_ON_STOP=&quot;yes&quot;
EBTABLES_SAVE_ON_RESTART=&quot;yes&quot;</pre></div></div>
</td></tr></table><br />
<p>And enable VLAN tagging on bridged interfaces&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ebtables</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">ebtables -t broute -A BROUTING -i eth0 -p 802_1Q -j DROP</pre></div></div>
</td></tr></table><br />
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/network/interfaces</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).
&#160;
# The loopback network interface
auto lo
iface lo inet loopback
&#160;
<span class="xtra ln-xtra"># The primary network interface</span><span class="xtra ln-xtra">allow-hotplug eth0</span><span class="xtra ln-xtra">auto eth0</span><span class="xtra ln-xtra">iface eth0 inet manual</span><span class="xtra ln-xtra">&#160;</span><span class="xtra ln-xtra">auto eth0.110</span><span class="xtra ln-xtra">iface eth0.110 inet manual</span><span class="xtra ln-xtra">        vlan_raw_device eth0</span>&#160;
# The bridged interface
auto vmbr0
iface vmbr0 inet static
        address 192.168.100.1
        netmask 255.255.255.0
        network 192.168.100.0
        broadcast 192.168.100.255
        gateway 192.168.100.254
        # dns-* options are implemented by the resolvconf package, if installed
        dns-nameservers 192.168.100.254
        dns-search deimos.fr
        bridge_ports eth0
        bridge_fd 9
        bridge_hello 2
        bridge_maxage 12
        bridge_stp off
&#160;
<span class="xtra ln-xtra">auto vmbr0.110</span><span class="xtra ln-xtra">iface vmbr0.110 inet static</span><span class="xtra ln-xtra">        address 192.168.110.1</span><span class="xtra ln-xtra">        netmask 255.255.255.0</span><span class="xtra ln-xtra">        bridge_ports eth0.190</span><span class="xtra ln-xtra">        bridge_stp off</span><span class="xtra ln-xtra">        bridge_maxwait 0</span><span class="xtra ln-xtra">        bridge_fd 0</span></pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="Nat_configuration"><span class="mw-headline-number">3.4.3</span> Nat configuration</span></h3>
<p>Nat is the default configuration. But you may need to do some adjustements. Add the forwarding to sysctl&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/sysctl.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">net.ipv4.ip_forward = 1</pre></div></div>
</td></tr></table><br />
<p>Check that the connecting is active&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; virsh net-list --all
Name                 State      Autostart 
-----------------------------------------
default              inactive   no</pre></div></div>
</td></tr></table><br />
<p>If it's not the case, then set the default network configuration&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">virsh net-define /etc/libvirt/qemu/networks/default.xml
virsh net-autostart default
virsh net-start default</pre></div></div>
</td></tr></table><br />
<p>Then you should see it enable&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; virsh net-list --all
Name                 State      Autostart 
-----------------------------------------
default              active     yes</pre></div></div>
</td></tr></table><br />
<p>Edit the configuration to add your range of IP&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/libvirt/qemu/networks/default.xml</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="xml source-xml"><pre class="de1"><span class="sc3"><span class="re1">&lt;network<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;name<span class="re2">&gt;</span></span></span>default<span class="sc3"><span class="re1">&lt;/name<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;bridge</span> <span class="re0">name</span>=<span class="st0">&quot;virbr0&quot;</span> <span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;forward</span><span class="re2">/&gt;</span></span>
<span class="xtra ln-xtra">  <span class="sc3"><span class="re1">&lt;ip</span> <span class="re0">address</span>=<span class="st0">&quot;192.168.122.1&quot;</span> <span class="re0">netmask</span>=<span class="st0">&quot;255.255.255.0&quot;</span><span class="re2">&gt;</span></span></span>    <span class="sc3"><span class="re1">&lt;dhcp<span class="re2">&gt;</span></span></span>
<span class="xtra ln-xtra">      <span class="sc3"><span class="re1">&lt;range</span> <span class="re0">start</span>=<span class="st0">&quot;192.168.122.100&quot;</span> <span class="re0">end</span>=<span class="st0">&quot;192.168.122.200&quot;</span> <span class="re2">/&gt;</span></span></span>    <span class="sc3"><span class="re1">&lt;/dhcp<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;/ip<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/network<span class="re2">&gt;</span></span></span></pre></div></div>
</td></tr></table><br />
<p>Now it's done, restart libvirt.
</p>
<h4><span class="mw-headline" id="Iptables"><span class="mw-headline-number">3.4.3.1</span> Iptables</span></h4>
<p>You may need to configure iptables for example if you're on a dedicated box where the provider doesn't allow bridge configuration. Here is a working iptables configuration to permit incoming connexions to Nated guests&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> iptables.sh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1"><span class="co0">#!/bin/bash</span>
<span class="co0"># Made by Pierre Mavro / Deimosfr</span>
<span class="co0"># This script will Nat you KVM/containers hosts</span>
<span class="co0"># and help you to get access from outside</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Essentials</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="re2">IPTABLES</span>=<span class="st_h">'/sbin/iptables'</span>
modprobe nf_conntrack_ftp
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Physical and virtual interfaces definitions</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Interfaces</span>
<span class="re2">wan1_if</span>=<span class="st0">&quot;eth0&quot;</span>
<span class="re2">wan2_if</span>=<span class="st0">&quot;eth0:0&quot;</span>
<span class="re2">kvm_if</span>=<span class="st0">&quot;virbr0&quot;</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Networks definitions</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Networks</span>
<span class="re2">wan1_ip</span>=<span class="st0">&quot;x.x.x.x&quot;</span>
<span class="re2">wan2_ip</span>=<span class="st0">&quot;x.x.x.x&quot;</span>
<span class="re2">vms_net</span>=<span class="st0">&quot;192.168.122.0/24&quot;</span>
&#160;
<span class="co0"># Dedibox internals IPs</span>
<span class="re2">web_ip</span>=<span class="st0">&quot;192.168.122.10&quot;</span>
<span class="re2">mail_ip</span>=<span class="st0">&quot;192.168.122.20&quot;</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Global Rules input / output / forward</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Flushing tables</span>
<span class="re1">$IPTABLES</span> <span class="re5">-F</span>
<span class="re1">$IPTABLES</span> <span class="re5">-X</span>
<span class="re1">$IPTABLES</span> <span class="re5">-t</span> nat <span class="re5">-F</span>
&#160;
<span class="co0"># Define default policy</span>
<span class="re1">$IPTABLES</span> <span class="re5">-P</span> INPUT DROP
<span class="re1">$IPTABLES</span> <span class="re5">-P</span> OUTPUT ACCEPT
<span class="re1">$IPTABLES</span> <span class="re5">-P</span> FORWARD ACCEPT
&#160;
<span class="co0">## Loopback accepte</span>
<span class="co1">${IPTABLES}</span> <span class="re5">-A</span> FORWARD <span class="re5">-i</span> lo <span class="re5">-o</span> lo <span class="re5">-j</span> ACCEPT
<span class="co1">${IPTABLES}</span> <span class="re5">-A</span> INPUT <span class="re5">-i</span> lo <span class="re5">-j</span> ACCEPT
<span class="co1">${IPTABLES}</span> <span class="re5">-A</span> OUTPUT <span class="re5">-o</span> lo <span class="re5">-j</span> ACCEPT
&#160;
<span class="co0"># Allow KVM DHCP/dnsmasq</span>
<span class="co1">${IPTABLES}</span> <span class="re5">-A</span> INPUT <span class="re5">-i</span> <span class="re1">$kvm_if</span> <span class="re5">-p</span> udp <span class="re5">--dport</span> <span class="nu0">67</span> <span class="re5">-j</span> ACCEPT
<span class="co1">${IPTABLES}</span> <span class="re5">-A</span> INPUT <span class="re5">-i</span> <span class="re1">$kvm_if</span> <span class="re5">-p</span> udp <span class="re5">--dport</span> <span class="nu0">69</span> <span class="re5">-j</span> ACCEPT
&#160;
<span class="re1">$IPTABLES</span> <span class="re5">-A</span> INPUT <span class="re5">-j</span> ACCEPT <span class="re5">-d</span> <span class="re1">$vms_net</span>
<span class="re1">$IPTABLES</span> <span class="re5">-A</span> INPUT <span class="re5">-j</span> ACCEPT <span class="re5">-m</span> state <span class="re5">--state</span> ESTABLISHED,RELATED
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Allow masquerading for KVM VMs</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Activating masquerade to get Internet from KVM VMs</span>
<span class="re1">$IPTABLES</span> <span class="re5">-t</span> nat <span class="re5">-A</span> POSTROUTING <span class="re5">-o</span> <span class="re1">$wan1_if</span> <span class="re5">-s</span> <span class="re1">$vms_net</span> <span class="re5">-j</span> MASQUERADE
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Allow ports on KVM host</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># Allow ICMP</span>
<span class="re1">$IPTABLES</span> <span class="re5">-A</span> INPUT <span class="re5">-j</span> ACCEPT <span class="re5">-p</span> icmp
&#160;
<span class="co0"># SSH access</span>
<span class="re1">$IPTABLES</span> <span class="re5">-A</span> INPUT <span class="re5">-j</span> ACCEPT <span class="re5">-p</span> tcp <span class="re5">--dport</span> <span class="nu0">22</span>
&#160;
<span class="co0"># HTTPS access</span>
<span class="re1">$IPTABLES</span> <span class="re5">-A</span> INPUT <span class="re5">-j</span> ACCEPT <span class="re5">-p</span> tcp <span class="re5">--dport</span> <span class="nu0">443</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Redirections for incoming connections (wan1)</span>
<span class="co0">#-------------------------------------------------------------------------</span>
&#160;
<span class="co0"># HTTP access</span>
<span class="re1">$IPTABLES</span> <span class="re5">-t</span> nat <span class="re5">-A</span> PREROUTING <span class="re5">-p</span> tcp <span class="re5">--dport</span> <span class="nu0">80</span> <span class="re5">-d</span> <span class="re1">$wan1_ip</span> <span class="re5">-j</span> DNAT <span class="re5">--to-destination</span> <span class="re1">$web_ip</span>:<span class="nu0">80</span>
&#160;
<span class="co0"># HTTP access</span>
<span class="re1">$IPTABLES</span> <span class="re5">-t</span> nat <span class="re5">-A</span> PREROUTING <span class="re5">-p</span> tcp <span class="re5">--dport</span> <span class="nu0">443</span> <span class="re5">-d</span> <span class="re1">$wan1_ip</span> <span class="re5">-j</span> DNAT <span class="re5">--to-destination</span> <span class="re1">$web_ip</span>:<span class="nu0">443</span>
&#160;
<span class="co0"># Mail for mailsrv</span>
<span class="re1">$IPTABLES</span> <span class="re5">-t</span> nat <span class="re5">-A</span> PREROUTING <span class="re5">-p</span> tcp <span class="re5">--dport</span> <span class="nu0">25</span> <span class="re5">-d</span> <span class="re1">$wan1_ip</span> <span class="re5">-j</span> DNAT <span class="re5">--to-destination</span> <span class="re1">$mail_ip</span>:<span class="nu0">25</span>
&#160;
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="co0"># Reload fail2ban</span>
<span class="co0">#-------------------------------------------------------------------------</span>
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>fail2ban reload</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Create_a_VM"><span class="mw-headline-number">4</span> Create a VM</span></h1>
<h2><span class="mw-headline" id="New_method_.28with_libvirt.29"><span class="mw-headline-number">4.1</span> New method (with libvirt)</span></h2>
<ul><li> If you want to create a VM with disk image and bridged configuration&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virt-install</font>
</td></tr>
<tr>
<td>
<pre>virt-install --ram=1024 --name=lenny --file=<b>/mnt/vms/lenny/disk0.qcow2</b> --cdrom=/mnt/isos/debian-6.0.4-amd64-CD-1.iso --hvm --vnc --noautoconsole --accelerate --network=bridge:br0,model=virtio
</pre>
</td></tr></table><br />
<ul><li> If you are using LVM and bridged configuration&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virt-install</font>
</td></tr>
<tr>
<td>
<pre>virt-install --os-variant=<b>debiansqueeze</b> --ram=<b>256</b> --name=<b>vmname</b> --disk path=<b>/dev/mapper/vgname-lvname</b>,device=disk,cache=none,bus=virtio --cdrom=<b>/mnt/isos/debian-6.0.4-amd64-CD-1.iso</b> --hvm --vnc --noautoconsole --accelerate --network=<b>bridge:br0</b>,model=virtio
</pre>
</td></tr></table><br />
<p>Now a configuration file for this VM has been created in /etc/libvirt/qemu.
</p>
<ul><li> If you are using LVM and nated configuration&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virt-install</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">virt-install --os-variant=debiansqueeze --ram=256 --name=vmname --disk path=/dev/mapper/vg--kvm-vmname,device=disk,cache=none,bus=virtio --cdrom=/mnt/isos/debian-6.0.5-amd64-CD-1.iso --hvm --vnc --noautoconsole --accelerate --network=network:default,model=virtio</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Old_method_.28without_libvirt.29"><span class="mw-headline-number">4.2</span> Old method (without libvirt)</span></h2>
<p>To make a clean installation of a Guest KVM, you can create a script for each VM you want to create. <br />
here is a script exemple to launch a KVM using VNC for display instead of X11 display:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> launch_vm.sh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">#!/bin/sh
clear
# Var Definition
&#160;
# Name of your KVM
HOSTNAME=&quot;Client 1&quot;
&#160;
# Path to your virtual hard drive image
HDD=&quot;-hda /mnt/vms/lenny/disk0.qcow2&quot;
&#160;
# Path to your CD-Rom 
# note&#160;: you can use an iso
CDROM=&quot;-cdrom /dev/cdrom&quot;
&#160;
# Boot Sequence 
# note&#160;: &quot;c&quot;&#160;: HDD, &quot;d&quot;&#160;: CD-Rom, &quot;a&quot;&#160;: Floppy
BOOT=&quot;-boot c&quot;
&#160;
# TAP Device Creation 
# note&#160;: don't forget to change &quot;ifname&quot; if you are using mutliples KVM's&#160;!
#        This is for &quot;bridged mode&quot;. if you wan't to use the &quot;user mode&quot;, remove the &quot;TAP&quot; variable
TAP=&quot;-net tap,vlan=0,ifname=tap0,script=/etc/kvm/kvm-ifup&quot;
&#160;
# Virtual Network Card parameters
# note&#160;: default model is a &quot;ne2k_pci&quot; (rtl8029) and works on Windows XP and Vista
#        &quot;rtl8139&quot; has better performances and is detected as a 100Mb Adapter
#        &quot;pcnet&quot; or &quot;ai82551&quot; are better for BSD's
NIC=&quot;-net nic,model=rtl8139,vlan=0&quot;
&#160;
# Amount of memory (in Megabyte)
MEM=&quot;-m 384&quot;
&#160;
# Miscelaneous options 
# note&#160;: &quot;-k fr&quot;&#160;: if using VNC, it corrects the keyboard problem 
#        &quot;-usbdevice&quot; tablet&#160;: correct the problem of mouse desynchronisation
#        &quot;-no-acpi&quot;&#160;: if you are installing a Windows based guest or a BSD
MISC=&quot;-k fr -localtime -no-acpi -usbdevice tablet&quot;
&#160;
# VNC Mode 
# note&#160;: &quot;-vnc &lt;ip&gt;:&lt;display&gt;&quot;&#160;: allows clients to connect to specified display only ON (not &quot;from&quot;) the specified IP Address
VNC=&quot;-vnc 192.168.0.80:1&quot;
&#160;
# Starting the KVM
# Cheapy Design by Hostin&#160;!&#160;;-p
echo -e &quot;\n\n################################&quot;
echo &quot;##### Starting KVM with... #####&quot;
echo &quot;################################&quot;
echo -e &quot;\n Hard Disk&#160;: \&quot;$HDD\&quot; &quot;
echo &quot; CD-Rom&#160;: \&quot;$CDROM\&quot; &quot;
echo &quot; Boot Sequence&#160;: \&quot;$BOOT\&quot; &quot;
echo &quot; TAP Device&#160;: \&quot;$TAP\&quot; &quot;
echo &quot; Virtual Network Card&#160;: \&quot;$NIC\&quot; &quot;
echo &quot; Memory size&#160;: \&quot;$MEM\&quot; &quot;
echo &quot; Miscelaneous&#160;: \&quot;$MISC\&quot; &quot;
echo &quot; VNC Mode&#160;: \&quot;$VNC\&quot; &quot;
echo -e &quot;\n################################&quot;
echo -e &quot;\n\n######################################################################&quot;
echo &quot;Kernel-based Virtual Machine&#160;: $HOSTNAME - Running&quot;
echo &quot;######################################################################&quot;
echo -e &quot;\n\nLoading kvm-intel kernel module...&quot;
modprobe kvm-intel
exec kvm $HDD $CDROM $BOOT $TAP $NIC $MEM $MISC $VNC</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Manage_VM"><span class="mw-headline-number">5</span> Manage VM</span></h1>
<h2><span class="mw-headline" id="Manual_method"><span class="mw-headline-number">5.1</span> Manual method</span></h2>
<p>After installation is complete, run it with:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> kvm</font>
</td></tr>
<tr>
<td>
<pre>kvm -hda vdisk.img -m 384
</pre>
</td></tr></table><br />
<p>Here is a good solution for *BSD guests&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> qemu-system-x86_64</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">/usr/local/bin/qemu-system-x86_64 /data/virt/netbsd.img \
	-net nic,macaddr=00:56:01:02:03:04,model=i82551 \
	-net tap,ifname=tap0,script=/etc/qemu-ifup \
	-m 256 \
	-no-acpi \
	-localtime \
	-daemonize</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Virt_Manager_.28GUI.29"><span class="mw-headline-number">5.2</span> Virt Manager (GUI)</span></h2>
<p>You can easily install locally or remotly this GUI to manage your VMs&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> apt-get</font>
</td></tr>
<tr>
<td>
<pre>apt-get install virt-manager virt-viewer
</pre>
</td></tr></table><br />
<p><a href="./File:Virt-manager-screenshot.png.html" class="image"><img alt="Virt-manager-screenshot.png" src="images/2/21/Virt-manager-screenshot.png" width="708" height="527" /></a>
</p><p>Just connect remotly or locally and double click to launch a VM (and use it as vnc).
</p>
<h2><span class="mw-headline" id="Virt_Manager_.28Command_line.29"><span class="mw-headline-number">5.3</span> Virt Manager (Command line)</span></h2>
<p>Use virsh command to manage your VMs. Here is a list of useless examples.
</p>
<h3><span class="mw-headline" id="Start.2C_stop.2C_list"><span class="mw-headline-number">5.3.1</span> Start, stop, list</span></h3>
<ul><li> List VMs&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh or list --all</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"> $ virsh list --all
 Id Name                 State
----------------------------------
  2 Mails        running
  4 Backups      running
  6 Web          running</pre></div></div>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td>
<pre>virsh start <b>vm_name</b>
</pre>
</td></tr></table><br />
<ul><li> Shutdown gracefully a VM&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td>
<pre>virsh shutdown <b>vm_name</b>
</pre>
</td></tr></table><br />
<ul><li> Force to shutdown the VM&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td>
<pre>virsh destroy <b>vm_name</b>
</pre>
</td></tr></table><br />
<h3><span class="mw-headline" id="Suspend.2C_restore"><span class="mw-headline-number">5.3.2</span> Suspend, restore</span></h3>
<ul><li> Suspend a VM&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td>
<pre>virsh suspend <b>vm_name</b>
</pre>
</td></tr></table><br />
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td>
<pre>virsh resume <b>vm_name</b>
</pre>
</td></tr></table><br />
<h3><span class="mw-headline" id="Delete"><span class="mw-headline-number">5.3.3</span> Delete</span></h3>
<ul><li> Will delete configuration file (xml in /etc/libvirt/qemu/)&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td>
<pre>virsh undefine <b>vm_name</b>
</pre>
</td></tr></table><br />
<h3><span class="mw-headline" id="Backups.2C_restore"><span class="mw-headline-number">5.3.4</span> Backups, restore</span></h3>
<ul><li> Save a VM&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td>
<pre>virsh save vm_name vm_name.dump
</pre>
</td></tr></table><br />
<ul><li> Restore a VM&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td>
<pre>virsh restore vm_name.dump
</pre>
</td></tr></table><br />
<h3><span class="mw-headline" id="Autostart"><span class="mw-headline-number">5.3.5</span> Autostart</span></h3>
<p>If you want to set a VM to start automatically on boot&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">virsh autostart &lt;vm_name&gt;</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Snapshots"><span class="mw-headline-number">6</span> Snapshots</span></h1>
<p>There is a long list on how to manage snapshots (<a rel="nofollow" class="external text" href="http://kashyapc.fedorapeople.org/virt/lc-2012/snapshots-handout.html">I suggest that link</a>). There are 2 kinds of snapshot&#160;:
</p>
<ul><li> Internal&#160;: snapshot are stored inside the image file</li>
<li> External&#160;: snapshot are stored in an external image file</li></ul>
<h2><span class="mw-headline" id="Create_a_snapshot"><span class="mw-headline-number">6.1</span> Create a snapshot</span></h2>
<p>To create the snapshot&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1">virsh snapshot-create-as <span class="re5">--domain</span> <span class="sy0">&lt;</span>vm_name<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>snapshot_name<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>snapshot_description<span class="sy0">&gt;</span> <span class="re5">--disk-only</span> <span class="re5">--diskspec</span> vda,<span class="re2">snapshot</span>=external,<span class="re2">file</span>=<span class="sy0">/</span>mnt<span class="sy0">/</span>vms<span class="sy0">/&lt;</span>snapshot_name<span class="sy0">&gt;</span>.qed <span class="re5">--atomic</span></pre></div></div>
</td></tr></table><br />
<ul><li> &lt;vm_name&gt;&#160;: set the vm domain name</li>
<li> &lt;snapshot_name&gt;&#160;: the name of the snapshot (not as a file, but as it will be displayed on virsh)</li>
<li> &lt;snapshot_description&gt;&#160;: a description of that snapshot</li>
<li> vda&#160;: select the name of the VM device to backup</li>
<li> &lt;snapshot_name&gt;&#160;: set the <b>full path</b> of the snapshot file (where it should be stored</li></ul>
<p>Once that command launched, the base VM disk (not the snapshot) becomes read only and the snapshot is read/write. You could copy the base for the backup if you want.
</p><p>You can check your disk currently used for write&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1"><span class="sy0">&gt;</span> virsh domblklist pma_qedtest
&#160;
Target     Source
<span class="re5">------------------------------------------------</span>
vda        <span class="sy0">/</span>mnt<span class="sy0">/</span>vms<span class="sy0">/</span>vms<span class="sy0">/</span>pma_qedtest-snap.qed</pre></div></div>
</td></tr></table><br />
<p><br />
</p>
<h2><span class="mw-headline" id="External_snapshot"><span class="mw-headline-number">6.2</span> External snapshot</span></h2>
<p>With the external snapshot, there are multiple way to create snapshots (blockcommit, blockpull...). They all got their pros and cons.
</p>
<h3><span class="mw-headline" id="blockpull"><span class="mw-headline-number">6.2.1</span> blockpull</span></h3>
<p>This is the simplest and oldest way to merge the base to the snapshot:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">virsh blockpull --domain test --path /mnt/vms/&lt;snapshot_name&gt;.img</pre></div></div>
</td></tr></table><br />
<p>When finished (look at iotop status), you can remove the base image and keep the snapshot.
</p>
<h3><span class="mw-headline" id="blockcommit"><span class="mw-headline-number">6.2.2</span> blockcommit</span></h3>
<p>The blockcommit, is my favorite way to create backups. The actual problem is on Debian 7, this is not present as virsh require a version upper or equal to 0.10.2 and it's only available on Debian unstable for the moment. Anyway, if you've got this version, here is how to do it.
</p><p>Now we've got something like that&#160;:
</p>
<pre>[base(1)]---&gt;[snapshot(2)]
</pre>
<p>If I now want to merge snapshot to base and got only one disk file&#160;:
</p>
<pre>[base(1)]&lt;---[snapshot(2)]
[base(2)]
</pre>
<p>you need to follow it&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1">virsh blockcommit <span class="re5">--domain</span> <span class="sy0">&lt;</span>vm_name<span class="sy0">&gt;</span> vda <span class="re5">--base</span> <span class="sy0">/</span>mnt<span class="sy0">/</span>vms<span class="sy0">/&lt;</span>base_name<span class="sy0">&gt;</span>.qed <span class="re5">--top</span> <span class="sy0">/</span>mnt<span class="sy0">/</span>vms<span class="sy0">/&lt;</span>snapshot_name<span class="sy0">&gt;</span>.qed <span class="re5">--wait</span> <span class="re5">--verbose</span></pre></div></div>
</td></tr></table><br />
<ul><li> --base&#160;: the actual read only base disk</li>
<li> --top&#160;: the snapshot disk file to merge in base</li></ul>
<h1><span class="mw-headline" id="Others"><span class="mw-headline-number">7</span> Others</span></h1>
<h2><span class="mw-headline" id="Reload_configuration"><span class="mw-headline-number">7.1</span> Reload configuration</span></h2>
<p>If you have made modifications on the xml file and wish reload it&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td>
<pre>virsh define <b>/etc/libvirt/qemu/my_vm.xml</b>
</pre>
</td></tr></table><br />
<h2><span class="mw-headline" id="Serial_Port_Connection"><span class="mw-headline-number">7.2</span> Serial Port Connection</span></h2>
<p>If you want to connect to serial port, <a href="Activer_le_port_série_sur_Linux.html" title="Activer le port série sur Linux">you need to have configured your guest to enable it</a>, then connect with virsh&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">virsh connect &lt;hostname&gt;</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Add_a_disk_to_an_existing_VM"><span class="mw-headline-number">7.3</span> Add a disk to an existing VM</span></h2>
<p>This is very simple (my VM is called 'ed')&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">virsh attach-disk vmname /dev/mapper/vg-lv sdb</pre></div></div>
</td></tr></table><br />
<ul><li> vmname&#160;: set the name of your VM</li>
<li> /dev/mapper/vg-lv&#160;: set the disk</li>
<li> sdb&#160;: the device name shown inside the VM</li></ul>
<p>On Debian 6, there is a little bug. So the configuration needs to be reviewed. Replace the current configuration by the running one&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">vmname=ed
virsh dumpxml $vmname &gt; /etc/libvirt/qemu/$vmname.xml
virsh shutdown $vmname</pre></div></div>
</td></tr></table><br />
<p>Then edit the xml of your VM and change driver name from 'phy' to 'qemu'&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/libvirt/qemu/$vmname.xml</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="xml source-xml"><pre class="de1">[...]
    <span class="sc3"><span class="re1">&lt;disk</span> <span class="re0">type</span>=<span class="st0">'block'</span> <span class="re0">device</span>=<span class="st0">'disk'</span><span class="re2">&gt;</span></span>
<span class="xtra ln-xtra">      <span class="sc3"><span class="re1">&lt;driver</span> <span class="re0">name</span>=<span class="st0">'phy'</span> <span class="re0">type</span>=<span class="st0">'raw'</span><span class="re2">/&gt;</span></span></span>[...]</pre></div></div>
</td></tr></table><br />
<p>And load it&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">virsh define /etc/libvirt/qemu/$vmname.xml</pre></div></div>
</td></tr></table><br />
<p>Now you can launch your VM
</p>
<h2><span class="mw-headline" id="Bind_CPU.2FCores_to_a_VM"><span class="mw-headline-number">7.4</span> Bind CPU/Cores to a VM</span></h2>
<p>If you want to bind some CPU/Cores to a VM/Container, there is a solution called CPU Pining&#160;:-). First, look at the available cores on your server&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> grep</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; grep -e processor -e core /proc/cpuinfo | sed 's/processor/\nprocessor/'
&#160;
processor	: 0
core id		: 0
cpu cores	: 4
&#160;
processor	: 1
core id		: 1
cpu cores	: 4
&#160;
processor	: 2
core id		: 2
cpu cores	: 4
&#160;
processor	: 3
core id		: 3
cpu cores	: 4
&#160;
processor	: 4
core id		: 0
cpu cores	: 4
&#160;
processor	: 5
core id		: 1
cpu cores	: 4
&#160;
processor	: 6
core id		: 2
cpu cores	: 4
&#160;
processor	: 7
core id		: 3
cpu cores	: 4</pre></div></div>
</td></tr></table><br />
<p>You can see there are 7 cores (called processor). In fact there are 4 cores with 2 thread each on this CPU. That's why there are 4 cores id and 8 detected cores.
</p><p>So here is the list of the cores with their attached core&#160;:
</p>
<pre>core id 0&#160;: processors 0 and 4
core id 1&#160;: processors 1 and 5
core id 2&#160;: processors 2 and 6
core id 3&#160;: processors 3 and 7
</pre>
<p>Now, if I want on a VM a dedicated CPU with it's additional thread, I would prefer do 2 virtual CPU (vpcu) and bind the good core on it. So first, look at the current configuration&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; virsh vcpuinfo vmname
VCPU:           0
CPU:            6
State:          running
CPU time:       7,5s
CPU Affinity:   yyyyyyyy</pre></div></div>
</td></tr></table><br />
<p>You can see there is only 1 vcpu. And all the cores of the CPU are used (count the number of 'y' in CPU Affinity, here 8). If we want the best performances, we need to add as many vcpu as we want of cores on a VM, you will see the advantage later... So let's add some cores&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">virsh setvcpus &lt;vmname&gt; &lt;number_of_vcpus&gt;</pre></div></div>
</td></tr></table><br />
<p>So here for example, we set 4 vcpus. That mean the VM will see 4 cores&#160;! Now, we're going to bind processor 0 and 4 on both vcpu&#160;! Why&#160;? Because if an application doesn't know how to multithread, it will use all the cores&#160;! And if applications knows how to use multi cores, they will use it like that. So in any case, you will have good performances&#160;:-).
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">virsh vcpupin vmname 0 2,6,3,7
virsh vcpupin vmname 1 2,6,3,7
virsh vcpupin vmname 2 2,6,3,7
virsh vcpupin vmname 3 2,6,3,7</pre></div></div>
</td></tr></table><br />
<p>So now I added 4 virtuals CPU (0 and 1) and added 2 cores (2 and 3) with their associated thread (6 and 7).
</p><p>In Debian 6 version, it will be done on the fly, but won't be set definitely in the configuration. That's why you'll need to add those parameters (cpuset) in the XML of your VM&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> vmname.xml</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="xml source-xml"><pre class="de1">[...]
  <span class="sc3"><span class="re1">&lt;vcpu</span> <span class="re0">cpuset</span>=<span class="st0">'2,6,3,7'</span><span class="re2">&gt;</span></span>4<span class="sc3"><span class="re1">&lt;/vcpu<span class="re2">&gt;</span></span></span>
[...]</pre></div></div>
</td></tr></table><br />
<p>Do not forget to apply the new configuration&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">virsh define /etc/libvirt/qemu/vmname.xml</pre></div></div>
</td></tr></table><br />
<p>We can now check the new configuration&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">&gt; virsh vcpuinfo vmname
VCPU:           0
CPU:            2
State:          running
CPU time:       8,1s
CPU Affinity:   --yy--yy
&#160;
VCPU:           1
CPU:            2
State:          running
CPU time:       2,6s
CPU Affinity:   --yy--yy
&#160;
VCPU:           2
CPU:            3
State:          running
CPU time:       2,7s
CPU Affinity:   --yy--yy
&#160;
VCPU:           3
CPU:            7
State:          running
CPU time:       6,6s
CPU Affinity:   --yy--yy</pre></div></div>
</td></tr></table><br />
<p>If you want to know more <a href="Latence_des_process_et_kernel_timing.html#cpuset" title="Latence des process et kernel timing">how cpusets works, follow that link</a>.
</p>
<h1><span class="mw-headline" id="Others_2"><span class="mw-headline-number">8</span> Others</span></h1>
<h2><span class="mw-headline" id="Convert_a_disk_based_VM_on_a_LVM_parition"><span class="mw-headline-number">8.1</span> Convert a disk based VM on a LVM parition</span></h2>
<p>You may have a couple of VM based on disk image like qcow2 and my want to convert them into LVM partition. Fortunatly, there is a solution&#160;! First convert into your qcow into raw format&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> kvm-img</font>
</td></tr>
<tr>
<td>
<pre>kvm-img convert disk0.qcow2 -O raw disk0.raw
</pre>
</td></tr></table><br />
<p>and then put the raw bits into the LVM volume&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> dd</font>
</td></tr>
<tr>
<td>
<pre>dd if=disk0.raw of=/dev/vg-name/lv-name bs=1M
</pre>
</td></tr></table><br />
<p>Now edit your xml file and make those changes&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/libvirt/qemu/vm.xml</font>
</td></tr>
<tr>
<td>
<pre>...
   &lt;disk type='file' device='disk'&gt;
     &lt;syntaxhighlight file='/dev/vg0/vm10'/&gt;
     &lt;target dev='hda' bus='ide'/&gt;
   &lt;/disk&gt;
...
</pre>
<p>Change to&#160;:
</p>
<pre>...
   &lt;disk type='<b>block'</b> device='disk'&gt;
     &lt;syntaxhighlight <b>dev</b>='<b>vg-name/lv-name'</b>/&gt;
     &lt;target dev='hda' bus='ide'/&gt;
   &lt;/disk&gt;
...
</pre>
</td></tr></table><br />
<p>Now reload your xml file of VM&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td>
<pre>virsh define /etc/libvirt/qemu/vm.xml
</pre>
</td></tr></table><br />
<p>And now you can start the VM&#160;:-)
</p>
<h2><span class="mw-headline" id="Convert_an_LVM_parition_to_a_disk_image"><span class="mw-headline-number">8.2</span> Convert an LVM parition to a disk image</span></h2>
<p>To convert an LVM to QED for example, launch that command and adapt it&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">qemu-img convert -O qed /dev/vg_name/lv_name/ /var/lib/libvirt/images/image_name.qed</pre></div></div>
</td></tr></table><br />
<p>Then edit the VM libvirt configuration file like this&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/libvirt/qemu/vm.xml</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="xml source-xml"><pre class="de1">    <span class="sc3"><span class="re1">&lt;disk</span> <span class="re0">type</span>=<span class="st0">'file'</span> <span class="re0">device</span>=<span class="st0">'disk'</span><span class="re2">&gt;</span></span>
      <span class="sc3"><span class="re1">&lt;driver</span> <span class="re0">name</span>=<span class="st0">'qemu'</span> <span class="re0">type</span>=<span class="st0">'qed'</span><span class="re2">/&gt;</span></span>
      <span class="sc3"><span class="re1">&lt;source</span> <span class="re0">file</span>=<span class="st0">'/var/lib/libvirt/images/image_name.qed'</span><span class="re2">/&gt;</span></span></pre></div></div>
</td></tr></table><br />
<p>Now reload your xml file of VM&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> virsh</font>
</td></tr>
<tr>
<td>
<pre>virsh define /etc/libvirt/qemu/vm.xml
</pre>
</td></tr></table><br />
<p>And now you can start the VM&#160;:-)
</p>
<h2><span class="mw-headline" id="Transfert_a_LVM_disk_based_VM"><span class="mw-headline-number">8.3</span> Transfert a LVM disk based VM</span></h2>
<p>If you need to transfer from one server to another a VM based on LVM, there is an easy way solution. You need to first stop the Virtual Machine to have consistency datas, then you can transfer them&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> dd</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">dd if=/dev/vgname/lvname bs=1M | ssh root@new-server 'dd of=/dev/vgname/lvname bs=1M'</pre></div></div>
</td></tr></table><br />
<p>Do not forget to transfer xml file configuration of the VM and adapt LVM disks name if needed. Then "virsh define" the new xml file.
</p>
<h2><span class="mw-headline" id="Graphically_access_to_VMs_without_Virt_Manager"><span class="mw-headline-number">8.4</span> Graphically access to VMs without Virt Manager</span></h2>
<p>If you want to access thought your VMs without installing any manager, you can. First you have to be sure when you created your VM, you entered the <b>--vnc</b> option <b>or</b> when you launch it, you use this option.
</p><p>If if it's not hte case and you're using libvirt, please add it to your wished VM&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/libvirt/qemu/myvm.xml</font>
</td></tr>
<tr>
<td>
<pre>...
    <b>&lt;graphics type='vnc' port='-1' autoport='yes' keymap='fr'/&gt;</b>
  &lt;/devices&gt;
&lt;/domain&gt;
</pre>
</td></tr></table><br />
<p>Now this is done, you need to change the default listening address of VNC on libvirt. By default, it's listening on 127.0.0.1. This is the most secure choice. However, you may have a secured LAN and wished to open it to anybody. Open so the qemu.conf and modify it to bind on you secure server IP address&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/libvirt/qemu.conf</font>
</td></tr>
<tr>
<td>
<pre>vnc_listen = "192.168.0.1"
</pre>
</td></tr></table><br />
<p>If you need as well to activate secure VNC connections, please activate TLS in the same config file.
</p><p>Then restart or reload libvirt-bin.
</p>
<h2><span class="mw-headline" id="Suspend_guests_VMs_on_host_shutdown"><span class="mw-headline-number">8.5</span> Suspend guests VMs on host shutdown</span></h2>
<p>If your desktop hosts several VMs, it could be interesting to auto suspend them when you restart your computer for example. There is a service for that to make it easy. Simply edit libvirt-guests file configuration&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/default/libvirt-guests</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># URIs to check for running guests
# example: URIS='default xen:/// vbox+tcp://host/system lxc:///'
<span class="xtra ln-xtra">URIS=qemu:///system</span># action taken on host boot
# - start   all guests which were running on shutdown are started on boot
#           regardless on their autostart settings
# - ignore  libvirt-guests init script won't start any guest on boot, however,
#           guests marked as autostart will still be automatically started by
#           libvirtd
<span class="xtra ln-xtra">ON_BOOT=ignore</span>&#160;
# Number of seconds to wait between each guest start. Set to 0 to allow
# parallel startup.
<span class="xtra ln-xtra">START_DELAY=0</span>&#160;
# action taken on host shutdown
# - suspend   all running guests are suspended using virsh managedsave
# - shutdown  all running guests are asked to shutdown. Please be careful with
#             this settings since there is no way to distinguish between a
#             guest which is stuck or ignores shutdown requests and a guest
#             which just needs a long time to shutdown. When setting
#             ON_SHUTDOWN=shutdown, you must also set SHUTDOWN_TIMEOUT to a
#             value suitable for your guests.
<span class="xtra ln-xtra">ON_SHUTDOWN=suspend</span>&#160;
# If set to non-zero, shutdown will suspend guests concurrently. Number of
# guests on shutdown at any time will not exceed number set in this variable.
<span class="xtra ln-xtra">PARALLEL_SHUTDOWN=3</span>&#160;
# Number of seconds we're willing to wait for a guest to shut down. If parallel
# shutdown is enabled, this timeout applies as a timeout for shutting down all
# guests on a single URI defined in the variable URIS. If this is 0, then there
# is no time out (use with caution, as guests might not respond to a shutdown
# request). The default value is 300 seconds (5 minutes).
<span class="xtra ln-xtra">SHUTDOWN_TIMEOUT=600</span>&#160;
# If non-zero, try to bypass the file system cache when saving and
# restoring guests, even though this may give slower operation for
# some file systems.
#BYPASS_CACHE=0</pre></div></div>
</td></tr></table><br />
<p>That's all&#160;:-)
</p>
<h1><span class="mw-headline" id="FAQ"><span class="mw-headline-number">9</span> FAQ</span></h1>
<p>Read the manual page for more information&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> man</font>
</td></tr>
<tr>
<td>
<pre>man kvm
</pre>
</td></tr></table><br />
<h2><span class="mw-headline" id="warning:_could_not_open_.2Fdev.2Fnet.2Ftun:_no_virtual_network_emulation"><span class="mw-headline-number">9.1</span> warning: could not open /dev/net/tun: no virtual network emulation</span></h2>
<p>This happen when you want to charge the tun device and you don't have permissions. Simply run your kvm command with sudo.
</p>
<h2><span class="mw-headline" id="Solaris_reboot_all_the_time_on_grub_menu"><span class="mw-headline-number">9.2</span> Solaris reboot all the time on grub menu</span></h2>
<ul><li> Run through the installer as usual</li>
<li> On completion and reboot, the VM will perpetually reboot. "Stop" the VM.</li>
<li> Start it up again, and immediately open a vnc console and select the Safe Boot from the options screen</li>
<li> When prompted if you want to try and recover the boot block, say yes</li>
<li> You should now have a Bourne terminal with your existing filesystem mounted on /a</li>
<li> Run /a/usr/bin/bash (my preferred shell)</li>
<li> export TERM=xterm</li>
<li> vi /a/boot/grub/menu.1st (editing the bootloader on your mounted filesystem), to add "kernel/unix" to the kernel options for the non-safe-mode boot. Ex&#160;:</li></ul>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /a/boot/grub/menu.lst</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">...
kernel$ /platform/i86pc/multiboot -B $ZFS-BOOTFS kernel/unix
...</pre></div></div>
</td></tr></table><br />
<ul><li> Save the file and restart the VM - that's it!</li></ul>
<h2><span class="mw-headline" id="error:_Timed_out_during_operation:_cannot_acquire_state_change_lock"><span class="mw-headline-number">9.3</span> error: Timed out during operation: cannot acquire state change lock</span></h2>
<p>If you got this kind of error while starting a VM&#160;:
</p>
<pre>error: Failed to start domain &lt;vm&gt;
error: Timed out during operation: cannot acquire state change lock
</pre>
<p>it's due to a bug and could be resolved like this&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">/etc/init.d/libvirt-bin stop
rm -Rf /var/run/libvirt
/etc/init.d/libvirt-bin start</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Ressources"><span class="mw-headline-number">10</span> Ressources</span></h1>
<p><a rel="nofollow" class="external free" href="https://help.ubuntu.com/community/KVM">https://help.ubuntu.com/community/KVM</a><br />
<a href="images/e/e4/Speed_up_qemu.pdf" class="internal" title="Speed up qemu.pdf">Documentation for Speeding up QEMU with KVM and KQEMU</a><br />
<a href="images/7/71/Using_KVM_On_Ubuntu.pdf" class="internal" title="Using KVM On Ubuntu.pdf">Documentation on using KVM on Ubuntu</a><br />
<a href="images/2/2a/Virtualization_With_KVM.pdf" class="internal" title="Virtualization With KVM.pdf">Virtualization With KVM</a><br />
<a href="images/0/02/KVM_Guest_Management_With_Virt-Manager.pdf" class="internal" title="KVM Guest Management With Virt-Manager.pdf">KVM Guest Management With Virt-Manager</a><br />
<a rel="nofollow" class="external free" href="http://www.linux-kvm.org/page/Using_VirtIO_NIC">http://www.linux-kvm.org/page/Using_VirtIO_NIC</a><br />
<a rel="nofollow" class="external free" href="http://blog.loftninjas.org/2008/10/22/kvm-virtio-network-performance/">http://blog.loftninjas.org/2008/10/22/kvm-virtio-network-performance/</a><br />
<a rel="nofollow" class="external free" href="http://www.linux-kvm.org/page/Tuning_KVM">http://www.linux-kvm.org/page/Tuning_KVM</a><br />
<a rel="nofollow" class="external free" href="http://blog.bodhizazen.net/linux/improve-kvm-performance/">http://blog.bodhizazen.net/linux/improve-kvm-performance/</a><br />
<a rel="nofollow" class="external free" href="http://blog.allanglesit.com/2011/05/linux-kvm-vlan-tagging-for-guest-connectivity/">http://blog.allanglesit.com/2011/05/linux-kvm-vlan-tagging-for-guest-connectivity/</a><br />
<a rel="nofollow" class="external free" href="https://wiki.archlinux.org/index.php/KVM#Enabling_KSM">https://wiki.archlinux.org/index.php/KVM#Enabling_KSM</a><br />
<a rel="nofollow" class="external free" href="http://fr.gentoo-wiki.com/wiki/Libvirt">http://fr.gentoo-wiki.com/wiki/Libvirt</a><br />
<a rel="nofollow" class="external free" href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Virtualization_Host_Configuration_and_Guest_Installation_Guide/chap-Virtualization_Host_Configuration_and_Guest_Installation_Guide-Network_Configuration.html#sect-Virtualization_Host_Configuration_and_Guest_Installation_Guide-Network_Configuration-Network_address_translation_NAT_with_libvirt">http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Virtualization_Host_Configuration_and_Guest_Installation_Guide/chap-Virtualization_Host_Configuration_and_Guest_Installation_Guide-Network_Configuration.html#sect-Virtualization_Host_Configuration_and_Guest_Installation_Guide-Network_Configuration-Network_address_translation_NAT_with_libvirt</a><br />
<a rel="nofollow" class="external free" href="http://docs.fedoraproject.org/en-US/Fedora/13/html/Virtualization_Guide/ch25s06.html">http://docs.fedoraproject.org/en-US/Fedora/13/html/Virtualization_Guide/ch25s06.html</a><br />
<a rel="nofollow" class="external free" href="http://berrange.com/posts/2010/02/12/controlling-guest-cpu-numa-affinity-in-libvirt-with-qemu-kvm-xen/">http://berrange.com/posts/2010/02/12/controlling-guest-cpu-numa-affinity-in-libvirt-with-qemu-kvm-xen/</a><br />
<a rel="nofollow" class="external free" href="http://wiki.kartbuilding.net/index.php/KVM_Setup_on_Debian_Squeeze">http://wiki.kartbuilding.net/index.php/KVM_Setup_on_Debian_Squeeze</a><br />
<a rel="nofollow" class="external free" href="http://kashyapc.fedorapeople.org/virt/lc-2012/snapshots-handout.html">http://kashyapc.fedorapeople.org/virt/lc-2012/snapshots-handout.html</a><br />
<a rel="nofollow" class="external free" href="http://fedoraproject.org/wiki/Features/Virt_Live_Snapshots">http://fedoraproject.org/wiki/Features/Virt_Live_Snapshots</a><br />
<a rel="nofollow" class="external free" href="https://www.redhat.com/archives/libvirt-users/2012-September/msg00063.html">https://www.redhat.com/archives/libvirt-users/2012-September/msg00063.html</a>
</p>
<!-- 
NewPP limit report
CPU time usage: 0.200 seconds
Real time usage: 0.202 seconds
Preprocessor visited node count: 1531/1000000
Preprocessor generated node count: 4212/1000000
Post‐expand include size: 22535/2097152 bytes
Template argument size: 6433/2097152 bytes
Highest expansion depth: 4/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   72.997      1 - -total
 44.96%   32.820     56 - Template:Command
 31.94%   23.313     22 - Template:Config
 15.60%   11.387      1 - Template:KVM_network_nat_iptables
  5.15%    3.759      1 - Template:KVM_network_nat
  3.95%    2.882      1 - Template:KVM_bridged_vlans_config
  2.80%    2.045      1 - Template:Infobox
  2.64%    1.930      1 - Template:KVM_network_bridged
  2.01%    1.470      1 - Template:Get_CPU_Pining_Infos
  1.82%    1.332      1 - Template:Dd_transfer_vm
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:1917-0!*!0!1!en!5!* and timestamp 20181111230816 and revision id 13465
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=KVM_:_Mise_en_place_de_KVM&amp;oldid=13465">https://wiki.deimos.fr/index.php?title=KVM_:_Mise_en_place_de_KVM&amp;oldid=13465</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=KVM+%3A+Mise+en+place+de+KVM" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="./KVM_:_Mise_en_place_de_KVM.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="./KVM_:_Mise_en_place_de_KVM.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="./KVM_:_Mise_en_place_de_KVM.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=KVM_:_Mise_en_place_de_KVM&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=KVM_:_Mise_en_place_de_KVM&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="./KVM_:_Mise_en_place_de_KVM.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/KVM_:_Mise_en_place_de_KVM.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/KVM_:_Mise_en_place_de_KVM" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=KVM_:_Mise_en_place_de_KVM&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=KVM_:_Mise_en_place_de_KVM&amp;oldid=13465" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=KVM_:_Mise_en_place_de_KVM&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 3 March 2015, at 09:41.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":239});
}</script>
	</body>
</html>
	
<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>PuppetDB : Augmentez les fonctionnalités de votre Puppet - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=ext.cite.styles|mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet","wgTitle":"PuppetDB : Augmentez les fonctionnalités de votre Puppet","wgCurRevisionId":13008,"wgRevisionId":13008,"wgArticleId":3505,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet","wgRelevantArticleId":3505,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-PuppetDB_Augmentez_les_fonctionnalités_de_votre_Puppet skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">PuppetDB : Augmentez les fonctionnalités de votre Puppet</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#mw-navigation">navigation</a>, 					<a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#PuppetDB"><span class="tocnumber">2.1</span> <span class="toctext">PuppetDB</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#PostgreSQL"><span class="tocnumber">2.2</span> <span class="toctext">PostgreSQL</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#Terminus"><span class="tocnumber">2.3</span> <span class="toctext">Terminus</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#Configuration"><span class="tocnumber">3</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#PostgreSQL_2"><span class="tocnumber">3.1</span> <span class="toctext">PostgreSQL</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#PuppetDB_2"><span class="tocnumber">3.2</span> <span class="toctext">PuppetDB</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#Puppet_Master"><span class="tocnumber">3.3</span> <span class="toctext">Puppet Master</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#FAQ"><span class="tocnumber">4</span> <span class="toctext">FAQ</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#J.27ai_des_erreurs_OutOfMemoryError_dans_mes_logs_et_PuppetDB_r.C3.A9ponds_difficilement"><span class="tocnumber">4.1</span> <span class="toctext">J'ai des erreurs OutOfMemoryError dans mes logs et PuppetDB réponds difficilement</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#References"><span class="tocnumber">5</span> <span class="toctext">References</span></a></li>
</ul>
</div>

<table class="config_array" align="right" style="width:20em; font-size:90%; text-align:left; border: 1px #d0e7ff solid; margin-left:10px;">
   <tr>
      <td class="config_subarray" colspan="2" style="text-align:center;"><a href="./File:Puppet-short.png.html" class="image" title="Puppet"><img alt="Puppet" src="images/e/ef/Puppet-short.png" width="151" height="44" /></a></td>
   </tr><tr><td colspan="2" style="text-align:center;"><hr class="gradient" /></td></tr><tr>
      <th>Software version</th>
      <td>1.5.2</td>
   </tr><tr>
      <th>Operating System</th>
      <td>Debian 7</td>
   </tr><tr>
      <th>Website</th>
      <td><a rel="nofollow" class="external text" href="http://puppetlabs.com/">Puppet Website</a></td>
   </tr><tr>
      <th>Last Update</th>
      <td>28/10/2013</td>
   </tr><tr>
      <th>Others</th>
      <td></td>
   </tr>
</table>
<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p>PuppetDB<sup id="cite_ref-1" class="reference"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#cite_note-1">[1]</a></sup> permet de récupérer les données collectées par <a href="./Puppet_:_Solution_de_gestion_de_fichier_de_configuration.html" title="Puppet : Solution de gestion de fichier de configuration">Puppet</a> comme les facts et d’utiliser entre autres les ressources exportées. Ces données pourront ensuite être utilisées par d’autres programmes, comme le <a href="./Puppet_Dashboard_:_Mise_en_place_d'une_interface_graphique_pour_Puppet.html" title="Puppet Dashboard : Mise en place d'une interface graphique pour Puppet">dashboard</a>, ou vos propres outils grâce à une API. Vous pouvez installer le serveur PuppetDB sur votre PuppetMaster ou sur un serveur à part.<sup id="cite_ref-2" class="reference"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#cite_note-2">[2]</a></sup> 
</p><p>Il est aujourd'hui possible d'utiliser 2 backends pour y stocker ces données&#160;:
</p>
<ul><li> HSQLDB&#160;: base de donnée en mémoire, avec pas mal de limitations en plus de celle des 100 noeuds maximum, mais extrêmement rapide (car chargée en RAM)</li>
<li> PostgreSQL&#160;: base de donnée classique, avec moins de performances (sur disque), mais avec plus de souplesse et une possibilité d'extension plus grande dans le temps (+100 noeuds Puppet).</li></ul>
<p>Nous partirons donc sur la solution basée sur PostgreSQL.
</p><p>Si vous souhaitez plus d'informations, regardez <a rel="nofollow" class="external text" href="http://docs.puppetlabs.com/puppetdb/1/scaling_recommendations.html">les différents goulots d’étranglement</a>. En gros et pour résumer&#160;: si vous avez plus de 100 clients, il vous faudra une base de données PostgreSQL, gonfler votre JVM, augmenter le nombre de cpu/coeurs.
</p>
<h1><span class="mw-headline" id="Installation"><span class="mw-headline-number">2</span> Installation</span></h1>
<h2><span class="mw-headline" id="PuppetDB"><span class="mw-headline-number">2.1</span> PuppetDB</span></h2>
<p>Commençons par mettre en place le nécessaire pour pouvoir ensuite installer PuppetDB&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">wget http://apt.puppetlabs.com/puppetlabs-release-stable.deb
dpkg -i puppetlabs-release-stable.deb</pre></div></div>
</td></tr></table><br />
<p>Et ensuite, nous mettez à jour&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude update</pre></div></div>
</td></tr></table><br />
<p>Puis il va falloir que vous ayez puppet d'installé sur la même machine où sera installé PuppetDB.
</p>
<table width="100%" class="warning_array">
<tr>
<td class="warning_subarray"> <font size="-1"><a href="./File:Warning_file.png.html" class="image" title="Warning"><img alt="Warning" src="images/0/09/Warning_file.png" width="39" height="32" /></a> <b>WARNING</b></font>
</td></tr>
<tr>
<td>PuppetDB ne peut fonctionner sans le client puppet&#160;!
</td></tr></table><br />
<p>Peut importe s'il s'agisse ou non de la même machine que le master. Par soucis de simplicité, nous allons l'installer sur le Puppet Master.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude install puppetdb puppet</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="PostgreSQL"><span class="mw-headline-number">2.2</span> PostgreSQL</span></h2>
<p>Comme nous prévoyons d'avoir plus de 100 clients (ou même si c'est moins, pas forcément envie de changer la configuration d'ici quelques temps), nous allons installer PostgreSQL&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude install postgresql</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="Terminus"><span class="mw-headline-number">2.3</span> Terminus</span></h2>
<p><b>Sur le serveur Puppet Master</b>, installez ce package&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">aptitude install puppetdb-terminus</pre></div></div>
</td></tr></table><br />
<h1><span class="mw-headline" id="Configuration"><span class="mw-headline-number">3</span> Configuration</span></h1>
<h2><span class="mw-headline" id="PostgreSQL_2"><span class="mw-headline-number">3.1</span> PostgreSQL</span></h2>
<p>Nous allons créer un utilisateur, ainsi qu'une base&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">su - postgres
createuser -DRSP puppetdb
createdb -O puppetdb puppetdb
exit</pre></div></div>
</td></tr></table><br />
<h2><span class="mw-headline" id="PuppetDB_2"><span class="mw-headline-number">3.2</span> PuppetDB</span></h2>
<p>Configurez les informations de la base de donnée pour commencer&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/puppetdb/conf.d/database.ini</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">[database]
# For the embedded DB: org.hsqldb.jdbcDriver
# For PostgreSQL: org.postgresql.Driver
# Defaults to embedded DB
<span class="xtra ln-xtra">classname = org.postgresql.Driver</span>&#160;
# For the embedded DB: hsqldb
# For PostgreSQL: postgresql
# Defaults to embedded DB
<span class="xtra ln-xtra">subprotocol = postgresql</span>&#160;
# For the embedded DB: file:/path/to/database;hsqldb.tx=mvcc;sql.syntax_pgs=true
# For PostgreSQL: //host:port/databaseName
# Defaults to embedded DB located in &lt;vardir&gt;/db
<span class="xtra ln-xtra">subname = //localhost:5432/puppetdb</span>&#160;
# Connect as a specific user
<span class="xtra ln-xtra">username = puppetdb</span>&#160;
# Use a specific password
<span class="xtra ln-xtra">password = puppetdb</span>&#160;
# How often (in minutes) to compact the database
# gc-interval = 60
&#160;
# Number of seconds before any SQL query is considered 'slow'; offending
# queries will not be interrupted, but will be logged at the WARN log level.
log-slow-statements = 10</pre></div></div>
</td></tr></table><br />
<p>Nous définissons donc ici, les propriétés de connexion à la base de donnée, ainsi que les identifiants que nous venons de créer juste avant.
</p><p>Nous allons maintenant configurer le nombre de thread&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/puppetdb/conf.d/config.ini</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># See README.md for more thorough explanations of each section and
# option.
&#160;
[global]
# Store mq/db data in a custom directory
vardir = /var/lib/puppetdb
# Use an external log4j config file
logging-config = /etc/puppetdb/conf.d/../log4j.properties
&#160;
# Maximum number of results that a resource query may return
resource-query-limit = 20000
&#160;
[command-processing]
# How many command-processing threads to use, defaults to (CPUs / 2)
<span class="xtra ln-xtra">threads = 4</span></pre></div></div>
</td></tr></table><br />
<p>Adaptez le nombre de thread à votre nombre de processeur divisé par 2.
</p><p>Puis, nous attaquons la configuration de Jetty&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/puppetdb/conf.d/jetty.ini</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">[jetty]
# Hostname to list for clear-text HTTP.  Default is localhost
<span class="xtra ln-xtra">host = 0.0.0.0</span># Port to listen on for clear-text HTTP.
port = 8080
&#160;
<span class="xtra ln-xtra">ssl-host = 0.0.0.0</span>ssl-port = 8081
keystore = /etc/puppetdb/ssl/keystore.jks
truststore = /etc/puppetdb/ssl/truststore.jks
&#160;
key-password = CoaRwY6IL8KQd8H6SfZ7O9hHC
trust-password = CoaRwY6IL8KQd8H6SfZ7O9hHC</pre></div></div>
</td></tr></table><br />
<p>Pour le host, ajoutez l'interface qui écoutera sur le port 8080 et 8081. Elle permet notamment de permettre au dashboard de se connecter dessus.
</p>
<table width="100%" class="warning_array">
<tr>
<td class="warning_subarray"> <font size="-1"><a href="./File:Warning_file.png.html" class="image" title="Warning"><img alt="Warning" src="images/0/09/Warning_file.png" width="39" height="32" /></a> <b>WARNING</b></font>
</td></tr>
<tr>
<td>Si vous en avez la possibilité et par mesure de sécurité, laissez tout sur localhost. Il est évident que Puppet Master doit se trouver sur cette même machine si host et host_ssl valent localhost
</td></tr></table><br />
<p>Redémarrez ensuite PuppetDB&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">/etc/init.d/puppetdb restart</pre></div></div>
</td></tr></table><br />
<p>Après quelques secondes/minutes, vous devriez pouvoir vous connecter sur le port 8081 (ssl) ou 8080 (non ssl) (http://&lt;hostname&gt;:8080|https://&lt;hostname&gt;:8081), vous aurez alors la possibilité de voir une belle interface&#160;:
</p><p><a href="./File:Puppetdb_dashboard.png.html" class="image"><img alt="Puppetdb dashboard.png" src="images/f/f4/Puppetdb_dashboard.png" width="568" height="690" /></a>
</p>
<h2><span class="mw-headline" id="Puppet_Master"><span class="mw-headline-number">3.3</span> Puppet Master</span></h2>
<p>Sur le master, vous devez toucher à sa configuration&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/puppet/puppet.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">[main]
logdir=/var/log/puppet
vardir=/var/lib/puppet
ssldir=/var/lib/puppet/ssl
rundir=/var/run/puppet
factpath=$vardir/lib/facter
templatedir=$confdir/templates
pluginsync = true
&#160;
[master]
# These are needed when the puppetmaster is run by passenger
# and can safely be removed if webrick is used.
ssl_client_header = SSL_CLIENT_S_DN
ssl_client_verify_header = SSL_CLIENT_VERIFY
<span class="xtra ln-xtra">storeconfigs = true</span><span class="xtra ln-xtra">storeconfigs_backend = puppetdb</span>report = true
&#160;
[agent]
<span class="xtra ln-xtra">server=puppet-prd.deimos.fr</span></pre></div></div>
</td></tr></table><br />
<table width="100%" class="warning_array">
<tr>
<td class="warning_subarray"> <font size="-1"><a href="./File:Warning_file.png.html" class="image" title="Warning"><img alt="Warning" src="images/0/09/Warning_file.png" width="39" height="32" /></a> <b>WARNING</b></font>
</td></tr>
<tr>
<td>Retirez les lignes thin_storeconfigs et async_storeconfigs si vous les utilisez, ou passez les à False
</td></tr></table><br />
<p>Puis nous allons mettre en place un fichier pour la configuration de Puppet, afin de lui indiquer comment se connecter au PuppetDB&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/puppet/puppetdb.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">[main]
<span class="xtra ln-xtra">server = puppet-prd.deimos.fr</span>port = 8081</pre></div></div>
</td></tr></table><br />
<p>Et pour finir, un fichier permettant de définir l'emplacement des facts&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/puppet/routes.yaml</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">---
master:
  facts:
<span class="xtra ln-xtra">    terminus: puppetdb</span>    cache: yaml</pre></div></div>
</td></tr></table><br />
<p>Et voilà, votre serveur Puppet a un backend PuppetDB qui est maintenant fonctionnel&#160;:-)
</p>
<h1><span class="mw-headline" id="FAQ"><span class="mw-headline-number">4</span> FAQ</span></h1>
<h2><span class="mw-headline" id="J.27ai_des_erreurs_OutOfMemoryError_dans_mes_logs_et_PuppetDB_r.C3.A9ponds_difficilement"><span class="mw-headline-number">4.1</span> J'ai des erreurs OutOfMemoryError dans mes logs et PuppetDB réponds difficilement</span></h2>
<p>Pour valider que le problème provient bien d'une insuffisance mémoire, vérifiez que ce fichier exite (/var/log/puppetdb/puppetdb-oom.hprof), et assurez vous que le contenu vous parle d'OOM.
</p><p>Il va falloir augmenter la Java Heap size (valeur du Xmx) de votre PuppetDB qui en fait requiert plus de RAM. Augmentez donc cette valeur&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/default/puppetdb</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">###########################################
# Init settings for puppetdb
###########################################
&#160;
# Location of your Java binary (version 6 or higher)
JAVA_BIN=&quot;/usr/bin/java&quot;
&#160;
# Modify this if you'd like to change the memory allocation, enable JMX, etc
<span class="xtra ln-xtra">JAVA_ARGS=&quot;-Xmx192m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/var/log/puppetdb/puppetdb-oom.hprof &quot;</span>&#160;
# These normally shouldn't need to be edited if using OS packages
USER=&quot;puppetdb&quot;
INSTALL_DIR=&quot;/usr/share/puppetdb&quot;
CONFIG=&quot;/etc/puppetdb/conf.d&quot;</pre></div></div>
</td></tr></table><br />
<p>Pour avoir une idée de la valeur à mettre (n représentant le nombre de nodes)&#160;:
</p>
<dl><dd>128M + (1M * n)</dd></dl>
<h1><span class="mw-headline" id="References"><span class="mw-headline-number">5</span> References</span></h1>
<ol class="references">
<li id="cite_note-1"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#cite_ref-1">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://docs.puppetlabs.com/puppetdb/1/index.html">http://docs.puppetlabs.com/puppetdb/1/index.html</a></span>
</li>
<li id="cite_note-2"><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#cite_ref-2">^</a> <span class="reference-text"><a rel="nofollow" class="external free" href="http://binbash.fr/2012/11/14/puppet-3-et-puppetdb/">http://binbash.fr/2012/11/14/puppet-3-et-puppetdb/</a></span>
</li>
</ol>

<!-- 
NewPP limit report
CPU time usage: 0.052 seconds
Real time usage: 0.054 seconds
Preprocessor visited node count: 378/1000000
Preprocessor generated node count: 1122/1000000
Post‐expand include size: 4945/2097152 bytes
Template argument size: 1385/2097152 bytes
Highest expansion depth: 4/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   17.571      1 - -total
 23.65%    4.156      7 - Template:Config
 19.89%    3.495      7 - Template:Command
 15.71%    2.761      1 - Template:Puppet_debian_repo
 12.34%    2.169      1 - Template:Infobox
  5.31%    0.934      3 - Template:Warning
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:3505-0!*!0!1!en!5!* and timestamp 20181111230707 and revision id 13008
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet&amp;oldid=13008">https://wiki.deimos.fr/index.php?title=PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet&amp;oldid=13008</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=PuppetDB+%3A+Augmentez+les+fonctionnalit%C3%A9s+de+votre+Puppet" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=PuppetDB_:_Augmentez_les_fonctionnalit%C3%A9s_de_votre_Puppet&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=PuppetDB_:_Augmentez_les_fonctionnalit%C3%A9s_de_votre_Puppet&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="./PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/PuppetDB_:_Augmentez_les_fonctionnalités_de_votre_Puppet.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/PuppetDB_:_Augmentez_les_fonctionnalit%C3%A9s_de_votre_Puppet" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=PuppetDB_:_Augmentez_les_fonctionnalit%C3%A9s_de_votre_Puppet&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=PuppetDB_:_Augmentez_les_fonctionnalit%C3%A9s_de_votre_Puppet&amp;oldid=13008" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=PuppetDB_:_Augmentez_les_fonctionnalit%C3%A9s_de_votre_Puppet&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 28 October 2013, at 10:57.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["ext.cite.a11y","mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":31});
}</script>
	</body>
</html>
	
<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>Mise en place d'une solution de Syncronisation entre ActiveDirectory et OpenLDAP - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP","wgTitle":"Mise en place d'une solution de Syncronisation entre ActiveDirectory et OpenLDAP","wgCurRevisionId":8897,"wgRevisionId":8897,"wgArticleId":2003,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP","wgRelevantArticleId":2003,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Mise_en_place_d_une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Mise en place d'une solution de Syncronisation entre ActiveDirectory et OpenLDAP</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#mw-navigation">navigation</a>, 					<a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Serveur"><span class="tocnumber">2.1</span> <span class="toctext">Serveur</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Windows"><span class="tocnumber">2.2</span> <span class="toctext">Windows</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Clients"><span class="tocnumber">2.3</span> <span class="toctext">Clients</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Configuration"><span class="tocnumber">3</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Serveur_2"><span class="tocnumber">3.1</span> <span class="toctext">Serveur</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#slapd.conf"><span class="tocnumber">3.1.1</span> <span class="toctext">slapd.conf</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#slapd.conf_proxy"><span class="tocnumber">3.1.2</span> <span class="toctext">slapd.conf proxy</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Schemas"><span class="tocnumber">3.1.3</span> <span class="toctext">Schemas</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#SSOD"><span class="tocnumber">3.1.4</span> <span class="toctext">SSOD</span></a>
<ul>
<li class="toclevel-4 tocsection-12"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Configuration_2"><span class="tocnumber">3.1.4.1</span> <span class="toctext">Configuration</span></a></li>
<li class="toclevel-4 tocsection-13"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Installation_2"><span class="tocnumber">3.1.4.2</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-4 tocsection-14"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Configuration_libpam-ldap_et_libnss-pam"><span class="tocnumber">3.1.4.3</span> <span class="toctext">Configuration libpam-ldap et libnss-pam</span></a></li>
<li class="toclevel-4 tocsection-15"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Configuration.2Futilisation_de_libpam-smbpass"><span class="tocnumber">3.1.4.4</span> <span class="toctext">Configuration/utilisation de libpam-smbpass</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-16"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Script_de_synchronisation"><span class="tocnumber">3.1.5</span> <span class="toctext">Script de synchronisation</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-17"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Clients_2"><span class="tocnumber">3.2</span> <span class="toctext">Clients</span></a>
<ul>
<li class="toclevel-3"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Debian"><span class="tocnumber">3.2.1</span> <span class="toctext">Debian</span></a>
<ul>
<li class="toclevel-4"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#libpam-ldapd"><span class="tocnumber">3.2.1.1</span> <span class="toctext">libpam-ldapd</span></a></li>
<li class="toclevel-4"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#libpam-ldap"><span class="tocnumber">3.2.1.2</span> <span class="toctext">libpam-ldap</span></a></li>
<li class="toclevel-4"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#libpam-ldapd_et_libpam-ldap"><span class="tocnumber">3.2.1.3</span> <span class="toctext">libpam-ldapd et libpam-ldap</span></a></li>
<li class="toclevel-4"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Autoriser_un_groupe_LDAP_en_particulier"><span class="tocnumber">3.2.1.4</span> <span class="toctext">Autoriser un groupe LDAP en particulier</span></a>
<ul>
<li class="toclevel-5"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Debian_2"><span class="tocnumber">3.2.1.4.1</span> <span class="toctext">Debian</span></a></li>
<li class="toclevel-5"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Red_Hat"><span class="tocnumber">3.2.1.4.2</span> <span class="toctext">Red Hat</span></a></li>
<li class="toclevel-5"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Configuration_3"><span class="tocnumber">3.2.1.4.3</span> <span class="toctext">Configuration</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-3"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Red_Hat_2"><span class="tocnumber">3.2.2</span> <span class="toctext">Red Hat</span></a>
<ul>
<li class="toclevel-4"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#M.C3.A9thode_1"><span class="tocnumber">3.2.2.1</span> <span class="toctext">Méthode 1</span></a></li>
<li class="toclevel-4"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#M.C3.A9thode_2"><span class="tocnumber">3.2.2.2</span> <span class="toctext">Méthode 2</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Forcer_un_shell_au_login"><span class="tocnumber">3.2.3</span> <span class="toctext">Forcer un shell au login</span></a></li>
<li class="toclevel-3"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Solaris"><span class="tocnumber">3.2.4</span> <span class="toctext">Solaris</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-18"><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#Ressources"><span class="tocnumber">4</span> <span class="toctext">Ressources</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p>Cette documentation est assez pousée techniquement, c'est pourquoi <b>il faut un minimum de conaissances</b> avant de l'attaquer. Je vous conseil de lire cette <a href="./LDAP_:_Installation_et_configuration_d'un_Annuaire_LDAP.html" title="LDAP : Installation et configuration d'un Annuaire LDAP">documentation</a> d'abord.
</p><p>En ce qui concerne l'authentification, on veut utiliser un annuaire OpenLDAP comme <b>cache/backup d'un serveur Active Directory (AD)</b>. L'authentification s'effectuera à partir de différentes applications et machines de type Unix. Le but est également en cas de crash de l'AD de pouvoir continuer à s'authentifier. 
</p><p>Note&#160;: Parceque objectivement, en cas de crash voici à peu prêts les temps de réinstallation et restauration&#160;:
</p>
<ul><li> Linux&#160;: ~30 min</li>
<li> Windows&#160;: ~ 4 h</li></ul>
<p>Le choix est donc vite fait, et cette solution tiens réellement la route. (Les pures Windoziens qui disent qu'un Windows crash jamais sortent&#160;!)
</p><p>Certaines autres informations pourront être stockées localement dans OpenLDAP.
</p><p>Afin de simplifier l'installation côté unix (linux ou solaris), Microsoft SFU est installé sur AD, ce qui permet de maintenir sur ce dernier les informations des comptes unix telles que les gig/uid/homedirectory,shell... (ceci va modifier le shéma de l'AD).
</p><p>Pour d'accéder aux mots de passe utilisateurs contenu dans AD (unicodePwd) <b>la connexion entre le serveur OpenLDAP et AD sera cryptée via SSL</b>. C'est <b>le seul moyen de pouvoir envoyer des requêtes sur AD qui touche à cet attribut</b>. PS: Cela ne permet pas de le lire mais uniquement de le modifier.
</p><p>Cette doc présentera l'installation pour la configuration la plus évolué. Celle-ci permet d'avoir un serveur openldap indépendant avec un contenu synchronisé de différentes manières&#160;: par un script en python pour tous les attributs de toutes les entrées, par ssod pour les mots de passe unix et samba, par pam pour les mots de passe unix et samba.
</p>
<h1><span class="mw-headline" id="Installation"><span class="mw-headline-number">2</span> Installation</span></h1>
<h2><span class="mw-headline" id="Serveur"><span class="mw-headline-number">2.1</span> Serveur</span></h2>
<p>Pour l'installation, nous allons le faire sur une Debian&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> apt-get</font>
</td></tr>
<tr>
<td>
<pre>apt-get install ldap-server ldap-client python-ldap
</pre>
</td></tr></table><br />
<p>Pour SSOD&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> apt-get</font>
</td></tr>
<tr>
<td>
<pre>apt-get install libpam-ldap
</pre>
</td></tr></table><br />
<p>Pour Samba&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> apt-get</font>
</td></tr>
<tr>
<td>
<pre>apt-get install libpam-smbpass libnss-ldap
</pre>
</td></tr></table><br />
<p>Lors de l'installation, il vous demandera quel mot de passe root vous souhaitez pour l'OpenLDAP.
</p><p>ssod est un utilitaire écrit par microsoft et dont le code source est téléchargeable sur ces pages&#160;:
</p>
<ul><li> <a rel="nofollow" class="external free" href="http://www.google.fr/search?q=+ssod.tar.gz">http://www.google.fr/search?q=+ssod.tar.gz</a></li>
<li> <a rel="nofollow" class="external free" href="http://www.microsoft.com/windowsserver2003/R2/unixcomponents/idmu.mspx">http://www.microsoft.com/windowsserver2003/R2/unixcomponents/idmu.mspx</a></li></ul>
<p>Néanmoins, le code fourni dans ce fichier n'est pas portable et ne fonctionne pas sous un système en 64bits... J'ai été obligé de modifier ces sources pour le rendre portable.
</p>
<h2><span class="mw-headline" id="Windows"><span class="mw-headline-number">2.2</span> Windows</span></h2>
<p>Pour windows, il faut donc un serveur DNS, un AD de configuré, et le petit <a rel="nofollow" class="external text" href="http://www.google.fr/search?q=microsoft+SFU">SFU</a> qu'il vous faudra télécharger et installer.
</p><p>Lors de l'installation, vous pouvez effectuer une installe personnalisée et cochez que&#160;:
</p>
<ul><li> Password synchronisation</li>
<li> NIS server</li></ul>
<p>Puis lancez l'installation.
</p>
<ul><li> Lancer ensuite l'utilitaire de configuration des services UNIX et configurez comme ceci&#160;:<br /></li></ul>
<p><a href="./File:Sfu_1.png.html" class="image"><img alt="Sfu 1.png" src="images/1/10/Sfu_1.png" width="946" height="603" /></a>
Cliquez ensuite apply.
</p>
<ul><li> Ajoutez ici votre serveur OpenLDAP&#160;:<br /></li></ul>
<p><a href="./File:Sfu_2.png.html" class="image"><img alt="Sfu 2.png" src="images/5/50/Sfu_2.png" width="945" height="412" /></a>
Cliquez ensuite apply.
</p>
<ul><li> Ensuite, si vous avez déjà un MASTER (comme le DELL1800 ici), connectez à l'utilitaire sur le master et ajoutez le. Sinon, si c'est ce serveur qui doit servir de master, ajoutez le dans cette MMC&#160;:<br /></li></ul>
<p><a href="./File:Sfu_3.png.html" class="image"><img alt="Sfu 3.png" src="images/7/7c/Sfu_3.png" width="737" height="391" /></a>
Cliquez ensuite apply.
</p><p>Ensuite il vous faudra rebooter et ce sera bon.
</p>
<h2><span class="mw-headline" id="Clients"><span class="mw-headline-number">2.3</span> Clients</span></h2>
<ol><li>REDIRECTION <a href="https://wiki.deimos.fr/index.php?title=Mod%C3%A8le:LDAP_Clients_installation_Debian&amp;action=edit&amp;redlink=1" class="new" title="Modèle:LDAP Clients installation Debian (page does not exist)">Modèle:LDAP Clients installation Debian</a></li></ol>
<h1><span class="mw-headline" id="Configuration"><span class="mw-headline-number">3</span> Configuration</span></h1>
<h2><span class="mw-headline" id="Serveur_2"><span class="mw-headline-number">3.1</span> Serveur</span></h2>
<h3><span class="mw-headline" id="slapd.conf"><span class="mw-headline-number">3.1.1</span> slapd.conf</span></h3>
<p>Pour les informations suivantes
</p><p>Editez le fichier de configuration /etc/ldap/slapd.conf et ajoutez ces lignes&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/ldap/slapd.conf</font>
</td></tr>
<tr>
<td>
<pre># Schema and objectClass definitions
include         /etc/ldap/schema/core.schema
include         /etc/ldap/schema/cosine.schema
include         /etc/ldap/schema/nis.schema
include         /etc/ldap/schema/inetorgperson.schema
<b>include         /etc/ldap/schema/microsoft.schema</b>
<b>include         /etc/ldap/schema/microsoft.sfu.schema</b>
<b>include         /etc/ldap/schema/microsoft.exchange.schema</b>
# Pour samba
<b>include         /etc/ldap/schema/samba.schema</b>
</pre>
</td></tr></table><br />
<p>Nous avons donc ici les schemas pour qu'OpenLDAP puisse reconnaitre les différents attributs Microsoft. On y met également Samba (car nous voulons également intégrer samba à OpenLDAP.
</p><p>Le shéma Samba se trouve dans /usr/share/doc/samba-doc/examples/LDAP et est à copier dans /etc/ldap/schema, mais il faut auparavant installer un package pour Samba&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>apt-get install samba-doc
cp /usr/share/doc/samba-doc/examples/LDAP/samba.schema /etc/ldap/schema/samba.schema
</pre>
</td></tr></table><br />
<p>On localise où sera stockée la syncro de la base AD&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/ldap/slapd.conf</font>
</td></tr>
<tr>
<td>
<pre># Where the database file are physically stored for database #1
<b>directory       "/var/lib/ldap/copy-ad"</b>
</pre>
</td></tr></table><br />
<p>On ajoute des index sur les champs uid,sn,cn,gid... pour accélérer les recherches par rapport à ces champs&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/ldap/slapd.conf</font>
</td></tr>
<tr>
<td>
<pre># Indexing options for database #1
index           objectClass eq
<b>index           cn,sn,uid,mail  pres,eq,sub</b>
<b>index           mailnickname,userprincipalname,proxyaddresses  pres,eq,sub</b>
</pre>
</td></tr></table><br />
<p>Maintenant configurez votre domaine AD ainsi que le mot de passe crypté (voir <a href="./LDAP_:_Installation_et_configuration_d'un_Annuaire_LDAP.html" title="LDAP : Installation et configuration d'un Annuaire LDAP">documentation ldap basique</a>)&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/ldap/slapd.conf</font>
</td></tr>
<tr>
<td>
<pre># The base of your directory in database #1
suffix          "<b>dc=openldap,dc=mydomain,dc=local</b>"

# rootdn directive for specifying a superuser on the database. This is needed
# for syncrepl.
rootdn          "<b>cn=admin,dc=openldap,dc=mydomain,dc=local</b>"
rootpw          <b>{SSHA}V2c83+XHO/DNrUjeNjyTwAA9W+yKm/4h</b>

access to attrs=userPassword,shadowLastChange
        by <b>dn="cn=admin,dc=mydomain,dc=local" write</b>
        by anonymous auth
        by self write
        by * none

access to *
        by dn="<b>cn=admin,dc=openldap,dc=mydomain,dc=local</b>" write
        by * read
</pre>
</td></tr></table><br />
<p>Ce qui donne quelquechose comme ceci&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/ldap/slapd.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">include         /etc/ldap/schema/core.schema
include         /etc/ldap/schema/cosine.schema
include         /etc/ldap/schema/nis.schema
include         /etc/ldap/schema/inetorgperson.schema
include         /etc/ldap/schema/microsoft.schema
include         /etc/ldap/schema/microsoft.sfu.schema
include         /etc/ldap/schema/microsoft.exchange.schema
include         /etc/ldap/schema/samba.schema
&#160;
pidfile         /var/run/slapd/slapd.pid
&#160;
argsfile        /var/run/slapd/slapd.args
&#160;
loglevel        0
&#160;
modulepath      /usr/lib/ldap
moduleload      back_bdb
&#160;
sizelimit 500
&#160;
tool-threads 1
&#160;
backend         bdb
checkpoint 512 30
&#160;
database        bdb
&#160;
suffix          &quot;dc=openldap,dc=mydomain,dc=local&quot;
rootdn          rootdn &quot;cn=admin,dc=openldap,dc=mydomain,dc=local&quot;
rootpw          {SSHA}V2c83+XHO/DNrUjeNjyTwAA9W+yKm/4h
&#160;
directory       &quot;/var/lib/ldap/copy-ad&quot;
&#160;
dbconfig set_cachesize 0 2097152 0
dbconfig set_lk_max_objects 1500
dbconfig set_lk_max_locks 1500
dbconfig set_lk_max_lockers 1500
&#160;
index       objectClass eq
index       cn,sn,uid,mail  pres,eq,sub
index       mailnickname,userprincipalname,proxyaddresses  pres,eq,sub
&#160;
lastmod         on
&#160;
access to attrs=userPassword,shadowLastChange
        by '''dn=&quot;cn=admin,dc=openldap,dc=mydomain,dc=local&quot; write
        by anonymous auth
        by self write
        by * none
&#160;
access to dn.base=&quot;&quot; by * read
&#160;
access to *
        by dn=&quot;cn=admin,dc=openldap,dc=mydomain,dc=local&quot; write
        by * read</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="slapd.conf_proxy"><span class="mw-headline-number">3.1.2</span> slapd.conf proxy</span></h3>
<p>Dans le cas où nous voulons que notre serveur LDAP serve de proxy, il faut loader le module back_meta&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/ldap/slapd.conf</font>
</td></tr>
<tr>
<td>
<pre># Where the dynamically loaded modules are stored
modulepath      /usr/lib/ldap
moduleload      back_bdb
<b>moduleload      back_meta</b>
</pre>
</td></tr></table><br />
<p>Et configurer comme il faut pour contenir les informations du serveur Active Directory&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/ldap/slapd.conf</font>
</td></tr>
<tr>
<td>
<pre>#######################################################################
database        meta
suffix          "<b>dc=ad,dc=mydomain,dc=local</b>"
uri             "<b>ldap://192.168.0.30/dc=ad,dc=mydomain,dc=local</b>"
suffixmassage   "<b>dc=ad,dc=mydomain,dc=local" "dc=mydomain,dc=local</b>"
rootdn          "<b>cn=admin,dc=ad,DC=mydomain,DC=local</b>" # compte admin locale
rootpw          <b>{SSHA}V2c83+XHO/DNrUjeNjyTwAA9W+yKm/4h # mot de passe local</b>
#acl-authcDN    "CN=Administrateur,CN=Users,DC=mydomain,DC=local"
#acl-passwd     {SSHA}V2c83+XHO/DNrUjeNjyTwAA9W+yKm/4h

access to attrs=userPassword,shadowLastChange
        by dn="<b>CN=Administrateur,CN=Users,DC=ad,DC=mydomain,DC=local</b>" write
        by anonymous auth
        by self write
        by * none

access to dn.base="" by * read

# The admin dn has full write access, everyone else
# can read everything.
access to *
        by dn="<b>CN=Administrateur,CN=Users,DC=ad,DC=mydomain,DC=local</b>" write
        by * read

# Save the time that the entry gets modified, for database #1
lastmod         on
cachesize 20
directory /var/lib/ldap/real-ad
<b>index       objectClass eq</b>
<b>index       cn,sn,uid,mail  pres,eq,sub</b>
</pre>
</td></tr></table><br />
<h3><span class="mw-headline" id="Schemas"><span class="mw-headline-number">3.1.3</span> Schemas</span></h3>
<p>Nous allons copier les schemas au bon endroit. Téléchargez l'archive&#160;:<br />
<a href="./File:Microsoft_shema.tgz.html" title="File:Microsoft shema.tgz">Schemas Microsoft</a>
</p><p>Maintenant on décompresse&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>mv Microsoft_shema.tgz /etc/ldap/schema
cd /etc/ldap/schema
tar -xzvf Microsoft_shema.tgz
rm Microsoft_shema.tgz
</pre>
</td></tr></table><br />
<p>On va créer les dossiers assosiés à l'endroit où va être stocker la base AD&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>mkdir -p /var/lib/ldap/copy-ad
chown -Rf openldap. /var/lib/ldap/copy-ad
</pre>
</td></tr></table><br />
<p>Et maintenant on peut redémarrer le serveur ldap&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>/etc/init.d/slapd restart
</pre>
</td></tr></table><br />
<h3><span class="mw-headline" id="SSOD"><span class="mw-headline-number">3.1.4</span> SSOD</span></h3>
<p>L'intérêt de ssod réside dans le fait que la synchronisation des mots de passe est effectuée en temps réel.<br />
Cette synchronisation peut s'effectuer via pam, ce qui permet de mettre à jour n'importe quel backend ou type de mot de passe (ldap, shadow, samba, kerberos, ...)
</p><p>Ce dernier point est très intéressant pour la synchronisation des mots de passe pour les serveurs samba qui utilisent leurs propres attributs LDAP pour stocker les mots de passe.<br />
On peut en effet utiliser conjointement pam_smbpass et ssod pour remplir les attributs sambaNTPassword, sambaLMPassword et autres attributs associés lorsqu'un mot de passe est modifié sur le serveur AD.
</p><p>Compilation de ssod
L'utilitaire ssod fournit par microsoft ne fonctionne pas en 64 bits. J'ai donc du modifier le code source et c'est cette version modifiée qu'il faut utiliser.
</p>
<h4><span class="mw-headline" id="Configuration_2"><span class="mw-headline-number">3.1.4.1</span> Configuration</span></h4>
<p>Pour compiler ssod, les packages g++ et libpam0g-dev doivent être installés&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> apt-get</font>
</td></tr>
<tr>
<td>
<pre>apt-get install g++ libpam0g-dev
</pre>
</td></tr></table><br />
<p>Récupérer ces sources <a href="images/7/7a/Ssod-src.zip" class="internal" title="Ssod-src.zip">disponibles ici</a>&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">unzip ssod-src.zip
cd sfu/tripldes
make -f make3des.debian clean
make -f make3des.debian 
cd ../ssod
make -f makessod.debian clean
make -f makessod.debian</pre></div></div>
</td></tr></table><br />
<p>On obtient un binaire dans bin/ssod.l52.
</p>
<h4><span class="mw-headline" id="Installation_2"><span class="mw-headline-number">3.1.4.2</span> Installation</span></h4>
<p>Copier le binaire obtenu après la compilation vers /usr/bin/ssod sur le serveur où est installé openldap.<br />
Télécharger le fichier <a href="images/7/77/Ssod-conf.tgz" class="internal" title="Ssod-conf.tgz">ssod-conf.tgz</a> dans /tmp et le décompresser en étant dans le répertoire racine:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>cd /
tar zxvf /tmp/ssod-conf.tgz
</pre>
</td></tr></table><br />
<p>Ceci installera le fichier de de démarrage et d'arrêt dans /etc/init.d, les liens correspondants aux différents runlevel dans /etc/rc?.d et finalement le fichier de configuration du daemon dans /etc/sso.conf.<br />
Les différentes options possibles sont disponible sur cette page&#160;:<br />
<a rel="nofollow" class="external free" href="http://technet2.microsoft.com/windowsserver/en/library/3f2ac52d-e9b3-4c8a-bc1d-a4e3adde91191033.mspx?mfr=true">http://technet2.microsoft.com/windowsserver/en/library/3f2ac52d-e9b3-4c8a-bc1d-a4e3adde91191033.mspx?mfr=true</a>
</p><p>Par défaut, la configuration est la suivante:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">SYNC_HOSTS=(192.168.0.30)
FILE_PATH=/etc
ENCRYPT_KEY=ABCDZ#efgh$12345
CASE_IGNORE_NAME=0
USE_NIS=0
USE_SHADOW=0
TEMP_FILE_PATH=/tmp
SYNC_USERS=ALL
SYNC_RETRIES=5
SYNC_DELAY=0
PORT_NUMBER=6677
NIS_UPDATE_PATH=bidon</pre></div></div>
<ul><li> SYNC_HOSTS doit contenir le nom ou l'adresse IP du serveur AD avec lequel on veut se synchroniser.</li>
<li> ENCRYPT_KEY doit être identique à ce qui est indiquer dans la configuration de SFU sur le serveur AD.</li>
<li> PORT_NUMBER doit contenir le n° de port utilisé par SFU sur le serveur AD.</li></ul>
<p>Avec ce fichier de configuration, ssod est configuré pour mettre à jour les mots de passe en utilisant PAM. Il faut donc créer un fichier correspondant au service ssod dans le répertoire de configuration de pam (/etc/pam.d). A priori, ce fichier est une copie de /etc/pam.d/passwd. Donc&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>cp /etc/pam.d/passwd /etc/pam.d/ssod
</pre>
</td></tr></table><br />
<p>/etc/pam.d/ssod contient normalement une directive d'include du fichier /etc/pam.d/common-password-ldap. Le contenu de ce dernier varie selon les fonctionalité voulues. À Priori il doit faire référence aux modules pam-ldap et éventuellement pam-smbpass.
</p><p>Une fois l'installation de ssod et des différents modules pam nécessaires à votre configuration, vous pouvez vérifier le bon fonctionnement du daemon ssod en modifiant un mot de passe sous AD et en regarant le fichier /var/log/auth.log sur le serveur où tourne ssod. Vous devez voir apparaître une ligne du type&#160;:
</p>
<pre>Successfully updated password via PAM User:  dummyuser
</pre>
<p>pour chaque mot de passe modifié.
</p>
<h4><span class="mw-headline" id="Configuration_libpam-ldap_et_libnss-pam"><span class="mw-headline-number">3.1.4.3</span> Configuration libpam-ldap et libnss-pam</span></h4>
<p>Se reporter au chapitre du même nom dans la partie configuration client en ce qui concerne les fichiers /etc/nsswitch.conf, /etc/libnss-ldap.* et /etc/pam_ldap.conf
</p>
<h4><span class="mw-headline" id="Configuration.2Futilisation_de_libpam-smbpass"><span class="mw-headline-number">3.1.4.4</span> Configuration/utilisation de libpam-smbpass</span></h4>
<p>Pour que ce module fonctionne, il faut obligatoirement configurer libnss-pam, sinon l'exécution de pam-smbpass.so se finira par un core dump&#160;:-( . Il faut en effet que ce module retrouve les informations des utilisateurs et/ou des groupes qui se trouvent dans l'annuaire ldap.
</p><p>Le fichier /etc/samba/smb.conf doit être configuré pour utiliser le backend ldap. Voir le chapitre se rapportant à la configuration de samba.
</p><p>Libpam-smbpass permet de s'authentifier en utilisant les attributs sambaNTPassword et/ou sambaLMPassword. Il permet aussi de mettre à jour ces attributs lorsque le mot de passe est changé ou lorsqu'un utilisateur se loggue après avoir été authentifié par un module tierce (pam_ldap par exemple). Ce sont ces deux dernières fonctionalités qui nous intéressent particulièrement. En effet, pour pouvoir s'authentifier auprès de serveurs samba, ces attributs doivent être remplis et c'est à priori les seules manières de les remplir.
</p><p>Pour synchroniser les mots de passe samba à partir de ceux contenu dans l'annuaire LDAP lorsqu'un utilisateur s'authentifie, il faut modifier le fichier /etc/pam.d/common-auth-ldap. Celui ci doit contenir&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pam.d/common-auth-ldap</font>
</td></tr>
<tr>
<td>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">auth    required        pam_nologin.so
auth    sufficient      pam_unix.so nullok_secure
auth    optional        pam_smbpass.so migrate use_first_pass
auth    sufficient      pam_ldap.so use_first_pass
auth    required        pam_deny.so</pre></div></div>
</td></tr></table><br />
<p>Pour modifier les mots de passe samba lorsqu'un utilisateur modifie son mot de passe sur AD ou sur  une machine unix, il faut modifier le fichier /etc/pam.d/common-password-ldap. Celui-ci doit contenir&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pam.d/common-password-ldap</font>
</td></tr>
<tr>
<td>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">password   required   pam_smbpass.so migrate
password   sufficient pam_ldap.so try_first_pass
password   sufficient pam_unix.so try_first_pass nullok obscure min=4 max=8 md5
password   required   pam_deny.so</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="Script_de_synchronisation"><span class="mw-headline-number">3.1.5</span> Script de synchronisation</span></h3>
<p>Maintenant au niveau de la crontab, on va rajouter un petit script qui va nous permettre de faire la synchro. Editez le script et modifiez le selon vos besoins&#160;:<br />
<a href="./File:Ad_import.tgz.html" title="File:Ad import.tgz">Script d'import AD</a>
</p><p>Mettez l'archive du script dans un endroit et décompressez le&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>mv Ad_import.tgz /etc/scripts/
cd /etc/scripts/
tar -xzvf Ad_import.tgz
chmod 755 ad_import.py
rm Ad_import.tgz
</pre>
</td></tr></table><br />
<p>Vous pouvez éditer le script et modifier les variables suivantes&#160;:
</p>
<ul><li> LOGLEVEL&#160;: contient un entier. Plus l'entier est grand, plus le script est verbeux</li>
<li> GENLDIF&#160;: 0 ou 1. Si c'est 1, le script génère un fichier LDIF contenant les entrées LDAP modifiées et destinée au serveur OpenLDAP</li>
<li> SYNCHRONIZE&#160;: 0 ou 1. Si c'est 1, le script modifie directement les entrées sur le serveur OpenLDAP</li>
<li> LOGSTDOUT&#160;: 0 ou 1. Si c'est 1, le script affiche ses messages sur la sortie standard.</li>
<li> FULLSYNC: 0 ou 1. Si c'est 1, le script récupère toutes les entrées contenues dans AD, sinon il récupère uniquement celles qui ont été modifiées depuis la dernière synchronisation (incrémentiel). Si vous changez de serveur AD source (ou faire une syncro complète), vous devez soit mettre cette variable à 1, soit mettre à 0 l'attribut uSNChanged du DN de base dans votre annuaire OpenLDAP.</li>
<li> src*&#160;: les différents paramètres pour se connecter au serveur source.</li>
<li> srcuri&#160;: URI du serveur source</li>
<li> srcadmin: DN de l'utilisateur servant à la réplication</li>
<li> srcpassword: son mot de passe</li>
<li> srcbasedn: la base de la hiérarchie à synchroniser.</li>
<li> dst*: idem ci-dessus mais pour le serveur cible</li>
<li> dstsamba: où stocker les infos concernant le domaine samba.</li></ul>
<p>Ensuite on le rajoute dans la crontab et on le lance toutes les 10 min&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> crontab</font>
</td></tr>
<tr>
<td>
<pre>*/10 * * * * python /etc/scripts/ad_import.py
</pre>
</td></tr></table><br />
<h2><span class="mw-headline" id="Clients_2"><span class="mw-headline-number">3.2</span> Clients</span></h2>
<p>D'une manière générale, les clients unix peuvent s'authentifier en utilisant les informations contenues dans l'annuaire LDAP via PAM et NSS. Il sufft donc d'installer et de configurer ces composants sur les différents systèmes.
</p>
<h3><span class="mw-headline" id="Debian"><span class="mw-headline-number">3.2.1</span> Debian</span></h3>
<p>Vous avez le choix d'installer libpam-ldapd ou libpam-ldap. libpam-ldapd est plus récent et évite quelques bugs vu sur libpam-ldap. A vous de voir ce que vous voulez&#160;:-)
</p>
<h4><span class="mw-headline" id="libpam-ldapd"><span class="mw-headline-number">3.2.1.1</span> libpam-ldapd</span></h4>
<p>Si vous optez pour libnss-ldapd, alors vous n'avez simplement qu'a installer ceci et répondre aux questions.
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td>
<pre>aptitude install libnss-ldapd
</pre>
</td></tr></table><br />
<h4><span class="mw-headline" id="libpam-ldap"><span class="mw-headline-number">3.2.1.2</span> libpam-ldap</span></h4>
<p>Si vous avez choisi d'installer libpam-ldap à la place de libpam-ldapd, vous allez devoir faire ceci à la main.
</p><p>Par défaut, debian créé deux fichiers de configuration différents pour libpam-ldap et libnss-ldap. Ceci est inutile vu que ces deux fichiers vont contenir la même chose. Il faut supprimer les fichiers de configuration libpam-ldap et créer des liens depuis ceux de libnss-ldap ver ceux de libpam-ldap:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>rm /etc/pam_ldap.*
ln -s /etc/libnss-ldap.conf /etc/pam_ldap.conf
ln -s /etc/libnss-ldap.secret /etc/pam_ldap.secret
</pre>
</td></tr></table><br />
<p>Editer /etc/libnss-ldap.conf et y mettre (il ne doit contenir que ces lignes)&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/libnss-ldap.conf</font>
</td></tr>
<tr>
<td>
<pre>uri <b>ldap://ldap.mydomain.local/</b>
base <b>dc=openldap,dc=mydomain,dc=local</b>
ldap_version 3
rootbinddn <b>cn=admin,dc=openldap,dc=mydomain,dc=local</b>
scope sub
nss_paged_results yes
pagesize 1000
nss_base_passwd <b>dc=openldap,dc=mydomain,dc=local</b>?sub?&amp;(&amp;(objectClass=posixAccount)(!(objectClass=computer)))
nss_base_shadow <b>dc=openldap,dc=mydomain,dc=local</b>?sub
</pre>
</td></tr></table><br />
<p>Dans /etc/libnss-ldap.secret, indiquer le mot de passe de l'utilisateur indiquer sur la ligne rootdn du fichier /etc/libnss-ldap.conf.
</p><p>Vous devez ensuite modifier le fichier /etc/nsswitch.conf afin d'y indiquer que la recherche se fera entre autre dans l'annuaire ldap pour les différents services. Cela donne par exemple&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/nsswitch.conf</font>
</td></tr>
<tr>
<td>
<pre>passwd:         <b>files ldap</b>
group:          <b>files ldap</b>
shadow:         <b>files ldap</b>

hosts:          <b>files dns</b>
networks:       files

protocols:      db files
services:       db files
ethers:         db files
rpc:            db files

netgroup:       nis
</pre>
</td></tr></table><br />
<h4><span class="mw-headline" id="libpam-ldapd_et_libpam-ldap"><span class="mw-headline-number">3.2.1.3</span> libpam-ldapd et libpam-ldap</span></h4>
<p>Enfin, il faut modifier les chaines pam pour que celles-ci permettent l'authentification via l'annuaire ldap. Ceci se fait en copiant les différents fichier /etc/pam.d/common-* vers /etc/pam.d/common-*-ldap&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>cd /etc/pam.d
cp common-account{,-ldap}        
cp common-auth{,-ldap}
cp common-pammount{,-ldap}
cp common-password{,-ldap}
cp common-session{,-ldap}
</pre>
</td></tr></table><br />
<p>Editer les différents fichiers /etc/pam.d/common-*-ldap pour avoir&#160;:
</p>
<ul><li> /etc/pam.d/common-account-ldap&#160;:</li></ul>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pam.d/common-account-ldap</font>
</td></tr>
<tr>
<td>
<pre>account sufficient      pam_ldap.so
account sufficient      pam_unix.so use_first_pass
account required        pam_deny.so
</pre>
</td></tr></table><br />
<ul><li> /etc/pam.d/common-auth-ldap</li></ul>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pam.d/common-auth-ldap</font>
</td></tr>
<tr>
<td>
<pre>auth    required        pam_nologin.so
auth    sufficient      pam_unix.so nullok_secure
auth    optional        pam_mount.so debug use_first_pass
auth    optional        pam_smbpass.so migrate use_first_pass
auth    sufficient      pam_ldap.so use_first_pass
auth    required        pam_deny.so
</pre>
</td></tr></table><br />
<ul><li> /etc/pam.d/common-password-ldap</li></ul>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pam.d/common-password-ldap</font>
</td></tr>
<tr>
<td>
<pre>password   required   pam_smbpass.so migrate
password   sufficient pam_ldap.so try_first_pass
password   sufficient pam_unix.so try_first_pass nullok obscure min=4 max=8 md5
password   required   pam_deny.so
</pre>
</td></tr></table><br />
<ul><li> /etc/pam.d/common-session-ldap</li></ul>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pam.d/common-session-ldap</font>
</td></tr>
<tr>
<td>
<pre>session required        pam_unix.so
session required        pam_ldap.so
session required        pam_mkhomedir.so skel=/etc/skel/ umask=0022
session optional        pam_mount.so
</pre>
</td></tr></table><br />
<ul><li> /etc/pam.d/common-session</li></ul>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pam.d/common-session</font>
</td></tr>
<tr>
<td>
<pre>session required        pam_mkhomedir.so skel=/etc/skel/ umask=0022
session sufficient      pam_ldap.so
session required        pam_unix.so
</pre>
</td></tr></table><br />
<p>Une fois ces fichiers common-*-ldap créés, on peut éditer les fichiers des différents services pour lesquels on veut autoriser l'authentification par ldap... Si par exemple on veut permettre aux utilisateurs contenus dans l'annuaire LDAP de se connecter en ssh sur la machine, on edite le fichier /etc/pam.d/ssh et on remplace les common-qqc en common-qqc-ldap.
</p><p>Pour l'automount des partitions en fonction de l'utilisateur, éditez le fichier /etc/security/pam_mount.conf&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/security/pam_mount.conf</font>
</td></tr>
<tr>
<td>
<pre>volume * cifs 192.168.0.30 &amp;$ /media/windows/&amp; sfu - -
</pre>
</td></tr></table><br />
<p>Si vous ne pouvez toujours pas vous connecter, redémarrer le service nscd&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>/etc/init.d/nscd restart
</pre>
</td></tr></table><br />
<p>La commande suivante doit fonctionner correctement&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> getent</font>
</td></tr>
<tr>
<td>
<pre>getent passwd <b>mon_user</b>
</pre>
</td></tr></table><br />
<h4><span class="mw-headline" id="Autoriser_un_groupe_LDAP_en_particulier"><span class="mw-headline-number">3.2.1.4</span> Autoriser un groupe LDAP en particulier</span></h4>
<p>Une des méthodes courantes est de n'autoriser qu'un ou certains groupes du LDAP à accéder à une machine. Pour celà, il faudra que les groupes aient comme attribut <b>posixGroup</b> nommé <b>login</b>. 
</p>
<h5><span class="mw-headline" id="Debian_2"><span class="mw-headline-number">3.2.1.4.1</span> Debian</span></h5>
<p>Installez libpam-modules si ce n'est pas déjà fait&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> aptitude</font>
</td></tr>
<tr>
<td>
<pre>aptitude install libpam-modules
</pre>
</td></tr></table><br />
<p>Ensuite ajoutez cette ligne dans le fichier /etc/pam.d/common-auth&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pam.d/common-auth</font>
</td></tr>
<tr>
<td>
<pre>...
auth required    pam_access.so
</pre>
</td></tr></table><br />
<h5><span class="mw-headline" id="Red_Hat"><span class="mw-headline-number">3.2.1.4.2</span> Red Hat</span></h5>
<p>Installez ce package&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> yum</font>
</td></tr>
<tr>
<td>
<pre>yum install pam-devel
</pre>
</td></tr></table><br />
<p>Et ajoutez cette ligne sur le service que vous souhaitez (sshd par exemple), la restriction&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pam.d/sshd</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">auth       include      password-auth
<span class="xtra ln-xtra">account    required     pam_access.so</span>account    required     pam_nologin.so</pre></div></div>
</td></tr></table><br />
<h5><span class="mw-headline" id="Configuration_3"><span class="mw-headline-number">3.2.1.4.3</span> Configuration</span></h5>
<p>Celà va nous permettre d'utiliser le fichier /etc/security/access.conf. Et voici le genre de ligne qu'il faut rajouter&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/security/access.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">...
# disallow all except people in the login group and root
-:ALL EXCEPT root (sysadmin):ALL EXCEPT LOCAL</pre></div></div>
</td></tr></table><br />
<p>Ceci permet de désactiver tous les comptes sauf&#160;:
</p>
<ul><li> root</li>
<li> Le groupe sysadmin (pas l'utilisateur grâce aux parenthèses)</li>
<li> LOCAL&#160;: les utilisateurs locaux</li></ul>
<h3><span class="mw-headline" id="Red_Hat_2"><span class="mw-headline-number">3.2.2</span> Red Hat</span></h3>
<p>Il existe 2 méthodes. La première passe par un script Red Hat qui va nous faire tout pour nous, tandis que la deuxième est la solution manuelle.
</p>
<h4><span class="mw-headline" id="M.C3.A9thode_1"><span class="mw-headline-number">3.2.2.1</span> Méthode 1</span></h4>
<p>Pour configurer PAM avec LDAP, utilisez cette commande et adaptez la à vos besoins&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> authconfig</font>
</td></tr>
<tr>
<td>
<pre>authconfig --enableldap --enableldapauth --ldapserver=ldap://<b>openldap-server.deimos.fr:389</b> --ldapbasedn="<b>dc=openldap,dc=deimos,dc=fr</b>" --enableldaptls --ldaploadcacer=<b><a rel="nofollow" class="external free" href="http://serveur-web/deimosfr.crt">http://serveur-web/deimosfr.crt</a></b> --enablemkhomedir --update
</pre>
</td></tr></table><br />
<ul><li> --ldapserver&#160;: rentrez l'adresse de votre serveur web</li>
<li> --ldapbasedn&#160;: le DN de votre serveur</li>
<li> --enableldaptls&#160;: si vous utilisez des connections LDAP sécurisées</li>
<li> --ldaploadcacer&#160;: le certificat à utiliser (si vous n'avez pas moyen de le récupérer de cette façon, regardez la procédure un peu plus bas)</li></ul>
<p>ou une version sans ssl/tls&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> authconfig</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">authconfig --enableldap --enableldapauth --disablenis --disableshadow --enablecache  --passalgo=sha512 --disableldaptls --disableldapstarttls --disablesssdauth --enablemkhomedir --enablepamaccess --enablecachecreds --enableforcelegacy --disablefingerprint  --ldapserver=192.168.0.1 --ldapbasedn=dc=openldap,dc=deimos,dc=fr --updateall</pre></div></div>
</td></tr></table><br />
<p>Pour récupérer le certificat ssl demandé plus haut, voici une solution&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> openssl</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"><span class="xtra ln-xtra">&gt; openssl s_client -connect openldap-server.deimos.fr:636</span>CONNECTED(00000003)
depth=0 C = FR, ST = IDF, L = Paris, O = DEIMOS, CN = openldap-server.deimos.fr, emailAddress = deimos@deimos.fr
verify error:num=18:self signed certificate
verify return:1
depth=0 C = FR, ST = IDF, L = Paris, O = DEIMOS, CN = openldap-server.deimos.fr, emailAddress = deimos@deimos.fr
verify return:1
---
Certificate chain
 0 s:/C=FR/ST=IDF/L=Paris/O=DEIMOS/CN=openldap-server.deimos.fr/emailAddress=deimos@deimos.fr
   i:/C=FR/ST=IDF/L=Paris/O=DEIMOS/CN=openldap-server.deimos.fr/emailAddress=deimos@deimos.fr
---
Server certificate
<span class="xtra ln-xtra">-----BEGIN CERTIFICATE-----</span><span class="xtra ln-xtra">MIIDpTCCAw6gAwIBAgIJAJJUJLhNM1/XMA0GCSqGSIb3DQEBBQUAMIGUMQswCQYD</span><span class="xtra ln-xtra">VQQGEwJGUjEMMAoGA1UECBMDSURGMQ4wDAYDVQQHEwVQYXJpczEPMA0GA1UEChMG</span><span class="xtra ln-xtra">VUxMSU5LMREwDwYDVQQLEwh1bHN5c25ldDEcMBoGA1UEAxMTdGFzbWFuaWEMdWxs</span><span class="xtra ln-xtra">aW5rLmxhbjElMCMGCSqGSIb3DQEJARYWaW503XJuYWwtaXRAdWxsaW5rLmNvbTAe</span><span class="xtra ln-xtra">Fw0xMTEyMDUxMjQzMzVaFw0yMTEyMDIxMjQzMzVaMIGUMQswCQYDVQQGEwJGUjEM</span><span class="xtra ln-xtra">MAoGA1UECBMDSURGMR4wDAYDVQQHEwVQYXJpczEPMA0GA1UEChMGVUxMSU5LMREw</span><span class="xtra ln-xtra">DwYDVQQLEwh1bHN5c25ldDEcMBoGA1UEAxMTdGFzbWFuaWEudWxsaW5rLmxhbjEl</span><span class="xtra ln-xtra">MCMGCSqGSIb3DQEJARYWaW50ZXJuYWwtaXRAdWxsaW5rLmNvbTCBnzANBgkqhkiG</span><span class="xtra ln-xtra">9w0BAQEFAAOBjQAwgYkCgYEA4QoXFn39LhMW7mlA9r3NOX6iTHCCSlZjVQi0mQ5k</span><span class="xtra ln-xtra">BVysN8KMFfC0E4vOeG1Z11AYwW7xCOb4Pl+LgfgfdgfgfdJIn92LX0meJcsgWKOh</span><span class="xtra ln-xtra">qVAsZNkWn2ss8oDw3t5NEOjKFZ5BKVR2fL4Yj23DmFOAwew5PR5xhxGV5LJ9VErS</span><span class="xtra ln-xtra">Ks0CAwEAAaOB/DCB+TAdBgNVHQ4EFgQUn5Ig2hFtROXcG3vxux7izNqcUd4wgckG</span><span class="xtra ln-xtra">A1UdIwSBwTCBvoAUn5Ig2hFtROXcG3vxux7izNqcUd6hgZqkgZcwgZQxCzAJBgNV</span><span class="xtra ln-xtra">BAYTAkZSMQwwCgYDVQQIEwNJREYxDjAMBgNVBAcTBVBhcmlzMQ8wDQYDVQQKEwZV</span><span class="xtra ln-xtra">TExJTksxETAPBgNVBAsTCHVsc3lzbmV0MRwwGgYDVQQDExN0YXNtYW5pYS51bGxp</span><span class="xtra ln-xtra">bmsubGFuMSUwIwYJKoZIhvcNAQkBFhZpbnRlcm5hbC1pdEB1bGxpbmsuY29tggkA</span><span class="xtra ln-xtra">klQkuE0zX9cwDAYCVR0TBAUwAwEB/zANBgkqhkiG9w0BAQUFAAOBgQAbjjAbcBez</span><span class="xtra ln-xtra">dKyq+Tlf3/DURW0BJhHKyY7UW7L39m/KZRIB2lbgFjslrAL4yNnFgipJ6aKlJFfV</span><span class="xtra ln-xtra">BYEu7MhKH2pJZBYFpzuHOdKvDq+Kmn/wGvxeOvzh1GzQPGhQv4cClm2PJNMh/jrK</span><span class="xtra ln-xtra">ZWNzqyLWYtWAoLu6N6gMER1Bd1Z5uzHl3A==</span><span class="xtra ln-xtra">-----END CERTIFICATE-----  </span>subject=/C=FR/ST=IDF/L=Paris/O=DEIMOS/CN=openldap-server.deimos.fr/emailAddress=deimos@deimos.fr
issuer=/C=FR/ST=IDF/L=Paris/O=DEIMOS/CN=openldap-server.deimos.fr/emailAddress=deimos@deimos.fr
---
No client certificate CA names sent
---
SSL handshake has read 1291 bytes and written 311 bytes
---
New, TLSv1/SSLv3, Cipher is AES256-SHA
Server public key is 1024 bit
Secure Renegotiation IS NOT supported
Compression: NONE
Expansion: NONE
SSL-Session:
    Protocol &#160;: TLSv1
    Cipher   &#160;: AES256-SHA 
    Session-ID: 91E6398F6DE9FBDC1B7EBDF890FE818B09EB79555C9FC1CF64EDC284F7A23B2A
    Session-ID-ctx:
    Master-Key: 51408932336792F4E8F5339BD12F312005022A4B20E6A5FBC56239BC0DD514344449531973B9A8395B1E799196D8F411
    Key-Arg  &#160;: None
    Krb5 Principal: None   
    PSK identity: None
    PSK identity hint: None
    Start Time: 1327491823 
    Timeout  &#160;: 300 (sec)  
    Verify return code: 18 (self signed certificate)
---</pre></div></div>
</td></tr></table><br />
<p>Dans le cas ou le certificat est récupérer de la manière manuelle, copiez le dans /etc/openldap/cacerts/ldap.crt, puis exécutez la commande suivante&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> cacertdir_rehash</font>
</td></tr>
<tr>
<td>
<pre>cacertdir_rehash /etc/openldap/cacerts
</pre>
</td></tr></table><br />
<h4><span class="mw-headline" id="M.C3.A9thode_2"><span class="mw-headline-number">3.2.2.2</span> Méthode 2</span></h4>
<p>Modifier /etc/ldap.conf. Ce fichier est l'équivalent de /etc/libnss_pam.conf sous debian. Vous pouvez donc y mettre la même chose.
</p><p>Modifier le fichier /etc/pam.d/system_auth&#160;: c'est l'équivalent des différents common-* sous debian. Cela donne par exemple:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pam.d/system_auth</font>
</td></tr>
<tr>
<td>
<pre>auth        required      /lib/security/$ISA/pam_env.so
auth        sufficient    /lib/security/$ISA/pam_unix.so likeauth nullok
auth        sufficient    /lib/security/$ISA/pam_ldap.so use_first_pass
auth        required      /lib/security/$ISA/pam_deny.so

account     sufficient    /lib/security/$ISA/pam_unix.so
account     sufficient    /lib/security/$ISA/pam_ldap.so
account     sufficient    /lib/security/$ISA/pam_succeed_if.so uid &lt; 100 quiet
account     required      /lib/security/$ISA/pam_permit.so

password    requisite     /lib/security/$ISA/pam_cracklib.so retry=3
password    sufficient    /lib/security/$ISA/pam_unix.so nullok use_authtok md5 shadow
password    required      /lib/security/$ISA/pam_deny.so

session     optional      /lib/security/$ISA/pam_mkhomedir.so skel=/etc/skel/ umask=0077
session     required      /lib/security/$ISA/pam_limits.so
session     required      /lib/security/$ISA/pam_unix.so
</pre>
</td></tr></table><br />
<p>Comme sur debian, il faut également modifier le fichier /etc/nsswitch.conf.
</p>
<h3><span class="mw-headline" id="Forcer_un_shell_au_login"><span class="mw-headline-number">3.2.3</span> Forcer un shell au login</span></h3>
<p>Si vous avez une authentification de pam via LDAP, il est possible de forcer un shell en particulier au login. Il va donc overrider les informations envoyées par NSS et les remplacer par le shell souhaité. Nous allons utiliser ici lshell pour toutes les personnes se connectant via LDAP&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/libnss-ldap.conf ou /etc/ldap.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">nss_override_attribute_value loginShell /usr/bin/lshell</pre></div></div>
</td></tr></table><br />
<h3><span class="mw-headline" id="Solaris"><span class="mw-headline-number">3.2.4</span> Solaris</span></h3>
<ul><li> Configurer le fichier /etc/pam.conf&#160;:</li></ul>
<p>Pour chaque ligne&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pam.conf</font>
</td></tr>
<tr>
<td>
<pre>service  auth <b>required</b>           pam_unix_auth.so.1
</pre>
</td></tr></table><br />
<p>remplacer "required" par "sufficient" et ajouter derrière la ligne&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pam.conf</font>
</td></tr>
<tr>
<td>
<pre>service auth <b>sufficient pam_ldap.so.1 try_first_pass</b>
</pre>
</td></tr></table><br />
<p>Ce qui doit donner quelquechose comme ceci&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/pam.conf</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">#
#ident  &quot;@(#)pam.conf   1.28    04/04/21 SMI&quot;
#
# Copyright 2004 Sun Microsystems, Inc.  All rights reserved.
# Use is subject to license terms.
#
# PAM configuration
#
# Unless explicitly defined, all services use the modules
# defined in the &quot;other&quot; section.
#
# Modules are defined with relative pathnames, i.e., they are
# relative to /usr/lib/security/$ISA. Absolute path names, as
# present in this file in previous releases are still acceptable.
#
# Authentication management
#
# login service (explicit because of pam_dial_auth)
#
login   auth requisite          pam_authtok_get.so.1
login   auth required           pam_dhkeys.so.1
login   auth required           pam_unix_cred.so.1
login   auth sufficient         pam_ldap.so.1 try_first_pass
login   auth sufficient         pam_unix_auth.so.1
login   auth required           pam_dial_auth.so.1
#
# rlogin service (explicit because of pam_rhost_auth)
#
rlogin  auth sufficient         pam_rhosts_auth.so.1
rlogin  auth requisite          pam_authtok_get.so.1
rlogin  auth required           pam_dhkeys.so.1
rlogin  auth required           pam_unix_cred.so.1
rlogin  auth sufficient         pam_ldap.so.1 try_first_pass
rlogin  auth sufficient         pam_unix_auth.so.1
#
# Kerberized rlogin service
#
krlogin auth required           pam_unix_cred.so.1
krlogin auth binding            pam_krb5.so.1
krlogin auth sufficient         pam_ldap.so.1
krlogin auth sufficient         pam_unix_auth.so.1
#
# rsh service (explicit because of pam_rhost_auth,
# and pam_unix_auth for meaningful pam_setcred)
#
rsh     auth sufficient         pam_rhosts_auth.so.1
rsh     auth required           pam_unix_cred.so.1
#
# Kerberized rsh service
#
krsh    auth required           pam_unix_cred.so.1
krsh    auth binding            pam_krb5.so.1
krsh    auth sufficient         pam_ldap.so.1
krsh    auth sufficient         pam_unix_auth.so.1
#
# Kerberized telnet service
#
ktelnet auth required           pam_unix_cred.so.1
ktelnet auth binding            pam_krb5.so.1
ktelnet auth sufficient         pam_ldap.so.1
ktelnet auth sufficient         pam_unix_auth.so.1
#
# PPP service (explicit because of pam_dial_auth)
#
ppp     auth requisite          pam_authtok_get.so.1
ppp     auth required           pam_dhkeys.so.1
ppp     auth required           pam_unix_cred.so.1
ppp     auth sufficient         pam_ldap.so.1
ppp     auth sufficient         pam_unix_auth.so.1
ppp     auth required           pam_dial_auth.so.1
#
# Default definitions for Authentication management
# Used when service name is not explicitly mentioned for authentication
#
other   auth requisite          pam_authtok_get.so.1
other   auth required           pam_dhkeys.so.1
other   auth required           pam_unix_cred.so.1
other   auth sufficient         pam_ldap.so.1
other   auth sufficient         pam_unix_auth.so.1
#
# passwd command (explicit because of a different authentication module)
#
passwd  auth required           pam_passwd_auth.so.1
#
# cron service (explicit because of non-usage of pam_roles.so.1)
#
cron    account required        pam_unix_account.so.1
#
# Default definition for Account management
# Used when service name is not explicitly mentioned for account management
#
other   account requisite       pam_roles.so.1
other   account required        pam_unix_account.so.1
#
# Default definition for Session management
# Used when service name is not explicitly mentioned for session management
#
other   session required        pam_unix_session.so.1
#
# Default definition for  Password management
# Used when service name is not explicitly mentioned for password management
#
other   password required       pam_dhkeys.so.1
other   password requisite      pam_authtok_get.so.1
other   password requisite      pam_authtok_check.so.1
other   password required       pam_authtok_store.so.1
#
# Support for Kerberos V5 authentication and example configurations can
# be found in the pam_krb5(5) man page under the &quot;EXAMPLES&quot; section.
#</pre></div></div>
</td></tr></table><br />
<ul><li> Configurer le fichier /etc/nsswitch.ldap</li></ul>
<p>Laisser "ldap" uniquement là où c'est utile&#160;: pour le moment sur les lignes passwd: et group:.<br />
Pour le reste, mettre le contenu du fichier /etc/nsswitch.dns.<br />
Ce qui donne&#160;:
</p>
<table width="100%" class="config_array">
<tr>
<td class="config_subarray"> <font size="-1"><a href="./File:Configuration_file.png.html" class="image" title="Configuration File"><img alt="Configuration File" src="images/a/a6/Configuration_file.png" width="32" height="32" /></a> /etc/nsswitch.ldap</font>
</td></tr>
<tr>
<td>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">#
# Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
# Use is subject to license terms.
#
&#160;
#
# /etc/nsswitch.dns:
#
# An example file that could be copied over to /etc/nsswitch.conf; it uses
# DNS for hosts lookups, otherwise it does not use any other naming service.
#
# &quot;hosts:&quot; and &quot;services:&quot; in this file are used only if the
# /etc/netconfig file has a &quot;-&quot; for nametoaddr_libs of &quot;inet&quot; transports.
&#160;
# DNS service expects that an instance of svc:/network/dns/client be
# enabled and online.
&#160;
passwd:     files ldap
group:      files ldap
&#160;
# You must also set up the /etc/resolv.conf file for DNS name
# server lookup.  See resolv.conf(4).
hosts:      files dns 
&#160;
# Note that IPv4 addresses are searched for in all of the ipnodes databases
# before searching the hosts databases.
ipnodes:   files dns 
&#160;
networks:   files
protocols:  files
rpc:        files
ethers:     files
netmasks:   files
bootparams: files
publickey:  files
# At present there isn't a 'files' backend for netgroup;  the system will 
#   figure it out pretty quickly, and won't use netgroups at all.
netgroup:   files
automount:  files
aliases:    files
services:   files
printers:       user files
&#160;
auth_attr:  files
prof_attr:  files
project:    files
&#160;
tnrhtp:     files
tnrhdb:     files</pre></div></div>
</td></tr></table><br />
<p>Une fois que cela est fait, nous allons pouvoir mettre en place la configuration. <b>Attention&#160;: si vous êtes en environnement cluster, adapatez à la conf initiale&#160;!</b>&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> </font>
</td></tr>
<tr>
<td>
<pre>cp /etc/nsswitch.ldap /etc/nsswitch.conf
</pre>
</td></tr></table><br />
<ul><li> Lancer la configuration du client ldap</li></ul>
<p>Il suffit de taper la commande&#160;:
</p>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> ldapclient</font>
</td></tr>
<tr>
<td>
<pre>ldapclient manual -v -a authenticationMethod=simple -a proxyDN=cn=admin,dc=<b>openldap,dc=mydomain,dc=local</b> -aproxyPassword=bidon -a defaultSearchBase=<b>dc=openldap,dc=mydomain,dc=local</b> -a defaultServerList=<b>ldap.mydomain.local</b> -a serviceSearchDescriptor=passwd:<b>dc=openldap,dc=mydomain,dc=local</b>?sub -a serviceSearchDescriptor=shadow:<b>dc=openldap,dc=mydomain,dc=local</b>?sub -a serviceSearchDescriptor=group:dc=<b>openldap,dc=mydomain,dc=local</b>?sub -a serviceAuthenticationMethod=pam_ldap:simple&lt;nowiki&gt;=&lt;/nowiki&gt;
</pre>
</td></tr></table><br />
<p>Attention&#160;: il semble que la commande ldapclient soit buggée et nécéssite les paramètres proxyDN et proxyPassword même s'ils sont inutilisés&#160;! (et même s'ils contiennent n'importe quoi)
</p>
<ul><li> Attention au répertoire home, il faut configurer /etc/auto_home (<a rel="nofollow" class="external free" href="http://www.solaris-fr.org/home/docs/base/utilisateurs">http://www.solaris-fr.org/home/docs/base/utilisateurs</a>). Ce qui donne pour ma part&#160;:</li></ul>
<table width="100%" class="command_array">
<tr>
<td class="command_subarray"> <font size="-1"><a href="./File:Terminal.png.html" class="image" title="Command"><img alt="Command" src="images/9/9c/Terminal.png" width="32" height="32" /></a> /etc/auto_home</font>
</td></tr>
<tr>
<td><div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">#
# Copyright 2003 Sun Microsystems, Inc.  All rights reserved.
# Use is subject to license terms.
#
# ident &quot;@(#)auto_home  1.6     03/04/28 SMI&quot;
#
# Home directory map for automounter
#
+auto_home
* localhost:/export/home/&amp;</pre></div></div>
</td></tr></table><br />
<p>Au cas où vous voudriez créer automatiquement le home directory, vous devez effectuer un portage du pam_mkhomedir de linux&#160;:
</p>
<ul><li> <a rel="nofollow" class="external free" href="http://mega.ist.utl.pt/~filipe/pam_mkhomedir-sol/?C=D;O=A">http://mega.ist.utl.pt/~filipe/pam_mkhomedir-sol/?C=D;O=A</a></li>
<li> <a rel="nofollow" class="external free" href="http://www.keutel.de/pam_mkhomedir/index.html">http://www.keutel.de/pam_mkhomedir/index.html</a></li></ul>
<p>Une bonne idée serait aussi de monter automatiquement le home depuis un serveur nfs.
</p><p>Il faut que les comptes utilisateurs dans l'annuaire LDAP aient dans leur liste d 'objectClass la classe «&#160;shadowAccount&#160;» pour pouvoir être pris en compte par solaris.
</p>
<h1><span class="mw-headline" id="Ressources"><span class="mw-headline-number">4</span> Ressources</span></h1>
<p><a href="./File:LDAP_Authentication_In_Linux.pdf.html" title="File:LDAP Authentication In Linux.pdf">Documentation Authentification avec Linux</a><br />
<a href="./File:Kerberos_s10.pdf.html" title="File:Kerberos s10.pdf">Using Kerberos to Authenticate a Solaris 10 OS LDAP Client With Microsoft Active Directory</a>
</p>
<!-- 
NewPP limit report
CPU time usage: 0.128 seconds
Real time usage: 0.133 seconds
Preprocessor visited node count: 1154/1000000
Preprocessor generated node count: 3178/1000000
Post‐expand include size: 46668/2097152 bytes
Template argument size: 13251/2097152 bytes
Highest expansion depth: 5/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   34.138      1 - -total
 59.61%   20.348      1 - Template:LDAP_Clients_configuration
 39.60%   13.519     26 - Template:Config
 24.66%    8.418     27 - Template:Command
 19.67%    6.714      1 - Template:Solaris_ldap_client_conf
 11.28%    3.852      1 - Template:LDAP_Clients_configuration_RedHat
  4.29%    1.465      1 - Template:Ldap_nss_override_shell
  3.57%    1.220      1 - Template:LDAP_Clients_installation
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:2003-0!*!0!1!en!5!* and timestamp 20181111230654 and revision id 8897
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=Mise_en_place_d%27une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP&amp;oldid=8897">https://wiki.deimos.fr/index.php?title=Mise_en_place_d%27une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP&amp;oldid=8897</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=Mise+en+place+d%27une+solution+de+Syncronisation+entre+ActiveDirectory+et+OpenLDAP" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=Mise_en_place_d%27une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=Mise_en_place_d%27une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/Mise_en_place_d'une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/Mise_en_place_d%27une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=Mise_en_place_d%27une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=Mise_en_place_d%27une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP&amp;oldid=8897" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=Mise_en_place_d%27une_solution_de_Syncronisation_entre_ActiveDirectory_et_OpenLDAP&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 12 April 2010, at 08:05.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":31});
}</script>
	</body>
</html>
	
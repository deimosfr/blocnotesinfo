<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>VServer : Mise en place de VServer - Deimos.fr / Bloc Notes Informatique</title>
<meta name="generator" content="MediaWiki 1.25.5" />
<link rel="shortcut icon" href="https://wiki.deimos.fr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Deimos.fr / Bloc Notes Informatique (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.deimos.fr/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="./VServer_:_Mise_en_place_de_VServer.html" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr" />
<link rel="alternate" type="application/atom+xml" title="Deimos.fr / Bloc Notes Informatique Atom feed" href="https://wiki.deimos.fr/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint,shared|mediawiki.sectionAnchor|mediawiki.skinning.interface|mediawiki.ui.button|skins.vector.styles&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*.css" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-css:7:6f8c0c45eefd74c7bbe9478b32df38c0 */</style>
<script src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"VServer_:_Mise_en_place_de_VServer","wgTitle":"VServer : Mise en place de VServer","wgCurRevisionId":9685,"wgRevisionId":9685,"wgArticleId":1913,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"VServer_:_Mise_en_place_de_VServer","wgRelevantArticleId":1913,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"publish":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: blocnotesinfo-wiki_:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-VServer_Mise_en_place_de_VServer skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">VServer : Mise en place de VServer</span></h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Deimos.fr / Bloc Notes Informatique</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="./VServer_:_Mise_en_place_de_VServer.html#mw-navigation">navigation</a>, 					<a href="./VServer_:_Mise_en_place_de_VServer.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="./VServer_:_Mise_en_place_de_VServer.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="./VServer_:_Mise_en_place_de_VServer.html#Retour_d.27exp.C3.A9rience"><span class="tocnumber">2</span> <span class="toctext">Retour d'expérience</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="./VServer_:_Mise_en_place_de_VServer.html#Installation"><span class="tocnumber">3</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="./VServer_:_Mise_en_place_de_VServer.html#Cr.C3.A9ation_d.27un_VServer"><span class="tocnumber">4</span> <span class="toctext">Création d'un VServer</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="./VServer_:_Mise_en_place_de_VServer.html#Management_des_VServer"><span class="tocnumber">5</span> <span class="toctext">Management des VServer</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="./VServer_:_Mise_en_place_de_VServer.html#Memory_Limits"><span class="tocnumber">5.1</span> <span class="toctext">Memory Limits</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="./VServer_:_Mise_en_place_de_VServer.html#R.C3.A9seau"><span class="tocnumber">5.2</span> <span class="toctext">Réseau</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="./VServer_:_Mise_en_place_de_VServer.html#Binding"><span class="tocnumber">5.2.1</span> <span class="toctext">Binding</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="./VServer_:_Mise_en_place_de_VServer.html#Montage_NFS"><span class="tocnumber">5.2.2</span> <span class="toctext">Montage NFS</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-10"><a href="./VServer_:_Mise_en_place_de_VServer.html#VPS"><span class="tocnumber">5.3</span> <span class="toctext">VPS</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="./VServer_:_Mise_en_place_de_VServer.html#D.C3.A9marrage_automatique_d.27un_Vserver_au_boot_de_la_machine"><span class="tocnumber">5.4</span> <span class="toctext">Démarrage automatique d'un Vserver au boot de la machine</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="./VServer_:_Mise_en_place_de_VServer.html#Monter_un_dossier_.C3.A0_plusieurs_endroits_en_m.C3.AAme_temps"><span class="tocnumber">5.5</span> <span class="toctext">Monter un dossier à plusieurs endroits en même temps</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="./VServer_:_Mise_en_place_de_VServer.html#Changer_la_taille_du_TMP"><span class="tocnumber">5.6</span> <span class="toctext">Changer la taille du TMP</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14"><a href="./VServer_:_Mise_en_place_de_VServer.html#Informations_sur_les_vms_en_cours"><span class="tocnumber">6</span> <span class="toctext">Informations sur les vms en cours</span></a>
<ul>
<li class="toclevel-2 tocsection-15"><a href="./VServer_:_Mise_en_place_de_VServer.html#RAM"><span class="tocnumber">6.1</span> <span class="toctext">RAM</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="./VServer_:_Mise_en_place_de_VServer.html#Load_Average"><span class="tocnumber">6.2</span> <span class="toctext">Load Average</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17"><a href="./VServer_:_Mise_en_place_de_VServer.html#FAQ"><span class="tocnumber">7</span> <span class="toctext">FAQ</span></a>
<ul>
<li class="toclevel-2 tocsection-18"><a href="./VServer_:_Mise_en_place_de_VServer.html#Je_rencontre_divers_probl.C3.A8mes_r.C3.A9seau"><span class="tocnumber">7.1</span> <span class="toctext">Je rencontre divers problèmes réseau</span></a>
<ul>
<li class="toclevel-3 tocsection-19"><a href="./VServer_:_Mise_en_place_de_VServer.html#Setting_network_flags_.28nflags.29"><span class="tocnumber">7.1.1</span> <span class="toctext">Setting network flags (nflags)</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="./VServer_:_Mise_en_place_de_VServer.html#Setting_network_capabilities_.28ncaps.29"><span class="tocnumber">7.1.2</span> <span class="toctext">Setting network capabilities (ncaps)</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-21"><a href="./VServer_:_Mise_en_place_de_VServer.html#La_r.C3.A9solution_DNS_ne_fonctionne_pas"><span class="tocnumber">7.2</span> <span class="toctext">La résolution DNS ne fonctionne pas</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-22"><a href="./VServer_:_Mise_en_place_de_VServer.html#Ressources"><span class="tocnumber">8</span> <span class="toctext">Ressources</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Introduction"><span class="mw-headline-number">1</span> Introduction</span></h1>
<p>Linux-VServer est un isolateur des contextes de sécurité combiné à du routage segmenté, chroot, quotas étendus et autres outils standards.
</p><p>Projet lancé à l'origine par Jacques Gélinas à l'origine du patch CTX, Linux-VServer consiste en un patch pour le noyau Linux qui permet de faire tourner plusieurs applications dans différents contextes de sécurité sur une même machine hôte. Linux-VServer est également muni d'un ensemble d'outils pour installer/gérer ces contextes.
</p><p>Ce projet permet de faire tourner un ou plusieurs environnements d'exploitation (systèmes d'exploitation sans le noyau) autrement dit il permet de faire tourner une ou plusieurs distributions sur une distribution.
</p><p>Linux-VServer est une solution de virtualisation beaucoup plus poussée que le simple chroot.
</p><p>À ne pas confondre avec le Linux Virtual Server Project.
</p>
<h1><span class="mw-headline" id="Retour_d.27exp.C3.A9rience"><span class="mw-headline-number">2</span> Retour d'expérience</span></h1>
<p>Vserver est un excellent produit pour les applications ne nécessitant pas beaucoup de connexions réseaux simultanées. Niveau processeur / ram, je n'ai jamais rencontré de soucis particulié. C'est vraiment côté réseaux qu'il y a quelques bizarreries. Par exemple un Nagios va avoir du mal avec + de 800 checks, ou bien une réplication MySQL ne va pas forcément correctement fonctionner etc...
</p><p>Vserver reste cependant un atout majeur, mais doit être utilisé selon des besoins spécifiques sans grosse charge réseaux.
</p>
<h1><span class="mw-headline" id="Installation"><span class="mw-headline-number">3</span> Installation</span></h1>
<p>Installez le minimum requis&#160;:
</p>
<pre>apt-get install linux-image-vserver-686 util-vserver vserver-debiantools ssh
</pre>
<p>Maintenant rebooter sur le nouveau kernel.
</p>
<h1><span class="mw-headline" id="Cr.C3.A9ation_d.27un_VServer"><span class="mw-headline-number">4</span> Création d'un VServer</span></h1>
<p>Créer le dossier où sera installer votre VServer puis entrez dedans&#160;:
</p>
<pre>mkdir -p /home/deimos/vserver/vservertest &amp;&amp; cd /home/deimos/vserver/
</pre>
<p>Créer un VServer comme ceci&#160;:
</p>
<pre>newvserver --vsroot $(pwd) --hostname vservertest --domain mydomain.local --ip 192.168.0.70/24 --dist etch --mirror http://ftp.fr.debian.org/debian --interface eth0
</pre>
<p>Note&#160;: mettez dummy0 si vous avez mis une interface dummy&#160;!
</p>
<ul><li> vsroot - par défaut dans /var/lib/vservers, c'est là ou sera installé le vserver</li>
<li> Hostname - le nom du vserver</li>
<li> Domain - le domaine du vserver (comme celui de la machine)</li>
<li> IP Address- l'adresse IP du vserver</li>
<li> CIDR Range - le CIDR (masque sous réseau)</li>
<li> Dist - la distribution à utiliser</li>
<li> Debian Mirror - le mirroir Debian</li>
<li> Interface - l'interface réseau à utiliser (eth0 par défaut sur la plupart des systèmes)</li></ul>
<h1><span class="mw-headline" id="Management_des_VServer"><span class="mw-headline-number">5</span> Management des VServer</span></h1>
<p>Pour démarrer un VServer et se connecter dessus&#160;:
</p>
<pre>vserver vservertest start; vserver vservertest enter
</pre>
<p>Voici les options de base&#160;:
</p>
<ul><li> Démarrer un vserver&#160;: <b>vserver <i>nom_du_vserver</i> start</b></li>
<li> Arrêter un vserver&#160;: <b>vserver <i>nom_du_vserver</i> stop</b></li>
<li> Redémarrer un vserver&#160;: <b>vserver <i>nom_du_vserver</i> restart</b></li>
<li> Entrer dans un shell d'un vserver&#160;: <b>vserver <i>nom_du_vserver</i> enter</b></li></ul>
<h2><span class="mw-headline" id="Memory_Limits"><span class="mw-headline-number">5.1</span> Memory Limits</span></h2>
<p>A vserver kernel keeps track many resources used by each guest (context). Some of these relate to memory usage by the guest. You can place limits on these resources to prevent guests from using all the host memory and making the host unusable.
</p><p>Two resources are particularly important in this regard: 
</p>
<ul><li> The <b>Resident Set Size</b> (<code>rss</code>) is the amount of pages currently present in RAM.</li>
<li> The <b>Address Space</b> (<code>as</code>) is the total amount of memory (pages) mapped in each process in the context.</li></ul>
<p>Both are measured in <b>pages</b>, which are 4 kB each on Intel machines (i386). So a value of 200000 means a limit of 800,000 kB, a little less than 800 MB.
</p><p>Each resource has a <b>soft</b> and a <b>hard limit</b>.
</p>
<ul><li> If a guest exceeds the <code>rss</code> hard limit, the kernel will invoke the Out-of-Memory (OOM) killer to kill some process in the guest.</li>
<li> The <code>rss</code> soft limit is shown inside the guest as the maximum available memory. If a guest exceeds the <code>rss</code> soft limit, it will get an extra "bonus" for the OOM killer (proportional to the oversize).</li>
<li> If a guest exceeds the <code>as</code> hard limit, memory allocation attempts will return an error, but no process is killed.</li>
<li> The <code>as</code> soft limit is not in utilized until now. In the future it may be used to penalizing guests over that limit or it could be used to force swapping on them and such ...</li></ul>
<p>Bertl explained the difference between <b>rss</b> and <b>as</b> with the following example. If two processes share 100 MB of memory, then only 100 MB worth of virtual memory pages can be used at most, so the RSS use of the guest increases by 100 MB. However, two processes are using it, so the AS use increases by 200 MB. 
</p><p>This makes me think that limiting AS is less useful than limiting RSS, since it doesn't directly reflect real, limited resources (RAM and swap) on the host, that deprive other virtual machines of those resources. Bertl says that AS limits can be used to give guests a "gentle" warning that they are running out of memory, but I don't know how much more gentle it is, or how to set it accurately. 
</p><p>For example, 100 processes each mapping a 100 MB file would consume a total of 10 GB of address space (AS), but no more than 100 MB of resources on the host. But if you set the AS limit to 10 GB, then it will not stop one process from allocating 4 GB of RAM, which could kill the host or result in that process being killed by the OOM killer.
</p><p>You can set the hard limit on a particular context, effective immediately, with this command:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">/usr/sbin/vlimit -c &lt;xid&gt; --&lt;resource&gt; &lt;value&gt;</pre></div></div>
<p>&lt;xid&gt; is the context ID of the guest, which you can determine with the <code>/usr/sbin/vserver-stat</code> command.
</p><p>For example, if you want to change the <b>rss</b> hard limit for the vserver with &lt;xid&gt; 49000, and limit it to 10,000 pages (40 MB), you could use this command:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">/usr/sbin/vlimit -c 49000 --rss 10000</pre></div></div>
<p>You can change the soft limit instead by adding the -S parameter.
</p><p>Changes made with the vlimit command are effective only until the vserver is stopped. To make permanent changes, write the value to this file:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">/etc/vservers/&lt;name&gt;/rlimits/&lt;resource&gt;.hard</pre></div></div>
<p>To set a soft limit, use the same file name without the <code>.hard</code> extension. The <code>rlimits</code> directory is not created by default, so you may need to create it yourself.
</p><p>Changes to these files take effect only when the vserver is started. To make immediate and permanent changes to a running vserver, you need to run vlimit <b>and</b> update the rlimits file.
</p><p>The safest setting, to prevent any guest from interfering with any other, is to set the total of all RSS hard limits (across all running guests) to be less than the total virtual memory (RAM and swap) on the host. It should be sufficiently less to leave room for processes running on the host, and some disk cache, perhaps 100 MB.
</p><p>However, this is very conservative, since it assumes the worst case where all guests are using the maximum amount of memory at one time. In practice, you can usually get away with contended resources, i.e. allowing guests to use more than this value.
</p>
<h2><span class="mw-headline" id="R.C3.A9seau"><span class="mw-headline-number">5.2</span> Réseau</span></h2>
<p>Pour configurer les vservers pour qu'ils aient une adresse IP bien distincte, il faut modifier le fichier /etc/network/interfaces de l'hôte principale&#160;:
</p>
<pre># The loopback network interface
auto lo bond0 <b>dummy0</b>
iface lo inet loopback

# Bonding interface
iface bond0 inet static
        address 192.168.0.98
        netmask 255.255.255.0
        gateway 192.168.0.248
        network 192.168.0.0
        up ifenslave bond0 eth0 eth1
        down ifenslave -d bond0 eth0 eth1

<b># Vserver interface</b>
<b>iface dummy0 inet static</b>
<b>        address 192.168.0.10</b>
<b>        netmask 255.255.255.0</b>
</pre>
<p>Ensuite redémarrez le réseau&#160;:
</p>
<pre>/etc/init.d/network restart
</pre>
<p>Maintenant créez un vserver et entrez comme interface <b>dummy0</b>&#160;:
</p>
<pre>newvserver --vsroot $(pwd) --hostname <b>hostname</b> --domain mydomain.local --ip <b>192.168.0.12/24</b> --dist <b>lenny</b> --mirror http://ftp.fr.debian.org/debian --interface <b>dummy0</b>
</pre>
<p>Puis ajoutez un fichier <b>name</b> comportant le dernier numéro de l'IP que vous avez attribuez à&#160;:
</p>
<pre>echo <b>12</b> &gt; /etc/vservers/<b>hostname</b>/interfaces/0/name
</pre>
<p>Démarrez votre vserver et si vous faites un ifconfig, vous devriez avoir quelquechose ressemblant à ceci&#160;:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1">dummy0    Lien encap:Ethernet  HWaddr 22:22:xx:xx:CF:xx  
          UP BROADCAST RUNNING NOARP  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 lg file transmission:0 
          RX bytes:0 (0.0 b)  TX bytes:210 (210.0 b)
&#160;
dummy0:12 Lien encap:Ethernet  HWaddr 22:22:xx:xx:CF:xx 
          inet adr:192.168.0.12  Bcast:192.168.0.255  Masque:255.255.255.0
          UP BROADCAST RUNNING NOARP  MTU:1500  Metric:1</pre></div></div>
<h3><span class="mw-headline" id="Binding"><span class="mw-headline-number">5.2.1</span> Binding</span></h3>
<p><b>Important&#160;: Si jamais vous souhaitez installer un soft tournant sur un port déjà en écoute sur un autre vserver, essayer de binder sur l'adresse du serveur correspondant. Ex&#160;: avec ssh, éditez le fichier /etc/ssh/sshd_config et rensignez le bind avec l'IP du vserver en cours.</b>
</p><p>Voici un tableau d'Applications avec fichiers de configuration à modifier pour le Bind&#160;:
</p>
<table border="1" width="100%">

<tr>
<th>Application
</th>
<th>Fichier de conf
</th>
<th>Ligne
</th></tr>
<tr>
<td>OpenSSH
</td>
<td>/etc/ssh/sshd_config
</td>
<td>ListenAddress 192.168.0.12
</td></tr>
<tr>
<td>Postgresql
</td>
<td>/etc/postgresql/8.1/main/postgresql.conf
</td>
<td>listen_addresses = '192.168.0.12'
</td></tr>
<tr>
<td>Apache2
</td>
<td>/etc/apache2/ports.conf
</td>
<td>Listen 192.168.0.12:80
</td></tr>
<tr>
<td>Munin
</td>
<td>/etc/munin/munin-node.conf
</td>
<td>host 192.168.0.12
</td></tr>
<tr>
<td>Tomcat5.5
</td>
<td>/etc/tomcat5.5/server.xml
</td>
<td>&lt;Server address="192.168.0.12" port="8005" shutdown="SHUTDOWN"&gt;
</td></tr>
<tr>
<td>MySQL
</td>
<td>/etc/mysql/my.cnf
</td>
<td>bind-address = 192.168.0.12
</td></tr>
<tr>
<td>Postfix
</td>
<td>/etc/postfix/main.cf
</td>
<td>inet_interfaces = 192.168.0.12
</td></tr>
<tr>
<td>Lighttpd
</td>
<td>/etc/lighttpd/lighttpd.conf
</td>
<td>server.bind = "192.168.0.12"
</td></tr>
<tr>
<td>Nagios NRPE
</td>
<td>/etc/nagios/nrpe.cfg
</td>
<td>server_address=192.168.0.12
</td></tr></table>
<h3><span class="mw-headline" id="Montage_NFS"><span class="mw-headline-number">5.2.2</span> Montage NFS</span></h3>
<p>Pour des raisons de sécurité, nous ne pouvons pas par défaut monter des partages nfs. Pour outrepasser cette sécu, il suffit de créer un fichier un fichier "bcapabilities" dans la configuration du vserver en question&#160;:
</p>
<pre>echo "CAP_SYS_ADMIN" &gt; /etc/vservers/<b>mon_vserver</b>/bcapabilities
</pre>
<p>Ensuite derémarrez votre vserver et il vous aurez la possibilité de monter des partages nfs&#160;:-)
</p><p>Vous rencontrerez peut être des problèmes de connection à cause du serveur car vous n'avez pas renseigner la machine principale du Vserver&#160;:
</p>
<pre>mount: block device backuppc:/mnt/backups/disk_array0/intranet is write-protected, mounting read-only
mount: cannot mount block device backuppc:/mnt/backups/disk_array0/intranet read-only
</pre>
<p>Editez sur le serveur le fichier /etc/export&#160;:
</p>
<pre>/mnt/backups/disk_array0/intranet     <b>IP_du_Serveur_Principale</b>(sync,insecure,rw,no_root_squash)   <b>IP_du_Vserver</b>(sync,insecure,rw,no_root_squash)
</pre>
<h2><span class="mw-headline" id="VPS"><span class="mw-headline-number">5.3</span> VPS</span></h2>
<p>Voici un espèce de <b>ps</b> mais pour VServer&#160;:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="text source-text"><pre class="de1"># vps -ef
root    8102     0 MAIN       8100  0 12:40 pts/1    00:00:00 -bash
root    8210 49159 ns0        5542  0 12:49&#160;?        00:00:00 sshd: root@pts/2 
root    8212 49159 ns0        8210  0 12:49 pts/2    00:00:00 -bash
root    8271     1 ALL_PROC   8102  0 12:57 pts/1    00:00:00 vps -ef
root    8272     1 ALL_PROC   8271  0 12:57 pts/1    00:00:00 ps -ef</pre></div></div>
<h2><span class="mw-headline" id="D.C3.A9marrage_automatique_d.27un_Vserver_au_boot_de_la_machine"><span class="mw-headline-number">5.4</span> Démarrage automatique d'un Vserver au boot de la machine</span></h2>
<p>Pour démarrer automatiquement un vserver au boot de la machine, il suffit de créer un fichier mark sur la machine souhaité et lui insérer default&#160;:
</p>
<pre>echo "default" &gt; /etc/vservers/<b>mon_vserver</b>/apps/init/mark
</pre>
<p>Ici le vserver appellé "mon_vserver" démarrera automatiquement au boot de la machine.
</p>
<h2><span class="mw-headline" id="Monter_un_dossier_.C3.A0_plusieurs_endroits_en_m.C3.AAme_temps"><span class="mw-headline-number">5.5</span> Monter un dossier à plusieurs endroits en même temps</span></h2>
<p>Modifiez le fichier <i>"/etc/vservers/<b>mon_serveur</b>/fstab"</i>. Voici un exemple&#160;:
</p>
<pre>/mnt/backups/disk_array0 /mnt/backups/disk_array0 none acl,bind 0 0
</pre>
<h2><span class="mw-headline" id="Changer_la_taille_du_TMP"><span class="mw-headline-number">5.6</span> Changer la taille du TMP</span></h2>
<p>Modifier le fichier <i>"/etc/vservers/<b>mon_serveur</b>/fstab"</i>, par defaut le <i>/tmp</i> est a 16Mo, il suffit de modifier le paramettre <b>Size</b> et redémarrer le Vserver ensuite&#160;:
</p>
<pre>none    /tmp            tmpfs   size=2g,mode=1777       0 0
</pre>
<h1><span class="mw-headline" id="Informations_sur_les_vms_en_cours"><span class="mw-headline-number">6</span> Informations sur les vms en cours</span></h1>
<p>Pour obtenir des informations, il faut faire une commande pour prendre le numéro d'une vm qui nous intéresse&#160;:
</p>
<pre># vserver-stat
<b>CTX</b>   PROC    VSZ    RSS  userTIME   sysTIME    UPTIME NAME
0       71   1.1G 101.1M   2h33m03   7m39s14   4d01h03 root server
<b>49159</b>    2  14.8M   1.4M   0m00s00   0m00s00  29m09s20 deb-vserv1
<b>49163</b>    2  14.8M   1.4M   0m00s00   0m00s00   0m00s69 deb-vserv2
</pre>
<p>Le numéro de la colonne CTX correspond au numéro d'une VM.
</p>
<h2><span class="mw-headline" id="RAM"><span class="mw-headline-number">6.1</span> RAM</span></h2>
<p>Ici si nous prennons par exemple la 49159, nous pouvons connaitre la ram actuelle&#160;:
</p>
<pre># cat /proc/virtual/49159/limit
PROC:            2               4              -1           0
VM:           <b>3808           11410          100000</b>           0
VML:             0               0              -1           0
RSS:           282            1163              -1           0
ANON:           81              81              -1           0
FILES:          37              37              -1           0
OFD:            22              22              -1           0
LOCKS:           1               1              -1           0
SOCK:            1               1              -1           0
MSGQ:            0               0              -1           0
SHM:             0               0              -1           0
</pre>
<p>Ici, nous avons donc 3808ko d'utilisé, 11410ko est le maximum de mémoire qui a déjà été utilisé, et la limite est fixée à 100000ko.
</p>
<h2><span class="mw-headline" id="Load_Average"><span class="mw-headline-number">6.2</span> Load Average</span></h2>
<p>Pour le load average, c'est pas mal aussi puisque on peut contrôler d'autres choses. Toujours sur la 49159&#160;:
</p>
<pre>cat cvirt
BiasUptime:     347673.95
SysName:        Linux
NodeName:       deb-vserv1
Release:        2.6.18-4-xen-vserver-amd64
Version:        #1 SMP Wed Apr 18 20:24:37 UTC 2007
Machine:        x86_64
DomainName:     (none)
nr_threads:     2
nr_running:     0
nr_unintr:      0
nr_onhold:      0
load_updates:   418
loadavg:        0.00 0.00 0.00
total_forks:    38
</pre>
<p>Là nous avons pas mal d'infos sur l'OS en plus.
</p>
<h1><span class="mw-headline" id="FAQ"><span class="mw-headline-number">7</span> FAQ</span></h1>
<h2><span class="mw-headline" id="Je_rencontre_divers_probl.C3.A8mes_r.C3.A9seau"><span class="mw-headline-number">7.1</span> Je rencontre divers problèmes réseau</span></h2>
<h3><span class="mw-headline" id="Setting_network_flags_.28nflags.29"><span class="mw-headline-number">7.1.1</span> Setting network flags (nflags)</span></h3>
<ul><li> Add the flags to a file named <code>nflags</code>:</li></ul>
<pre>echo HIDE_NETIF &gt;&gt; nflags
</pre>
<ul><li> The default nflags are:</li></ul>
<pre>HIDE_NETIF
</pre>
<h3><span class="mw-headline" id="Setting_network_capabilities_.28ncaps.29"><span class="mw-headline-number">7.1.2</span> Setting network capabilities (ncaps)</span></h3>
<ul><li> Add the capabilities to a file named <code>ncapabilities</code>:</li></ul>
<pre>echo ^12 &gt;&gt; ncapabilities
</pre>
<ul><li> There are no default ncaps.</li></ul>
<h2><span class="mw-headline" id="La_r.C3.A9solution_DNS_ne_fonctionne_pas"><span class="mw-headline-number">7.2</span> La résolution DNS ne fonctionne pas</span></h2>
<p>Il est possible que vous ayez un serveur Bind de cache sur votre machine hôte qui vous empêche de résoudre via d'autres serveur DNS. Dans ce cas, autorisez simplement le range de vos machines virtuelles à résoudre via ce serveur bind.
</p>
<h1><span class="mw-headline" id="Ressources"><span class="mw-headline-number">8</span> Ressources</span></h1>
<p><a href="./File:Virtualisation-de-serveur-grace-a-linux-vserver.pdf.html" title="File:Virtualisation-de-serveur-grace-a-linux-vserver.pdf">Virtualisation de serveur grace a linux vserver</a><br />
<a href="./File:Vserver_memory_allocation.pdf.html" title="File:Vserver memory allocation.pdf">Documentation on Memory Allocation</a><br />
<a href="./File:Multi_vservers.pdf.html" title="File:Multi vservers.pdf">Documentation Multi Vservers</a><br />
<a href="./Xen_et_vserver_:_monitoring_des_VM_sur_une_page_PHP.html" title="Xen et vserver : monitoring des VM sur une page PHP">Xen et vserver : monitoring des VM sur une page PHP</a><br />
<a href="./File:Setup_web_server_cluster.pdf.html" title="File:Setup web server cluster.pdf">Documentation on Setting up a Web Server with Apache, LVS and Heartbeat 2</a><br />
<a rel="nofollow" class="external text" href="http://linux-vserver.org/util-vserver:Capabilities_and_Flags">Capabilities and Flags</a><br />
<a href="images/f/f2/Un_peu_plus_loin_avec_Linux_vserver.pdf" class="internal" title="Un peu plus loin avec Linux vserver.pdf">Un peu plus loin avec Linux vserver</a><br />
<a rel="nofollow" class="external free" href="http://linux-vserver.org/Networking_vserver_guests">http://linux-vserver.org/Networking_vserver_guests</a><br />
<a rel="nofollow" class="external free" href="http://fr.wikibooks.org/wiki/Linux_VServer">http://fr.wikibooks.org/wiki/Linux_VServer</a>
</p>
<!-- 
NewPP limit report
CPU time usage: 0.020 seconds
Real time usage: 0.020 seconds
Preprocessor visited node count: 157/1000000
Preprocessor generated node count: 248/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->

<!-- Saved in parser cache with key blocnotesinfo-wiki_:pcache:idhash:1913-0!*!0!1!en!*!* and timestamp 20181111230815 and revision id 9685
 -->
</div>									<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://wiki.deimos.fr/index.php?title=VServer_:_Mise_en_place_de_VServer&amp;oldid=9685">https://wiki.deimos.fr/index.php?title=VServer_:_Mise_en_place_de_VServer&amp;oldid=9685</a>"					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://wiki.deimos.fr/index.php?title=Special:UserLogin&amp;returnto=VServer+%3A+Mise+en+place+de+VServer" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="./VServer_:_Mise_en_place_de_VServer.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>Variants</span><a href="./VServer_:_Mise_en_place_de_VServer.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="./VServer_:_Mise_en_place_de_VServer.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.deimos.fr/index.php?title=VServer_:_Mise_en_place_de_VServer&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.deimos.fr/index.php?title=VServer_:_Mise_en_place_de_VServer&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="./VServer_:_Mise_en_place_de_VServer.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.deimos.fr/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="Search" title="Search Deimos.fr / Bloc Notes Informatique [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(images/a/a7/Logo_deimosfr.png);" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation_et_RSS' aria-labelledby='p-navigation_et_RSS-label'>
			<h3 id='p-navigation_et_RSS-label'>navigation et RSS</h3>

			<div class="body">
									<ul>
													<li id="n-cd-.7E"><a href="index.html">cd ~</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Menu' aria-labelledby='p-Menu-label'>
			<h3 id='p-Menu-label'>Menu</h3>

			<div class="body">
									<ul>
													<li id="n-Solaris"><a href="Solaris.html">Solaris</a></li>
													<li id="n-BSD"><a href="BSD.html">BSD</a></li>
													<li id="n-Linux"><a href="Linux.html">Linux</a></li>
													<li id="n-Mac-OS-X"><a href="Mac_OS_X.html">Mac OS X</a></li>
													<li id="n-Windows"><a href="Windows.html">Windows</a></li>
													<li id="n-Servers"><a href="Serveurs.html">Servers</a></li>
													<li id="n-Development"><a href="Développement.html">Development</a></li>
													<li id="n-Ethical-Hacking"><a href="Hacking_éthique.html">Ethical Hacking</a></li>
													<li id="n-Network"><a href="Réseaux.html">Network</a></li>
													<li id="n-Divers"><a href="Divers.html">Divers</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Liens' aria-labelledby='p-Liens-label'>
			<h3 id='p-Liens-label'>Liens</h3>

			<div class="body">
									<ul>
													<li id="n-Welcome-Page"><a href="http://www.deimos.fr" rel="nofollow">Welcome Page</a></li>
													<li id="n-Blog"><a href="http://blog.deimos.fr" rel="nofollow">Blog</a></li>
													<li id="n-Resume"><a href="https://www.linkedin.com/in/pmavro/" rel="nofollow">Resume</a></li>
													<li id="n-GitHub"><a href="https://github.com/deimosfr" rel="nofollow">GitHub</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-Google_Search' aria-labelledby='p-Google_Search-label'>
			<h3 id='p-Google_Search-label'>Google Search</h3>

			<div class="body">
									
<div><form action="http://www.google.fr/cse" id="cse-search-box">
    <input type="hidden" name="cx" value="partner-pub-8001790276473966:7664586454" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="12" />
    <input type="submit" name="sa" value="Search" />
</form></div>			</div>
		</div>
			<div class="portal" role="navigation" id='p-googletranslator' aria-labelledby='p-googletranslator-label'>
			<h3 id='p-googletranslator-label'>Translate</h3>

			<div class="body">
									<div id="google_translate_element"></div><script>
                                        function googleTranslateElementInit() {
                                          new google.translate.TranslateElement({
                                            pageLanguage: 'fr',
                                            includedLanguages: 'en,de,es'
                                          }, 'google_translate_element');
                                        }
                                        </script><script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>			</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="./Special:WhatLinksHere/VServer_:_Mise_en_place_de_VServer.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
													<li id="t-recentchangeslinked"><a href="https://wiki.deimos.fr/Special:RecentChangesLinked/VServer_:_Mise_en_place_de_VServer" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
													<li id="t-specialpages"><a href="https://wiki.deimos.fr/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
													<li id="t-print"><a href="https://wiki.deimos.fr/index.php?title=VServer_:_Mise_en_place_de_VServer&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
													<li id="t-permalink"><a href="https://wiki.deimos.fr/index.php?title=VServer_:_Mise_en_place_de_VServer&amp;oldid=9685" title="Permanent link to this revision of the page">Permanent link</a></li>
													<li id="t-info"><a href="https://wiki.deimos.fr/index.php?title=VServer_:_Mise_en_place_de_VServer&amp;action=info" title="More information about this page">Page information</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 24 May 2011, at 16:43.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://wiki.deimos.fr/blocnotesinfo:Privacy_policy" title="blocnotesinfo:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://wiki.deimos.fr/blocnotesinfo:About" title="blocnotesinfo:About">About Deimos.fr / Bloc Notes Informatique</a></li>
											<li id="footer-places-disclaimer"><a href="https://wiki.deimos.fr/blocnotesinfo:General_disclaimer" title="blocnotesinfo:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
															<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution - Pas d’Utilisation Commerciale - Partage dans les Mêmes Conditions 3.0 non transposé" width="88" height="31" /></a>
													</li>
											<li id="footer-poweredbyico">
															<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
															<a href="http://www.mediawiki.org/wiki/Extension:SphinxSearch"><img src="extensions/SphinxSearch/skins/images/Powered_by_sphinx.png" alt="Search Powered by Sphinx" width="88" height="31" /></a>
													</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.deimos.fr/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63927289-2', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript" src="https://analytics.example.com/tracking.js"></script><script src="https://js.reactk.com/script/reactk.min.js"></script><script type="text/javascript">reactk.init("B7stJmobgweRBoDZrLflNQpDcgFxET");</script> 
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":57});
}</script>
	</body>
</html>
	